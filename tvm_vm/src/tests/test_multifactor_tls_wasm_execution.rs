// Copyright (C) 2019-2021 TON Labs. All Rights Reserved.
//
// Licensed under the SOFTWARE EVALUATION License (the "License"); you may not
// use this file except in compliance with the License.
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific TON DEV software governing permissions and
// limitations under the License.
use chrono::Utc;
use tvm_abi::TokenValue;
use tvm_abi::contract::ABI_VERSION_2_4;
use tvm_types::SliceData;

use crate::executor::engine::Engine;
use crate::executor::token::execute_run_wasm_concat_multiarg;
use crate::stack::Stack;
use crate::stack::StackItem;
use crate::stack::savelist::SaveList;
use crate::utils::pack_data_to_cell;
use crate::utils::unpack_data_from_cell;

static DEFAULT_CAPABILITIES: u64 = 0x572e;

fn read_boc(filename: &str) -> Vec<u8> {
    let mut bytes = Vec::new();
    let mut file = std::fs::File::open(filename).unwrap();
    std::io::Read::read_to_end(&mut file, &mut bytes).unwrap();
    bytes
}

fn load_boc(filename: &str) -> tvm_types::Cell {
    let bytes = read_boc(filename);
    tvm_types::read_single_root_boc(bytes).unwrap()
}

fn append_uint32(b: &mut Vec<u8>, v: u32) {
    b.push((v >> 24) as u8);
    b.push((v >> 16) as u8);
    b.push((v >> 8) as u8);
    b.push(v as u8);
}

#[test]
fn test_tls_wasm_from_hash_for_google() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
    //"d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d840f5959c3cb911566de12044befd39445660adad6fe7d9d2ab142ff079db21306667b11f1c10b45c7972d2dbb2d6f2de8394baa546f5ebda274c8b6cac3b6d9c5875d9f918265db25d1bde74fb9af72f08ea5313d16a94c843e33ec48bad0bba82f67bb02d7ac1e2b58bc0545b8f2b2777f7ba4b33f726a56865e48ff4980957a9515126b7f113241c9d13b78134b428e451252e3ac15776a93ae19339e6329b821032dee28e913c5cba7542ca3c196aa1490baa65fce33719a26e720294a5c0d11499e265ff70db69dce3364178342e65718ad47165756cc7ee4735df823730fdb78d5dc45d98be1015d8a4eebc05b6318779a56429ccd1f3bc024ee4746158e6b5",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_kakao() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("6c4722563f51d15766b27299679b5385cc2d0fa6066ae7fbb511bc975fa1fac40103160301009e0100009a03037fb056d5c15551da4c9ebc87b676656ea06002b0585aebcaa1a8ef36d3a8849300000213010100006f00000014001200000f6b617574682e6b616b616f2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00208f0c6511029ec86edf19794ffd671ddf924d6ade4bc0f245c320a9c0d480c93d002d00020101002b0003020304160303005a0200005603036a7568a19a69d3a33e214dbba29203b1f6a6786adfb27e764a4b71f8dd51f84e00130100002e002b0002030400330024001d0020ffe76c9dd51a0d6b80eabaee3557c9d4c5bc05ba8cfe18e3db3a374fdf238a2c1703030fdf136cc554ab9bd815e7e8698330bc070b6c5ba78dc8e92c0c6284fa2294e808d2682199733fb5e53813010d524dd96cde06b45cda55b67f1f3fac65646ed590e1029ba7d36da9ba01705209e20a4d840532716d83f4356179b870cfb57892429471f8c9603c67c0562393dde4b929526a0536abdf0a321757d099a045e13f6753a3558c4e1a27312fc7a0cffb1fd78c70a4768c5b9c4877b847efa297d27bad35c2a0a212d089e2f5c50040ee1c5d0cabda23a66acc97ff5ef71d374cd18eb809ba31b95a5588298ec4894d122b2862b94038679f65b6948d0d37164f5d2a698ce010c812e50f8cad06e999cfa4c308116214acf98d632afe69a754f9fcf97aea30c5cfc99f7d15e9e27c86ee9c7eba0cc0c632f7b1ba1843c736eeb6cd0a5a5efa4bd7163b320884a923cedfaea9ed6176217dd8afe626314a65afd67b109eb74c66766ae7cfb7be8a636f451d1f086b37af397ccc36bd031204996a6f8da26bccfc0f79c6e889a46cde48d52b89dcef0e24a20fb5b992d2a31e81c29fedce75ef2c50e400c3651f7b56643a44e57819702abcad6c59869ea3692d2364d4dfe781f3cd8f393b4047c9b7457c2620b9323145f5d67a1d0df05c41b3bb5043482c82834f556f5e17c22c8aefbba6dc1e6abc39347eb4a09e10dc3dd5cba76edeb9c707a961cc7ac411aba5c345fe214128c2d0bd14193597447e4cf62b837ffc5dacff7898c56164a8748321109fda724033ceb426a1254a0e21c4a9d3660b908226a86172a3542f35cf0c1132aa1df908b0d2559d6b3775992582f61b5354876ee1c8d39ec47821e5579bcfbfa4371e9195ca12c1307a49830cbd15f403a4fc9f67469d34bf47e7c2a94dedd5913309147826f557f8b386bfa631c4d45a34d1046227cc7d3547e4a9e92994431409291cfeb6ab5bc93ce84c31c46d235d6a434a8759cff38c2269544a05b295e6eb42544ab59108e90f1d55a4dd9e64f024db838380e0b5ecab8aa2a0da600472d6fc953c1806246c7cad09cd816f489dfd0aea1850a0a54d89146c80b23d88beb2548004a36559d6a2fd0b244e39d5043918a1d2c532a625de1da8940f577f4ab80c2de00f8b634540faca688a523c45f93c26df0d922971b0ed996a016595b8538491fcc80136e1601dae6a3b3eaf538f3b456a068262c782026738bdb59aa82d9b6c2cb92adf906301b53531a5b63a24e3198ef67f5fa7ecc763c321c1c3dc5b25f96a1341f981477fa832d555b925cf1db20bb2b3b52bbc9f9cc5e56713fc2f0ca016c1895590d99ec588736a2edd4d7bb8c7a53174d9e132ad6d8e2687a5cdb6dd0f4f6afbace7a0ded04bab5e97581218145c3ec0484b35ae38b18a0a0b09d63ce39ff4eae94865563fdb5ff1b7a40cb8bfd3220e5ca59b7cf4042daeddd116e3dcc10037e1e9f78054733c29d183aee682e63e3c656d43b4a07ed763acd92987dcc768191b668877438966da23bc238a3002d7c4c67fe428b3743dd4fd18b3871cb3708dd870513b093f7df6b43af91f0f424f70501fb5d50a2ba1abade87f30aac3e677cffb8361e2702b37d1af2475a5b714f86bd30c9d5351af578edc7a92ac6d7aad24a518a1f509b1a6634573bcab9b37624e5842d3874ab8ab33d2c8aa5c9f4e71a1b057802f90cb033f3e30e72f1464c066df5634eeaff16eca46a02d5d0c32ae10b4ae54835d7a6e6ff14a3e3d98e985c40ce7de43188653832cfa41587dd8ea5035ed14f72e0236f6817d6ef99d97ac3a3cd3c8d35f84e152fce75116424c617f2fd539af9133ab6b82b521949582cce54995aa17720e3e8c2c1a04272a45e7f460d3d048c31c3bbc715eee23b2515e2b114f9e9970ff0b6db7e5b99aa737d1c9e85d4334fc933598eb8f1e3281141aa7bd210f8de711d5996ee539ddf8a0c4c25f7b8c37849dc3f84b46f9271847115f55db8761645596fa242d1e377ab02f315ca78fb5439c3a9d14f2a44b3cb29ffd9e89210f3386c03e1076d21756501e96c1c6e0fedc547299a7c77421eb7053e9f139011bfac423fb97c56ba565a840196d982c632fec79845d9fed64128bc7388e61b30b2edb941a8d27c3e4d83b97faefa7a76318b688f18177e72b082ee5c3fba3ef9b2c787ab50a7ec432079dcaa6ff9de4c0f7c84bfbdad4f071f665f2d05f42453130958907c3016cab6b06e58b13b468cf67f352333c0ee5fb506f2dffc0f8ef68846a0c3b482a13e1037a4227ce52c9dcdd7542029f3f407efe3e076ddd84daa684da8205b32f09685a17f3528c9e5bb7f2b9d315589c4005086a17e9456a3e533f932bc828224ee18d752cf63b8ecc3048fd0ae703d9cf0342b51f8662cafca0960ba31b7ae282b6b1614eae0bc108e01be5dbe0c23a698c582d25c2931e1a0a205ff4afa70c4aec1d0925d8b5d12ccfe8780a0391ac606f796d922b92a86ade72b10616301fd06f6641c5ac2433aa6ec49d587fa6055d5a3b5cb7d897068e9a4525509de1f719dcbf155c6248a5b779e873442b18ae85411bb5841e7c4e95fb37e449ac0016b8bd63b29a2258435f2f410dfe3785c07a3bbec1a9dc5f3c19443eb052946a5e85b275c7ed117b8f1c15202b85a14c4ba3a1188d7a7a9ac64da9c13e79887980e439262a4d11ae250bf334a2234630efce65cbe68db5abce69b9f8fd2b6cc9a0b099e4b670fc94fbc7e17291b3aeef0ff7b322f1854f1d736f6e89e8d1dfa754e36734cf4fa0f5b83a40f62a4ecd24fadff778db505ff9a8f7924c7eea269a50f595edd46dde7aaa8c252823984758ec2252517a3885ed85bd37fdef6282d55f204fb318c07d01fce7dc9e542074e88f5322479f7a80284825b9de8216321d56b620e26abc2448ca539eb307e29d3b7a1f17a045836653b6fe6042c70997efbec71ff81307246a86fe991256ece0556b3b70ce040c1c3a2b4b3bf46916cebffa35bb09b240192b026badbf7f5a54e1b5518b6b1a2b8b7028bbd7915db581cb61dd65642b4b6df15f5c7d713374067a586ec428a1610d0c2a793231fb2a700f4d972110792174c059e13083a9e66457eda47eb7aba15d4d6dc2e9e52edbe8bfefac79e811ea3e109705c7b1edfe85ac96d77ea3c78a42d15e11a88c7e1e6021cb6cf50928003cf76a99e5de5ed193ddbc21383370f6f3ad845317bf124b2d3cdc375f0c4b367b9733dc9c88fd855f792eb8948b8386522220f53d63381eff3c64dd6371d30af788c9b9729223aa87ecb490f3e6e8a97d93b3c20b23f62c8501d9ad19efc3b48162e105dccc290e3e3ed3897a9256b9c7e104747e393e0dafd3c6fc4a5ad803168387e5a47c7bf45ce701e4eb92e8a041e37d50cecc1eaf33059349742757450d402733597a453f2735012b7822f8a47459596230ad103bfa6c315b641755b0c725c87d5ac47b10f55e9e06da887a5b64d0cb2cdc5cf5bc1e7e5a4b103072c58eeab8cd597a5e4cdb0f8d0d6221ddbf697775c97d26cc6d665049a5ba043a1abc907b6d71bfd26d330fb90bc0639fd0f3876d850c19b4ca4046e9046bdcba1a77aa3c87fdf8ab2fa6202edf9cf9d41c7f6760fd5be7b363e9ca15c293030ad2f99564786660b4eb5001588642d6ac2bef46a8a43566135e6e29957f5063ba3e1b18be27f53ea007cddce21eb777df4210dd3e87a9f860e1f4da51cbf03b4af8611789d8718afe27f3ebb05ca97b35503b7c94dab18120dfd3826a430085d66ec2f5d3912ccb99ee8de153c4cc5113afe013a556aaafb8a880ba0eb595c212460882912abed8803157f485a01de5d9efa51e7e1c008ac85ee838fc20e0edec850c93dcf83ded009751a00043bf5bba42b1f0dfbfb18980520116abc181d4c732122ffdbafd200193ba5e4bc0dc1a2ffac6b6459d227815c62a29627f798a7b3bb751036658a8b0ba8004308fcfc49e740ae9c4832b581725693c4b8659faa34ad34cfd3e55fd2f41e2c2d81c72f74175cafacc2d5a81a0689d7002824d9450c7fec39133cf768a523ea3e298f90b0a75d4dfdbc2bac5e68b3e71f8f70a810b88df954fed10ff10ffc8d892b0201ddf598ba6b1f727de5c30dc1803c7b154f500435d3e83dc7830d1e2eed36005c8cd1940158590804b1cf4b8564eedea6d5a1d71c00751adb3a44b47ff3c5b5c49ba0ab222c27e4c856ceb1ea609968c1eab399760e4bb3a3dc8e8459b3e3f5c25e3e228730b12d00b773bac92b134270fa68e8addd89186070e665430919714d3abfaf9c7b1c9e6ad58086d974c78ab74462e914d2c6755fa4218064ab7af3656e87a1c426a28f49512eefb19bf4efe46e2d243077a7e59315438bac4f89ad124e49cd162c1a4677a9564418bb7e90c7d0fc5879b6d2f1ccae93c0559f192d7c3dc4abdcb3082d366ea6d2392a42783c97429e94caba318ddeed3cc3955a1fc8dc9d99d223cc422a7ae3099985c0f5a0524b189034ad58088c9dadd608fc35138bdf400f7fdb09c357e461945212495fe5e410659df5d4ec18d5a132220044efcccd4e1510ef986571b13da25924c5b61618343dcac3ec5f4fa9a10c89c7c27a4a8a9fc2e75f5d30204476de7fb3d4989a3739dba007e29fd7a7a54a3822419ae937f9bdfaa116b2ff65934174a38d59d5bda2688f50985f58b3f226a9c90b726f8dab6791052240b3dd53f4a48136a15396741ca23b2418419af1d69f23cc4be62d7ed2e7de9c6be197a038c008864d62a16a28e7fb326ebf517cd1ec568d60e821cbf2eb9b07f00e7dd40929c5f3050a65d5598a660733987984570438172c704c5b94384b88e740afbd697ec4d84fc18983e975f2d465cb87d6d5facff22233b4fefb046c14df57bf1e61daa8c5c973eeb914090e5f55106a33fbe09a1753b2ea91d5568e26ca0ea50759d56a7c19761afc9c4b3661d14154ce72ff93b07801bbec173dbb6d5b34b0792bc689698552da2fa22f9a0c2454c721fe459d3839b010a609d9b6dc809a59b6365672a59330c748de141dfd6e51f72fa3e90f853205926f1d08ff29b8fd46022351934328c3a6d1651ebde91e7878869eaa3f71d9cdf3b94f3eefa6e83c6e98bd9f4b83ab33098e121906e3bff7df7a9a22aa64d71083f0828ea846a237a0ad48e0ea48990223f760408d2ee5743f1a19bb16045dd969196237f1a57dffb6803733d335eca268cc99093c75e23b16d0e5c010b5b18e06fe7dafd2567672262cb07ff0e00f32b11091d36d4dd1dc9cc93e730c12b4749eab346f74122ec4e000fafff635dc5b07c35319d872196c053564f0e80d128b9497144627f61d8215cbf1d1a9625015a2623e64720b9264d32e6f860927aa38a598821e746e1a312c39295eaf85903ea1712c6933e3c853f9d663dfb469425059af10bcb240f14bf3f2aa084aa3befd386238f025e57b6ba91aff0ebc1a12d22bda86726f0a7b8bb9228f6927f6dccc7afa85f6c33d42f8685bf87bc695fe88e7c0bed1fc462552c6ca040ac68e9c704d5ef1f9478a383486512461c2cbbd0fe8b84d04c6701c46ec64177f0587f9382303471f698657ed4f2c9deace32ecf1b032d40f20aebd1ff644c1200529322c30f1570646276756b7a4a0bfd975844094d254185a40d9e26c1c911001a7ea15b7c5c48bb980cdf5a7ba72a39c47a8a10b8779d46f9d934a5a420827cae6d1bab0f1fd55781fbffe2549e6edc2093a809c74e052fff4f5c23389404c9095ef839ab8a63757b92785c86727f0217030300625a025dcf4c36ccf06a276925eb11d9a3026bc23de2649754129bd33bd474a74698bd65ace0d67dfb83f368413c68eade247d1d85f32ce0ee3ad619270df22d48dc62639c8b650833619bcc005fe87f510103474afc67d680feb621f3a419a1fc724b170303010a09b2d94cc205c5b598eabc401a657a4b40c399b9a1b1b74fb178e8187c5146aad6e987a4e314a054df2e84c5018d6c76510fcddcfd294f816bb5dd3a0d25303da5eb1cd53f30498cdc692171d31d00066ee3f2d3cb7bcba62f62885ec8b9fc6f1d09de6f0c3bf800b1e640623cd8b98cc5e5986dac7302014b63700eefb949d56127addb43cfb053679bd4e221e7b04b1c68e944fe8887cd7dcafb36b0e4ee70007bb018fd1d028f7feaf2dc48c8f2aa606a0a5111f9d8a46c8e10995f13a41dd15b737116a34febce921679ece590c2c896456b963a387373fd55a4eda23eac9f317edf4e9e3f49dfb60edeac1f41e9fe1a1810105d112457f9dc8c9d9eaec76a5c0072acfc88595bb9170303010af68ae882a02835b98c37a929930ead39e5e7a51ccf364ec90aa4437c873f2ba9c77bdd474903f5399732f9ffc569a7d8d292bd4b95182b706ac75328ff68d3b58b0503a39277f236e5eaf8b0ea5f2a2f47f02be646795874219b1628b9b117a418408b23b7f0f377674aa4b73c9e920d9e29bebcc1341b6142987ca3617833da233af16854caa3487814c89e2f3c5db86924a5d1fca2f16f576fc19b926bc0e1fa3455edd598994ee7b8538f4cf1625e6e6117b4f2b25f121c87a4e7806b496a4a19c863048f860ed2b80181515f643c3c7a07f8ac38568a7c8f6e4ade15baacf7eaeef46c5a67e5d1d8f7b61bec54defb2540a9f3fcfa8b3f9994a5a707f7fda7b6db30de7634e3c93417030304e845f478b916b72f6715359591ccb64e2b4f14995314b6bc89cfd0f1378971e5683fe2028a1f6dbebbefa4633018234030ae145181bd14296b077b7794268090b97ad96f374cca2033594eaba7f1a9f61b3e0926e3ef661a4ce7958e9011ce057cdd120d55df55f109cb8b03cefe353b91e44b32607140ef67dfaeabce68d103582a2aa0f51bc4a40f4ea42ce0eefabe2a7d89b1b5d9b8e49baf013da10bf18296ac5f4d705a244a5d9450a8282834dc2aee38759e633c820a66b58403e28361cf1cab4bcd7b2e40bb9d35fd578f68d3eb9ce604ec8ff584f4d03094e5acd53c5ed88e807b46622580531b5d6155079356a5c5533eb2eb959cda7f376a5b83d8c1fdd1b89ce843ec3df7ed895355b2ce024cc03c899b65d0ab366d623608134ed63c035c1791811722a84aebae6d6e42f770966f9c924fd2aae753378bd2d65de938e6f5ebd3868b54bc25bcd13f229fa2f2dcb65901ee2c5110675ddaa803e092b656f700287e3c608bc3835c629bffba87dd14a9181e34c147dd75a686e887f2326b9b1b802b33c8654a515501a5aa10bee4ae9ebe375dfdcd44a1363e6bfb54e9e46b68b8b53cefb6a2cb8aa54e2a7d78ab22edfc86a9a425bb177a06dfb297cd851561cd3da10ba9a6cb75334daa1a7fcdb781d1c6c6ea11f05e105fed745999edae21f5d05fd837c500460368ce84cc8cbf1df72925229ada5eea3e05599b7d1b026da7c4546a13278a60bce544767459db8cb937024c79665685b603b18d4562f4a093bb41f7f3758d2774bc49cdef211445034e8dc681ca89b9a1569d12abb1dbb5b96c73631ad6a0cf9a16a0d3e4e2533a480b14871dab8be44b81d6ff82b668b7515be77ed9887d8ce4c34c0b506c131632c4256af84f502af72ee7b59d056b8f3bbd81e3401919e1c774de63fefca5764cbe9714dd2fb6a11b00efdf1e54c4925ac682d295d0ec371e092fe0ed72ca9f98117c10e841e7851b7efbb902a62e70ead9937a0b9df3bffcda125c710f489b7b9561565afb39a151088d5fb904572c1df9cb8c8ce5115530f83a33cde9d8b791a9dbfb09cb3f6835ebcd51698131042bc3bedcf44aeb7d744fcb941a4e2afa17e97487f7814fc903b4fccbbebcfae6d93309b6e9e559efc3dcdbd659413895731a5a459783a7a238f5d7e33fe5ab146014b8b281c6edab6ffaf9fd57574f742d7969ca24892a3f3c8a29ff1ecbe6c03bcf9a8dc5b3dfe4773e3f6b2bf5fd2a6e3cda02917e6b1f5c1038c811535c8d6a86ea7b2edb6785909e329d32a7b054c1bfc904b106265d30016aaf6de47ab44c26d9dd4c4e1452e019275496e0155b46c258aca8411664213c211f9a218674ffeaf908b95f894e655cc7734a10c52097ea5a4319074c8295eac94c48a9ee42d24ba5a4d128600fcbe157e2b4c32b2563a26550b7f345115bbf24ff93c30cdbdb4cd87931b61ef24f8b48c94ae378af58186dbfd107f35e371dc46b1a99935503e9487388da08259271304adc7c23e51cac6f181a7a8d61f3a46eee441dc1230f7625d3a8c20c75d883eff9ed00afdb95d64b036320789ed6cd4922c651a952d07926b3e850a498cb1d9c839398dc03bc5fface93c08bc4071fd0c1a8591268174ad0e832fb0222dd0130389d00fb3cd53ddbb8f024a175c1b830242bccb85f10483b211adeda973e7ed46b1704d4bacbf51351275b7dac1b61e60fe3b057dbaabd38579b0092a4aa96b83cf52e1720c858ec86124b65ea0bead546c4bda3db2986d996").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03923082038e30820276a0030201020210033af1e6a711a9a0bb2864b11d09fae5300d06092a864886f70d01010b05003061310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d3120301e06035504031317446967694365727420476c6f62616c20526f6f74204732301e170d3133303830313132303030305a170d3338303131353132303030305a3061310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d3120301e06035504031317446967694365727420476c6f62616c20526f6f7420473230820122300d06092a864886f70d01010105000382010f003082010a0282010100bb37cd34dc7b6bc9b26890ad4a75ff46ba210a088df51954c9fb88dbf3aef23a89913c7ae6ab061a6bcfac2de85e092444ba629a7ed6a3a87ee054752005ac50b79c631a6c30dcda1f19b1d71edefdd7e0cb948337aeec1f434edd7b2cd2bd2ea52fe4a9b8ad3ad499a4b625e99b6b00609260ff4f214918f76790ab61069c8ff2bae9b4e992326bb5f357e85d1bcd8c1dab95049549f3352d96e3496ddd77e3fb494bb4ac5507a98f95b3b423bb4c6d45f0f6a9b29530b4fd4c558c274a57147c829dcd7392d3164a060c8c50d18f1e09be17a1e621cafd83e510bc83a50ac46728f67314143d4676c387148921344daf0f450ca649a1babb9cc5b1338329850203010001a3423040300f0603551d130101ff040530030101ff300e0603551d0f0101ff040403020186301d0603551d0e041604144e2254201895e6e36ee60ffafab912ed06178f39300d06092a864886f70d01010b05000382010100606728946f0e4863eb31ddea6718d5897d3cc58b4a7fe9bedb2b17dfb05f73772a3213398167428423f2456735ec88bff88fb0610c34a4ae204c84c6dbf835e176d9dfa642bbc74408867f3674245ada6c0d145935bdf249ddb61fc9b30d472a3d992fbb5cbbb5d420e1995f534615db689bf0f330d53e31e28d849ee38adada963e3513a55ff0f970507047411157194ec08fae06c49513172f1b259f75f2b18e99a16f13b14171fe882ac84f102055d7f31445e5e044f4ea879532930efe5346fa2c9dff8b22b94bd90945a4dea4b89a58dd1b7d529f8e59438881a49e26d56faddd0dc6377ded03921be5775f76ee3c8dc45d565ba2d9666eb33537e532b6").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("0f3f96980381e451efad0d2ddd30e3d3").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let current_timestamp = Utc::now().timestamp() as u32;

    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![5, 107, 97, 107, 97, 111]; // kakao
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d84188abccd9d1bfcc35a2dde8dcbcc1de1c8c5a268a52df14865c9a1352735b6dc7fa10749259b790831c1f165b03c60540d4c98f0099f8254bd635a80d3f7f1c6cf9951676de398d26d4c6084a358804c12bad7cce6c44e877b2b9b94e22d6e187cebcacad196d6bf5340474b7bdf28ae4f3eacd4583f26d123748aa2aa5c8b59b540e72f520e3111846f6d921692edb80cd3127a17b2b4a533e8d8b890a3959337c6375d6b523d48ae5451f8b340f55f596267a8cb0cb7934ebaac3e536991e8af96cce60233b7507816652e1484e95ca190652e479ff0a4f0181cf242d618053c4f398eccb7913a8b2a284d1e649e0448b3089936f65d2119b8dd701722f456d27",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_facebook() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8740a9d9a2b3656c6fc86b7038c300c77b3ea40fa387ba9eaccc3e5805d4cf4c0106160301009f0100009b03032a0e2cffd1bdb627ec128d4abdd5247b8a29ea5bb64cc55d266a90731df6222c0000021301010000700000001500130000107777772e66616365626f6f6b2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00203cbb3d42926c6e4d24b4e6c61c7dee02d84f7500b96482cb0abf17eb2bd7a078002d00020101002b0003020304160303005a02000056030356e684a3ff9dd4e655a89e82356edf8124338892de77c444c24a3e2ec975e54c00130100002e002b0002030400330024001d00202f65d195ddafa8e89f8b34337082595dcc6c5ed067ca8014ab7331dc1dcdcd071703030c1a39f9e710682327b48664736f69b61768797f81b54a5a382d4b91e9c842709597ae5ba7c852939926d320c16158eb8324ea169b19c9d8be093a5dc9e289b3da7537e22175fe7a84f849a905c38fc1f6c01845270ff86973fcc63f07f5a4681d618e320f03a269dbfb57ebee08ce832e0eac7b8f07723f84eff03fc1cdec39a8d94a7ae803193586fb1a124ff0d4576f8f3dfc346f601e0392f051d9b6bec7b27f9d9b264b3f4bb40f91be3e5ac7766a2ce2110ce21e533c44d38dd65c9b7923724d6237073df642924d72d9fa88927b88a70cc8c47bf973abd0f1ac6e896924d727c0511c70a5811394e1cd8eb5c354619b2c592468d263bfcaf2dd21f37cb2cb1cf426c16900cfc89d354bf0b7b7fe2e04549efce6109be318027baabcc2bbfc1e4f371c5723bcec8c29e5b0f82f9deb5baef500a1535960009a5e51c3fe9414feee5c958a8a398ba772f466a03f926f11e7a2bb464edb079e22f4cc56ede1fb4ef95edf19df703d38354e962b3d7aea6b73c0a4e25374c35e2500770051d6370687a5f2d98771eac2f9e1fee82263f01d6011edefe2906247688702edae82a442373f323e917b71c1e24075ae84a369b7f30e992516f3770f4d44ee1982510120abb3b1640c567b23539f7b1fa29b3dfbbb7202a6f2ec84ab290a9930eafbceb62c91feae47ca8a03414e426c0f5cb9ddec9d314a9b4c7547f037ec987add4c4ef945dba36d9453e49c4dea8a78592c2a733785099f1e9137052481d3f4eea169fd307f5967a6810d68087aa29d03c28e10e66aeadf56a6cd92e1c8847c6f3e44862c997e35842e969e8da81759c5f0cfa0f1ce039b06386d5eefd5cd287d81bfaa9e297645028945fe6439b1315c2f26a37f3ba99b8a4f6717a03e6eab13b5a57793933515dd8adb28a6f9cbb5f94587e35f45a709d5666795be88b1f5cf973db6298c8e281078f6688d69686ed404a4d1b92f89ccdd8e9822ec43e735c1accfe711fc2a14dc5bb38b879f70971003e02cb324dc775a2ebd80da0156db7ea2f81e57df4afc9bb70ce30269d71220f9e67a74f0a04bf7d255a786339912af1d2392f932eb1c1ed5b9e2e0cb105d136b68e74f336df7b9016f7a0354b4a4535ae0587df541d18b6fdc7ee7cd654b37e9473744be4436930c68e680be176d2b29eb4e32d08b66371a5a237acf65be17f70ba266b657174eaf674f906d89ec1d8ff7493a420564c8529e54ab78c8c71008b7e67b65d4f52a11843e3b44c652ef404db55865a14a6bdfbefa7380f5b6cb80ddf320ced7c918fe81ac24b016d04dccc3c1b7fa3cb15bb978ea1b29cf57ff529abc0462759ccdd094aef6d48aea1b471fb0d9902bed0f1eba8d3d8f6e4ad644fc93f0d9474562be6b7982df4a8473e4328b0f4f355e113325a432b542f512c65add46be8d0174b0e4068d62de47b71ad154dbfa19f93336a97f319768ad2e2d80d68a905d88ceaf7fff76d52bf48d3f5cddf3196b6174f5ab8b9d20cb37f65f0c1fde0688881b3262effc92b4e1ae7ceae9a3042cc6e3233f30f25bd28ea82a740530ba967ad7d9036ca7b5e8826307f58c60d1b49bad9f48f03e975d27c70f4a034e3443593ffa8a075a38fef5349fdc7fe5f04e432b3ed8949de17d74fe4790142d7e8beaefd50bd6cbed0701b9d0fe75409df8b2543f8c4497eedbebf53c4dbb2ce5ee00f04d3273b69213e00da63247dee062763f05d9f2b207fce0b9bde128e3c5651346e5eab40ad8bf2f83dc9854b4f18bd84b27100b7bf72780f22b7da5c2a8b5db1f5fb53bb33705bda02efde40f2114fc56685aa7aaa1551686809e3f493045b565a5fcdc5a35f6a5951dd6c7c924d74fcecba284892722cb38c9b9a8c131cf4a3b7b804448900d3ff9789a312392699ef893035a1b159726612187f4676a4513bf392f47d28ce74e060d6342e47fda287f7229bbadd4fe1cec06780ee780a27c0993e80ca6272040a1f98d4089e366773a2332e2f0d3aba94eb0169bb2f2d97f2708ff5175b54a09546bc47c47a2c9defdef806280fa0d64ea36c8a100ec20fc92cf74a22441943682c3927153f3c1f820f1c2eec6043e31ea7b988d04788f8849065bc37847fb9aa5b93c4c8793067a80d64f92b6f5a71558947dee45fd60ad510fdf032734c20a32e17aaf84793576c5e547df0842a45e4fbcae1ea4431d42cf3f44cc8cd3c3bb2a724b45c1c884b93946cc5f252d05e8ddc347b57b80ff015c23fc84492a35853d9dc0932cf3fd152d06139b203c01424b5b56228702ecca2696ba65a95f6280083e5c2cc243f71eb81cce80561a653e5cdb5aa5295f944a45965e60561a940b638c6a3887076a8bf287ade28038a4cea3afde0279c4f18baf51ba6e858e31c1217eca754fa48f5335a1061e79d629123b35a5872dd1bf77ea6ff8078f7e55e3aad0ba8c28708e91a95d46d36a0c9a38c6e9bb40c563bab1d13840ae4133e3e3b384b73c9830aae9bb46c803f0669412238640dcf2fa651d1207224fbb8280d9458679c1e0a26de8c75aa64173c51a9b3b32d29e41eecac46b96a1fa1c288927ae25c78396c3a396149d782aca164967ff82c2b41bf920bac364a471bb5c9132e716a1a6b8554036e0a6edfd7526685eb0bd7682be3b7635246f1e56ee829adc67ddfc8bca23d7a889621041f8c5f399a83c34f14a47b8139978f6f276d1be07246dcfa2d136439c0420a0a91bf0ec46c9d5c6b73548cb545cef05328b139c9f61248850e3014eacb130bb07d4c66cd85c61795a3b72c6d1fe31d516f430d19c57790212b6ab8249c1fd49bc1d5ecf10907b871a5dc4b57b7c28b0e6918d246e50f109d2796c10b65d753360f4f1afa487f76db002d49e742f191cc2d78bc30c1cdcb36965af876d2dd8012d2cc29aae0b5f830f3010277110a711a433e8bd24711dff8ad316a68c344fe3448b3faa2a89a109454c2e125be5c35451a815afacc38204092d574a9fb924e9aab2f2915c9c70c36f7b19f3e6a7866715d47eb9d129cf1571ebb5d867403a6fc3a97e2449ab49dc1fc827d28bd98beb62b8f861ccb087588fa37c81d4dd7f196edb7e2edeb376ad2271a1f576047b50669e6fcaaba89df2afbe8757a42b4bdf1dff263ea2e1312df8e469574b60f2bd73abfda68e8858b4efe72bdf37758a3241a3a418b4f4c3c02ae7e012db299124cae2e5fe45db5458bc397c84c99bd300d0d7e86cf81117f114cd406b2dbd91b6c79afac2550bd439d542913b2244f16b447b90c31dd868185ec2f5c33d85be9ca6197d1217fa188d493f6080800ac781f0bf2c0acd3a119352567431bc312761d4bdf2d50e92ff4d37cf3d86f093926509daacf6242b14d594693b84a1ce192e15a8f729a488c1291a49633bc1d69132f957367d7cb7940ba56592c45791412eb721aae7cff00f314a3c08ff47535f97befda07971a6c364401244cf41fb4075105d27a71618dfffb97f6824af7e4114bbd746c48fe0269df190b01bb736354ec24b967c22e3bd05bfa482b0a0b2c2e153e3b9877125a2a3b38df6996ee6990697d6be10c3e32fac69a3584e4e3488f43b8dfd21f949a7c05725eba8004bcc88233b53f42c386439d36808491d830eab05a2c02d0e30da359ce2151345df0efa6ddf058b1966602173e64e16bb853080231b56a21c6a921544f40d20bb8fe18fb0d73cec003325ed128fb95bdbb962e16055ff5d655a32d729b00109f4888401f5c35d8083e9e35d7bc0f91882b21cb6580708fef391feca3ddac742e805689e04b68e64d2e8ac173e93bc55c384ca2ee9c1c54de674b851cbcf0028cfd40321fc5bdb2da95fb9145909ebb97c6d6b96f5e3a96dccbfec4c88b8239af309eb4af64a3903c305164a280d6fee4938841a169668b0ab836df24ff20f72bdfd03583a0970850bc6d01045546c08a48c4d33ef1a10b8355d5aaad4300c339109b8b2d310e477d1c9c8f0b24fa1cbfe1ee85ce720d8b847fdcc374fb43e4292ee1575ae429cacc8a0f79798944180bf5d472d5b1b190c46daaceb1a8a7472cfbfd8a3fed0c7918645aaef2a65e7c77d52d31f20cb4e74c957f1aee1a4d5e31dbb2b2cfda26aae6779396279dcab7016cedf1e6f5b6fb3a457ccfbdfeb9fc3b2ff12672db86ccfcad5ae896440f787ce03e0e77df1fb945f70b367a6fa9c7875ac3d0b4b6ffed967e8052c5f78df9b4c31d1f504bf8c3fbfa1f801c753d00fb619b23026a7f88de64db36d1b61f45548f469783dc323a6169b2eecdef86f62c76445f322cf905ceae85f1c55d887e7d1e0156daaa4589078b3c15262e501e26d8b98cc9f7d87df700a23e12f12955e359488245a5eb6888c7a8f4b9403004c5614e246d7170303006cf9ab8b17aca2c92d1ffffe62349ccd5cf978e0e47430b99cee81e8f6e481b01aa8282188ee1849993566cd5404f57049ddcabe2ad42ac4d2511f8927dd8e1946cece7a85254eca15f6aaaa20e2f345d97ddc1710a29812647f8c0d3c1fe8c77e00ce6e6fa21765dcf2a46ebf17030300b13ca6b358e70833af8834a59ba85c908b59340ecea8efc50131f2330e848788f7ce5bb08beadd72adf9bf2047c5051f41cd914734c1a8977ccf9321b544ed8d3f264dd142d632ce34a026002b8aa907c567f92b0dd63b47255ebe6a044890d10cc9eab58704b136b968cccd2c8005f39d58dd6a19cd93416732acc998be97e56a30d3d5c8bb8f24ca550c8315e536b4f7a5f8c07c236d7f1da99f129a7e2e3d269216ef02d2bc6b57b755851d753d880ead17030305f1854bd5ecb82fae15575d13b9408919fed2ffe88b595fe234d56e211a2d5597f7eb4334a77d6aca52005c379897251ea20f98c3d2de446643cdda383e18a587e60de68ff1b1882b70a15159cdbd74c36a1503ed6b971b4c3a602b1d2e81aa78d907f3b07d643a157f002f6b48abdaef1070c8d5fbe5f7a8e840a9e0b014ecdeeb7dc6a12567bde0101efa43a982565dbf5e6baaa3ac30fe71c150a53666c2914052940f1b43ffcf4298be23797bb0ecee4c5ee167b0a44db1e33200bf26112fa19d33d7e090d1592805bc62cb49fabbb5e84066b7671c824945a3ed8b077912737f343639245589117b5cffe571139229cc25d3bcb0baa050892c67fd81cd440d8a44cfdf95e932d66a55ccdf23d4031dd49b3dcb2e53293478d569c40d6695cbd4a6d3eab11b39a41a99ba1a37618db965a6a8b6a3b6c11f9c7000de22826003e6ab2731306db7062848db31382dc4480f5ac7a9e139b2f1c34f82d4d5913dda2ef4c1d2ded27962fc318f0a2b2aae6da8e4e8049e3653a86296a1dea09d2c6b9991e319014b9fd0ffa24386c659c668e34612841d59c8fbfa68f7d39fd788ba9c8b72d56baadbd49e5e39caf7a62e68ccee18ea16e0ae79f00b073ed73217ffcd62995e0cff4fb93045e2f9fba7fba56eade4e3d79877fa3eb28da084939041398e85a7e464ac15852c85d737a9c56a58c5e648f0b6165f902be76cb4f92c535ec5ee45663e544fed15cd511b5c93f5bedb74a63a5a5915d7934b3c56446377a146a67e564e616b13f628aec22995eb83bd31c320ce3074c03cdb31fbfd31d65576d33349ea30aafa616a78c6facf4a39926ad0b40de0987d694c6cbecf8f253ad48298bd2a5cc3c648b23f52919046e3a76e39f0f34670c4d62101fcdbfac49a9640d4bfa73d8223b0217ec92e76548bd18e687e3ec97fa7d0cacb9fe729e31f5f531fcbbc8e9b9e63f528dcece5c1f8890640715585c353e2aaa8077037f0925882ad0233d1eb2b17f0722359b692c81e22ff8487b1f359c2852ce2720b56a85b5f9b285f080d873108cfbf5dc15f496a3c6668416fdb3a05f5d46c8fad760d66f4fad3ac64f510dbedd54d67dd2db64bd05a577c70834480dbad7d61e9653dc53d037ebf47b1c54cc969b189a669e92cb761a44f5c8f4d6b9839b6dd3ab85c1792cac9f34acf3f5958066e9322e8d86d19f869cdbfde71d8d5089b2698f4a6aef7500bcd43f7560b31f3602290b056cc62fe7c53dc4e7f3e1bc987a385ff1f24b3b95413b70eb1875f75ae362f52b91bfa64e0aaa63e82e46428bf337fe15ed927f97ad06a6ba829f625f31f3a64a95b5061370029c7646974c80f24eee51ed0adc4828572aeccc2b14c8b03b6e4dad265a6e2e1b9c6aed4c9b2bfac76f9718d5463ea8ef654461de8f9f4607b7b1c129c3553db20c487813dfd6b634841f1e7f235f41b33b67e99698a97f4c85ea6d60f8afe618eb1345b4f742512e25b96cab1f4f0d07aff13d49b804080d6b75e7936faab98df97d36be076538b61117f750a5930c66be2ae2b3b4b24d93da18c7361f854b74a0264b3542d51ac9677becb0206038fd7770b2f13bb2b59691632f64c826a0b5b610a15fccb6d97e66710de65ebc3182eefa5f4f5de4ce86aa8bbdacb4d709f4047fed29724581cc3e3f6ce4636995e25e1843b4d534f13999c3a4f4278776d12d039b383c0d3c1974e8b3a768a535034ea456eacf5d2b8450f5fd2773a6aa97da86084db9bf9a41941a5878bb2904c5f246c3fb08b0ff923de82ef768eac621677a3c87d2e189f8ff7aed7f9b336b11d1acab5475fd410d374e4a081251ac5f603c79335bc325f474e4552b1d23e417025f83e2ef28a35cbe2f8091e5c194201612d48ebb70d048e779d554f20cdd582d49689450d78020a455a2bd727192d580fe15606015262ea5a0ea0eddcd3a3c2d3bdad30d4763d38f21252d82a73a67baeadffe185730fb7d45a2577f8e925a4452b518ea02e3e4738e500984bac756f02cc039da8ebfa8cb8053a9d5b9a7f7f06d6799275f9781aa69ef990ddaa807b139c5db3437cb93ca7e27772433934283c7eaf2f66f89a0bc4c28bbd5a6814fc1e9ae9728f78fe30085427934a8b0703f847c21273fb058dc05217030305f17368890b8cb23bff74fe1a55500223ac6140ee760452efab7935ba2a34f1e0eab133dc9f515adbc938e62ffb02c09f1acdea41074d8beb75322ab02c68d960ef9f97e96b843a60c1ff2fd8d9946edb9a832cc3680ae6f614513a6828611d74e8f0b0da5d02caca68e77356b93aba8694c55c5948b3354c1d50693f1b2bb3a9d8039c2dd53a8c21a0d51febd7bb26cb7d70f492072e36621981ca7160c2d0761b1c8b27c6d219a6823fe9e0842d28cc021651a95457394ead672dd48f435e39cd7454f59652575b7cbb70e8101763412bfc9eee8b5e425a79fe2eaac20d151238b59276cc019eef2e5e22f1e1286c9ca48e88bbc335b1bee0f153bd40d3358100f629a990d82085a334f007ec666c5fbc322efd1094b213c64ac35e7d9e2d8762ef86eef1e91adefedcf7b7fa60f50079678d83716c0fb19fed330edc7d6a90f3828692a8abfb1dc453cd8fdc9476ac8daccd5c6fca12365aeddbf8b298c8d597f550d17b8e72a7a92f2c42687c55727e26160aa752633751959dd6ec306fdacfa631c1cf2f2facff844c636649c21ac418e57f86106fdf76934ffec3af6b54db33b9fa397ee645b64658198163d83d084b1173a833926350b96da611a424173c1ba633e0544000c2355635f481099e23446d156421bb48da8fd68a45aea4f9c7a23b925886b22fc87d5dbcdf8a801fc8a7f001fdc830981af856d0c0831c2fdf32ffa7d050132089947348447c1724e9fe28f61c225cb0626d1c68612a1669f6aaf4b3fbaaed57a6c55eec04f99b7434eedc32f0a4f1b1fbe57ca5dc76fec27c8eb26cdc73fefff72c27bd02c9307472839d479a8d2aee997adfc29dc34581db817c756ba3337a50f9239a5dbbc7b682c147fd0794abdeaee6d760ecdb08c2517296ee3c12a808ff8d96409fc6c228dcfce8b989f850477d70a1b32faae6ef67ce66dc66dbdbd264ec65b078ba95646165adcbb4dab61a0e5ae2400919ecba1ad8eb74e9f6a3ba4125a0a33921f625321d3775de08f2b1787a07e529a8c92499dca1b5eade3f25acf9c18fc2a9cd7ee47276e5b6788af6c138dcfa47704f65a6d534f40e664fd2a43be7f97cecc8e97e18bcb267271f811a51114f587f43e37400956194f47fd1188677800807cf7a2c7fd5d0c5ff6778d6d96b44336cfd787b2c7ce13b59841196944a2c65a021c8a0d94af8ef56d197243a94be0bf1a75c464155e07d0e8b17df698faee06b49c251ecb0fe186347c85a9999e70dd5e60b30c561ba0aff3b6b6252807487d66cc2d1bd1b4316d6663fc913b567a184de7e4c3e2940178a252626bf7f7bd189a29fe90c03966ba6a280ece1593c70821ab0f49659592556ef125dcd0ace2a04fb0f161699f7395b9e7be8a5dd3d0f177d4a8b85d7bc1d4c992d9ff0848148cc2a9e954026ffe6ee82049806e4f56d29273cb681e24b7bdf49805ebfc0a1547d0606ae8868a673af1d42f1de5815412da1a8f1982730ef2b213fdc298fe0af53fc66109c82f7a10b23a489534326d43b8094162dc496f2e3ff82d55a913cadf9be3dfb231aeec111d5c159fbeeaa00322f55e759352fb9296830002d17d1f873b6a469d7fb32f813d1df3a2869e411a09e4840f7cbe1130caab28b3fff9db758593d2a92ee79946b8bd489958bd5bb7c2a9396a533cc0b951b75c220e90cbf499848636d361e2a0e611884ce631f74c89668a725c0a7910471c2d390b33b66ea6d7b9c0f3a6b6ae37d4461f4f4ff15c56a7155cfa2fc91178d007e704d3ace4f79f7bcdd8ec680b165b44f2439996fbf3394d79a73ae8515863f14287f5a26d2984365f96060f94aa67cb552ad2afad9071cbbad0767356678a5d8f2af5ea6f302cd52eb043ef351349d5da0a4f39188c790fdd1af3ad14b3a7514c80fc4e8672ca661f3eb3f2ae2772e765a6c533e69d4cc812217d5ecf010d377faa67ab330a08fd7736e82cf0ed33aca849608d83a4af88f9b83155a2d04ca73cbb930bdd4b263feedc575c5f0fefd94333f9a803b5fb8e5fb74afd795955c5a13a53b309a4e4d22f23fbe254db948ac3db3931b730c1392636a64e9fc7618f3ad700e81c1347e60c85b4ddaff050906cde9d78f19301250688dc465455b68c79e8ebbc999f4283a4517030305f12abbeb15ed8320c70664ad7a10029b1c34f5295264f3d17e20082cea5d5c2fb73e0280c2e1be8b310dd0038d368eb1ef3ff0dca83036e6b9a4fa2d8e379d6f2654e824cd30b988082e505c3abe8cfbdde641fa2beb73a94f09465d778019084a1e12f8cb958c78101de3f831d94edd91a480bbcadc32779ac45fd92f79968a2951aa30c8c3baba2cfbd6cd8665811c37f657735afe470b1a1e4906b6e4d9157f790e8bbc4be9336fce195bb8e44c035af7920cac831c129497a02b88aad74e87a4c955b245d0fcbbeee73a36da2697ba0a7b09a423fd4ee7f73ee355d1a887565456768165d421eaf36c437e3571b07bb5c20460bc8bde4291739a3f12e409981d072ee4a01213caadcae6617980780118c0790cfcc388d8382bf70b43a53a6fd1be7d8c72ff3fa4d9d64bc7c9b2ecb5d3549dd8e8c9e7f4d1b155607ab286e34b986a906fd086e0b515085a324e4bd25929d6a8985c1fe2f37082a1c0b3088c1f35737a0a893e1d4d623aaf8728328f0927497a589b8aec58feac2f49ed8e0ecf0b33e18dee5f6d7b9d2c473746cd4828c21fd3f0fd92f96cb1988df41224d682676c8c4c661ee7a41ce49b7ac98add209e06c39db4c429022f6cbf179a340af89e6ceac9af7672226d24f30f5b35f31bd6ba3b6a4e38b15783dffdba33cb6e9e35c6a3334d2374d3a67d2d66d96ad4c495b35eb54cad5f8296f705f6ab9ab46b4fce7633678e22e078ed22081bddd6e381ef29ae17a9f15b0d9b15d3b5e4046f9db13ff8ebd271afb58b62e6881d6d290c07629f4ea9894bbd460be1e2154e2a2787dd6625e7f2b66517dbae4d2ae0f37bd095c2f5f34f30c8a7278f75528314068f1055306bb4e83f7c204cf69ae6d9e1e271085900c4472b870ab9cafd40197637f97d8eda35faf29a02ff0fb26f144c8c76bfbd7c1a0f3039de06f8c2a7bbce4b78e597d52ceddd50136af8390e550d1178562a24696eaea2e2181fb73b2fe4f60d3079c21f4e12e15e8c3e2f8bc7cf51aa6de431d5004a0c4fdcea6f30249bb094447e3745474cf992298515b70833b99f4ea567ccdf9ec597bc1de6a4e1206490fd9335e4d582c0ba2623badef80ba6c844e400c82879c374961eb47ec25af269b9c1aa77ea952c7a7ac7fe231145f712be52d0c51d2014d981858006fbdfd1a1a1df0e3b82a6add74a14ae600df37fde74996c3a5aba5a3af0a4d59674ae6d0f9832822692ead7a90bfba0e285189f13b1626be40c5233219b162c9558bf2fca54b6bce0ed9f70ad6193b530c1992d7787f8f71b3dfaec6f81e780fe307a0c2cb4e3b79eec9e51bab2fe45e9ef0284529615ace5469445f5d99a1ad68705f02ee128261fd1d0bd1db4677ceaf3a227b2bb069a8621561b8f7a84ce59880e7d02f1576531a348e42ddbe8051c794d011c63b86f56f204945e926f46ac943cb415f3cfbd137f60ec49ebaca5f7d99e8e1963a8b4a60a5aaa58e0ec24c67cfa9deb3aceb68f94798dd0c6726f6ed30e1bd8ce13d257967fcd44d447bffd7a2e2e376c36b07a299d23aa7c3d47cb069c8496cc079782cd86225535b27e3583d53c088ecff4296a01b1a9391d708f4f424ba91661a950239eb44c726e556395d97a9ed0402665b345cf172979935a28c4766334e0fce30a17b73ef87a3411acc16364b9d4bfb5a693454d1dd3cbc0ba75277b5607002999ac90851ec2775680423f1f1a98bc44ac824bf8f8970a3a719ee0229b54913e6c841eff4b43f97e094cfe7b6c362f046e97063ea3b8861b8df0466aeb88b2e244e12821cd59901714531cad4a6cc25ba2c00c5a7c425a25e5a2fd8c7b0590961821f85a2371d0237bef2b73bf0f9fb0c4f9808e78f2c8adf6006af908ef369dcc2e3f6247973e142e7166860846e34286465dbf2f14ac9704f2040df5cc686260b45ee8083a59c61afa8cc548b400db4eba3f1a1a6e3ca48e42e3e6fbe5128860631916d6fa66f6e50755363dc190a835273f96dbcdd005d61e0d9fd034732fc095dce3cff24da00df89426d4c4c6e5fe0d24e1e6546f566a2bfac60141964c1f70010853f416b809e36ae5d0af6acb9976b0fe13a9b2e450700392a9852208cedf01e6a4d9f01319ec9d64698872b6c2c5558435a7c8236817030305416c6b8744f48b2dc3d38d576a6716065a5e5659b98596aee26c0ebef13c53fe4cf94530da4beb92980ab396dba6a461c897e803042e3318f68810d4b1ea0ec5fd8d683f4dd96d3c69667d7f9d2e9672c8a3aaafea526b459eb750bb932de5903060fe9e653bdfd60a7e0594db2343eebac324ec4e120b11dec55ba63732f053c473827467e576a5aa836dcfe38112d07146197fcd8f91669bc6c239e51b3b38c73f55984dae1e78e2cc800812563dfc654792beca61c212e3cd07c3ff2198a3edbb23d8d12de533f500534466e5130420774112bcfd8d894666b0ab14863c6e836b6609609ddd8c410a5e9e46a23d9f3343a7cfa93b1a0a858e2323da7fda2e646d343e1b739866a8ee19c446fd7cfaad4deb84c321c449e4a9539d57db99516751287601983fa07c1ea70c98c0c39c4aed61eec822ae38f16388ac158b0ac24ea6250b01401e74d50d229910ec2b0678c8433c3fe69c548c4b84cad784c1b1ef00134236ba658cc311aef8467c742ad12e3442cea540b550147a89efb2e828dcbb5d4cee7ac0d03fd8d4849418393b6f71c5c4d1e6d7ff2d758cb8127fb6dddfaa521b953aa18d2ee0227b5b945fbfb55072262c1f9dcb5c495dc2f7a0ba1ce7f28139f56531afa0d5742a3fdf429c3943d3fd23746b23cb7e1d4df14898e92c35e65eead0469d8e59487ea049f90c2d7a90c3c56d1f0b79a67240603067e0d8f17f3e0426eb1a02b12e3c031accc7d62d0d23e0f4a5f63333b98fe7de97083b2125130b12b7fb29f8ee29a0d429e5db48f01997d7a8d80d1d5ef6f70739a47224706292dc80b258d9372f89533e7f234c9880fa0eb094489f72de00fd8662e98ceea06dafec579861c07dfed5a79b7382b5fca4575f189bd18daba3b495eae63f804c07c0e6121b3b0a14a5f387f7dd1e3b5928db37da5286128f5351535d517dd3099d70cf117ab8e897d22626c98e0718027ecfbc2386997a3d8e5f4b9bfea492bc171232eb4fc43567b643058477d43ca2b003bdf85737a8fb9c4389b8e6f515bfbbeb62f246495f5bc73a0c643b68c549868fd1a9f01bce586fe1878843366e9c48e8c832e38346d267c9eb0cfe66882cf9c686013e0191cb2d6e0d77936a45050bc09b21d38231884e7ab927a2679d7830a6b8f42ef4f2d2e774d957e8457849b866715ce15b27c78b83ad24e107e9b3f473afb5b54d3b80b092b822376b3f194076e899bced6f06f97efa99ff2afa110e92065a2de148be66ed032c2212dcdffcd27c0cfde0495cdaa1baf29cb3a2faed49369ea65fb29b9fb877e4c11e9c93577ec046e141cd8448e455cd80bba611056a6050847dcf99de6ad560e4b01d0f53d6965a30aed9511f6c93082bb77fac0bdeeb9a330950abe679d82faa99713c87f0cf9a47a67434670b0376f52e668ceb083981b9e7cb85f90a941772e7c78350905026769f3b8228e229a921d3205328f1bdb5244ea38f65a85d7018adc95f8fb342671771773d686b6980be9ed272d9efb5104a0478a5e3b1701442d4f9b3e57f015f742e2da86244e82fd12db94c6b23c05ed14d9d854c1e55278587b1405abe97372f77f671dbb8a9482ea9293b9b5903b7eca6f4a196a3c8a6a4018f4f66e03d9abfb4ea22c35ea133e0deea4a4c0324929e8f5ecd27e9b29399626f5673c93ec6187b0c5ab73c2386a63bb339198b25909bb07f5b9d45c382e3ea80d915189c462ef0bd36f20d5c88c1001234f8c14e662213ba4709267b2294449549c607ea3a5c515a05802c59449cc117dc48a5558f010bc57651d14fecc7e6343dc2c98a35eeda49749dc4d41c3396788f739dde7ef47eb1f5a562461f0137be50767f814a444c3cc731ad7aca324af318488d5d20afaf325c23648ba596f4170303002114383bf8afcd2d9bdd65d156d8d685100ddd7acd10e28e942c20ade00db4db1ebc").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03923082038E30820276A0030201020210033AF1E6A711A9A0BB2864B11D09FAE5300D06092A864886F70D01010B05003061310B300906035504061302555331153013060355040A130C446967694365727420496E6331193017060355040B13107777772E64696769636572742E636F6D3120301E06035504031317446967694365727420476C6F62616C20526F6F74204732301E170D3133303830313132303030305A170D3338303131353132303030305A3061310B300906035504061302555331153013060355040A130C446967694365727420496E6331193017060355040B13107777772E64696769636572742E636F6D3120301E06035504031317446967694365727420476C6F62616C20526F6F7420473230820122300D06092A864886F70D01010105000382010F003082010A0282010100BB37CD34DC7B6BC9B26890AD4A75FF46BA210A088DF51954C9FB88DBF3AEF23A89913C7AE6AB061A6BCFAC2DE85E092444BA629A7ED6A3A87EE054752005AC50B79C631A6C30DCDA1F19B1D71EDEFDD7E0CB948337AEEC1F434EDD7B2CD2BD2EA52FE4A9B8AD3AD499A4B625E99B6B00609260FF4F214918F76790AB61069C8FF2BAE9B4E992326BB5F357E85D1BCD8C1DAB95049549F3352D96E3496DDD77E3FB494BB4AC5507A98F95B3B423BB4C6D45F0F6A9B29530B4FD4C558C274A57147C829DCD7392D3164A060C8C50D18F1E09BE17A1E621CAFD83E510BC83A50AC46728F67314143D4676C387148921344DAF0F450CA649A1BABB9CC5B1338329850203010001A3423040300F0603551D130101FF040530030101FF300E0603551D0F0101FF040403020186301D0603551D0E041604144E2254201895E6E36EE60FFAFAB912ED06178F39300D06092A864886F70D01010B05000382010100606728946F0E4863EB31DDEA6718D5897D3CC58B4A7FE9BEDB2B17DFB05F73772A3213398167428423F2456735EC88BFF88FB0610C34A4AE204C84C6DBF835E176D9DFA642BBC74408867F3674245ADA6C0D145935BDF249DDB61FC9B30D472A3D992FBB5CBBB5D420E1995F534615DB689BF0F330D53E31E28D849EE38ADADA963E3513A55FF0F970507047411157194EC08FAE06C49513172F1B259F75F2B18E99A16F13B14171FE882AC84F102055D7F31445E5E044F4EA879532930EFE5346FA2C9DFF8B22B94BD90945A4DEA4B89A58DD1B7D529F8E59438881A49E26D56FADDD0DC6377DED03921BE5775F76EE3C8DC45D565BA2D9666EB33537E532B6").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14996af12848fc796cb61a6ab287e4b01dbd78a82f").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; // facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d84407a8cdd763e2175db4b267e9c6e14a506f7169475fc0af54decde9fb04316826f0e56cc54d19c80a8a1fe24c404420d09ec9288ca46fbfcd9e80dd19f6accdc0b4519b775019e139ba001b1e62cad6ad021605892c49b1e778fca40497621a001de52b8fa1ad5ae4834191da3ef2345bce28fb49d3a3ea4a6ccedbd314facaed71558bf47bd4ea8c792944c3c5daa0add41784423aa660f3acd8a1d4ec0e6535a2714f762f6e0be41c6ef36079f1e307a309adf04ffb761aa8bbc66f5bcacc74c84655f3f3bed93206b70c30bf93069195f1c9d51b2e59f6d226ab9a92f473578221456143e0c45065f50d930a1807ca24702e4b045589c8353f80383f608288c3",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_for_not_existing_kid() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14827b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("0003c8", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_for_invalid_root_cert() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("0003be", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_too_short_tls_data() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8fa2d869").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000321", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_invalid_provider_name() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
    //"d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; //google but facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "000327",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_facebook_invalid_root_cert() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8740a9d9a2b3656c6fc86b7038c300c77b3ea40fa387ba9eaccc3e5805d4cf4c0106160301009f0100009b03032a0e2cffd1bdb627ec128d4abdd5247b8a29ea5bb64cc55d266a90731df6222c0000021301010000700000001500130000107777772e66616365626f6f6b2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00203cbb3d42926c6e4d24b4e6c61c7dee02d84f7500b96482cb0abf17eb2bd7a078002d00020101002b0003020304160303005a02000056030356e684a3ff9dd4e655a89e82356edf8124338892de77c444c24a3e2ec975e54c00130100002e002b0002030400330024001d00202f65d195ddafa8e89f8b34337082595dcc6c5ed067ca8014ab7331dc1dcdcd071703030c1a39f9e710682327b48664736f69b61768797f81b54a5a382d4b91e9c842709597ae5ba7c852939926d320c16158eb8324ea169b19c9d8be093a5dc9e289b3da7537e22175fe7a84f849a905c38fc1f6c01845270ff86973fcc63f07f5a4681d618e320f03a269dbfb57ebee08ce832e0eac7b8f07723f84eff03fc1cdec39a8d94a7ae803193586fb1a124ff0d4576f8f3dfc346f601e0392f051d9b6bec7b27f9d9b264b3f4bb40f91be3e5ac7766a2ce2110ce21e533c44d38dd65c9b7923724d6237073df642924d72d9fa88927b88a70cc8c47bf973abd0f1ac6e896924d727c0511c70a5811394e1cd8eb5c354619b2c592468d263bfcaf2dd21f37cb2cb1cf426c16900cfc89d354bf0b7b7fe2e04549efce6109be318027baabcc2bbfc1e4f371c5723bcec8c29e5b0f82f9deb5baef500a1535960009a5e51c3fe9414feee5c958a8a398ba772f466a03f926f11e7a2bb464edb079e22f4cc56ede1fb4ef95edf19df703d38354e962b3d7aea6b73c0a4e25374c35e2500770051d6370687a5f2d98771eac2f9e1fee82263f01d6011edefe2906247688702edae82a442373f323e917b71c1e24075ae84a369b7f30e992516f3770f4d44ee1982510120abb3b1640c567b23539f7b1fa29b3dfbbb7202a6f2ec84ab290a9930eafbceb62c91feae47ca8a03414e426c0f5cb9ddec9d314a9b4c7547f037ec987add4c4ef945dba36d9453e49c4dea8a78592c2a733785099f1e9137052481d3f4eea169fd307f5967a6810d68087aa29d03c28e10e66aeadf56a6cd92e1c8847c6f3e44862c997e35842e969e8da81759c5f0cfa0f1ce039b06386d5eefd5cd287d81bfaa9e297645028945fe6439b1315c2f26a37f3ba99b8a4f6717a03e6eab13b5a57793933515dd8adb28a6f9cbb5f94587e35f45a709d5666795be88b1f5cf973db6298c8e281078f6688d69686ed404a4d1b92f89ccdd8e9822ec43e735c1accfe711fc2a14dc5bb38b879f70971003e02cb324dc775a2ebd80da0156db7ea2f81e57df4afc9bb70ce30269d71220f9e67a74f0a04bf7d255a786339912af1d2392f932eb1c1ed5b9e2e0cb105d136b68e74f336df7b9016f7a0354b4a4535ae0587df541d18b6fdc7ee7cd654b37e9473744be4436930c68e680be176d2b29eb4e32d08b66371a5a237acf65be17f70ba266b657174eaf674f906d89ec1d8ff7493a420564c8529e54ab78c8c71008b7e67b65d4f52a11843e3b44c652ef404db55865a14a6bdfbefa7380f5b6cb80ddf320ced7c918fe81ac24b016d04dccc3c1b7fa3cb15bb978ea1b29cf57ff529abc0462759ccdd094aef6d48aea1b471fb0d9902bed0f1eba8d3d8f6e4ad644fc93f0d9474562be6b7982df4a8473e4328b0f4f355e113325a432b542f512c65add46be8d0174b0e4068d62de47b71ad154dbfa19f93336a97f319768ad2e2d80d68a905d88ceaf7fff76d52bf48d3f5cddf3196b6174f5ab8b9d20cb37f65f0c1fde0688881b3262effc92b4e1ae7ceae9a3042cc6e3233f30f25bd28ea82a740530ba967ad7d9036ca7b5e8826307f58c60d1b49bad9f48f03e975d27c70f4a034e3443593ffa8a075a38fef5349fdc7fe5f04e432b3ed8949de17d74fe4790142d7e8beaefd50bd6cbed0701b9d0fe75409df8b2543f8c4497eedbebf53c4dbb2ce5ee00f04d3273b69213e00da63247dee062763f05d9f2b207fce0b9bde128e3c5651346e5eab40ad8bf2f83dc9854b4f18bd84b27100b7bf72780f22b7da5c2a8b5db1f5fb53bb33705bda02efde40f2114fc56685aa7aaa1551686809e3f493045b565a5fcdc5a35f6a5951dd6c7c924d74fcecba284892722cb38c9b9a8c131cf4a3b7b804448900d3ff9789a312392699ef893035a1b159726612187f4676a4513bf392f47d28ce74e060d6342e47fda287f7229bbadd4fe1cec06780ee780a27c0993e80ca6272040a1f98d4089e366773a2332e2f0d3aba94eb0169bb2f2d97f2708ff5175b54a09546bc47c47a2c9defdef806280fa0d64ea36c8a100ec20fc92cf74a22441943682c3927153f3c1f820f1c2eec6043e31ea7b988d04788f8849065bc37847fb9aa5b93c4c8793067a80d64f92b6f5a71558947dee45fd60ad510fdf032734c20a32e17aaf84793576c5e547df0842a45e4fbcae1ea4431d42cf3f44cc8cd3c3bb2a724b45c1c884b93946cc5f252d05e8ddc347b57b80ff015c23fc84492a35853d9dc0932cf3fd152d06139b203c01424b5b56228702ecca2696ba65a95f6280083e5c2cc243f71eb81cce80561a653e5cdb5aa5295f944a45965e60561a940b638c6a3887076a8bf287ade28038a4cea3afde0279c4f18baf51ba6e858e31c1217eca754fa48f5335a1061e79d629123b35a5872dd1bf77ea6ff8078f7e55e3aad0ba8c28708e91a95d46d36a0c9a38c6e9bb40c563bab1d13840ae4133e3e3b384b73c9830aae9bb46c803f0669412238640dcf2fa651d1207224fbb8280d9458679c1e0a26de8c75aa64173c51a9b3b32d29e41eecac46b96a1fa1c288927ae25c78396c3a396149d782aca164967ff82c2b41bf920bac364a471bb5c9132e716a1a6b8554036e0a6edfd7526685eb0bd7682be3b7635246f1e56ee829adc67ddfc8bca23d7a889621041f8c5f399a83c34f14a47b8139978f6f276d1be07246dcfa2d136439c0420a0a91bf0ec46c9d5c6b73548cb545cef05328b139c9f61248850e3014eacb130bb07d4c66cd85c61795a3b72c6d1fe31d516f430d19c57790212b6ab8249c1fd49bc1d5ecf10907b871a5dc4b57b7c28b0e6918d246e50f109d2796c10b65d753360f4f1afa487f76db002d49e742f191cc2d78bc30c1cdcb36965af876d2dd8012d2cc29aae0b5f830f3010277110a711a433e8bd24711dff8ad316a68c344fe3448b3faa2a89a109454c2e125be5c35451a815afacc38204092d574a9fb924e9aab2f2915c9c70c36f7b19f3e6a7866715d47eb9d129cf1571ebb5d867403a6fc3a97e2449ab49dc1fc827d28bd98beb62b8f861ccb087588fa37c81d4dd7f196edb7e2edeb376ad2271a1f576047b50669e6fcaaba89df2afbe8757a42b4bdf1dff263ea2e1312df8e469574b60f2bd73abfda68e8858b4efe72bdf37758a3241a3a418b4f4c3c02ae7e012db299124cae2e5fe45db5458bc397c84c99bd300d0d7e86cf81117f114cd406b2dbd91b6c79afac2550bd439d542913b2244f16b447b90c31dd868185ec2f5c33d85be9ca6197d1217fa188d493f6080800ac781f0bf2c0acd3a119352567431bc312761d4bdf2d50e92ff4d37cf3d86f093926509daacf6242b14d594693b84a1ce192e15a8f729a488c1291a49633bc1d69132f957367d7cb7940ba56592c45791412eb721aae7cff00f314a3c08ff47535f97befda07971a6c364401244cf41fb4075105d27a71618dfffb97f6824af7e4114bbd746c48fe0269df190b01bb736354ec24b967c22e3bd05bfa482b0a0b2c2e153e3b9877125a2a3b38df6996ee6990697d6be10c3e32fac69a3584e4e3488f43b8dfd21f949a7c05725eba8004bcc88233b53f42c386439d36808491d830eab05a2c02d0e30da359ce2151345df0efa6ddf058b1966602173e64e16bb853080231b56a21c6a921544f40d20bb8fe18fb0d73cec003325ed128fb95bdbb962e16055ff5d655a32d729b00109f4888401f5c35d8083e9e35d7bc0f91882b21cb6580708fef391feca3ddac742e805689e04b68e64d2e8ac173e93bc55c384ca2ee9c1c54de674b851cbcf0028cfd40321fc5bdb2da95fb9145909ebb97c6d6b96f5e3a96dccbfec4c88b8239af309eb4af64a3903c305164a280d6fee4938841a169668b0ab836df24ff20f72bdfd03583a0970850bc6d01045546c08a48c4d33ef1a10b8355d5aaad4300c339109b8b2d310e477d1c9c8f0b24fa1cbfe1ee85ce720d8b847fdcc374fb43e4292ee1575ae429cacc8a0f79798944180bf5d472d5b1b190c46daaceb1a8a7472cfbfd8a3fed0c7918645aaef2a65e7c77d52d31f20cb4e74c957f1aee1a4d5e31dbb2b2cfda26aae6779396279dcab7016cedf1e6f5b6fb3a457ccfbdfeb9fc3b2ff12672db86ccfcad5ae896440f787ce03e0e77df1fb945f70b367a6fa9c7875ac3d0b4b6ffed967e8052c5f78df9b4c31d1f504bf8c3fbfa1f801c753d00fb619b23026a7f88de64db36d1b61f45548f469783dc323a6169b2eecdef86f62c76445f322cf905ceae85f1c55d887e7d1e0156daaa4589078b3c15262e501e26d8b98cc9f7d87df700a23e12f12955e359488245a5eb6888c7a8f4b9403004c5614e246d7170303006cf9ab8b17aca2c92d1ffffe62349ccd5cf978e0e47430b99cee81e8f6e481b01aa8282188ee1849993566cd5404f57049ddcabe2ad42ac4d2511f8927dd8e1946cece7a85254eca15f6aaaa20e2f345d97ddc1710a29812647f8c0d3c1fe8c77e00ce6e6fa21765dcf2a46ebf17030300b13ca6b358e70833af8834a59ba85c908b59340ecea8efc50131f2330e848788f7ce5bb08beadd72adf9bf2047c5051f41cd914734c1a8977ccf9321b544ed8d3f264dd142d632ce34a026002b8aa907c567f92b0dd63b47255ebe6a044890d10cc9eab58704b136b968cccd2c8005f39d58dd6a19cd93416732acc998be97e56a30d3d5c8bb8f24ca550c8315e536b4f7a5f8c07c236d7f1da99f129a7e2e3d269216ef02d2bc6b57b755851d753d880ead17030305f1854bd5ecb82fae15575d13b9408919fed2ffe88b595fe234d56e211a2d5597f7eb4334a77d6aca52005c379897251ea20f98c3d2de446643cdda383e18a587e60de68ff1b1882b70a15159cdbd74c36a1503ed6b971b4c3a602b1d2e81aa78d907f3b07d643a157f002f6b48abdaef1070c8d5fbe5f7a8e840a9e0b014ecdeeb7dc6a12567bde0101efa43a982565dbf5e6baaa3ac30fe71c150a53666c2914052940f1b43ffcf4298be23797bb0ecee4c5ee167b0a44db1e33200bf26112fa19d33d7e090d1592805bc62cb49fabbb5e84066b7671c824945a3ed8b077912737f343639245589117b5cffe571139229cc25d3bcb0baa050892c67fd81cd440d8a44cfdf95e932d66a55ccdf23d4031dd49b3dcb2e53293478d569c40d6695cbd4a6d3eab11b39a41a99ba1a37618db965a6a8b6a3b6c11f9c7000de22826003e6ab2731306db7062848db31382dc4480f5ac7a9e139b2f1c34f82d4d5913dda2ef4c1d2ded27962fc318f0a2b2aae6da8e4e8049e3653a86296a1dea09d2c6b9991e319014b9fd0ffa24386c659c668e34612841d59c8fbfa68f7d39fd788ba9c8b72d56baadbd49e5e39caf7a62e68ccee18ea16e0ae79f00b073ed73217ffcd62995e0cff4fb93045e2f9fba7fba56eade4e3d79877fa3eb28da084939041398e85a7e464ac15852c85d737a9c56a58c5e648f0b6165f902be76cb4f92c535ec5ee45663e544fed15cd511b5c93f5bedb74a63a5a5915d7934b3c56446377a146a67e564e616b13f628aec22995eb83bd31c320ce3074c03cdb31fbfd31d65576d33349ea30aafa616a78c6facf4a39926ad0b40de0987d694c6cbecf8f253ad48298bd2a5cc3c648b23f52919046e3a76e39f0f34670c4d62101fcdbfac49a9640d4bfa73d8223b0217ec92e76548bd18e687e3ec97fa7d0cacb9fe729e31f5f531fcbbc8e9b9e63f528dcece5c1f8890640715585c353e2aaa8077037f0925882ad0233d1eb2b17f0722359b692c81e22ff8487b1f359c2852ce2720b56a85b5f9b285f080d873108cfbf5dc15f496a3c6668416fdb3a05f5d46c8fad760d66f4fad3ac64f510dbedd54d67dd2db64bd05a577c70834480dbad7d61e9653dc53d037ebf47b1c54cc969b189a669e92cb761a44f5c8f4d6b9839b6dd3ab85c1792cac9f34acf3f5958066e9322e8d86d19f869cdbfde71d8d5089b2698f4a6aef7500bcd43f7560b31f3602290b056cc62fe7c53dc4e7f3e1bc987a385ff1f24b3b95413b70eb1875f75ae362f52b91bfa64e0aaa63e82e46428bf337fe15ed927f97ad06a6ba829f625f31f3a64a95b5061370029c7646974c80f24eee51ed0adc4828572aeccc2b14c8b03b6e4dad265a6e2e1b9c6aed4c9b2bfac76f9718d5463ea8ef654461de8f9f4607b7b1c129c3553db20c487813dfd6b634841f1e7f235f41b33b67e99698a97f4c85ea6d60f8afe618eb1345b4f742512e25b96cab1f4f0d07aff13d49b804080d6b75e7936faab98df97d36be076538b61117f750a5930c66be2ae2b3b4b24d93da18c7361f854b74a0264b3542d51ac9677becb0206038fd7770b2f13bb2b59691632f64c826a0b5b610a15fccb6d97e66710de65ebc3182eefa5f4f5de4ce86aa8bbdacb4d709f4047fed29724581cc3e3f6ce4636995e25e1843b4d534f13999c3a4f4278776d12d039b383c0d3c1974e8b3a768a535034ea456eacf5d2b8450f5fd2773a6aa97da86084db9bf9a41941a5878bb2904c5f246c3fb08b0ff923de82ef768eac621677a3c87d2e189f8ff7aed7f9b336b11d1acab5475fd410d374e4a081251ac5f603c79335bc325f474e4552b1d23e417025f83e2ef28a35cbe2f8091e5c194201612d48ebb70d048e779d554f20cdd582d49689450d78020a455a2bd727192d580fe15606015262ea5a0ea0eddcd3a3c2d3bdad30d4763d38f21252d82a73a67baeadffe185730fb7d45a2577f8e925a4452b518ea02e3e4738e500984bac756f02cc039da8ebfa8cb8053a9d5b9a7f7f06d6799275f9781aa69ef990ddaa807b139c5db3437cb93ca7e27772433934283c7eaf2f66f89a0bc4c28bbd5a6814fc1e9ae9728f78fe30085427934a8b0703f847c21273fb058dc05217030305f17368890b8cb23bff74fe1a55500223ac6140ee760452efab7935ba2a34f1e0eab133dc9f515adbc938e62ffb02c09f1acdea41074d8beb75322ab02c68d960ef9f97e96b843a60c1ff2fd8d9946edb9a832cc3680ae6f614513a6828611d74e8f0b0da5d02caca68e77356b93aba8694c55c5948b3354c1d50693f1b2bb3a9d8039c2dd53a8c21a0d51febd7bb26cb7d70f492072e36621981ca7160c2d0761b1c8b27c6d219a6823fe9e0842d28cc021651a95457394ead672dd48f435e39cd7454f59652575b7cbb70e8101763412bfc9eee8b5e425a79fe2eaac20d151238b59276cc019eef2e5e22f1e1286c9ca48e88bbc335b1bee0f153bd40d3358100f629a990d82085a334f007ec666c5fbc322efd1094b213c64ac35e7d9e2d8762ef86eef1e91adefedcf7b7fa60f50079678d83716c0fb19fed330edc7d6a90f3828692a8abfb1dc453cd8fdc9476ac8daccd5c6fca12365aeddbf8b298c8d597f550d17b8e72a7a92f2c42687c55727e26160aa752633751959dd6ec306fdacfa631c1cf2f2facff844c636649c21ac418e57f86106fdf76934ffec3af6b54db33b9fa397ee645b64658198163d83d084b1173a833926350b96da611a424173c1ba633e0544000c2355635f481099e23446d156421bb48da8fd68a45aea4f9c7a23b925886b22fc87d5dbcdf8a801fc8a7f001fdc830981af856d0c0831c2fdf32ffa7d050132089947348447c1724e9fe28f61c225cb0626d1c68612a1669f6aaf4b3fbaaed57a6c55eec04f99b7434eedc32f0a4f1b1fbe57ca5dc76fec27c8eb26cdc73fefff72c27bd02c9307472839d479a8d2aee997adfc29dc34581db817c756ba3337a50f9239a5dbbc7b682c147fd0794abdeaee6d760ecdb08c2517296ee3c12a808ff8d96409fc6c228dcfce8b989f850477d70a1b32faae6ef67ce66dc66dbdbd264ec65b078ba95646165adcbb4dab61a0e5ae2400919ecba1ad8eb74e9f6a3ba4125a0a33921f625321d3775de08f2b1787a07e529a8c92499dca1b5eade3f25acf9c18fc2a9cd7ee47276e5b6788af6c138dcfa47704f65a6d534f40e664fd2a43be7f97cecc8e97e18bcb267271f811a51114f587f43e37400956194f47fd1188677800807cf7a2c7fd5d0c5ff6778d6d96b44336cfd787b2c7ce13b59841196944a2c65a021c8a0d94af8ef56d197243a94be0bf1a75c464155e07d0e8b17df698faee06b49c251ecb0fe186347c85a9999e70dd5e60b30c561ba0aff3b6b6252807487d66cc2d1bd1b4316d6663fc913b567a184de7e4c3e2940178a252626bf7f7bd189a29fe90c03966ba6a280ece1593c70821ab0f49659592556ef125dcd0ace2a04fb0f161699f7395b9e7be8a5dd3d0f177d4a8b85d7bc1d4c992d9ff0848148cc2a9e954026ffe6ee82049806e4f56d29273cb681e24b7bdf49805ebfc0a1547d0606ae8868a673af1d42f1de5815412da1a8f1982730ef2b213fdc298fe0af53fc66109c82f7a10b23a489534326d43b8094162dc496f2e3ff82d55a913cadf9be3dfb231aeec111d5c159fbeeaa00322f55e759352fb9296830002d17d1f873b6a469d7fb32f813d1df3a2869e411a09e4840f7cbe1130caab28b3fff9db758593d2a92ee79946b8bd489958bd5bb7c2a9396a533cc0b951b75c220e90cbf499848636d361e2a0e611884ce631f74c89668a725c0a7910471c2d390b33b66ea6d7b9c0f3a6b6ae37d4461f4f4ff15c56a7155cfa2fc91178d007e704d3ace4f79f7bcdd8ec680b165b44f2439996fbf3394d79a73ae8515863f14287f5a26d2984365f96060f94aa67cb552ad2afad9071cbbad0767356678a5d8f2af5ea6f302cd52eb043ef351349d5da0a4f39188c790fdd1af3ad14b3a7514c80fc4e8672ca661f3eb3f2ae2772e765a6c533e69d4cc812217d5ecf010d377faa67ab330a08fd7736e82cf0ed33aca849608d83a4af88f9b83155a2d04ca73cbb930bdd4b263feedc575c5f0fefd94333f9a803b5fb8e5fb74afd795955c5a13a53b309a4e4d22f23fbe254db948ac3db3931b730c1392636a64e9fc7618f3ad700e81c1347e60c85b4ddaff050906cde9d78f19301250688dc465455b68c79e8ebbc999f4283a4517030305f12abbeb15ed8320c70664ad7a10029b1c34f5295264f3d17e20082cea5d5c2fb73e0280c2e1be8b310dd0038d368eb1ef3ff0dca83036e6b9a4fa2d8e379d6f2654e824cd30b988082e505c3abe8cfbdde641fa2beb73a94f09465d778019084a1e12f8cb958c78101de3f831d94edd91a480bbcadc32779ac45fd92f79968a2951aa30c8c3baba2cfbd6cd8665811c37f657735afe470b1a1e4906b6e4d9157f790e8bbc4be9336fce195bb8e44c035af7920cac831c129497a02b88aad74e87a4c955b245d0fcbbeee73a36da2697ba0a7b09a423fd4ee7f73ee355d1a887565456768165d421eaf36c437e3571b07bb5c20460bc8bde4291739a3f12e409981d072ee4a01213caadcae6617980780118c0790cfcc388d8382bf70b43a53a6fd1be7d8c72ff3fa4d9d64bc7c9b2ecb5d3549dd8e8c9e7f4d1b155607ab286e34b986a906fd086e0b515085a324e4bd25929d6a8985c1fe2f37082a1c0b3088c1f35737a0a893e1d4d623aaf8728328f0927497a589b8aec58feac2f49ed8e0ecf0b33e18dee5f6d7b9d2c473746cd4828c21fd3f0fd92f96cb1988df41224d682676c8c4c661ee7a41ce49b7ac98add209e06c39db4c429022f6cbf179a340af89e6ceac9af7672226d24f30f5b35f31bd6ba3b6a4e38b15783dffdba33cb6e9e35c6a3334d2374d3a67d2d66d96ad4c495b35eb54cad5f8296f705f6ab9ab46b4fce7633678e22e078ed22081bddd6e381ef29ae17a9f15b0d9b15d3b5e4046f9db13ff8ebd271afb58b62e6881d6d290c07629f4ea9894bbd460be1e2154e2a2787dd6625e7f2b66517dbae4d2ae0f37bd095c2f5f34f30c8a7278f75528314068f1055306bb4e83f7c204cf69ae6d9e1e271085900c4472b870ab9cafd40197637f97d8eda35faf29a02ff0fb26f144c8c76bfbd7c1a0f3039de06f8c2a7bbce4b78e597d52ceddd50136af8390e550d1178562a24696eaea2e2181fb73b2fe4f60d3079c21f4e12e15e8c3e2f8bc7cf51aa6de431d5004a0c4fdcea6f30249bb094447e3745474cf992298515b70833b99f4ea567ccdf9ec597bc1de6a4e1206490fd9335e4d582c0ba2623badef80ba6c844e400c82879c374961eb47ec25af269b9c1aa77ea952c7a7ac7fe231145f712be52d0c51d2014d981858006fbdfd1a1a1df0e3b82a6add74a14ae600df37fde74996c3a5aba5a3af0a4d59674ae6d0f9832822692ead7a90bfba0e285189f13b1626be40c5233219b162c9558bf2fca54b6bce0ed9f70ad6193b530c1992d7787f8f71b3dfaec6f81e780fe307a0c2cb4e3b79eec9e51bab2fe45e9ef0284529615ace5469445f5d99a1ad68705f02ee128261fd1d0bd1db4677ceaf3a227b2bb069a8621561b8f7a84ce59880e7d02f1576531a348e42ddbe8051c794d011c63b86f56f204945e926f46ac943cb415f3cfbd137f60ec49ebaca5f7d99e8e1963a8b4a60a5aaa58e0ec24c67cfa9deb3aceb68f94798dd0c6726f6ed30e1bd8ce13d257967fcd44d447bffd7a2e2e376c36b07a299d23aa7c3d47cb069c8496cc079782cd86225535b27e3583d53c088ecff4296a01b1a9391d708f4f424ba91661a950239eb44c726e556395d97a9ed0402665b345cf172979935a28c4766334e0fce30a17b73ef87a3411acc16364b9d4bfb5a693454d1dd3cbc0ba75277b5607002999ac90851ec2775680423f1f1a98bc44ac824bf8f8970a3a719ee0229b54913e6c841eff4b43f97e094cfe7b6c362f046e97063ea3b8861b8df0466aeb88b2e244e12821cd59901714531cad4a6cc25ba2c00c5a7c425a25e5a2fd8c7b0590961821f85a2371d0237bef2b73bf0f9fb0c4f9808e78f2c8adf6006af908ef369dcc2e3f6247973e142e7166860846e34286465dbf2f14ac9704f2040df5cc686260b45ee8083a59c61afa8cc548b400db4eba3f1a1a6e3ca48e42e3e6fbe5128860631916d6fa66f6e50755363dc190a835273f96dbcdd005d61e0d9fd034732fc095dce3cff24da00df89426d4c4c6e5fe0d24e1e6546f566a2bfac60141964c1f70010853f416b809e36ae5d0af6acb9976b0fe13a9b2e450700392a9852208cedf01e6a4d9f01319ec9d64698872b6c2c5558435a7c8236817030305416c6b8744f48b2dc3d38d576a6716065a5e5659b98596aee26c0ebef13c53fe4cf94530da4beb92980ab396dba6a461c897e803042e3318f68810d4b1ea0ec5fd8d683f4dd96d3c69667d7f9d2e9672c8a3aaafea526b459eb750bb932de5903060fe9e653bdfd60a7e0594db2343eebac324ec4e120b11dec55ba63732f053c473827467e576a5aa836dcfe38112d07146197fcd8f91669bc6c239e51b3b38c73f55984dae1e78e2cc800812563dfc654792beca61c212e3cd07c3ff2198a3edbb23d8d12de533f500534466e5130420774112bcfd8d894666b0ab14863c6e836b6609609ddd8c410a5e9e46a23d9f3343a7cfa93b1a0a858e2323da7fda2e646d343e1b739866a8ee19c446fd7cfaad4deb84c321c449e4a9539d57db99516751287601983fa07c1ea70c98c0c39c4aed61eec822ae38f16388ac158b0ac24ea6250b01401e74d50d229910ec2b0678c8433c3fe69c548c4b84cad784c1b1ef00134236ba658cc311aef8467c742ad12e3442cea540b550147a89efb2e828dcbb5d4cee7ac0d03fd8d4849418393b6f71c5c4d1e6d7ff2d758cb8127fb6dddfaa521b953aa18d2ee0227b5b945fbfb55072262c1f9dcb5c495dc2f7a0ba1ce7f28139f56531afa0d5742a3fdf429c3943d3fd23746b23cb7e1d4df14898e92c35e65eead0469d8e59487ea049f90c2d7a90c3c56d1f0b79a67240603067e0d8f17f3e0426eb1a02b12e3c031accc7d62d0d23e0f4a5f63333b98fe7de97083b2125130b12b7fb29f8ee29a0d429e5db48f01997d7a8d80d1d5ef6f70739a47224706292dc80b258d9372f89533e7f234c9880fa0eb094489f72de00fd8662e98ceea06dafec579861c07dfed5a79b7382b5fca4575f189bd18daba3b495eae63f804c07c0e6121b3b0a14a5f387f7dd1e3b5928db37da5286128f5351535d517dd3099d70cf117ab8e897d22626c98e0718027ecfbc2386997a3d8e5f4b9bfea492bc171232eb4fc43567b643058477d43ca2b003bdf85737a8fb9c4389b8e6f515bfbbeb62f246495f5bc73a0c643b68c549868fd1a9f01bce586fe1878843366e9c48e8c832e38346d267c9eb0cfe66882cf9c686013e0191cb2d6e0d77936a45050bc09b21d38231884e7ab927a2679d7830a6b8f42ef4f2d2e774d957e8457849b866715ce15b27c78b83ad24e107e9b3f473afb5b54d3b80b092b822376b3f194076e899bced6f06f97efa99ff2afa110e92065a2de148be66ed032c2212dcdffcd27c0cfde0495cdaa1baf29cb3a2faed49369ea65fb29b9fb877e4c11e9c93577ec046e141cd8448e455cd80bba611056a6050847dcf99de6ad560e4b01d0f53d6965a30aed9511f6c93082bb77fac0bdeeb9a330950abe679d82faa99713c87f0cf9a47a67434670b0376f52e668ceb083981b9e7cb85f90a941772e7c78350905026769f3b8228e229a921d3205328f1bdb5244ea38f65a85d7018adc95f8fb342671771773d686b6980be9ed272d9efb5104a0478a5e3b1701442d4f9b3e57f015f742e2da86244e82fd12db94c6b23c05ed14d9d854c1e55278587b1405abe97372f77f671dbb8a9482ea9293b9b5903b7eca6f4a196a3c8a6a4018f4f66e03d9abfb4ea22c35ea133e0deea4a4c0324929e8f5ecd27e9b29399626f5673c93ec6187b0c5ab73c2386a63bb339198b25909bb07f5b9d45c382e3ea80d915189c462ef0bd36f20d5c88c1001234f8c14e662213ba4709267b2294449549c607ea3a5c515a05802c59449cc117dc48a5558f010bc57651d14fecc7e6343dc2c98a35eeda49749dc4d41c3396788f739dde7ef47eb1f5a562461f0137be50767f814a444c3cc731ad7aca324af318488d5d20afaf325c23648ba596f4170303002114383bf8afcd2d9bdd65d156d8d685100ddd7acd10e28e942c20ade00db4db1ebc").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03c9308203c5308202ada003020102021002ac5c266a0b409b8f0b79f2ae462577300d06092a864886f70d0101050500306c310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d312b30290603550403132244696769436572742048696768204173737572616e636520455620526f6f74204341301e170d3036313131303030303030305a170d3331313131303030303030305a306c310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d312b30290603550403132244696769436572742048696768204173737572616e636520455620526f6f7420434130820122300d06092a864886f70d01010105000382010f003082010a0282010100c6cce573e6fbd4bbe52d2d32a6dfe5813fc9cd2549b6712ac3d5943467a20a1cb05f69a640b1c4b7b28fd098a4a941593ad3dc94d63cdb7438a44acc4d2582f74aa5531238eef3496d71917e63b6aba65fc3a484f84f6251bef8c5ecdb3892e306e508910cc4284155fbcb5a89157e71e835bf4d72093dbe3a38505b77311b8db3c724459aa7ac6d00145a04b7ba13eb510a984141224e656187814150a6795c89de194a57d52ee65d1c532c7e98cd1a0616a46873d03404135ca171d35a7c55db5e64e13787305604e511b4298012f1793988a202117c2766b788b778f2ca0aa838ab0a64c2bf665d9584c1a1251e875d1a500b2012cc41bb6e0b5138b84bcb0203010001a3633061300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414b13ec36903f8bf4701d498261a0802ef63642bc3301f0603551d23041830168014b13ec36903f8bf4701d498261a0802ef63642bc3300d06092a864886f70d010105050003820101001c1a0697dcd79c9f3c886606085721db2147f82a67aabf183276401057c18af37ad911658e35fa9efc45b59ed94c314bb891e8432c8eb378cedbe3537971d6e5219401da55879a2464f68a66ccde9c37cda834b1699b23c89e78222b7043e35547316119ef58c5852f4e30f6a0311623c8e7e2651633cbbf1a1ba03df8ca5e8b318b6008892d0c065c52b7c4f90a98d1155f9f12be7c366338bd44a47fe4262b0ac497690de98ce2c01057b8c876129155f24869d8bc2a025b0f44d42031dbf4ba70265d90609ebc4b17092fb4cb1e4368c90727c1d25cf7ea21b968129c3c9cbf9efc805c9b63cdec47aa252767a037f300827d54d7a9f8e92e13a377e81f4a").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14996af12848fc796cb61a6ab287e4b01dbd78a82f").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; // facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "000352",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}











// #[test]
// fn test_tls_wasm_from_hash_for_google_spoiled_tls_data() {
// let elector_code = load_boc("benches/elector-code.boc");
// let elector_data = load_boc("benches/elector-data.boc");
// let config_data = load_boc("benches/config-data.boc");
//
// let mut ctrls = SaveList::default();
// ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
// let params = vec![
// StackItem::int(0x76ef1ea),
// StackItem::int(0),
// StackItem::int(0),
// StackItem::int(1633458077),
// StackItem::int(0),
// StackItem::int(0),
// StackItem::int(0),
// StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
// StackItem::slice(
// SliceData::from_string(
// "9fe0000000000000000000000000000000000000000000000000000000000000001_",
// )
// .unwrap(),
// ),
// StackItem::cell(config_data.reference(0).unwrap()),
// StackItem::None,
// StackItem::int(0),
// ];
// ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();
//
// let stack = Stack::new();
//
// let mut engine =
// Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
// SliceData::load_cell_ref(&elector_code).unwrap(),
// Some(ctrls.clone()),
// Some(stack.clone()),
// None,
// vec![],
// );
// engine.wasm_engine_init_cached().unwrap();
//
// let hash_str =
// //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11";
// "25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
// "f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
// "d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
// let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
// let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
// let hash: Vec<u8> = (0..hash_str.len())
// .step_by(2)
// .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
// .collect::<Vec<u8>>();
// let cell =
// TokenValue::write_bytes(hash.as_slice(),
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// let tls_data: Vec<u8> =
// hex::decode("
// 8fa2d869e938a71a2cd1d1eed76c82c133408bf07d49f5e6a5768d518c8ae72c010316030100a10100009d03038f73f3532eb8b51bfb5f88dc2cf559eb728751d67e458dc067fc49e2062e52d50000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00204796db556e029e1b98b0e9be06d4c23ddde853c627f1dfc52b9e3103b5f1ca0b002d00020101002b0003020304160303005a020000560303c99f389e5ac8e8f3181e4804b70c89036be8d2cc7668e0c1649c78e66ce17fe800130100002e00330024001d00209cacd9c4e8bca9041188341a5bb347d1cc86012614432bcc192cd129d17d5c20002b000203041703030be7d99a04ada3091a4e87220816628a2f76033a4b3e5bb0d7c6515993d0dc6e49cc68bbe2724d973ab450c7e312cf513f9cd2577682873feef58531782bb90ce37aaeb62c1005568bf5d993c98510ce51099cf76cf73d9e54c33e16e747f97688d83b5b1d7274ae2b3eadff5e5d209f86c0af37b81a1ba00e3451397b8338ddba20ed634503f78ebf2dec7ef350b806d47c7e31c5748f2488322100171ca0313d0bd8c5460e896c664f3e593953e7fa6394430ba064c28d26686444ee4ea1eb67aced42070ba044bc999e9e6b56b9256407297bc79b6043cb92e4cf0bab84ec0755a0c5556d8ad7b622bccd3f3322ee0c16f7e3a7d17b5c82d80241e5045a400eaa4814835867db2858bb988797dac15f633c0aca926e5496b0c4572fb0947a85b7d4928db482a17b79052840cf080b0c25cd219da7301b2c766b88980626997448cf9ff696b90e8262852ded638b96e716b34af40d01785fe34c1de91739ab7cbfe7579fdb67bc7ffff1b187de962da204fcf0a00323ae125662f19f0e427c35383b81826e7a0bc7d89621d589e074ccc0470103d0c271394dda1f72ae52a61997754608a4ac42eeada12237a416968de797095792d7c26f1a0ae89c02ce9f88501d8474a4fb37aece4c696d504a265a3303f1af4e3641234ae8e6fab4a2f466eb43172a3d3a12ca714ebb5624bfe0433ed54b17ee90d8b5b5577e470db6bf1cda0a59f40c7f4872b766b9c8cfd27ee2d6be5d73f17aa92bc586b0da97ef2443d5d63140e45f621d4b88833fa2b9c34398ee2c4510ee3b5fa56008f2e05537486e4f0c6c3fb920b1d0724f92d1210213d5e0cf3fb4b090268243c2386a32d1d0294a52c00ba16db0418f2e4626ffd1f30d90c76aff0b1bd3250ed2fa9a437ce229bc673b506c1a017ec56b0d53e40f94020e44fa6bbd3f5b31e3aa3fbc741da5413a5c055ea2bf8a7f928054fc26a261813b5d2d247851b2a5df4aa3f577a5999342a77e9c35c811914e2a80eabe77018f7218b285b97f204849027bad55eb6d0d0746a3bc7790699dde1ff17e32fb26aa27b7f92022db3b12b65c290060de578a79d7de62fc4b16b43d8a1e1cc8f5290023a9b4021537c5fe488ce9d48aa5957c6588cb31f90653ac75d6b3c0d5beaf01064a9e6631aaa2fe0ccb2fe8296e99a5181af90e893e29ec5aeee44b568d5d78d445dab932843be6b0bae4e87e04fd0a574f7f63a3d7a9b311b99b5c824f20047453060e13d441edee8c12d0644c730e04eaa15fbb349c338861e5b67d8caa2df839a89283fade6b9ad4f3174b301e8e5a7550c720ba561cfaddf864259eac6465b955fe4c83ab9bcedd8509abc2c814be18c1045cb0c9ca08f154eac9baee5418b638ec2162da27515a85feb1c983a0c867650819f423d4fb27fd345d5ec63e463d07b484be14eca45eb9cdad05942d67a44b9e5966749b0a695c3c1cb90ec3275b3d1193eef1eba4dcf9f2985877ab7c1c68c1a7985ec859f66ab2a7480c9fb24adba48b3b1a1e74b36b405c40cfbe0f3a2d9eb21b9c1074c42c633b90863d10d317db0ae7bee4523d1b7acc6310f1134d24f51cc4f4572bf0eaf097c470456c45c293aa3639e255853c9621d7555a759787b8819dc2e945927af9bdebd8a471116a40decad5ce0a45517954f97edbb760636958ef529f241fab7eda69c904c914090f915fc4fbdd4266a34f60642a01d3537616f7cc0739a1c07dd046048c6f55bf6a5f521cc957aa97bf9483a7512d41872b76b9573610b98b8874f77771c00ebc937d0c587989e7ea5b1c0b727b42100c26c3d808a811c2e57b3123f145eb035ba9a1bff4c555be2762cc1595e5797d081ba5897c260778932ffa694345059c35094f8e4b0235111fb916ee8527f7e38a73af562cb846ac55f1bd6e638021164a91c93acd15b2b90db95802406d8d3d6a7c8b6817dcd84eb4cdabedb162c827dfd86ea9525b4d21b8d350a8900d156fe896d76514cd75cda5080215093795bf8c15629af912aa8987a8fed60eb56ed17b0b2c14288f77db57b6f79dcf888b3407229ef2eacf950e138ac7b0a86f04dd27ed1863cfc4958d95349beb50ab4b1049413127a3071dfef124980cb738ef41435e8fa5c9b7d38cf274f48ace0bc73048e29c7fe1e22ae0b786d066eec46229779ef43fe34f4375edac2c2967ebe941c1f9c54c9456c9d2a134a7da80faf65ca3681045f81e4235cdde3a899b90d2519d49fccbaacd47380fe56ddc277b05293cb63fbe86459d9f0a887cf17e9d7b9c88c0ecb0be853ea9e7e83ebd78e10dd2396c50f76108cb6ef5cb9c6992cd20090c49b7c63ee258aa452b9fd507766c0b9ca0c512761ff2ce1acda26b07aaf35b4c1c4b695326f18205883014a3a456afbe1237b69f6a447e1b471e713da33c6ca333e2c76ba4edc521acd6aa7f9342b8c8da2e4b72c3b89497caf40a5eaf53398aada0630fb715fa328f261c9542d0d2a67f7548ecd76a6c3b46c965ffdfd926129b5a0e64048a3df4bac29440e2cf8c0a0d4dca25ff1df5bc0a683b32ed3e01f12710ad2875d644b47bc51d9de32d9754207aca629ab9bef6086a59d2cf789e04a38a854f586413ed0f2c634a88dab6d6dfd76e7cd02c314a765b727b049f3926cc53e6453c4d4bef9c7fa04f4abedd0b553752713453307a6b094b4249efab7d68590ce3c64ef3d7373c90951d611eed2c68d8734243e0f1464becf04fa6a4cd2a72ffd1a1069ecfeb1837732acd723dc3ee291c380818ff2c4ceb7ab375dd6aa18596f55269889af34d395dbb2bddf4491b5a7c41aefe65b1be73a501d1c03f1711af1c4535df54446d774ca01f213ff01910a05e3542682768f258e1625e0a197f7f509c3cdd61524652759edd5206eb1339c858ab78a34e32dc3cb330cd619ec8478aa8a6e3c46181c6bfd396d63d7505fcaf9189719fbc8715fce2066e644952fcf146ae66fab35445d299e4d44060f4dc5c76993bf9388b22a0d43ae9b723bc265b2d258387928fce27696746ed5f25f65011089be5d8040c0bff0ffaf2e649f22853b38ec6b70c62e4a90e45afa0bc357ae7ad90c0cd0f9a1224a6d05c892a47e860e249e2af53c6b6016a9212ed7d2a897421971fc775e27804d4e4dd5116e180206a1a4e32f7283020baf73441a7a575110202222b2ee5a2011f18571439ffaf334445424f5b4d8487b1faeece0524f6208765fc840d3d11c864f219fc323da4ce07c30dd2800d3da350173b3fe49b2635a687fa09e177004f1b3f1d83d26905d380bfc8b266f87bcdb2adec175a8aa26dd386362992e92678061a312fc5444a2d3c2b73c0c3159280bb59303ed0f8fd91cc3d36f9ad687fc96b1984e9f607446c0ed6d5b5c4d6ac9728041c013ae25dcf77893157fd245ba2aa60823ac3c9e1930bddf05f6d7de37a6fd05529e67bf836e133c98e5cc0ac8c29bf9af8c8a9b4ed82ab4e2be8e02a2a2928def2640ced0d76c7162e5ab17642257435bcb24b27da2d15e39cf5dd78506f66cee3f4ca01581e38d36312ec21d1272d97a40d9041790e0372b6007dd09e7d6aca768e1419b669e17c7ecf0e5e65be20a29cc77481451947d8dfed6559ca75f8e9fad957f53a1956e85f87740ae154aa9ab30cd5b2ae26a9a0d1b2901982403080889e28721cdac49228a306f19bcaefbf493c2e3199e51a409282725ebb2ccfb7e99d9ff92090433b2b7ad1d2f04fd5fcbc8abf4438a73eb4e42e9414b032b234dc4ca70ea74f11545a5ccaa5c6e7fe506f8ece85fa8858573eb31239bca2b795baf7a27f301621d906c5e1dc3b52c2a926eb22cb17d609f328e6042655a86d9194c331195517f72923aebcc3cdf3f174bd0e764e32a9af6b5e4dd518836b458261c7b6161410498bdb43e819b35800444788e67b0c651a63ec4eb0f77c9bf0ef68afc6e62128bceacfba13a47e023c6faaee3c619e471c173a51c2cd4411a9f34e0f4b5fbe84345c60e74f84e5bb75eb04ace1b10405ef5ae608e214a1e39838b9bd4bc76ae5e444f6f7b48c1c54a29bf84d5f911f2ade92193d7dc02fda263f72b2b3b6baa5a4fe5f3b8c2226106673c8e8bc626597e81d56cbb54bf8b3d68342d8ca72b505f3ea6c3e95c0fe66a542daee5e5487a15ac96fb4099cb0d6112c5b897a534019e4c3ae54f82a910f10d757144e6e0242b3f64bc32f3f1fc7d2dc5ac779c60b63b9e7138f0126748da64905c0868c36b5c7bbdad35c078e7b2dabe66dbf2412473d38571a97ff497e715d16c184e0c310a44b2b2584c4becb2b059716170303005f4eafe9ed8c935f7725035adc100422c722633aec99bb085ea3d32b87206b330e3f31f51e7db76dc4e2a0f562c5634cbfa72da16db78606f1fc383531ce789e78c19d50a01db91d2d19e54359e83eb1bf78b445af18e5e68afd985a5c92186917030302172c4cc8ffe4658b5ab9f57383ec481daef6edeb8b2ef176a23e0305d37f1c8af52536b5bbe8e339b079881ffaca7ebd9ef3deb4c2c5b5c9b8847a8d9c2ab436bbcaddae027d0396821bc40314f51b00f904228a338a02607af2bc0eb3ae764fcee80cbe155941c1ad7e0d2b20efcec20b49abb30fd9a20f65a11d6e27729bbdd206ec082f953765a763a31968cb4c34355d071d677a409c31b35c2d101294c33664cd1c39292757e19d05fa6b5fb0c0c2c1e4ccc62c8315e61dd91a9c200c459e37612efe313334bb292a56d0665a2ffcc9fe3ade7943d8e6bede14fd6876327891493eae251ec57be177b893eb2ec8644435a106ba4202318448fc07fe821b622dce71405720e8ec1789f4a9ccf63f399d201831674201513b09ff27c3a2b89d13415f5343ab5c82495d692be6326e08faa4b90bf1bf09e5317ade350b2250b92e3750b87ef140fb3c6dbd72ec72ff91263c0221dda6c8327cccc5b903c554c7e431e87cd01c2c64f9c291b8687102305ff2c2ca1105ab00dc4c54cc035183da20294fc6a8712d0736de196a97bb38acdaf356ae1be2e686aac5eb04594c814f8bb93b83b28e59b8d51ec414d05b572c6c28e0aa6b8a8c0474c928b983f1a3a83e6ad9446f61cc1ced7b54e46d0db2133d6deb01eedfc6aca335d7d64519b601f7784ce9ba8f99387cf65a0f40dac80198795e178e5464a32bcc0c57a9e5a408adfea63680c7b9ccdb1c863d1df16a14f13afb5cafd14617030305536e49d346e03977f3e0053e968ba2d88969e3ad81a462d887e67a2a93dddfe2d7436e22781ceaf7e52c2eaf190c37c25e4bd16ed79a256b057086a49a8507841741f490f372b7fe5b75d97c1190c87da8be4e8785acb1572eba94f97abfc545d8850d709b4cc94b12b36bb9da53706fc1e7b6f3c5a0eb16af2693799659bbda0fd0ee8106d980d016eea154be5ec706749f58bafe3812ab8936b3ca2a35020935ee72f4f93a09b21aec5fb91d3f5b39331d51df4e7aa7b4230ff2de7cd567c53834d2b927ba2d54612422a127ae6ca89c9891968268983ccced3f92018371698d8cd681ce7a00c9c33fc0935aef41b7a57ffb7d89e7a3ebf24d23564a97643fd6d2ce9f5106cafb10edee21772a9456ea8b666f6c8cba750a518cbde33145df9b409cf74054595f47e4fd62521d49fd8b7a48c18693f4560d5997fc442cf1cb70983a4a3f506198da10cca030af9bf5ab3f9d4f0f39dd92cea13bee52d27f19cb03927042607b9be06bf2e53e5c4cc16eee7ed17b7700bcca4972e3f682f24a40cd3b19a514b2fc8d09551a29e6864b8cd852c245f9267422388176e0c4c83fe483d2b2f7398527022076ff9071d3fc206a4b22c0868523afc1390ee0094df37bebb8096baf93d95986b72065bbedbb38f32dcf32a62d2a717c959a59f990fc2de93a70dcc0f7593d52072c2b5f0e49996aae8239217ee732d341fdcd2d810be6ddddd22276c09a46ea1262b33dc342c9762f000eaaa4e8bf545e54bb2b998b5c76f9ac5a81298fc57f9f5e4ee7b925f8b134dfdfa08de3067584af0e86e8b9745955b4e0e209fc453c4a87ae62a482172636ed627982af9d80cf26749c9ec9d920054fb5042a7c0d46a0e6c010de55bdd699e8bfa62a690302ce956b9ad6ff9ff4653918be4eda472d4b61321eaa3ffefb43f0b430c65b8b9156ba2730bffa6899f5f03d3c3e76ced6d1cf7dff663b7555aa5a8fb589d7e61b4c1ee8c84deda3b80410f3045d5cd8c76180bdfcc159647d5594c7d921312568786b34d42896f18116fd86f3aa49c421188a09f77a7ade07ef0ef55cf85a1416f8aed111a179cce8c0068f26e101720793240eb1f4988108fc39b26e8ca5c87430c5e2faf77104fd2233e178359618190a280dda9d3f06e414d9098b97d093b573ae8b34b1fb38018294019415e5ca04a71269d28ccc29bdcbb2a41def67a512773b87f00e30f315897f20332ec9a02081472fb8a7a9dd0f9fbee92e7da301bd39c6ba7405994a551ea054a78fbe8183ba82fd93c300ea88e3c587740238cc7e9b6c03c4e66ce37a4b9fac14c2b49520c4c4ae90a8defce4f5050d5218dab0c7052ec7f191e438b290aa3884e39b9162731064e2129a8a4b92c710f3ada848854debbd30990fb5d10f494138f09ebc2918384348e7fc6eb04dde09fc90a1595199e90ebffaf0de390d8abf93ac0894f8f14a61c3915276df375a73d975937d82c60e719b90c139793bd416237ea5bb023f2917ef4c984fe8f62e5d2c2b2f354c8d12422901ec7727a150687e2fb56f4ccfa9c3d8d5c189c53f0a5a504a2bb54f2cf82980f832dde951025e731b2bda8caac33b773d1bbe77226b6bf643288f303d060834566b1abeff996789d27c8602a388b1564a0deee991e672b36232d08c09fb812604c32be9ea5e618ca3e03c174bbcb75ad210217c3241fa1b73edcc902bbddb9a0b57f64060b0156c4ca3ffd0f6c0a27b220c183cc2e4a6d70ed71930f0c3fe98ab82140df5ff0ac7ef3820edec0f8fde890a15045c1848b80f4bb0ac7e5bd03d8ab03b97c20dd404e485fae2e51827c8105c536948e309f0998dee252dce110c6c3ad93f0afd05467df874b0c7df80e19aaaefe02285a3e0eef41421ad6dd9a2450967f4b11d06df1a9e351490119bc099fff2592d1917030300e47867a00b245092c645c3d564267c357379cfb308045e64a1da1bb749dc0cf016baa8c725b2a87b569aa0c551fb3bb03eaffcece061248749c3be0ec8a01ce0cd7e0b03c97b2f5a836645e924cd91aacd7ae2685e2eaa1cab1bd4822236c9c8c86fa27e38bf73f64e0ba8e27998055aba324630dff541cbffbb71cd2e0b0ea788976535e4c5782e9b50fc61f549b2577ff31bfd7da9201da840a2da5aa93e8eb4191a665eb423f87ecbb3f731b8d43ce84c01ac68b8696babe333dd76fc5fbd9e51fe1c4da9e9d22a1217d6f262ed5767460c6bf6a65bafb7e85fcde2d1d3fd6a10f0cb9c"
// ).unwrap();
//
// let cell = TokenValue::write_bytes(&tls_data,
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// let cert: Vec<u8> =
// hex::decode("
// 020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943"
// ).unwrap();
//
// let cell = TokenValue::write_bytes(&cert,
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// let lv_kid: Vec<u8> =
// hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();
//
// let cell = TokenValue::write_bytes(&lv_kid,
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// let current_timestamp = Utc::now().timestamp() as u32;
// let mut timestamp: Vec<u8> = Vec::new();
// append_uint32(&mut timestamp, current_timestamp);
//
// let timestamp: Vec<u8> = vec![0, 0, 3, 232];
// let cell = TokenValue::write_bytes(&timestamp,
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// Push args, func name, instance name, then wasm.
// let wasm_func = "tlscheck";
// let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
// engine.cc.stack.push(StackItem::cell(cell.clone()));
// let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
// let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
// engine.cc.stack.push(StackItem::cell(cell.clone()));
// let wasm_dict = Vec::<u8>::new();
//
// let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
// .unwrap()
// .into_cell()
// .unwrap();
//
// engine.cc.stack.push(StackItem::cell(cell.clone()));
//
// let start = std::time::Instant::now();
// let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
// let t = start.elapsed().as_micros();
// println!("Wasm Return Status: {:?}", status);
// println!("Time: {:?}", t);
//
// let res = engine.cc.stack.get(0).as_cell().unwrap();
// //engine.cc.stack.get(0).as_slice().unwrap().clone(); let slice =
// SliceData::load_cell(res.clone()).unwrap(); let ress =
// unpack_data_from_cell(slice, &mut engine).unwrap();
//
// assert_eq!("0100000000689fabf7ab8e1f759972f2594613044e4a197c71d4f3f541d7e2afaba98838c6d2e031e330e2fb0805dd8ea233cc05ae3d1d52ea11d0db3ae013e30b1f71808448606f90fb06a56215f57ad962829f36187e345c60153a92f9169f9de61ee7feb5dc6eaadd908e93790c729ab17a3ee9276f51cb0081e5a7d03dd76717ca596bdfc183fe5309d70b1b9cbce2757448b8577d9d1a00c30f56de34e5524255c8a51b0bcfa5d7661dfab69b7ed0e200629687635e769f43a8b2b0251d23da93753dde5b8873898500c85ea72ad05c9b3c1d014106ff21b12495051c87ed593fdc963578a73023b3390e88c39a3941ae443be09fff2a4d1a36c64c2e439ca82bb1dea584f325", hex::encode(ress.clone()));
//
// println!("ress: {:?}", hex::encode(ress));
// }
