// Copyright (C) 2019-2021 TON Labs. All Rights Reserved.
//
// Licensed under the SOFTWARE EVALUATION License (the "License"); you may not
// use this file except in compliance with the License.
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific TON DEV software governing permissions and
// limitations under the License.
use chrono::Utc;
use tvm_abi::TokenValue;
use tvm_abi::contract::ABI_VERSION_2_4;
use tvm_types::SliceData;

use crate::executor::engine::Engine;
use crate::executor::token::execute_run_wasm_concat_multiarg;
use crate::stack::Stack;
use crate::stack::StackItem;
use crate::stack::savelist::SaveList;
use crate::utils::pack_data_to_cell;
use crate::utils::unpack_data_from_cell;

static DEFAULT_CAPABILITIES: u64 = 0x572e;

fn read_boc(filename: &str) -> Vec<u8> {
    let mut bytes = Vec::new();
    let mut file = std::fs::File::open(filename).unwrap();
    std::io::Read::read_to_end(&mut file, &mut bytes).unwrap();
    bytes
}

fn load_boc(filename: &str) -> tvm_types::Cell {
    let bytes = read_boc(filename);
    tvm_types::read_single_root_boc(bytes).unwrap()
}

fn append_uint32(b: &mut Vec<u8>, v: u32) {
    b.push((v >> 24) as u8);
    b.push((v >> 16) as u8);
    b.push((v >> 8) as u8);
    b.push(v as u8);
}

#[test]
fn test_tls_wasm_from_hash_for_google() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
    //"d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d840f5959c3cb911566de12044befd39445660adad6fe7d9d2ab142ff079db21306667b11f1c10b45c7972d2dbb2d6f2de8394baa546f5ebda274c8b6cac3b6d9c5875d9f918265db25d1bde74fb9af72f08ea5313d16a94c843e33ec48bad0bba82f67bb02d7ac1e2b58bc0545b8f2b2777f7ba4b33f726a56865e48ff4980957a9515126b7f113241c9d13b78134b428e451252e3ac15776a93ae19339e6329b821032dee28e913c5cba7542ca3c196aa1490baa65fce33719a26e720294a5c0d11499e265ff70db69dce3364178342e65718ad47165756cc7ee4735df823730fdb78d5dc45d98be1015d8a4eebc05b6318779a56429ccd1f3bc024ee4746158e6b5",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_kakao() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("6c4722563f51d15766b27299679b5385cc2d0fa6066ae7fbb511bc975fa1fac40103160301009e0100009a03037fb056d5c15551da4c9ebc87b676656ea06002b0585aebcaa1a8ef36d3a8849300000213010100006f00000014001200000f6b617574682e6b616b616f2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00208f0c6511029ec86edf19794ffd671ddf924d6ade4bc0f245c320a9c0d480c93d002d00020101002b0003020304160303005a0200005603036a7568a19a69d3a33e214dbba29203b1f6a6786adfb27e764a4b71f8dd51f84e00130100002e002b0002030400330024001d0020ffe76c9dd51a0d6b80eabaee3557c9d4c5bc05ba8cfe18e3db3a374fdf238a2c1703030fdf136cc554ab9bd815e7e8698330bc070b6c5ba78dc8e92c0c6284fa2294e808d2682199733fb5e53813010d524dd96cde06b45cda55b67f1f3fac65646ed590e1029ba7d36da9ba01705209e20a4d840532716d83f4356179b870cfb57892429471f8c9603c67c0562393dde4b929526a0536abdf0a321757d099a045e13f6753a3558c4e1a27312fc7a0cffb1fd78c70a4768c5b9c4877b847efa297d27bad35c2a0a212d089e2f5c50040ee1c5d0cabda23a66acc97ff5ef71d374cd18eb809ba31b95a5588298ec4894d122b2862b94038679f65b6948d0d37164f5d2a698ce010c812e50f8cad06e999cfa4c308116214acf98d632afe69a754f9fcf97aea30c5cfc99f7d15e9e27c86ee9c7eba0cc0c632f7b1ba1843c736eeb6cd0a5a5efa4bd7163b320884a923cedfaea9ed6176217dd8afe626314a65afd67b109eb74c66766ae7cfb7be8a636f451d1f086b37af397ccc36bd031204996a6f8da26bccfc0f79c6e889a46cde48d52b89dcef0e24a20fb5b992d2a31e81c29fedce75ef2c50e400c3651f7b56643a44e57819702abcad6c59869ea3692d2364d4dfe781f3cd8f393b4047c9b7457c2620b9323145f5d67a1d0df05c41b3bb5043482c82834f556f5e17c22c8aefbba6dc1e6abc39347eb4a09e10dc3dd5cba76edeb9c707a961cc7ac411aba5c345fe214128c2d0bd14193597447e4cf62b837ffc5dacff7898c56164a8748321109fda724033ceb426a1254a0e21c4a9d3660b908226a86172a3542f35cf0c1132aa1df908b0d2559d6b3775992582f61b5354876ee1c8d39ec47821e5579bcfbfa4371e9195ca12c1307a49830cbd15f403a4fc9f67469d34bf47e7c2a94dedd5913309147826f557f8b386bfa631c4d45a34d1046227cc7d3547e4a9e92994431409291cfeb6ab5bc93ce84c31c46d235d6a434a8759cff38c2269544a05b295e6eb42544ab59108e90f1d55a4dd9e64f024db838380e0b5ecab8aa2a0da600472d6fc953c1806246c7cad09cd816f489dfd0aea1850a0a54d89146c80b23d88beb2548004a36559d6a2fd0b244e39d5043918a1d2c532a625de1da8940f577f4ab80c2de00f8b634540faca688a523c45f93c26df0d922971b0ed996a016595b8538491fcc80136e1601dae6a3b3eaf538f3b456a068262c782026738bdb59aa82d9b6c2cb92adf906301b53531a5b63a24e3198ef67f5fa7ecc763c321c1c3dc5b25f96a1341f981477fa832d555b925cf1db20bb2b3b52bbc9f9cc5e56713fc2f0ca016c1895590d99ec588736a2edd4d7bb8c7a53174d9e132ad6d8e2687a5cdb6dd0f4f6afbace7a0ded04bab5e97581218145c3ec0484b35ae38b18a0a0b09d63ce39ff4eae94865563fdb5ff1b7a40cb8bfd3220e5ca59b7cf4042daeddd116e3dcc10037e1e9f78054733c29d183aee682e63e3c656d43b4a07ed763acd92987dcc768191b668877438966da23bc238a3002d7c4c67fe428b3743dd4fd18b3871cb3708dd870513b093f7df6b43af91f0f424f70501fb5d50a2ba1abade87f30aac3e677cffb8361e2702b37d1af2475a5b714f86bd30c9d5351af578edc7a92ac6d7aad24a518a1f509b1a6634573bcab9b37624e5842d3874ab8ab33d2c8aa5c9f4e71a1b057802f90cb033f3e30e72f1464c066df5634eeaff16eca46a02d5d0c32ae10b4ae54835d7a6e6ff14a3e3d98e985c40ce7de43188653832cfa41587dd8ea5035ed14f72e0236f6817d6ef99d97ac3a3cd3c8d35f84e152fce75116424c617f2fd539af9133ab6b82b521949582cce54995aa17720e3e8c2c1a04272a45e7f460d3d048c31c3bbc715eee23b2515e2b114f9e9970ff0b6db7e5b99aa737d1c9e85d4334fc933598eb8f1e3281141aa7bd210f8de711d5996ee539ddf8a0c4c25f7b8c37849dc3f84b46f9271847115f55db8761645596fa242d1e377ab02f315ca78fb5439c3a9d14f2a44b3cb29ffd9e89210f3386c03e1076d21756501e96c1c6e0fedc547299a7c77421eb7053e9f139011bfac423fb97c56ba565a840196d982c632fec79845d9fed64128bc7388e61b30b2edb941a8d27c3e4d83b97faefa7a76318b688f18177e72b082ee5c3fba3ef9b2c787ab50a7ec432079dcaa6ff9de4c0f7c84bfbdad4f071f665f2d05f42453130958907c3016cab6b06e58b13b468cf67f352333c0ee5fb506f2dffc0f8ef68846a0c3b482a13e1037a4227ce52c9dcdd7542029f3f407efe3e076ddd84daa684da8205b32f09685a17f3528c9e5bb7f2b9d315589c4005086a17e9456a3e533f932bc828224ee18d752cf63b8ecc3048fd0ae703d9cf0342b51f8662cafca0960ba31b7ae282b6b1614eae0bc108e01be5dbe0c23a698c582d25c2931e1a0a205ff4afa70c4aec1d0925d8b5d12ccfe8780a0391ac606f796d922b92a86ade72b10616301fd06f6641c5ac2433aa6ec49d587fa6055d5a3b5cb7d897068e9a4525509de1f719dcbf155c6248a5b779e873442b18ae85411bb5841e7c4e95fb37e449ac0016b8bd63b29a2258435f2f410dfe3785c07a3bbec1a9dc5f3c19443eb052946a5e85b275c7ed117b8f1c15202b85a14c4ba3a1188d7a7a9ac64da9c13e79887980e439262a4d11ae250bf334a2234630efce65cbe68db5abce69b9f8fd2b6cc9a0b099e4b670fc94fbc7e17291b3aeef0ff7b322f1854f1d736f6e89e8d1dfa754e36734cf4fa0f5b83a40f62a4ecd24fadff778db505ff9a8f7924c7eea269a50f595edd46dde7aaa8c252823984758ec2252517a3885ed85bd37fdef6282d55f204fb318c07d01fce7dc9e542074e88f5322479f7a80284825b9de8216321d56b620e26abc2448ca539eb307e29d3b7a1f17a045836653b6fe6042c70997efbec71ff81307246a86fe991256ece0556b3b70ce040c1c3a2b4b3bf46916cebffa35bb09b240192b026badbf7f5a54e1b5518b6b1a2b8b7028bbd7915db581cb61dd65642b4b6df15f5c7d713374067a586ec428a1610d0c2a793231fb2a700f4d972110792174c059e13083a9e66457eda47eb7aba15d4d6dc2e9e52edbe8bfefac79e811ea3e109705c7b1edfe85ac96d77ea3c78a42d15e11a88c7e1e6021cb6cf50928003cf76a99e5de5ed193ddbc21383370f6f3ad845317bf124b2d3cdc375f0c4b367b9733dc9c88fd855f792eb8948b8386522220f53d63381eff3c64dd6371d30af788c9b9729223aa87ecb490f3e6e8a97d93b3c20b23f62c8501d9ad19efc3b48162e105dccc290e3e3ed3897a9256b9c7e104747e393e0dafd3c6fc4a5ad803168387e5a47c7bf45ce701e4eb92e8a041e37d50cecc1eaf33059349742757450d402733597a453f2735012b7822f8a47459596230ad103bfa6c315b641755b0c725c87d5ac47b10f55e9e06da887a5b64d0cb2cdc5cf5bc1e7e5a4b103072c58eeab8cd597a5e4cdb0f8d0d6221ddbf697775c97d26cc6d665049a5ba043a1abc907b6d71bfd26d330fb90bc0639fd0f3876d850c19b4ca4046e9046bdcba1a77aa3c87fdf8ab2fa6202edf9cf9d41c7f6760fd5be7b363e9ca15c293030ad2f99564786660b4eb5001588642d6ac2bef46a8a43566135e6e29957f5063ba3e1b18be27f53ea007cddce21eb777df4210dd3e87a9f860e1f4da51cbf03b4af8611789d8718afe27f3ebb05ca97b35503b7c94dab18120dfd3826a430085d66ec2f5d3912ccb99ee8de153c4cc5113afe013a556aaafb8a880ba0eb595c212460882912abed8803157f485a01de5d9efa51e7e1c008ac85ee838fc20e0edec850c93dcf83ded009751a00043bf5bba42b1f0dfbfb18980520116abc181d4c732122ffdbafd200193ba5e4bc0dc1a2ffac6b6459d227815c62a29627f798a7b3bb751036658a8b0ba8004308fcfc49e740ae9c4832b581725693c4b8659faa34ad34cfd3e55fd2f41e2c2d81c72f74175cafacc2d5a81a0689d7002824d9450c7fec39133cf768a523ea3e298f90b0a75d4dfdbc2bac5e68b3e71f8f70a810b88df954fed10ff10ffc8d892b0201ddf598ba6b1f727de5c30dc1803c7b154f500435d3e83dc7830d1e2eed36005c8cd1940158590804b1cf4b8564eedea6d5a1d71c00751adb3a44b47ff3c5b5c49ba0ab222c27e4c856ceb1ea609968c1eab399760e4bb3a3dc8e8459b3e3f5c25e3e228730b12d00b773bac92b134270fa68e8addd89186070e665430919714d3abfaf9c7b1c9e6ad58086d974c78ab74462e914d2c6755fa4218064ab7af3656e87a1c426a28f49512eefb19bf4efe46e2d243077a7e59315438bac4f89ad124e49cd162c1a4677a9564418bb7e90c7d0fc5879b6d2f1ccae93c0559f192d7c3dc4abdcb3082d366ea6d2392a42783c97429e94caba318ddeed3cc3955a1fc8dc9d99d223cc422a7ae3099985c0f5a0524b189034ad58088c9dadd608fc35138bdf400f7fdb09c357e461945212495fe5e410659df5d4ec18d5a132220044efcccd4e1510ef986571b13da25924c5b61618343dcac3ec5f4fa9a10c89c7c27a4a8a9fc2e75f5d30204476de7fb3d4989a3739dba007e29fd7a7a54a3822419ae937f9bdfaa116b2ff65934174a38d59d5bda2688f50985f58b3f226a9c90b726f8dab6791052240b3dd53f4a48136a15396741ca23b2418419af1d69f23cc4be62d7ed2e7de9c6be197a038c008864d62a16a28e7fb326ebf517cd1ec568d60e821cbf2eb9b07f00e7dd40929c5f3050a65d5598a660733987984570438172c704c5b94384b88e740afbd697ec4d84fc18983e975f2d465cb87d6d5facff22233b4fefb046c14df57bf1e61daa8c5c973eeb914090e5f55106a33fbe09a1753b2ea91d5568e26ca0ea50759d56a7c19761afc9c4b3661d14154ce72ff93b07801bbec173dbb6d5b34b0792bc689698552da2fa22f9a0c2454c721fe459d3839b010a609d9b6dc809a59b6365672a59330c748de141dfd6e51f72fa3e90f853205926f1d08ff29b8fd46022351934328c3a6d1651ebde91e7878869eaa3f71d9cdf3b94f3eefa6e83c6e98bd9f4b83ab33098e121906e3bff7df7a9a22aa64d71083f0828ea846a237a0ad48e0ea48990223f760408d2ee5743f1a19bb16045dd969196237f1a57dffb6803733d335eca268cc99093c75e23b16d0e5c010b5b18e06fe7dafd2567672262cb07ff0e00f32b11091d36d4dd1dc9cc93e730c12b4749eab346f74122ec4e000fafff635dc5b07c35319d872196c053564f0e80d128b9497144627f61d8215cbf1d1a9625015a2623e64720b9264d32e6f860927aa38a598821e746e1a312c39295eaf85903ea1712c6933e3c853f9d663dfb469425059af10bcb240f14bf3f2aa084aa3befd386238f025e57b6ba91aff0ebc1a12d22bda86726f0a7b8bb9228f6927f6dccc7afa85f6c33d42f8685bf87bc695fe88e7c0bed1fc462552c6ca040ac68e9c704d5ef1f9478a383486512461c2cbbd0fe8b84d04c6701c46ec64177f0587f9382303471f698657ed4f2c9deace32ecf1b032d40f20aebd1ff644c1200529322c30f1570646276756b7a4a0bfd975844094d254185a40d9e26c1c911001a7ea15b7c5c48bb980cdf5a7ba72a39c47a8a10b8779d46f9d934a5a420827cae6d1bab0f1fd55781fbffe2549e6edc2093a809c74e052fff4f5c23389404c9095ef839ab8a63757b92785c86727f0217030300625a025dcf4c36ccf06a276925eb11d9a3026bc23de2649754129bd33bd474a74698bd65ace0d67dfb83f368413c68eade247d1d85f32ce0ee3ad619270df22d48dc62639c8b650833619bcc005fe87f510103474afc67d680feb621f3a419a1fc724b170303010a09b2d94cc205c5b598eabc401a657a4b40c399b9a1b1b74fb178e8187c5146aad6e987a4e314a054df2e84c5018d6c76510fcddcfd294f816bb5dd3a0d25303da5eb1cd53f30498cdc692171d31d00066ee3f2d3cb7bcba62f62885ec8b9fc6f1d09de6f0c3bf800b1e640623cd8b98cc5e5986dac7302014b63700eefb949d56127addb43cfb053679bd4e221e7b04b1c68e944fe8887cd7dcafb36b0e4ee70007bb018fd1d028f7feaf2dc48c8f2aa606a0a5111f9d8a46c8e10995f13a41dd15b737116a34febce921679ece590c2c896456b963a387373fd55a4eda23eac9f317edf4e9e3f49dfb60edeac1f41e9fe1a1810105d112457f9dc8c9d9eaec76a5c0072acfc88595bb9170303010af68ae882a02835b98c37a929930ead39e5e7a51ccf364ec90aa4437c873f2ba9c77bdd474903f5399732f9ffc569a7d8d292bd4b95182b706ac75328ff68d3b58b0503a39277f236e5eaf8b0ea5f2a2f47f02be646795874219b1628b9b117a418408b23b7f0f377674aa4b73c9e920d9e29bebcc1341b6142987ca3617833da233af16854caa3487814c89e2f3c5db86924a5d1fca2f16f576fc19b926bc0e1fa3455edd598994ee7b8538f4cf1625e6e6117b4f2b25f121c87a4e7806b496a4a19c863048f860ed2b80181515f643c3c7a07f8ac38568a7c8f6e4ade15baacf7eaeef46c5a67e5d1d8f7b61bec54defb2540a9f3fcfa8b3f9994a5a707f7fda7b6db30de7634e3c93417030304e845f478b916b72f6715359591ccb64e2b4f14995314b6bc89cfd0f1378971e5683fe2028a1f6dbebbefa4633018234030ae145181bd14296b077b7794268090b97ad96f374cca2033594eaba7f1a9f61b3e0926e3ef661a4ce7958e9011ce057cdd120d55df55f109cb8b03cefe353b91e44b32607140ef67dfaeabce68d103582a2aa0f51bc4a40f4ea42ce0eefabe2a7d89b1b5d9b8e49baf013da10bf18296ac5f4d705a244a5d9450a8282834dc2aee38759e633c820a66b58403e28361cf1cab4bcd7b2e40bb9d35fd578f68d3eb9ce604ec8ff584f4d03094e5acd53c5ed88e807b46622580531b5d6155079356a5c5533eb2eb959cda7f376a5b83d8c1fdd1b89ce843ec3df7ed895355b2ce024cc03c899b65d0ab366d623608134ed63c035c1791811722a84aebae6d6e42f770966f9c924fd2aae753378bd2d65de938e6f5ebd3868b54bc25bcd13f229fa2f2dcb65901ee2c5110675ddaa803e092b656f700287e3c608bc3835c629bffba87dd14a9181e34c147dd75a686e887f2326b9b1b802b33c8654a515501a5aa10bee4ae9ebe375dfdcd44a1363e6bfb54e9e46b68b8b53cefb6a2cb8aa54e2a7d78ab22edfc86a9a425bb177a06dfb297cd851561cd3da10ba9a6cb75334daa1a7fcdb781d1c6c6ea11f05e105fed745999edae21f5d05fd837c500460368ce84cc8cbf1df72925229ada5eea3e05599b7d1b026da7c4546a13278a60bce544767459db8cb937024c79665685b603b18d4562f4a093bb41f7f3758d2774bc49cdef211445034e8dc681ca89b9a1569d12abb1dbb5b96c73631ad6a0cf9a16a0d3e4e2533a480b14871dab8be44b81d6ff82b668b7515be77ed9887d8ce4c34c0b506c131632c4256af84f502af72ee7b59d056b8f3bbd81e3401919e1c774de63fefca5764cbe9714dd2fb6a11b00efdf1e54c4925ac682d295d0ec371e092fe0ed72ca9f98117c10e841e7851b7efbb902a62e70ead9937a0b9df3bffcda125c710f489b7b9561565afb39a151088d5fb904572c1df9cb8c8ce5115530f83a33cde9d8b791a9dbfb09cb3f6835ebcd51698131042bc3bedcf44aeb7d744fcb941a4e2afa17e97487f7814fc903b4fccbbebcfae6d93309b6e9e559efc3dcdbd659413895731a5a459783a7a238f5d7e33fe5ab146014b8b281c6edab6ffaf9fd57574f742d7969ca24892a3f3c8a29ff1ecbe6c03bcf9a8dc5b3dfe4773e3f6b2bf5fd2a6e3cda02917e6b1f5c1038c811535c8d6a86ea7b2edb6785909e329d32a7b054c1bfc904b106265d30016aaf6de47ab44c26d9dd4c4e1452e019275496e0155b46c258aca8411664213c211f9a218674ffeaf908b95f894e655cc7734a10c52097ea5a4319074c8295eac94c48a9ee42d24ba5a4d128600fcbe157e2b4c32b2563a26550b7f345115bbf24ff93c30cdbdb4cd87931b61ef24f8b48c94ae378af58186dbfd107f35e371dc46b1a99935503e9487388da08259271304adc7c23e51cac6f181a7a8d61f3a46eee441dc1230f7625d3a8c20c75d883eff9ed00afdb95d64b036320789ed6cd4922c651a952d07926b3e850a498cb1d9c839398dc03bc5fface93c08bc4071fd0c1a8591268174ad0e832fb0222dd0130389d00fb3cd53ddbb8f024a175c1b830242bccb85f10483b211adeda973e7ed46b1704d4bacbf51351275b7dac1b61e60fe3b057dbaabd38579b0092a4aa96b83cf52e1720c858ec86124b65ea0bead546c4bda3db2986d996").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03923082038e30820276a0030201020210033af1e6a711a9a0bb2864b11d09fae5300d06092a864886f70d01010b05003061310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d3120301e06035504031317446967694365727420476c6f62616c20526f6f74204732301e170d3133303830313132303030305a170d3338303131353132303030305a3061310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d3120301e06035504031317446967694365727420476c6f62616c20526f6f7420473230820122300d06092a864886f70d01010105000382010f003082010a0282010100bb37cd34dc7b6bc9b26890ad4a75ff46ba210a088df51954c9fb88dbf3aef23a89913c7ae6ab061a6bcfac2de85e092444ba629a7ed6a3a87ee054752005ac50b79c631a6c30dcda1f19b1d71edefdd7e0cb948337aeec1f434edd7b2cd2bd2ea52fe4a9b8ad3ad499a4b625e99b6b00609260ff4f214918f76790ab61069c8ff2bae9b4e992326bb5f357e85d1bcd8c1dab95049549f3352d96e3496ddd77e3fb494bb4ac5507a98f95b3b423bb4c6d45f0f6a9b29530b4fd4c558c274a57147c829dcd7392d3164a060c8c50d18f1e09be17a1e621cafd83e510bc83a50ac46728f67314143d4676c387148921344daf0f450ca649a1babb9cc5b1338329850203010001a3423040300f0603551d130101ff040530030101ff300e0603551d0f0101ff040403020186301d0603551d0e041604144e2254201895e6e36ee60ffafab912ed06178f39300d06092a864886f70d01010b05000382010100606728946f0e4863eb31ddea6718d5897d3cc58b4a7fe9bedb2b17dfb05f73772a3213398167428423f2456735ec88bff88fb0610c34a4ae204c84c6dbf835e176d9dfa642bbc74408867f3674245ada6c0d145935bdf249ddb61fc9b30d472a3d992fbb5cbbb5d420e1995f534615db689bf0f330d53e31e28d849ee38adada963e3513a55ff0f970507047411157194ec08fae06c49513172f1b259f75f2b18e99a16f13b14171fe882ac84f102055d7f31445e5e044f4ea879532930efe5346fa2c9dff8b22b94bd90945a4dea4b89a58dd1b7d529f8e59438881a49e26d56faddd0dc6377ded03921be5775f76ee3c8dc45d565ba2d9666eb33537e532b6").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("0f3f96980381e451efad0d2ddd30e3d3").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let current_timestamp = Utc::now().timestamp() as u32;

    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![5, 107, 97, 107, 97, 111]; // kakao
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d84188abccd9d1bfcc35a2dde8dcbcc1de1c8c5a268a52df14865c9a1352735b6dc7fa10749259b790831c1f165b03c60540d4c98f0099f8254bd635a80d3f7f1c6cf9951676de398d26d4c6084a358804c12bad7cce6c44e877b2b9b94e22d6e187cebcacad196d6bf5340474b7bdf28ae4f3eacd4583f26d123748aa2aa5c8b59b540e72f520e3111846f6d921692edb80cd3127a17b2b4a533e8d8b890a3959337c6375d6b523d48ae5451f8b340f55f596267a8cb0cb7934ebaac3e536991e8af96cce60233b7507816652e1484e95ca190652e479ff0a4f0181cf242d618053c4f398eccb7913a8b2a284d1e649e0448b3089936f65d2119b8dd701722f456d27",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_facebook() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("74c6fad894310f917a22dd3b22f4707223c2d9122f1be2bade044aa538d012ef0107160301009f0100009b0303a77a2866c8099a6089a5751c5644c020d9756ae9fcc801e09008ba9c9c3530900000021301010000700000001500130000107777772e66616365626f6f6b2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d0020f46f9ef9728def70a1cdbe1faa907104b4630d004c923de8756ecfb0be369915002d00020101002b0003020304160303005a0200005603038e220c50659f0deac012a42ee6832f122e7985552504779fa79077b20d926ba100130100002e002b0002030400330024001d002012f24d0021004aa2c39146ae7d683f242e9399f774f7e6f1b86c930c796f823b1703030c1942ab7e8cdd1879df75b50e8f61ac63817ceafb927b05555430b812aff6f848306bc2a5311bbd4f08197589e81280d1f2af145ea79d1ae1d72831b3dd5f1cfffa0702817fb14e4e6fe46e4665c2a8d132563f70c8daa8930da457e894e73e3c1e61df4ff8bdf99ec2a541883459d9d52c1f84fdc3c477599005be8699049b4bd1f5caff25a71210faa50b05ea2aef71ff5f28cfeb0d5170d5fce9718a118c9d6fe1ca3be247f8c5d1c671a2a5962fac0e48b73af1ec24d91d0f2970dc46a06b56d4d8a3da1ae9b6c74419209a80add0be45568680d29c9e3ecaaa51706302269f1a7527333ff5f31e30c692a05c4cbbea48ce62f899fb8626914631ded8a3887f493646deff591e3d90a3ceab84adc0d54e87416ff4e3d5fd19592127b6b46f331735f553aeb72ce902e46b04cb3b785e352634cd5412ac5e308c6524abbdfed6db415b7b1271315920320ac754f7292ccda877f9711579c8f1a66278e3f88bffafe0331b69c5763f43194e145872fc2800dac2bfa03db0f0fdc1773f119e9ab52cd6ebfba229e3b130e41260ce742d1642f9fa78a77519ff95c225dc3123a6aed6fe2476888c1e4b3e0205f944747d054132dc84ad8cec175ba7139ad5b5663370192126c0b4db4f50190fdf10719a19122c4e3db7ebbf857751e8aaab8940c40fb12f156c71c6e492a048ee622b7c889853a32ad7a75a439a892807e221d997b19a56530f5f0e68611f602bd72bfafbeed472b7370308a3ea789485cf0ff65634a901e18002c758b5fdc513884c2a2daf08b9c70afd45a9624225cd5203eb883d1abf709aaa5f6549d8fff0e7b24e76764737945b0925bfa1f95466311ae6963743b59f63e7cffebf1e99172098d4ead289a1a179bd09e167a04fcc7266a829553da13d6cf5c23174fa07cf98eb82a7a3ad79fb4c96bf1cc2b13dd4fd9752fd37f909caab332709993e3c57a2b3eae1f373537b89dc280fabec357434834a8e21eb40c6f4ed0edb8f715e7f9db753382381d1a8b9955ab6f1ea496f091d4f19055fe42d3e16e01026beab160e20f5d94c38a9e4251f5ba5cddffadfe679b619f8be83aef52f21988f5cf191a98e388a650c4ebc47848b7f1a6a0b0467bd35f6a40e5ba669128d2a98c767ee568081df74b8580e0cce7dcb439141a4a9ddc576e5071fa83093fa0bbdcdefac3a715ab89b43442898735e3e0700e4b133ab307963716b302c906644e1b76d425872c0d0cfeb4e32f42302d30e4729bd1149ffab2a7c1978d65cbb43186d38be691a514b0b535c48c5fc992ffb44fe7a91ad0661aaf91f679fcad11e818f00e97a226c21894cef5647dce13bf14d1f23deddc228888caf5f0df9b1ad83c74e16370147e72bb14a94105348b58b6c73356e4e96cdf5702625e7c99d3fb243a09681e5380de165b7209ac6b2934c23f292c39759a82ac58ed895c98f3b65c463af1bf5c4245db19cc544cc1aa953104a51f7b5eba56f1d76fa4fdf7274ab6baf610f7a65025ca020c6280cfea8bd15fcf8bfd115be44c7e50366e7a371a16cc7956523cfaa8833e55e6caf4be2c04a2b0d151e84eec8979ef779cd0c3a3dbdd529d567f6c51cf7fed93c0d722b5f25b6082ce072d86d3eb4d41e1191aa9f361a7cce46c3aa9dc99c850345348cb5c3a53fcf6f8c1162e40be4e01d35286d5419d33532061705afdd40d1890700a514e113cec11965ea58b8c7263d30c88da5cf80b79c371110b503f396c59d325c5068d417e54402323d953de757dabe5d605bea6fd1687b542639f43a89b5b21d2c3aee7b8268a59bbdacc56c158e2ebb950d1ef85e19d7e901775732203c00cb75734ad6ee3016ea780d10cb82d09b4ea2ad979854678923a70adb77b8003b57bba4ce81aaedf715c8768127fc4ca70e26f2c1e3cc70058868c9c217a604e5d1d03527c5996d1db88818f3579e23bef1d6e0191f71d7f103600b2c55a7a636e12fa6fc6e45350a9eb7aa81670994682fd6af4186c1a3b3da87a50b658017fdab81c001564fc2af128e9884f90531d3b607c73bad2d8982bd5a3137d2079ea67819bcf3beb21a9fc9234de5af97e1be729f0e3b9d2c582aa5d9d1ac3b47b08c74909654d3c51b95220c2e3ab5412bbf2597ecca9daa470b60b3f8c28d201beceb9bcfad2ddcc916fa81c6ae2e213debd2a3c5e518e471600490d3f69fbb9ae2c893316c0400b5ce4c43a3609e30adb472e85b624b8d4ffb1685dac04e12da685be01bf8f7979527342f0490d2f499d28788e6d61a5974a676a0e73c841a5951216add7c888159fc3b3de162f05031f2175bfe7a99df586214bceca7342a3bd29009003b53382325fe85f297783647bd245282538fe7edabdc44fd5b24ffa543388e2de11a5aacc6af003c0ceae57271ecdb4c4bb7d02e5544102417124fd743cd7800c3bb387e7f3f6fd9486171c94ca963073a9e6008a035341a22fb4044759060a6ff466bb6927662cf0215f32c30d104c3f97265de790baf5da7d17b44cb8b05013546384578d201d95852bb732f08b85291dd4d9b8d53f2ff9f3c44b0ab004e8d5a48433d3363d17129b9634fa07a5f5f85c31dc52beb249c046994725427b2ef17d7aa98e8934ab87a6e4ed8c5173951e2e975aebd68c7351f016b1ed75b6727e0f0bb0e0a5bb27ac38203f0a3897e5c6fbbc99e5968b07d32a055d9c7027e78591e16bcdf138ac9524c50341ac17a1f33e647fc0bfec611ce908de6b2a68476a27151d7aad8c543609dc643bcd4397ae755054e632a17af5a9a5abf32ebcd95dfcc5c19886dc2ca3ea3a1b7970b28298a971c0c8a0e39cf807f0934bf508436be0c6a4d125fb9664f2cffec10acd398d2126f8e99a896f062982907a5cddc499f8615222509a15b58574fa2dd285ea36259e2505d1ab26289305160e650fd3a0ab1e485b75a0da646199524b006246de2003ddbffe35748f9c4bf27e4edcac5535b550a1709d5d9b3e1ff0914fc626d34d3ca23891cea0e2b2ce57659517bf7071e396260884525054b84992c7203ca117be27851fa46a9c8c56c1404e4188bcc58dc115028636a77ab4e204c86a0e9a37dc851cfeb9a77c305f1ecc04ccb31211d35626af4d74e63e1fc57ba5beff41340092a14974b846a27b5a483e4fd958a1cd97064ed629d0dd5a5ecdd3f4620cafe53c52f942fd02f21c221b8e855ac458b8811f3052bbc6e01a7a61a7b3ad24188edfbfd88226d82887f031d4114dc2e980cdea05700f2bbcfd6f1c5280e2c3052a2082a020b0398f9818c5745039d5fe27711a4b1a13632cf6583c9083a011592d40530de226d0adf9c75aad8fdc2bea2cd6ad748fa824bbe67b48ea9c648b803cd20997d0732ffc5cb005ad0c26f95026a871c66a814ad321171f69ed6e93a3839c8584fdb19b1651bc8a79c20648b9ad9040129dda52646331710b45cd7a65123ecca6929743ccacdcd3725f7621f8f2aa97a1b4515b02cde3e39caa4d6aee0bf2ba448fad0c06d4e44a9b760da0c3d601f3b131179c602681b303017af13240c0715cc529ff81a9d38cbf3a15b75b2ca083372e2e7394726fd1dd4c4eeca6e43065d5a1cfab6fc498e42366ddcbb8f86d00757723045233348d1f52c4adbff338d30572043bad2b367dac644c596fca6cb797d53c80cb6f793d9e399a2a7a3bc965c35e9bb8b7ccd6c7a9da27bb7ae0b5bcfa8ce55acbd5eb5bc7db2ead6c285a7c3c34923524813f2a96bb0cc082ef5c87f5fae7291cf5b9918a281bf2203e8a0f0ffda85e07e87637444821de8247f1e1a133f196f8edba19b31ecaec422d7dc451e7e2ac27029036ded22827800089d67b333f96279a120d8824c01155c1d1282aaf671373f4b4c1e20c4c42433cbfa2a850439395c93aaf92881b9efcc61bbb31c13fea5741268aa27bc08140ace967ce142ff59a4ddcfb0fd4b66b770281331eb2976ca4dc6193b658c2bba70ea3dc6b98193dfd69d4553e21d70d0e2ff02458172d5b33ff438a12e724f5e4bbf2586e4e32f0e80743d3efb6174afaf774e298b1f027bc2f294cfc7265acba212e0800727243756ff46c7b27d9083bc074d948becbb3e8bb16d62a7f1d513b0fad9e633ce4fea02099a8938e7df4c4a926e6284a6777d3ddead286a7efe296c77c238229b36bddf0e7825ce65e0413b59d6bfd5c8459121b280579c05bf5f58d855b3dfc3a81ad9f915e16e3a2779218cf8e2a21e877456bd952894884768e1473578a32d6a56b97106e4c203d421eb7dc5b3012e61c97851f4a4f7b735be791946b613d4a77d5e54b2bd0c403ea68e08adc3729c117aa47f3007affe7fe2dd750165c64817f01f5280065232605ff297fcc49d5b2d5979f7c11d30170303006cd8e47534bf56634f3375439888bea959576be7a1ce5623fb493ebe8f0f4b29034a35a6fff292c0afb4c0f881c9c796f94c8f912035dbe456cf1855ed8709e776c64a7667edb33af85e34a8f2d2c48c7b23f707fab037ae256131a16c01f5cbdcf7b874d5fd7df14df1c8574817030300b194b7b9bafd7fbc2fbb18079d21c867444320498bf0d449297e7344e6de3ec4b3dbd9c1865d872c9cf6acfc71e0853a8ab9838f0c078c5318df6fffa6699f5362f21d0413a525afcce55cf22ee30eab449f77202a050d065b7f3f357a25790e65c53bb13b36188e1b7cef297ed33db73c39e6563fc89410dadfe0e2ff1ec9d7e2e7fc3a6b74480a2de65c0104416766e08790d345bd4d9a3c9de377304e63356f0210508519a58d4c84c3927c68cbf28a3617030305f1e6b6c9da4155ce1c18b5820b94cc3c0fc8a8a7abe8c7b03aa3d0e400c45d68b81a6bbe12e3bb312760735e702291dca0bbdd3899586911b05f0494660ad8945a933abbc6837cf211e53548ef3935b7ce587bec26a84bf99f3b08e63e44399a2b4e0dead86e97651af7f144c17c5e304ca0d56ab184b85f38da9bdb2251f55038327879038172288024e1d751087d1a27b8f7f8d804eff37a54fe7fdc611908728a20cac0e7bb589dfbe6d929987d42b3e0b2f4761f8cc75a00a7b204cf1c91076f2437efa3f570f73af51fa20fca98b6782f8ec8645fd0e1d4a69832ef6616b2ecb68bdba0b2a41edfb0793a4a15231fe6a0e8c478b9ecfe378a23c19842e28896289e040181cbb61a9c3644c19b43c35e3f9b757cb13241d20409179b45b0a2c0bbdf8e4f5babb1502cdf16e9830bd561e6f22eb2b1b6e17d45f756f551ec058fbe80bc47e3355fe3cea7016443841524d6a741fdd7afacd2642273968a04a1bbb3ee5f1441be307a4bf5b7f8267d9a95d4c27b3e48cf670f1c98233856c0fa7bbef5df0989028c07c260796c06ba8b8effbe90ccaeb891818ddb5cffc149c9df5cb4122b3584d30d5192fbea760f5c12d1a1a1b4893aa776c86d5ef63e66f613b720a436290d1cf6720d83b006b8c5d0778c43f19784abea0d19ea27c13236c2ee000da71d5a4aec09c2515617bad36f42e6ddfe1a2081f1a17207dea0717e0b73e1b4126a376ebec03c4187d23abfd1714727d480fc566e874d15f28c979b89d12efca7bcad257c428418d0ee28556e055621b846b856277405c00c7efdc35ca88d887710fe725f29a6eb7b15816a8c50db0bc733b4fc8c47ced152bb04740b94fb3ce5295779eb856977f43be0de09e6627848ac8ab41a9a4c96a57f918bd2550ab0b26c735cf176b8a025f12d35ad966f7d07d61a1a90a4d9e2cd6b89049067bc9cfb765301f2d2016843833a2b0bcab7788c26d976feb4f0aaeb2c1cb51208bcc8e099d90862b96695e5c168e5cb31863193e8d026e434d0da4968a48943dcf7c96fabb7396f7a1d9d2abce29e87b18e76a65d9035767a523b72ccb10679a37d744854b037ddbda9eea8226e2515453142a4a111a3eed6ed04d1958ecf4332df6ebb9909cd9ea70924efe1edfed06041db8228a37a6ae243d5fe7e852c217a2dd2c2df324abad68280e3c60d6e3beaf6d542c21cf47801b4bcbb3e08b6699163d790c067d246a95a576c7f173bd604d42955995440b32f66f57f3662dc19750ecf447be2ba072622487f27dd5b391a9dcfb533e19fe3183d1883238b5b432f0e5753816094d38796df95b2ac837372de7acf359e06fe29bcaf09f36ffe780def59585c46a53bddb4e5c3dadf5354e0d98664a7f74c2980b3d433855faf4eae19bee1231a8d838f2acfaeb0f01eadfcd404b0cd616b1cb9f9e32cf384aebdff7c3e8d42e99f206b5b96ebfc2e946251cf329fc6eed902a47e471ed54f241bc7e8b713ad3291c59fb8dfe2e2afad99f838cc31d6346d5362094a8d09f3e63da411f4e48857a94d47c748c656eb7f7944a30464c544c11e9906393258d26395bd623e367a29ba960b933499abd245111043d193bfe17ae384e3ae555d7f610698c5e4ecfc6dd90d10c3d6eb2060ef9313c022215e6f74a1056e6d485863cbd112b0c9b592d3cc86a1b4e5913d6e3b7a1a2066185d60f426e1b8d9aa2ec3ddbe5a596a133ce2c0c30ed4535f2eb70b98d33f0065d8f4400cc78bb32773711343d2106392e9388c96ae6acbc10511c317cbb4f887c7390aa6013936df3efff2551f9420517dce777d3982e30d91866f4a2db7556c08ce148389f97a85b498c957174fd8da593a3b385f294353db5d1800cf01b517d4bb369c1fe05310dd3b83e0d65b191a0eeb24bee89d50bf53b5a55c52a32b1601e18b4353fcfda8e14ceb8f6838ba8705ddd3ea2a19b7a3f3f9bbe2d9dda12743570d7999b4da7bc15a344273e4349bbc0d7f09dc5c536369da16f557bd8771560150983b72506a82438e56677e67e57f3f28fbb8eb52c313163e6a0ac42ed43193ae3771f942a4196612e54b6315b3c37c8b9152c0535c435b03ada3c95399bf41e561e244db2096ef55ad5e7a10ed25d5abaf78d28bfcede9b85017030305f152e0254017d0180cc62e81b16933c0f673b36c1ec6c4d6f7f25c8367ca660c1a4ab14fc0d60778cf77b2b5ed3f183c3c593644d0379d65474d8cba505047814c7868b6677a6f47023b366b45b720e3d69dbbe39d45222d9774ce1b9e415a871432830b7cf2c2e8c118ccfc9bd264c3dc43b087b1faf79238f9ca03173a66a7b391e58a0137d6eac811ab0d89ac09d0aa15bcf1422144890ff95c2cf2109ee5785f726503b8945030c4cb3d75ba4ee43a18de24c9f5dee666dce1d35f1d501d219dd5677ebfee18676f2920ada8c1a89e0a8826ea8e5a8abee2c195ee3d5452011e97f5089305c4dc0a0fe74b6f5557eed54b7f79f20f57d30b38787b94e3293f525e0b6cf97679a5047997d8b6a8743ad97d0409e44a92b75496d7d76bd2b9be8f0c36afdd29b4114aa6ebe30ef31db77364351bdf829e57a9e9d9ff4d03b7d39d54f5f5272e3f37ff6ceba23f0faa67296bd2803119204222735845f02fb066b34527cbde9c9ad49c0e467ea7e4e788a76ca7091ba66373bb59f7466f3eecea08f01f37c4a5beeccaf923f82e3f1293fadffa2a202ab3253d897abe921b66e13b2abd882ea50ec960223a15d65e5a6e3f1fbd8dbdd205dad273444fef05b221f6fa5dcea8d5c44235657518b9636436a43d8d62d95ad34ee9ea6bdaf6e89341ed7382ecf085128d89bc18d55881efc8dd3d30ea74ba64080b7dfbf2fd449189bb093b61068be5c151e95f588622278bcb098b923e2d7681674b8d642bdbefb2996e2c39986469f1bb515c62a1210bfe16d4cedb7be1e497d51f50877453b5ff8a7a222bd46eafe0407c7fc0ab140a399baca61952872023f200eb4152c2abd43cc3079f02722b1853ded2f3a995c7805192c42324727bf65f1ec1586cf6b0962031f25d4a6f420d7231a213186a04aac249586ee8df7cac1530f66e195e7d2fbb390e4bbc75a09c6741b0256d19c6323270a2d881545d489797e436fa0329e7396c450327a5a5120c2a6621b3e29426d9b116bcd7772a9c8a3bcf9479b9a13741156c5e1f85d5e0c980322c736bfe08af5c70e15dcbbf6fd24be16dac0816f44af227ed518a3ae5eea7f42d76f09b14b9af7f9b0b696de9fad804a89c7db468a9d57f7d4b3c4afb84a6602e4d687a5c983ef89a8a305cd7ed60389db27508bf2595dac33df37d3f259b505b942d5608b35e9349e635b1f901fa193c93a2fbc171e2131b1d1fd3d95ffca111145759bf1f8655f7c6025743b5ca731cff84c553116492993a1fb8e3cfbaa314baeb2f0d0bc287987aa4eae7d430526fe090fa66ef2d01f1949407dfbc3532496c9579a3db9f9b1163a80fcd8a686e49c1f877baaf0f08210825ab06407669fa5edda1169cbfd496eaa54e0049e556e2a4faa4ef49b62125fc45f3136bc81a5cc8d3542bc1b488c1c9929883f55cecb2408d5b48c06bfa98faca69a02a36ffd290193a47cb896dda01845b0ad5d9732cb1ab17ef5636d3574514d906f629489b59e7142cd34c9171ffec93f6bd226ed0604f8e794d729edaf308968d89433d3b14a4afde5055b54372832f37383403e369a9ac70e52d5049a3a65b41103bb287f42426f3beaf513cc059923ec99b78b19eda3528638b5dd6189b52597ccd32b33cc30b456238f2c95144b8756b6c1c065d2c4367bef1adb9b84d121d796f39b3fc43e6655de8160d6898386373105f8672b2feedd251ec9083f31296337fa6ca0ff71fb7c4730668d51dee05487327b15369c79b0c631ecd3f21cdc41dfb8957e8eb64bc8359b158f09d06926de5cf2fed5a5f3292486f520456b383d7728d7c6363e70568689a50df8a904561c8e408bae12b2ffd60ceb2ae90c11694abb715c5d5a1bceb109b950450e4209ea1ccb5405fec7bd01fb5c55e744a7f2fa75f6d1778186be67ca0567af30f17c6a1dce03f5c5c8fd49fd20b034f675b6c13021f59867dfc8f320ee1258de272faf9b8c2b6125bb155d64d71d99822730ad620ba488cf50a301b6727722fcee9470f6ebfc8e8dbb75e50f39eedc415ae2747358647430f4800ef50daef936ec514f7e4356cb57ec6049a27fbc99c512f406d4e80b87bea3fe845b4dce6989e3e68a39f3d01a7378974fa209c654980a3988fa46438ca3a714e17030305f1697b08ce0ab2027aa260f8d9b85853d8437f79baf98252d96da34deed84ede82de768589bc16df6951f3627d8f48cc8163f8466ff57f1be351478b6cd59ff09e9e5a7cecfa5e6ce03f87bb8136f35f52a26961d51f085e28d256305f6834ddbd8539b92733cbf84ed7457feb80df0187dd23e41fae1af90e5eb229c8fcbab35a8bd987a9f31c4d97c6b42860bde3cf449ea1d271d7d6bad8f37983fc0f6d81b51d0aca549b793c7e288a09b8adfd5dc0d5a66cd6f57c4aaee4f68377b2e1e3c6ee3b2a9dd915d59dbaa7bcd92b24f8f80f8ba6f3982c2d1d2fab618d2c9c4c7b44b6b2c7884192593ead88793e16e5a146fecb3c981d8a723462a9a87f5b5b6dbe7af9991dde8073bb4d65e63979eecf7b47d81050aed90739ab6e5ca295917f70f4907491b10acdc943390c7d76624f9e1fa2cc95cd29135fc505acb93d039a09495fd0976a7ac74f2f2b9d6b4ab1ec51dced835611d751574d0e90088140ef3180cd56943220510e811a921b8ba643c026cabb9d37544b6e2b98d321ba222efe728dabce5bc1a58549e1ae7d6ed07ad05626f79b2aef0519258f0234522dcedf2a2f0cc68002c7c8b5554bd64ec07160b19a49817e2962dfd3f7547f448e9b2ae74042be5bdf971a60871d360e0d21257e4c365ce9afcb40c8d719d5b9e34fcfc87eff83bc589a27607eeaf279c74266572ba7bd4e998e880341508ce969956b09fe495460b9f95460e72374f6e586f953590b7518c2203bca8186a0fa909eff8f591a17d2b24230b9724680f5ca50bedf9645ce8a945f616b9e8fdf2a7475cdbe6bed8845a9b792f23f2c3ebe27740ef85bb45ff94cfd304ea3d72eecb5d2385eda3682dc00a8be93276a83cfb7a870548741532c9cea373a93bfcce646cb47e60162cea0252abea09edaf7cdaee14743211eb686677ae2ffc4dfcae003f3fe57325b9ef488ebf115aba20b8dd751b880d29f932b3e7a79665f92042b2851a3ebf06822ee497d531c69aafc470c5ee9d9ed897ea55b80e5459eb11d9da5801f7577bb892d0b5cf6a8cc6285f3f6dec75cbe49933e8b759f550d4e0fa756b5b8e75f267a7cf4ddda5421277b81b32d18dd5adf02df9a7992d4e63b13e8d8f51ec5bd81dab4762416b485a810407647a8421fac0adca8ed5fd5ac8136f30333ec483f0c177321977f902e882f300a2d668fad08c202bfd48ce55e54760af30a4f48f2c875a4a3304b5483c47eb20a2b618f7ef0051265e650e46ebed0c987fdc67ec2466829d86465e9fdd2ee351554fb35bfd0ed3fdf8867ef4dbe4509f427e8a823f72c4c2d369dc640f6f1224feaa4bfa39ac18ea747579eb891bcd4dbff71dd68d9ba0d60d7a8e3ac81cf077e583ec1d6184bbe2a63fe2cf2a85f0c6f02afb667a9af7fe4b7a6316b44d5e30bd45ea2d40988213b63cfc3958879958cd34494732d84798543f1f9086ea43766bb64cc945bb668cdb0725c1a9ecffbee90675060949160b10a5202dfa29681644ac1256c0ce73cf99dff7ff8c6e623fc827549fc9d5a4cb4ee910bfcc178ebc4d5e94da07305f90ed625114e133bec881dd830a91c4c20fcf8a6bb093c13f2c8f7bbd67bb17409c503a3db85528ca9c5da81bf6ea86bfb9912b75edfbd18a394a66fb8a24e3464cdac86f56f68a7301266b9a46853042062f05121b643bdd7dfd67860ea2fa43cd2d77182f85b9c226ef717e247a3f5d53706a0dfc04d807bfc2efdb95189848be11c97ca75205e22d7cc8372a2eeccb4bf7b89b0c60638164a9b96c0c3978c47c5e01598b94a399742723b5c0f49ecac007ee3bbb157680c6f99dd084f29d035799e83cc35891711f912592a2f0a229c9b670b08952a62dfb7923f528a34a0705e438b7a3709c32c69ce31d1cce78c9a4f2d7cc4cb48436403a092a57984efb3bf691f7438d7ff408d038d4c2bebb2234dd16fc95a89fa60e434f864d4f82f210a1f339009b61fdcae26e4a2e0b833498970104acc3e542ddb85066364a9a51293b3319bb21b957157fac354a599ed487b909922a06a8967e6310aad580e0af1d74de766a4b40f7a540a7be089b782018e1d6b6d9d4430b06c4ebe39bc82e32571bfab898b29c7f6f3a268cd17bd3aff730d92119c66580490841a17030305f149fb42ec696be0d698d0b7563e088ecff7401e3228a2b5ff65611a52242adfe1c7d50f92a7e3eb7a527b86fdda55930bbb1868398aee75f1a484de114140ad285d6f12ceb7098890769577bb5c2e501ef92e443bd5ac8d36f1d437ec774b5428c1cd7c9bc3d3b1304eb8b047cbdbd6d16ccaa8cf25b31ef7a60823a180d28df9db6a82043d84abcb4726be88ad392fa075bdbe654e657cc435a1ba1b20a3be22044593b814d13e07759352541e1911f7598ebbcc1deecf06e0bd2919740e293bb25a43cb4930b756f75541e0373fb2f4ea6f24044017194760fbe9f2f3210d763fdc2f851ffbe0c7b52c7b6beff129b1b174ce2b10b996aa0243fe119a027849726ecc87d41db53db2ffdab800d36bf9acf0e83242abcb8b29d7c42cdf06539e430549b9ad71b2f63c6116fa4739cfdbff50548d42d89509d153890db5380754bee97af3dc20137f615b83a5a91bd9bcf4f84f4ed6952537dfeffe3cc520f0c0c9bcb239a0fd06df0f1f974803cae354e7289d2fe94ef3ef44c7405f3886e52b456b8e55aa522de35d855e2ac640da9114b284a01854d4de1cb175998a93e3a46615f2b35fa815baeca71c20d6c4e022a6a32e203bead578a2a46dc85ffd0a7f97e08c6bdce89c75766b599f4ab756487eabc8c4fe426e8cea8248be8840f10629dd63cc8c04a17c63861fa9c95ea8afaf699064834f07a29ad2f9c6416d4c6b5102bb092ec61a692da017ce367203556bef32a45fa91a925fa35b75185eaeed8c542f7d7c5174ce185fbddeb1d1daf2075368dc002f3b10c9797892a3ee9ea61a994d28741154c039f0a162089d9409b6f67d03740552649b65725179d94133e62a88bbd55edeba7e8014da7bef1b0b211cb37dddd0647d2eec8a224bca4f0e8b5bcfa0cb919ed98f0bd80901eb7341738b2392b6e2ebf46784451bcd273b0ebda9a9cf67b9858886b9ab04375621a956cef115dfb06ab8000b427d8223b009789e0eba990f5f5693b0ee01b63676d079ba8b31f5305536c0a7a8d89a2505cf603ddd21c47c0cbb95601b1b16380fd844aec390aedd3871ea8cba4d0f820458e45e8153689bfafff6ccadcd8e6b758e8b2d37741d88254d4f9c9c3179d34da88117b82a25ef88ec914ad51b5d343db146184d24c745b596a79a5eec2ee65c510614cd7ab7841de4d710bf94eec0f171eaa995d00c13c532f74fee2045fb8d864d2c23b8930b5d29d78823e1442985922546c24dad6d16d832d03601a09e711c2132b079a325dc47e90d1759290eb696fc19f83f1420ee6d30977f6176a64bec3b491ba0bd999d0aeef5e82e8bf25284b5f3d84fb03fd0239f8a7d61cd48750c4a27e86245b6db9180d6c6be574d52fcb0a0a901d5834fa659fe3aa10dad65b417bf6917063c23fa8e5859264c2efcbaa2d693de4ba492346a5980e7405146788f852cafa720f677172e3f203bd8292243bc6fa8516021e37ee23cf4e8a6c84650487aeb3a7c17a9584b324db0b4ba50257a937e8d7eedf15b82d9abd5c3ed5bf039c5de8abebbc82c0f79dff65655becdf6b1f9fdfa8dd124bb32955d283bd77905594940a15ae4d6a0020f28ae829eb734b301b1378ac4bb7ea88f4047bc758cd5b463fe9ffd32f40c10be506e1b598083c7ee44f2489bb55f727a30f9c5ad0745c419433cba82301877fb39b6a0c410b2ccc8daf4a822d5080aa1f823e2e69656ae448b8bb05452f0cf1e4934a8d6e8aca4a815645c20f8280b1c20f30cc1f74c78d7eb43a4eb2b0f0f72275c8c07caa4663fb214d1cbe32bef7981f9d619cff87e24e0830103f375ed6ba8a9e48c81d7e0bc7595f0530ccd28a0d48d065735b2145b652f1dc2f458bd6be13a51806fee4cdbdc78305ef24f7a62a3108103f454fc501624aecbce4261e62de319cb668d470a706bc6c8c83afbc14eaf3c3edb114fa312eaaadf09266ce282281459b21db45214e4b5daf6a179945f92452e4a047ab85267e93e46119b5cb83d140da7890ce7c548e014f69eefb6189b4098f896934c5fd3a90de57428c9b87637630e152a947a8a2cefbeb7afa656a582cb2e6ba7bd4f9b21d72165d38167d8134c2a054320a53b33cff73416d3830409dadc80237bc9801ff4790f1ab52a59457e1f1703030081f33847cda47b88a9730751003f2acedadd426537435f37a74badd95c7723248e02b9d6e42a84e6ff201fc4eb7f76c0ff9c66f9e1b28b2b79b47ef20c9454a8c7d71a0e694cb95c53e5854d3aac1bc0f38d0eb5ca9340f126234f8900eaac81a97436976dbaf9379eac504765b4b3562914900a81f832d6b454186d58f7da341de41703030021afa5a57850a85e99167b742f9520f2098378321b7ccd4c08ca56e5c460a5dfc209").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03923082038E30820276A0030201020210033AF1E6A711A9A0BB2864B11D09FAE5300D06092A864886F70D01010B05003061310B300906035504061302555331153013060355040A130C446967694365727420496E6331193017060355040B13107777772E64696769636572742E636F6D3120301E06035504031317446967694365727420476C6F62616C20526F6F74204732301E170D3133303830313132303030305A170D3338303131353132303030305A3061310B300906035504061302555331153013060355040A130C446967694365727420496E6331193017060355040B13107777772E64696769636572742E636F6D3120301E06035504031317446967694365727420476C6F62616C20526F6F7420473230820122300D06092A864886F70D01010105000382010F003082010A0282010100BB37CD34DC7B6BC9B26890AD4A75FF46BA210A088DF51954C9FB88DBF3AEF23A89913C7AE6AB061A6BCFAC2DE85E092444BA629A7ED6A3A87EE054752005AC50B79C631A6C30DCDA1F19B1D71EDEFDD7E0CB948337AEEC1F434EDD7B2CD2BD2EA52FE4A9B8AD3AD499A4B625E99B6B00609260FF4F214918F76790AB61069C8FF2BAE9B4E992326BB5F357E85D1BCD8C1DAB95049549F3352D96E3496DDD77E3FB494BB4AC5507A98F95B3B423BB4C6D45F0F6A9B29530B4FD4C558C274A57147C829DCD7392D3164A060C8C50D18F1E09BE17A1E621CAFD83E510BC83A50AC46728F67314143D4676C387148921344DAF0F450CA649A1BABB9CC5B1338329850203010001A3423040300F0603551D130101FF040530030101FF300E0603551D0F0101FF040403020186301D0603551D0E041604144E2254201895E6E36EE60FFAFAB912ED06178F39300D06092A864886F70D01010B05000382010100606728946F0E4863EB31DDEA6718D5897D3CC58B4A7FE9BEDB2B17DFB05F73772A3213398167428423F2456735EC88BFF88FB0610C34A4AE204C84C6DBF835E176D9DFA642BBC74408867F3674245ADA6C0D145935BDF249DDB61FC9B30D472A3D992FBB5CBBB5D420E1995F534615DB689BF0F330D53E31E28D849EE38ADADA963E3513A55FF0F970507047411157194EC08FAE06C49513172F1B259F75F2B18E99A16F13B14171FE882AC84F102055D7F31445E5E044F4EA879532930EFE5346FA2C9DFF8B22B94BD90945A4DEA4B89A58DD1B7D529F8E59438881A49E26D56FADDD0DC6377DED03921BE5775F76EE3C8DC45D565BA2D9666EB33537E532B6").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14e4f6715b789895089f5c26d53b01a2991ed2772b").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; // facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068fb9cd98eac9eeb509907c5c1d44ce6d2c045bc9240d4ea41195a82c160ecc731f345898a65a698ca6267423fd3149583c1cffc99104ca5bad9227182c4e07f918baea634e50087298ce52c5733691f501a700c680667d919de1844333105cc4340623e8b66d6de35f608603747804ec68dae54ce0a6dc1dbbbd733e7b14b45302863e78d02f8467da4769a19a84c46e9518cf6a08e22eb911fa0d6a4620ab2ef4d3ce4038cd30ebee239d090e26a9579712a7fb4eaf121a05f13fe346c660eae496877de27978ebf3478a87759317e3fed591a7520a54aa85089ffb5f6c9ca02e8cd2f585d6fcf62274dea9c1a04b4c61e625b4680943ec878b8ed3e8843093b8c5db1",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_for_not_existing_kid() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14827b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("0003c8", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_for_invalid_root_cert() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("0003be", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_too_short_tls_data() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8fa2d869").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000321", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_invalid_provider_name() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
    //"d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; //google but facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000327", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_facebook_invalid_root_cert() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("74c6fad894310f917a22dd3b22f4707223c2d9122f1be2bade044aa538d012ef0107160301009f0100009b0303a77a2866c8099a6089a5751c5644c020d9756ae9fcc801e09008ba9c9c3530900000021301010000700000001500130000107777772e66616365626f6f6b2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d0020f46f9ef9728def70a1cdbe1faa907104b4630d004c923de8756ecfb0be369915002d00020101002b0003020304160303005a0200005603038e220c50659f0deac012a42ee6832f122e7985552504779fa79077b20d926ba100130100002e002b0002030400330024001d002012f24d0021004aa2c39146ae7d683f242e9399f774f7e6f1b86c930c796f823b1703030c1942ab7e8cdd1879df75b50e8f61ac63817ceafb927b05555430b812aff6f848306bc2a5311bbd4f08197589e81280d1f2af145ea79d1ae1d72831b3dd5f1cfffa0702817fb14e4e6fe46e4665c2a8d132563f70c8daa8930da457e894e73e3c1e61df4ff8bdf99ec2a541883459d9d52c1f84fdc3c477599005be8699049b4bd1f5caff25a71210faa50b05ea2aef71ff5f28cfeb0d5170d5fce9718a118c9d6fe1ca3be247f8c5d1c671a2a5962fac0e48b73af1ec24d91d0f2970dc46a06b56d4d8a3da1ae9b6c74419209a80add0be45568680d29c9e3ecaaa51706302269f1a7527333ff5f31e30c692a05c4cbbea48ce62f899fb8626914631ded8a3887f493646deff591e3d90a3ceab84adc0d54e87416ff4e3d5fd19592127b6b46f331735f553aeb72ce902e46b04cb3b785e352634cd5412ac5e308c6524abbdfed6db415b7b1271315920320ac754f7292ccda877f9711579c8f1a66278e3f88bffafe0331b69c5763f43194e145872fc2800dac2bfa03db0f0fdc1773f119e9ab52cd6ebfba229e3b130e41260ce742d1642f9fa78a77519ff95c225dc3123a6aed6fe2476888c1e4b3e0205f944747d054132dc84ad8cec175ba7139ad5b5663370192126c0b4db4f50190fdf10719a19122c4e3db7ebbf857751e8aaab8940c40fb12f156c71c6e492a048ee622b7c889853a32ad7a75a439a892807e221d997b19a56530f5f0e68611f602bd72bfafbeed472b7370308a3ea789485cf0ff65634a901e18002c758b5fdc513884c2a2daf08b9c70afd45a9624225cd5203eb883d1abf709aaa5f6549d8fff0e7b24e76764737945b0925bfa1f95466311ae6963743b59f63e7cffebf1e99172098d4ead289a1a179bd09e167a04fcc7266a829553da13d6cf5c23174fa07cf98eb82a7a3ad79fb4c96bf1cc2b13dd4fd9752fd37f909caab332709993e3c57a2b3eae1f373537b89dc280fabec357434834a8e21eb40c6f4ed0edb8f715e7f9db753382381d1a8b9955ab6f1ea496f091d4f19055fe42d3e16e01026beab160e20f5d94c38a9e4251f5ba5cddffadfe679b619f8be83aef52f21988f5cf191a98e388a650c4ebc47848b7f1a6a0b0467bd35f6a40e5ba669128d2a98c767ee568081df74b8580e0cce7dcb439141a4a9ddc576e5071fa83093fa0bbdcdefac3a715ab89b43442898735e3e0700e4b133ab307963716b302c906644e1b76d425872c0d0cfeb4e32f42302d30e4729bd1149ffab2a7c1978d65cbb43186d38be691a514b0b535c48c5fc992ffb44fe7a91ad0661aaf91f679fcad11e818f00e97a226c21894cef5647dce13bf14d1f23deddc228888caf5f0df9b1ad83c74e16370147e72bb14a94105348b58b6c73356e4e96cdf5702625e7c99d3fb243a09681e5380de165b7209ac6b2934c23f292c39759a82ac58ed895c98f3b65c463af1bf5c4245db19cc544cc1aa953104a51f7b5eba56f1d76fa4fdf7274ab6baf610f7a65025ca020c6280cfea8bd15fcf8bfd115be44c7e50366e7a371a16cc7956523cfaa8833e55e6caf4be2c04a2b0d151e84eec8979ef779cd0c3a3dbdd529d567f6c51cf7fed93c0d722b5f25b6082ce072d86d3eb4d41e1191aa9f361a7cce46c3aa9dc99c850345348cb5c3a53fcf6f8c1162e40be4e01d35286d5419d33532061705afdd40d1890700a514e113cec11965ea58b8c7263d30c88da5cf80b79c371110b503f396c59d325c5068d417e54402323d953de757dabe5d605bea6fd1687b542639f43a89b5b21d2c3aee7b8268a59bbdacc56c158e2ebb950d1ef85e19d7e901775732203c00cb75734ad6ee3016ea780d10cb82d09b4ea2ad979854678923a70adb77b8003b57bba4ce81aaedf715c8768127fc4ca70e26f2c1e3cc70058868c9c217a604e5d1d03527c5996d1db88818f3579e23bef1d6e0191f71d7f103600b2c55a7a636e12fa6fc6e45350a9eb7aa81670994682fd6af4186c1a3b3da87a50b658017fdab81c001564fc2af128e9884f90531d3b607c73bad2d8982bd5a3137d2079ea67819bcf3beb21a9fc9234de5af97e1be729f0e3b9d2c582aa5d9d1ac3b47b08c74909654d3c51b95220c2e3ab5412bbf2597ecca9daa470b60b3f8c28d201beceb9bcfad2ddcc916fa81c6ae2e213debd2a3c5e518e471600490d3f69fbb9ae2c893316c0400b5ce4c43a3609e30adb472e85b624b8d4ffb1685dac04e12da685be01bf8f7979527342f0490d2f499d28788e6d61a5974a676a0e73c841a5951216add7c888159fc3b3de162f05031f2175bfe7a99df586214bceca7342a3bd29009003b53382325fe85f297783647bd245282538fe7edabdc44fd5b24ffa543388e2de11a5aacc6af003c0ceae57271ecdb4c4bb7d02e5544102417124fd743cd7800c3bb387e7f3f6fd9486171c94ca963073a9e6008a035341a22fb4044759060a6ff466bb6927662cf0215f32c30d104c3f97265de790baf5da7d17b44cb8b05013546384578d201d95852bb732f08b85291dd4d9b8d53f2ff9f3c44b0ab004e8d5a48433d3363d17129b9634fa07a5f5f85c31dc52beb249c046994725427b2ef17d7aa98e8934ab87a6e4ed8c5173951e2e975aebd68c7351f016b1ed75b6727e0f0bb0e0a5bb27ac38203f0a3897e5c6fbbc99e5968b07d32a055d9c7027e78591e16bcdf138ac9524c50341ac17a1f33e647fc0bfec611ce908de6b2a68476a27151d7aad8c543609dc643bcd4397ae755054e632a17af5a9a5abf32ebcd95dfcc5c19886dc2ca3ea3a1b7970b28298a971c0c8a0e39cf807f0934bf508436be0c6a4d125fb9664f2cffec10acd398d2126f8e99a896f062982907a5cddc499f8615222509a15b58574fa2dd285ea36259e2505d1ab26289305160e650fd3a0ab1e485b75a0da646199524b006246de2003ddbffe35748f9c4bf27e4edcac5535b550a1709d5d9b3e1ff0914fc626d34d3ca23891cea0e2b2ce57659517bf7071e396260884525054b84992c7203ca117be27851fa46a9c8c56c1404e4188bcc58dc115028636a77ab4e204c86a0e9a37dc851cfeb9a77c305f1ecc04ccb31211d35626af4d74e63e1fc57ba5beff41340092a14974b846a27b5a483e4fd958a1cd97064ed629d0dd5a5ecdd3f4620cafe53c52f942fd02f21c221b8e855ac458b8811f3052bbc6e01a7a61a7b3ad24188edfbfd88226d82887f031d4114dc2e980cdea05700f2bbcfd6f1c5280e2c3052a2082a020b0398f9818c5745039d5fe27711a4b1a13632cf6583c9083a011592d40530de226d0adf9c75aad8fdc2bea2cd6ad748fa824bbe67b48ea9c648b803cd20997d0732ffc5cb005ad0c26f95026a871c66a814ad321171f69ed6e93a3839c8584fdb19b1651bc8a79c20648b9ad9040129dda52646331710b45cd7a65123ecca6929743ccacdcd3725f7621f8f2aa97a1b4515b02cde3e39caa4d6aee0bf2ba448fad0c06d4e44a9b760da0c3d601f3b131179c602681b303017af13240c0715cc529ff81a9d38cbf3a15b75b2ca083372e2e7394726fd1dd4c4eeca6e43065d5a1cfab6fc498e42366ddcbb8f86d00757723045233348d1f52c4adbff338d30572043bad2b367dac644c596fca6cb797d53c80cb6f793d9e399a2a7a3bc965c35e9bb8b7ccd6c7a9da27bb7ae0b5bcfa8ce55acbd5eb5bc7db2ead6c285a7c3c34923524813f2a96bb0cc082ef5c87f5fae7291cf5b9918a281bf2203e8a0f0ffda85e07e87637444821de8247f1e1a133f196f8edba19b31ecaec422d7dc451e7e2ac27029036ded22827800089d67b333f96279a120d8824c01155c1d1282aaf671373f4b4c1e20c4c42433cbfa2a850439395c93aaf92881b9efcc61bbb31c13fea5741268aa27bc08140ace967ce142ff59a4ddcfb0fd4b66b770281331eb2976ca4dc6193b658c2bba70ea3dc6b98193dfd69d4553e21d70d0e2ff02458172d5b33ff438a12e724f5e4bbf2586e4e32f0e80743d3efb6174afaf774e298b1f027bc2f294cfc7265acba212e0800727243756ff46c7b27d9083bc074d948becbb3e8bb16d62a7f1d513b0fad9e633ce4fea02099a8938e7df4c4a926e6284a6777d3ddead286a7efe296c77c238229b36bddf0e7825ce65e0413b59d6bfd5c8459121b280579c05bf5f58d855b3dfc3a81ad9f915e16e3a2779218cf8e2a21e877456bd952894884768e1473578a32d6a56b97106e4c203d421eb7dc5b3012e61c97851f4a4f7b735be791946b613d4a77d5e54b2bd0c403ea68e08adc3729c117aa47f3007affe7fe2dd750165c64817f01f5280065232605ff297fcc49d5b2d5979f7c11d30170303006cd8e47534bf56634f3375439888bea959576be7a1ce5623fb493ebe8f0f4b29034a35a6fff292c0afb4c0f881c9c796f94c8f912035dbe456cf1855ed8709e776c64a7667edb33af85e34a8f2d2c48c7b23f707fab037ae256131a16c01f5cbdcf7b874d5fd7df14df1c8574817030300b194b7b9bafd7fbc2fbb18079d21c867444320498bf0d449297e7344e6de3ec4b3dbd9c1865d872c9cf6acfc71e0853a8ab9838f0c078c5318df6fffa6699f5362f21d0413a525afcce55cf22ee30eab449f77202a050d065b7f3f357a25790e65c53bb13b36188e1b7cef297ed33db73c39e6563fc89410dadfe0e2ff1ec9d7e2e7fc3a6b74480a2de65c0104416766e08790d345bd4d9a3c9de377304e63356f0210508519a58d4c84c3927c68cbf28a3617030305f1e6b6c9da4155ce1c18b5820b94cc3c0fc8a8a7abe8c7b03aa3d0e400c45d68b81a6bbe12e3bb312760735e702291dca0bbdd3899586911b05f0494660ad8945a933abbc6837cf211e53548ef3935b7ce587bec26a84bf99f3b08e63e44399a2b4e0dead86e97651af7f144c17c5e304ca0d56ab184b85f38da9bdb2251f55038327879038172288024e1d751087d1a27b8f7f8d804eff37a54fe7fdc611908728a20cac0e7bb589dfbe6d929987d42b3e0b2f4761f8cc75a00a7b204cf1c91076f2437efa3f570f73af51fa20fca98b6782f8ec8645fd0e1d4a69832ef6616b2ecb68bdba0b2a41edfb0793a4a15231fe6a0e8c478b9ecfe378a23c19842e28896289e040181cbb61a9c3644c19b43c35e3f9b757cb13241d20409179b45b0a2c0bbdf8e4f5babb1502cdf16e9830bd561e6f22eb2b1b6e17d45f756f551ec058fbe80bc47e3355fe3cea7016443841524d6a741fdd7afacd2642273968a04a1bbb3ee5f1441be307a4bf5b7f8267d9a95d4c27b3e48cf670f1c98233856c0fa7bbef5df0989028c07c260796c06ba8b8effbe90ccaeb891818ddb5cffc149c9df5cb4122b3584d30d5192fbea760f5c12d1a1a1b4893aa776c86d5ef63e66f613b720a436290d1cf6720d83b006b8c5d0778c43f19784abea0d19ea27c13236c2ee000da71d5a4aec09c2515617bad36f42e6ddfe1a2081f1a17207dea0717e0b73e1b4126a376ebec03c4187d23abfd1714727d480fc566e874d15f28c979b89d12efca7bcad257c428418d0ee28556e055621b846b856277405c00c7efdc35ca88d887710fe725f29a6eb7b15816a8c50db0bc733b4fc8c47ced152bb04740b94fb3ce5295779eb856977f43be0de09e6627848ac8ab41a9a4c96a57f918bd2550ab0b26c735cf176b8a025f12d35ad966f7d07d61a1a90a4d9e2cd6b89049067bc9cfb765301f2d2016843833a2b0bcab7788c26d976feb4f0aaeb2c1cb51208bcc8e099d90862b96695e5c168e5cb31863193e8d026e434d0da4968a48943dcf7c96fabb7396f7a1d9d2abce29e87b18e76a65d9035767a523b72ccb10679a37d744854b037ddbda9eea8226e2515453142a4a111a3eed6ed04d1958ecf4332df6ebb9909cd9ea70924efe1edfed06041db8228a37a6ae243d5fe7e852c217a2dd2c2df324abad68280e3c60d6e3beaf6d542c21cf47801b4bcbb3e08b6699163d790c067d246a95a576c7f173bd604d42955995440b32f66f57f3662dc19750ecf447be2ba072622487f27dd5b391a9dcfb533e19fe3183d1883238b5b432f0e5753816094d38796df95b2ac837372de7acf359e06fe29bcaf09f36ffe780def59585c46a53bddb4e5c3dadf5354e0d98664a7f74c2980b3d433855faf4eae19bee1231a8d838f2acfaeb0f01eadfcd404b0cd616b1cb9f9e32cf384aebdff7c3e8d42e99f206b5b96ebfc2e946251cf329fc6eed902a47e471ed54f241bc7e8b713ad3291c59fb8dfe2e2afad99f838cc31d6346d5362094a8d09f3e63da411f4e48857a94d47c748c656eb7f7944a30464c544c11e9906393258d26395bd623e367a29ba960b933499abd245111043d193bfe17ae384e3ae555d7f610698c5e4ecfc6dd90d10c3d6eb2060ef9313c022215e6f74a1056e6d485863cbd112b0c9b592d3cc86a1b4e5913d6e3b7a1a2066185d60f426e1b8d9aa2ec3ddbe5a596a133ce2c0c30ed4535f2eb70b98d33f0065d8f4400cc78bb32773711343d2106392e9388c96ae6acbc10511c317cbb4f887c7390aa6013936df3efff2551f9420517dce777d3982e30d91866f4a2db7556c08ce148389f97a85b498c957174fd8da593a3b385f294353db5d1800cf01b517d4bb369c1fe05310dd3b83e0d65b191a0eeb24bee89d50bf53b5a55c52a32b1601e18b4353fcfda8e14ceb8f6838ba8705ddd3ea2a19b7a3f3f9bbe2d9dda12743570d7999b4da7bc15a344273e4349bbc0d7f09dc5c536369da16f557bd8771560150983b72506a82438e56677e67e57f3f28fbb8eb52c313163e6a0ac42ed43193ae3771f942a4196612e54b6315b3c37c8b9152c0535c435b03ada3c95399bf41e561e244db2096ef55ad5e7a10ed25d5abaf78d28bfcede9b85017030305f152e0254017d0180cc62e81b16933c0f673b36c1ec6c4d6f7f25c8367ca660c1a4ab14fc0d60778cf77b2b5ed3f183c3c593644d0379d65474d8cba505047814c7868b6677a6f47023b366b45b720e3d69dbbe39d45222d9774ce1b9e415a871432830b7cf2c2e8c118ccfc9bd264c3dc43b087b1faf79238f9ca03173a66a7b391e58a0137d6eac811ab0d89ac09d0aa15bcf1422144890ff95c2cf2109ee5785f726503b8945030c4cb3d75ba4ee43a18de24c9f5dee666dce1d35f1d501d219dd5677ebfee18676f2920ada8c1a89e0a8826ea8e5a8abee2c195ee3d5452011e97f5089305c4dc0a0fe74b6f5557eed54b7f79f20f57d30b38787b94e3293f525e0b6cf97679a5047997d8b6a8743ad97d0409e44a92b75496d7d76bd2b9be8f0c36afdd29b4114aa6ebe30ef31db77364351bdf829e57a9e9d9ff4d03b7d39d54f5f5272e3f37ff6ceba23f0faa67296bd2803119204222735845f02fb066b34527cbde9c9ad49c0e467ea7e4e788a76ca7091ba66373bb59f7466f3eecea08f01f37c4a5beeccaf923f82e3f1293fadffa2a202ab3253d897abe921b66e13b2abd882ea50ec960223a15d65e5a6e3f1fbd8dbdd205dad273444fef05b221f6fa5dcea8d5c44235657518b9636436a43d8d62d95ad34ee9ea6bdaf6e89341ed7382ecf085128d89bc18d55881efc8dd3d30ea74ba64080b7dfbf2fd449189bb093b61068be5c151e95f588622278bcb098b923e2d7681674b8d642bdbefb2996e2c39986469f1bb515c62a1210bfe16d4cedb7be1e497d51f50877453b5ff8a7a222bd46eafe0407c7fc0ab140a399baca61952872023f200eb4152c2abd43cc3079f02722b1853ded2f3a995c7805192c42324727bf65f1ec1586cf6b0962031f25d4a6f420d7231a213186a04aac249586ee8df7cac1530f66e195e7d2fbb390e4bbc75a09c6741b0256d19c6323270a2d881545d489797e436fa0329e7396c450327a5a5120c2a6621b3e29426d9b116bcd7772a9c8a3bcf9479b9a13741156c5e1f85d5e0c980322c736bfe08af5c70e15dcbbf6fd24be16dac0816f44af227ed518a3ae5eea7f42d76f09b14b9af7f9b0b696de9fad804a89c7db468a9d57f7d4b3c4afb84a6602e4d687a5c983ef89a8a305cd7ed60389db27508bf2595dac33df37d3f259b505b942d5608b35e9349e635b1f901fa193c93a2fbc171e2131b1d1fd3d95ffca111145759bf1f8655f7c6025743b5ca731cff84c553116492993a1fb8e3cfbaa314baeb2f0d0bc287987aa4eae7d430526fe090fa66ef2d01f1949407dfbc3532496c9579a3db9f9b1163a80fcd8a686e49c1f877baaf0f08210825ab06407669fa5edda1169cbfd496eaa54e0049e556e2a4faa4ef49b62125fc45f3136bc81a5cc8d3542bc1b488c1c9929883f55cecb2408d5b48c06bfa98faca69a02a36ffd290193a47cb896dda01845b0ad5d9732cb1ab17ef5636d3574514d906f629489b59e7142cd34c9171ffec93f6bd226ed0604f8e794d729edaf308968d89433d3b14a4afde5055b54372832f37383403e369a9ac70e52d5049a3a65b41103bb287f42426f3beaf513cc059923ec99b78b19eda3528638b5dd6189b52597ccd32b33cc30b456238f2c95144b8756b6c1c065d2c4367bef1adb9b84d121d796f39b3fc43e6655de8160d6898386373105f8672b2feedd251ec9083f31296337fa6ca0ff71fb7c4730668d51dee05487327b15369c79b0c631ecd3f21cdc41dfb8957e8eb64bc8359b158f09d06926de5cf2fed5a5f3292486f520456b383d7728d7c6363e70568689a50df8a904561c8e408bae12b2ffd60ceb2ae90c11694abb715c5d5a1bceb109b950450e4209ea1ccb5405fec7bd01fb5c55e744a7f2fa75f6d1778186be67ca0567af30f17c6a1dce03f5c5c8fd49fd20b034f675b6c13021f59867dfc8f320ee1258de272faf9b8c2b6125bb155d64d71d99822730ad620ba488cf50a301b6727722fcee9470f6ebfc8e8dbb75e50f39eedc415ae2747358647430f4800ef50daef936ec514f7e4356cb57ec6049a27fbc99c512f406d4e80b87bea3fe845b4dce6989e3e68a39f3d01a7378974fa209c654980a3988fa46438ca3a714e17030305f1697b08ce0ab2027aa260f8d9b85853d8437f79baf98252d96da34deed84ede82de768589bc16df6951f3627d8f48cc8163f8466ff57f1be351478b6cd59ff09e9e5a7cecfa5e6ce03f87bb8136f35f52a26961d51f085e28d256305f6834ddbd8539b92733cbf84ed7457feb80df0187dd23e41fae1af90e5eb229c8fcbab35a8bd987a9f31c4d97c6b42860bde3cf449ea1d271d7d6bad8f37983fc0f6d81b51d0aca549b793c7e288a09b8adfd5dc0d5a66cd6f57c4aaee4f68377b2e1e3c6ee3b2a9dd915d59dbaa7bcd92b24f8f80f8ba6f3982c2d1d2fab618d2c9c4c7b44b6b2c7884192593ead88793e16e5a146fecb3c981d8a723462a9a87f5b5b6dbe7af9991dde8073bb4d65e63979eecf7b47d81050aed90739ab6e5ca295917f70f4907491b10acdc943390c7d76624f9e1fa2cc95cd29135fc505acb93d039a09495fd0976a7ac74f2f2b9d6b4ab1ec51dced835611d751574d0e90088140ef3180cd56943220510e811a921b8ba643c026cabb9d37544b6e2b98d321ba222efe728dabce5bc1a58549e1ae7d6ed07ad05626f79b2aef0519258f0234522dcedf2a2f0cc68002c7c8b5554bd64ec07160b19a49817e2962dfd3f7547f448e9b2ae74042be5bdf971a60871d360e0d21257e4c365ce9afcb40c8d719d5b9e34fcfc87eff83bc589a27607eeaf279c74266572ba7bd4e998e880341508ce969956b09fe495460b9f95460e72374f6e586f953590b7518c2203bca8186a0fa909eff8f591a17d2b24230b9724680f5ca50bedf9645ce8a945f616b9e8fdf2a7475cdbe6bed8845a9b792f23f2c3ebe27740ef85bb45ff94cfd304ea3d72eecb5d2385eda3682dc00a8be93276a83cfb7a870548741532c9cea373a93bfcce646cb47e60162cea0252abea09edaf7cdaee14743211eb686677ae2ffc4dfcae003f3fe57325b9ef488ebf115aba20b8dd751b880d29f932b3e7a79665f92042b2851a3ebf06822ee497d531c69aafc470c5ee9d9ed897ea55b80e5459eb11d9da5801f7577bb892d0b5cf6a8cc6285f3f6dec75cbe49933e8b759f550d4e0fa756b5b8e75f267a7cf4ddda5421277b81b32d18dd5adf02df9a7992d4e63b13e8d8f51ec5bd81dab4762416b485a810407647a8421fac0adca8ed5fd5ac8136f30333ec483f0c177321977f902e882f300a2d668fad08c202bfd48ce55e54760af30a4f48f2c875a4a3304b5483c47eb20a2b618f7ef0051265e650e46ebed0c987fdc67ec2466829d86465e9fdd2ee351554fb35bfd0ed3fdf8867ef4dbe4509f427e8a823f72c4c2d369dc640f6f1224feaa4bfa39ac18ea747579eb891bcd4dbff71dd68d9ba0d60d7a8e3ac81cf077e583ec1d6184bbe2a63fe2cf2a85f0c6f02afb667a9af7fe4b7a6316b44d5e30bd45ea2d40988213b63cfc3958879958cd34494732d84798543f1f9086ea43766bb64cc945bb668cdb0725c1a9ecffbee90675060949160b10a5202dfa29681644ac1256c0ce73cf99dff7ff8c6e623fc827549fc9d5a4cb4ee910bfcc178ebc4d5e94da07305f90ed625114e133bec881dd830a91c4c20fcf8a6bb093c13f2c8f7bbd67bb17409c503a3db85528ca9c5da81bf6ea86bfb9912b75edfbd18a394a66fb8a24e3464cdac86f56f68a7301266b9a46853042062f05121b643bdd7dfd67860ea2fa43cd2d77182f85b9c226ef717e247a3f5d53706a0dfc04d807bfc2efdb95189848be11c97ca75205e22d7cc8372a2eeccb4bf7b89b0c60638164a9b96c0c3978c47c5e01598b94a399742723b5c0f49ecac007ee3bbb157680c6f99dd084f29d035799e83cc35891711f912592a2f0a229c9b670b08952a62dfb7923f528a34a0705e438b7a3709c32c69ce31d1cce78c9a4f2d7cc4cb48436403a092a57984efb3bf691f7438d7ff408d038d4c2bebb2234dd16fc95a89fa60e434f864d4f82f210a1f339009b61fdcae26e4a2e0b833498970104acc3e542ddb85066364a9a51293b3319bb21b957157fac354a599ed487b909922a06a8967e6310aad580e0af1d74de766a4b40f7a540a7be089b782018e1d6b6d9d4430b06c4ebe39bc82e32571bfab898b29c7f6f3a268cd17bd3aff730d92119c66580490841a17030305f149fb42ec696be0d698d0b7563e088ecff7401e3228a2b5ff65611a52242adfe1c7d50f92a7e3eb7a527b86fdda55930bbb1868398aee75f1a484de114140ad285d6f12ceb7098890769577bb5c2e501ef92e443bd5ac8d36f1d437ec774b5428c1cd7c9bc3d3b1304eb8b047cbdbd6d16ccaa8cf25b31ef7a60823a180d28df9db6a82043d84abcb4726be88ad392fa075bdbe654e657cc435a1ba1b20a3be22044593b814d13e07759352541e1911f7598ebbcc1deecf06e0bd2919740e293bb25a43cb4930b756f75541e0373fb2f4ea6f24044017194760fbe9f2f3210d763fdc2f851ffbe0c7b52c7b6beff129b1b174ce2b10b996aa0243fe119a027849726ecc87d41db53db2ffdab800d36bf9acf0e83242abcb8b29d7c42cdf06539e430549b9ad71b2f63c6116fa4739cfdbff50548d42d89509d153890db5380754bee97af3dc20137f615b83a5a91bd9bcf4f84f4ed6952537dfeffe3cc520f0c0c9bcb239a0fd06df0f1f974803cae354e7289d2fe94ef3ef44c7405f3886e52b456b8e55aa522de35d855e2ac640da9114b284a01854d4de1cb175998a93e3a46615f2b35fa815baeca71c20d6c4e022a6a32e203bead578a2a46dc85ffd0a7f97e08c6bdce89c75766b599f4ab756487eabc8c4fe426e8cea8248be8840f10629dd63cc8c04a17c63861fa9c95ea8afaf699064834f07a29ad2f9c6416d4c6b5102bb092ec61a692da017ce367203556bef32a45fa91a925fa35b75185eaeed8c542f7d7c5174ce185fbddeb1d1daf2075368dc002f3b10c9797892a3ee9ea61a994d28741154c039f0a162089d9409b6f67d03740552649b65725179d94133e62a88bbd55edeba7e8014da7bef1b0b211cb37dddd0647d2eec8a224bca4f0e8b5bcfa0cb919ed98f0bd80901eb7341738b2392b6e2ebf46784451bcd273b0ebda9a9cf67b9858886b9ab04375621a956cef115dfb06ab8000b427d8223b009789e0eba990f5f5693b0ee01b63676d079ba8b31f5305536c0a7a8d89a2505cf603ddd21c47c0cbb95601b1b16380fd844aec390aedd3871ea8cba4d0f820458e45e8153689bfafff6ccadcd8e6b758e8b2d37741d88254d4f9c9c3179d34da88117b82a25ef88ec914ad51b5d343db146184d24c745b596a79a5eec2ee65c510614cd7ab7841de4d710bf94eec0f171eaa995d00c13c532f74fee2045fb8d864d2c23b8930b5d29d78823e1442985922546c24dad6d16d832d03601a09e711c2132b079a325dc47e90d1759290eb696fc19f83f1420ee6d30977f6176a64bec3b491ba0bd999d0aeef5e82e8bf25284b5f3d84fb03fd0239f8a7d61cd48750c4a27e86245b6db9180d6c6be574d52fcb0a0a901d5834fa659fe3aa10dad65b417bf6917063c23fa8e5859264c2efcbaa2d693de4ba492346a5980e7405146788f852cafa720f677172e3f203bd8292243bc6fa8516021e37ee23cf4e8a6c84650487aeb3a7c17a9584b324db0b4ba50257a937e8d7eedf15b82d9abd5c3ed5bf039c5de8abebbc82c0f79dff65655becdf6b1f9fdfa8dd124bb32955d283bd77905594940a15ae4d6a0020f28ae829eb734b301b1378ac4bb7ea88f4047bc758cd5b463fe9ffd32f40c10be506e1b598083c7ee44f2489bb55f727a30f9c5ad0745c419433cba82301877fb39b6a0c410b2ccc8daf4a822d5080aa1f823e2e69656ae448b8bb05452f0cf1e4934a8d6e8aca4a815645c20f8280b1c20f30cc1f74c78d7eb43a4eb2b0f0f72275c8c07caa4663fb214d1cbe32bef7981f9d619cff87e24e0830103f375ed6ba8a9e48c81d7e0bc7595f0530ccd28a0d48d065735b2145b652f1dc2f458bd6be13a51806fee4cdbdc78305ef24f7a62a3108103f454fc501624aecbce4261e62de319cb668d470a706bc6c8c83afbc14eaf3c3edb114fa312eaaadf09266ce282281459b21db45214e4b5daf6a179945f92452e4a047ab85267e93e46119b5cb83d140da7890ce7c548e014f69eefb6189b4098f896934c5fd3a90de57428c9b87637630e152a947a8a2cefbeb7afa656a582cb2e6ba7bd4f9b21d72165d38167d8134c2a054320a53b33cff73416d3830409dadc80237bc9801ff4790f1ab52a59457e1f1703030081f33847cda47b88a9730751003f2acedadd426537435f37a74badd95c7723248e02b9d6e42a84e6ff201fc4eb7f76c0ff9c66f9e1b28b2b79b47ef20c9454a8c7d71a0e694cb95c53e5854d3aac1bc0f38d0eb5ca9340f126234f8900eaac81a97436976dbaf9379eac504765b4b3562914900a81f832d6b454186d58f7da341de41703030021afa5a57850a85e99167b742f9520f2098378321b7ccd4c08ca56e5c460a5dfc209").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03c9308203c5308202ada003020102021002ac5c266a0b409b8f0b79f2ae462577300d06092a864886f70d0101050500306c310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d312b30290603550403132244696769436572742048696768204173737572616e636520455620526f6f74204341301e170d3036313131303030303030305a170d3331313131303030303030305a306c310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d312b30290603550403132244696769436572742048696768204173737572616e636520455620526f6f7420434130820122300d06092a864886f70d01010105000382010f003082010a0282010100c6cce573e6fbd4bbe52d2d32a6dfe5813fc9cd2549b6712ac3d5943467a20a1cb05f69a640b1c4b7b28fd098a4a941593ad3dc94d63cdb7438a44acc4d2582f74aa5531238eef3496d71917e63b6aba65fc3a484f84f6251bef8c5ecdb3892e306e508910cc4284155fbcb5a89157e71e835bf4d72093dbe3a38505b77311b8db3c724459aa7ac6d00145a04b7ba13eb510a984141224e656187814150a6795c89de194a57d52ee65d1c532c7e98cd1a0616a46873d03404135ca171d35a7c55db5e64e13787305604e511b4298012f1793988a202117c2766b788b778f2ca0aa838ab0a64c2bf665d9584c1a1251e875d1a500b2012cc41bb6e0b5138b84bcb0203010001a3633061300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414b13ec36903f8bf4701d498261a0802ef63642bc3301f0603551d23041830168014b13ec36903f8bf4701d498261a0802ef63642bc3300d06092a864886f70d010105050003820101001c1a0697dcd79c9f3c886606085721db2147f82a67aabf183276401057c18af37ad911658e35fa9efc45b59ed94c314bb891e8432c8eb378cedbe3537971d6e5219401da55879a2464f68a66ccde9c37cda834b1699b23c89e78222b7043e35547316119ef58c5852f4e30f6a0311623c8e7e2651633cbbf1a1ba03df8ca5e8b318b6008892d0c065c52b7c4f90a98d1155f9f12be7c366338bd44a47fe4262b0ac497690de98ce2c01057b8c876129155f24869d8bc2a025b0f44d42031dbf4ba70265d90609ebc4b17092fb4cb1e4368c90727c1d25cf7ea21b968129c3c9cbf9efc805c9b63cdec47aa252767a037f300827d54d7a9f8e92e13a377e81f4a").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14e4f6715b789895089f5c26d53b01a2991ed2772b").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; // facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000352", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}
