// Copyright (C) 2019-2021 TON Labs. All Rights Reserved.
//
// Licensed under the SOFTWARE EVALUATION License (the "License"); you may not
// use this file except in compliance with the License.
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific TON DEV software governing permissions and
// limitations under the License.
use chrono::Utc;
use tvm_abi::TokenValue;
use tvm_abi::contract::ABI_VERSION_2_4;
use tvm_types::SliceData;

use crate::executor::engine::Engine;
use crate::executor::token::execute_run_wasm_concat_multiarg;
use crate::stack::Stack;
use crate::stack::StackItem;
use crate::stack::savelist::SaveList;
use crate::utils::pack_data_to_cell;
use crate::utils::unpack_data_from_cell;

static DEFAULT_CAPABILITIES: u64 = 0x572e;

fn read_boc(filename: &str) -> Vec<u8> {
    let mut bytes = Vec::new();
    let mut file = std::fs::File::open(filename).unwrap();
    std::io::Read::read_to_end(&mut file, &mut bytes).unwrap();
    bytes
}

fn load_boc(filename: &str) -> tvm_types::Cell {
    let bytes = read_boc(filename);
    tvm_types::read_single_root_boc(bytes).unwrap()
}

fn append_uint32(b: &mut Vec<u8>, v: u32) {
    b.push((v >> 24) as u8);
    b.push((v >> 16) as u8);
    b.push((v >> 8) as u8);
    b.push(v as u8);
}

#[test]
fn test_tls_wasm_from_hash_for_google() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
    //"d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d840f5959c3cb911566de12044befd39445660adad6fe7d9d2ab142ff079db21306667b11f1c10b45c7972d2dbb2d6f2de8394baa546f5ebda274c8b6cac3b6d9c5875d9f918265db25d1bde74fb9af72f08ea5313d16a94c843e33ec48bad0bba82f67bb02d7ac1e2b58bc0545b8f2b2777f7ba4b33f726a56865e48ff4980957a9515126b7f113241c9d13b78134b428e451252e3ac15776a93ae19339e6329b821032dee28e913c5cba7542ca3c196aa1490baa65fce33719a26e720294a5c0d11499e265ff70db69dce3364178342e65718ad47165756cc7ee4735df823730fdb78d5dc45d98be1015d8a4eebc05b6318779a56429ccd1f3bc024ee4746158e6b5",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_kakao() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("6c4722563f51d15766b27299679b5385cc2d0fa6066ae7fbb511bc975fa1fac40103160301009e0100009a03037fb056d5c15551da4c9ebc87b676656ea06002b0585aebcaa1a8ef36d3a8849300000213010100006f00000014001200000f6b617574682e6b616b616f2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00208f0c6511029ec86edf19794ffd671ddf924d6ade4bc0f245c320a9c0d480c93d002d00020101002b0003020304160303005a0200005603036a7568a19a69d3a33e214dbba29203b1f6a6786adfb27e764a4b71f8dd51f84e00130100002e002b0002030400330024001d0020ffe76c9dd51a0d6b80eabaee3557c9d4c5bc05ba8cfe18e3db3a374fdf238a2c1703030fdf136cc554ab9bd815e7e8698330bc070b6c5ba78dc8e92c0c6284fa2294e808d2682199733fb5e53813010d524dd96cde06b45cda55b67f1f3fac65646ed590e1029ba7d36da9ba01705209e20a4d840532716d83f4356179b870cfb57892429471f8c9603c67c0562393dde4b929526a0536abdf0a321757d099a045e13f6753a3558c4e1a27312fc7a0cffb1fd78c70a4768c5b9c4877b847efa297d27bad35c2a0a212d089e2f5c50040ee1c5d0cabda23a66acc97ff5ef71d374cd18eb809ba31b95a5588298ec4894d122b2862b94038679f65b6948d0d37164f5d2a698ce010c812e50f8cad06e999cfa4c308116214acf98d632afe69a754f9fcf97aea30c5cfc99f7d15e9e27c86ee9c7eba0cc0c632f7b1ba1843c736eeb6cd0a5a5efa4bd7163b320884a923cedfaea9ed6176217dd8afe626314a65afd67b109eb74c66766ae7cfb7be8a636f451d1f086b37af397ccc36bd031204996a6f8da26bccfc0f79c6e889a46cde48d52b89dcef0e24a20fb5b992d2a31e81c29fedce75ef2c50e400c3651f7b56643a44e57819702abcad6c59869ea3692d2364d4dfe781f3cd8f393b4047c9b7457c2620b9323145f5d67a1d0df05c41b3bb5043482c82834f556f5e17c22c8aefbba6dc1e6abc39347eb4a09e10dc3dd5cba76edeb9c707a961cc7ac411aba5c345fe214128c2d0bd14193597447e4cf62b837ffc5dacff7898c56164a8748321109fda724033ceb426a1254a0e21c4a9d3660b908226a86172a3542f35cf0c1132aa1df908b0d2559d6b3775992582f61b5354876ee1c8d39ec47821e5579bcfbfa4371e9195ca12c1307a49830cbd15f403a4fc9f67469d34bf47e7c2a94dedd5913309147826f557f8b386bfa631c4d45a34d1046227cc7d3547e4a9e92994431409291cfeb6ab5bc93ce84c31c46d235d6a434a8759cff38c2269544a05b295e6eb42544ab59108e90f1d55a4dd9e64f024db838380e0b5ecab8aa2a0da600472d6fc953c1806246c7cad09cd816f489dfd0aea1850a0a54d89146c80b23d88beb2548004a36559d6a2fd0b244e39d5043918a1d2c532a625de1da8940f577f4ab80c2de00f8b634540faca688a523c45f93c26df0d922971b0ed996a016595b8538491fcc80136e1601dae6a3b3eaf538f3b456a068262c782026738bdb59aa82d9b6c2cb92adf906301b53531a5b63a24e3198ef67f5fa7ecc763c321c1c3dc5b25f96a1341f981477fa832d555b925cf1db20bb2b3b52bbc9f9cc5e56713fc2f0ca016c1895590d99ec588736a2edd4d7bb8c7a53174d9e132ad6d8e2687a5cdb6dd0f4f6afbace7a0ded04bab5e97581218145c3ec0484b35ae38b18a0a0b09d63ce39ff4eae94865563fdb5ff1b7a40cb8bfd3220e5ca59b7cf4042daeddd116e3dcc10037e1e9f78054733c29d183aee682e63e3c656d43b4a07ed763acd92987dcc768191b668877438966da23bc238a3002d7c4c67fe428b3743dd4fd18b3871cb3708dd870513b093f7df6b43af91f0f424f70501fb5d50a2ba1abade87f30aac3e677cffb8361e2702b37d1af2475a5b714f86bd30c9d5351af578edc7a92ac6d7aad24a518a1f509b1a6634573bcab9b37624e5842d3874ab8ab33d2c8aa5c9f4e71a1b057802f90cb033f3e30e72f1464c066df5634eeaff16eca46a02d5d0c32ae10b4ae54835d7a6e6ff14a3e3d98e985c40ce7de43188653832cfa41587dd8ea5035ed14f72e0236f6817d6ef99d97ac3a3cd3c8d35f84e152fce75116424c617f2fd539af9133ab6b82b521949582cce54995aa17720e3e8c2c1a04272a45e7f460d3d048c31c3bbc715eee23b2515e2b114f9e9970ff0b6db7e5b99aa737d1c9e85d4334fc933598eb8f1e3281141aa7bd210f8de711d5996ee539ddf8a0c4c25f7b8c37849dc3f84b46f9271847115f55db8761645596fa242d1e377ab02f315ca78fb5439c3a9d14f2a44b3cb29ffd9e89210f3386c03e1076d21756501e96c1c6e0fedc547299a7c77421eb7053e9f139011bfac423fb97c56ba565a840196d982c632fec79845d9fed64128bc7388e61b30b2edb941a8d27c3e4d83b97faefa7a76318b688f18177e72b082ee5c3fba3ef9b2c787ab50a7ec432079dcaa6ff9de4c0f7c84bfbdad4f071f665f2d05f42453130958907c3016cab6b06e58b13b468cf67f352333c0ee5fb506f2dffc0f8ef68846a0c3b482a13e1037a4227ce52c9dcdd7542029f3f407efe3e076ddd84daa684da8205b32f09685a17f3528c9e5bb7f2b9d315589c4005086a17e9456a3e533f932bc828224ee18d752cf63b8ecc3048fd0ae703d9cf0342b51f8662cafca0960ba31b7ae282b6b1614eae0bc108e01be5dbe0c23a698c582d25c2931e1a0a205ff4afa70c4aec1d0925d8b5d12ccfe8780a0391ac606f796d922b92a86ade72b10616301fd06f6641c5ac2433aa6ec49d587fa6055d5a3b5cb7d897068e9a4525509de1f719dcbf155c6248a5b779e873442b18ae85411bb5841e7c4e95fb37e449ac0016b8bd63b29a2258435f2f410dfe3785c07a3bbec1a9dc5f3c19443eb052946a5e85b275c7ed117b8f1c15202b85a14c4ba3a1188d7a7a9ac64da9c13e79887980e439262a4d11ae250bf334a2234630efce65cbe68db5abce69b9f8fd2b6cc9a0b099e4b670fc94fbc7e17291b3aeef0ff7b322f1854f1d736f6e89e8d1dfa754e36734cf4fa0f5b83a40f62a4ecd24fadff778db505ff9a8f7924c7eea269a50f595edd46dde7aaa8c252823984758ec2252517a3885ed85bd37fdef6282d55f204fb318c07d01fce7dc9e542074e88f5322479f7a80284825b9de8216321d56b620e26abc2448ca539eb307e29d3b7a1f17a045836653b6fe6042c70997efbec71ff81307246a86fe991256ece0556b3b70ce040c1c3a2b4b3bf46916cebffa35bb09b240192b026badbf7f5a54e1b5518b6b1a2b8b7028bbd7915db581cb61dd65642b4b6df15f5c7d713374067a586ec428a1610d0c2a793231fb2a700f4d972110792174c059e13083a9e66457eda47eb7aba15d4d6dc2e9e52edbe8bfefac79e811ea3e109705c7b1edfe85ac96d77ea3c78a42d15e11a88c7e1e6021cb6cf50928003cf76a99e5de5ed193ddbc21383370f6f3ad845317bf124b2d3cdc375f0c4b367b9733dc9c88fd855f792eb8948b8386522220f53d63381eff3c64dd6371d30af788c9b9729223aa87ecb490f3e6e8a97d93b3c20b23f62c8501d9ad19efc3b48162e105dccc290e3e3ed3897a9256b9c7e104747e393e0dafd3c6fc4a5ad803168387e5a47c7bf45ce701e4eb92e8a041e37d50cecc1eaf33059349742757450d402733597a453f2735012b7822f8a47459596230ad103bfa6c315b641755b0c725c87d5ac47b10f55e9e06da887a5b64d0cb2cdc5cf5bc1e7e5a4b103072c58eeab8cd597a5e4cdb0f8d0d6221ddbf697775c97d26cc6d665049a5ba043a1abc907b6d71bfd26d330fb90bc0639fd0f3876d850c19b4ca4046e9046bdcba1a77aa3c87fdf8ab2fa6202edf9cf9d41c7f6760fd5be7b363e9ca15c293030ad2f99564786660b4eb5001588642d6ac2bef46a8a43566135e6e29957f5063ba3e1b18be27f53ea007cddce21eb777df4210dd3e87a9f860e1f4da51cbf03b4af8611789d8718afe27f3ebb05ca97b35503b7c94dab18120dfd3826a430085d66ec2f5d3912ccb99ee8de153c4cc5113afe013a556aaafb8a880ba0eb595c212460882912abed8803157f485a01de5d9efa51e7e1c008ac85ee838fc20e0edec850c93dcf83ded009751a00043bf5bba42b1f0dfbfb18980520116abc181d4c732122ffdbafd200193ba5e4bc0dc1a2ffac6b6459d227815c62a29627f798a7b3bb751036658a8b0ba8004308fcfc49e740ae9c4832b581725693c4b8659faa34ad34cfd3e55fd2f41e2c2d81c72f74175cafacc2d5a81a0689d7002824d9450c7fec39133cf768a523ea3e298f90b0a75d4dfdbc2bac5e68b3e71f8f70a810b88df954fed10ff10ffc8d892b0201ddf598ba6b1f727de5c30dc1803c7b154f500435d3e83dc7830d1e2eed36005c8cd1940158590804b1cf4b8564eedea6d5a1d71c00751adb3a44b47ff3c5b5c49ba0ab222c27e4c856ceb1ea609968c1eab399760e4bb3a3dc8e8459b3e3f5c25e3e228730b12d00b773bac92b134270fa68e8addd89186070e665430919714d3abfaf9c7b1c9e6ad58086d974c78ab74462e914d2c6755fa4218064ab7af3656e87a1c426a28f49512eefb19bf4efe46e2d243077a7e59315438bac4f89ad124e49cd162c1a4677a9564418bb7e90c7d0fc5879b6d2f1ccae93c0559f192d7c3dc4abdcb3082d366ea6d2392a42783c97429e94caba318ddeed3cc3955a1fc8dc9d99d223cc422a7ae3099985c0f5a0524b189034ad58088c9dadd608fc35138bdf400f7fdb09c357e461945212495fe5e410659df5d4ec18d5a132220044efcccd4e1510ef986571b13da25924c5b61618343dcac3ec5f4fa9a10c89c7c27a4a8a9fc2e75f5d30204476de7fb3d4989a3739dba007e29fd7a7a54a3822419ae937f9bdfaa116b2ff65934174a38d59d5bda2688f50985f58b3f226a9c90b726f8dab6791052240b3dd53f4a48136a15396741ca23b2418419af1d69f23cc4be62d7ed2e7de9c6be197a038c008864d62a16a28e7fb326ebf517cd1ec568d60e821cbf2eb9b07f00e7dd40929c5f3050a65d5598a660733987984570438172c704c5b94384b88e740afbd697ec4d84fc18983e975f2d465cb87d6d5facff22233b4fefb046c14df57bf1e61daa8c5c973eeb914090e5f55106a33fbe09a1753b2ea91d5568e26ca0ea50759d56a7c19761afc9c4b3661d14154ce72ff93b07801bbec173dbb6d5b34b0792bc689698552da2fa22f9a0c2454c721fe459d3839b010a609d9b6dc809a59b6365672a59330c748de141dfd6e51f72fa3e90f853205926f1d08ff29b8fd46022351934328c3a6d1651ebde91e7878869eaa3f71d9cdf3b94f3eefa6e83c6e98bd9f4b83ab33098e121906e3bff7df7a9a22aa64d71083f0828ea846a237a0ad48e0ea48990223f760408d2ee5743f1a19bb16045dd969196237f1a57dffb6803733d335eca268cc99093c75e23b16d0e5c010b5b18e06fe7dafd2567672262cb07ff0e00f32b11091d36d4dd1dc9cc93e730c12b4749eab346f74122ec4e000fafff635dc5b07c35319d872196c053564f0e80d128b9497144627f61d8215cbf1d1a9625015a2623e64720b9264d32e6f860927aa38a598821e746e1a312c39295eaf85903ea1712c6933e3c853f9d663dfb469425059af10bcb240f14bf3f2aa084aa3befd386238f025e57b6ba91aff0ebc1a12d22bda86726f0a7b8bb9228f6927f6dccc7afa85f6c33d42f8685bf87bc695fe88e7c0bed1fc462552c6ca040ac68e9c704d5ef1f9478a383486512461c2cbbd0fe8b84d04c6701c46ec64177f0587f9382303471f698657ed4f2c9deace32ecf1b032d40f20aebd1ff644c1200529322c30f1570646276756b7a4a0bfd975844094d254185a40d9e26c1c911001a7ea15b7c5c48bb980cdf5a7ba72a39c47a8a10b8779d46f9d934a5a420827cae6d1bab0f1fd55781fbffe2549e6edc2093a809c74e052fff4f5c23389404c9095ef839ab8a63757b92785c86727f0217030300625a025dcf4c36ccf06a276925eb11d9a3026bc23de2649754129bd33bd474a74698bd65ace0d67dfb83f368413c68eade247d1d85f32ce0ee3ad619270df22d48dc62639c8b650833619bcc005fe87f510103474afc67d680feb621f3a419a1fc724b170303010a09b2d94cc205c5b598eabc401a657a4b40c399b9a1b1b74fb178e8187c5146aad6e987a4e314a054df2e84c5018d6c76510fcddcfd294f816bb5dd3a0d25303da5eb1cd53f30498cdc692171d31d00066ee3f2d3cb7bcba62f62885ec8b9fc6f1d09de6f0c3bf800b1e640623cd8b98cc5e5986dac7302014b63700eefb949d56127addb43cfb053679bd4e221e7b04b1c68e944fe8887cd7dcafb36b0e4ee70007bb018fd1d028f7feaf2dc48c8f2aa606a0a5111f9d8a46c8e10995f13a41dd15b737116a34febce921679ece590c2c896456b963a387373fd55a4eda23eac9f317edf4e9e3f49dfb60edeac1f41e9fe1a1810105d112457f9dc8c9d9eaec76a5c0072acfc88595bb9170303010af68ae882a02835b98c37a929930ead39e5e7a51ccf364ec90aa4437c873f2ba9c77bdd474903f5399732f9ffc569a7d8d292bd4b95182b706ac75328ff68d3b58b0503a39277f236e5eaf8b0ea5f2a2f47f02be646795874219b1628b9b117a418408b23b7f0f377674aa4b73c9e920d9e29bebcc1341b6142987ca3617833da233af16854caa3487814c89e2f3c5db86924a5d1fca2f16f576fc19b926bc0e1fa3455edd598994ee7b8538f4cf1625e6e6117b4f2b25f121c87a4e7806b496a4a19c863048f860ed2b80181515f643c3c7a07f8ac38568a7c8f6e4ade15baacf7eaeef46c5a67e5d1d8f7b61bec54defb2540a9f3fcfa8b3f9994a5a707f7fda7b6db30de7634e3c93417030304e845f478b916b72f6715359591ccb64e2b4f14995314b6bc89cfd0f1378971e5683fe2028a1f6dbebbefa4633018234030ae145181bd14296b077b7794268090b97ad96f374cca2033594eaba7f1a9f61b3e0926e3ef661a4ce7958e9011ce057cdd120d55df55f109cb8b03cefe353b91e44b32607140ef67dfaeabce68d103582a2aa0f51bc4a40f4ea42ce0eefabe2a7d89b1b5d9b8e49baf013da10bf18296ac5f4d705a244a5d9450a8282834dc2aee38759e633c820a66b58403e28361cf1cab4bcd7b2e40bb9d35fd578f68d3eb9ce604ec8ff584f4d03094e5acd53c5ed88e807b46622580531b5d6155079356a5c5533eb2eb959cda7f376a5b83d8c1fdd1b89ce843ec3df7ed895355b2ce024cc03c899b65d0ab366d623608134ed63c035c1791811722a84aebae6d6e42f770966f9c924fd2aae753378bd2d65de938e6f5ebd3868b54bc25bcd13f229fa2f2dcb65901ee2c5110675ddaa803e092b656f700287e3c608bc3835c629bffba87dd14a9181e34c147dd75a686e887f2326b9b1b802b33c8654a515501a5aa10bee4ae9ebe375dfdcd44a1363e6bfb54e9e46b68b8b53cefb6a2cb8aa54e2a7d78ab22edfc86a9a425bb177a06dfb297cd851561cd3da10ba9a6cb75334daa1a7fcdb781d1c6c6ea11f05e105fed745999edae21f5d05fd837c500460368ce84cc8cbf1df72925229ada5eea3e05599b7d1b026da7c4546a13278a60bce544767459db8cb937024c79665685b603b18d4562f4a093bb41f7f3758d2774bc49cdef211445034e8dc681ca89b9a1569d12abb1dbb5b96c73631ad6a0cf9a16a0d3e4e2533a480b14871dab8be44b81d6ff82b668b7515be77ed9887d8ce4c34c0b506c131632c4256af84f502af72ee7b59d056b8f3bbd81e3401919e1c774de63fefca5764cbe9714dd2fb6a11b00efdf1e54c4925ac682d295d0ec371e092fe0ed72ca9f98117c10e841e7851b7efbb902a62e70ead9937a0b9df3bffcda125c710f489b7b9561565afb39a151088d5fb904572c1df9cb8c8ce5115530f83a33cde9d8b791a9dbfb09cb3f6835ebcd51698131042bc3bedcf44aeb7d744fcb941a4e2afa17e97487f7814fc903b4fccbbebcfae6d93309b6e9e559efc3dcdbd659413895731a5a459783a7a238f5d7e33fe5ab146014b8b281c6edab6ffaf9fd57574f742d7969ca24892a3f3c8a29ff1ecbe6c03bcf9a8dc5b3dfe4773e3f6b2bf5fd2a6e3cda02917e6b1f5c1038c811535c8d6a86ea7b2edb6785909e329d32a7b054c1bfc904b106265d30016aaf6de47ab44c26d9dd4c4e1452e019275496e0155b46c258aca8411664213c211f9a218674ffeaf908b95f894e655cc7734a10c52097ea5a4319074c8295eac94c48a9ee42d24ba5a4d128600fcbe157e2b4c32b2563a26550b7f345115bbf24ff93c30cdbdb4cd87931b61ef24f8b48c94ae378af58186dbfd107f35e371dc46b1a99935503e9487388da08259271304adc7c23e51cac6f181a7a8d61f3a46eee441dc1230f7625d3a8c20c75d883eff9ed00afdb95d64b036320789ed6cd4922c651a952d07926b3e850a498cb1d9c839398dc03bc5fface93c08bc4071fd0c1a8591268174ad0e832fb0222dd0130389d00fb3cd53ddbb8f024a175c1b830242bccb85f10483b211adeda973e7ed46b1704d4bacbf51351275b7dac1b61e60fe3b057dbaabd38579b0092a4aa96b83cf52e1720c858ec86124b65ea0bead546c4bda3db2986d996").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03923082038e30820276a0030201020210033af1e6a711a9a0bb2864b11d09fae5300d06092a864886f70d01010b05003061310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d3120301e06035504031317446967694365727420476c6f62616c20526f6f74204732301e170d3133303830313132303030305a170d3338303131353132303030305a3061310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d3120301e06035504031317446967694365727420476c6f62616c20526f6f7420473230820122300d06092a864886f70d01010105000382010f003082010a0282010100bb37cd34dc7b6bc9b26890ad4a75ff46ba210a088df51954c9fb88dbf3aef23a89913c7ae6ab061a6bcfac2de85e092444ba629a7ed6a3a87ee054752005ac50b79c631a6c30dcda1f19b1d71edefdd7e0cb948337aeec1f434edd7b2cd2bd2ea52fe4a9b8ad3ad499a4b625e99b6b00609260ff4f214918f76790ab61069c8ff2bae9b4e992326bb5f357e85d1bcd8c1dab95049549f3352d96e3496ddd77e3fb494bb4ac5507a98f95b3b423bb4c6d45f0f6a9b29530b4fd4c558c274a57147c829dcd7392d3164a060c8c50d18f1e09be17a1e621cafd83e510bc83a50ac46728f67314143d4676c387148921344daf0f450ca649a1babb9cc5b1338329850203010001a3423040300f0603551d130101ff040530030101ff300e0603551d0f0101ff040403020186301d0603551d0e041604144e2254201895e6e36ee60ffafab912ed06178f39300d06092a864886f70d01010b05000382010100606728946f0e4863eb31ddea6718d5897d3cc58b4a7fe9bedb2b17dfb05f73772a3213398167428423f2456735ec88bff88fb0610c34a4ae204c84c6dbf835e176d9dfa642bbc74408867f3674245ada6c0d145935bdf249ddb61fc9b30d472a3d992fbb5cbbb5d420e1995f534615db689bf0f330d53e31e28d849ee38adada963e3513a55ff0f970507047411157194ec08fae06c49513172f1b259f75f2b18e99a16f13b14171fe882ac84f102055d7f31445e5e044f4ea879532930efe5346fa2c9dff8b22b94bd90945a4dea4b89a58dd1b7d529f8e59438881a49e26d56faddd0dc6377ded03921be5775f76ee3c8dc45d565ba2d9666eb33537e532b6").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("0f3f96980381e451efad0d2ddd30e3d3").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let current_timestamp = Utc::now().timestamp() as u32;

    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![5, 107, 97, 107, 97, 111]; // kakao
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d84188abccd9d1bfcc35a2dde8dcbcc1de1c8c5a268a52df14865c9a1352735b6dc7fa10749259b790831c1f165b03c60540d4c98f0099f8254bd635a80d3f7f1c6cf9951676de398d26d4c6084a358804c12bad7cce6c44e877b2b9b94e22d6e187cebcacad196d6bf5340474b7bdf28ae4f3eacd4583f26d123748aa2aa5c8b59b540e72f520e3111846f6d921692edb80cd3127a17b2b4a533e8d8b890a3959337c6375d6b523d48ae5451f8b340f55f596267a8cb0cb7934ebaac3e536991e8af96cce60233b7507816652e1484e95ca190652e479ff0a4f0181cf242d618053c4f398eccb7913a8b2a284d1e649e0448b3089936f65d2119b8dd701722f456d27",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_facebook() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("05e00a86df6cf47bd879e7392977562336d38d705d98ed02c4ef53b91d919ca60105160301009f0100009b0303241c28f0a081385b47f0b95886434f588a4121cdee92840f32fbcea2c40d43d80000021301010000700000001500130000107777772e66616365626f6f6b2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d0020636d6062393140916553a6d590110de9e085e37ba828d49f84b6db7225faf44a002d00020101002b0003020304160303005a020000560303b5ac49b76cf019ce046443f2d82d638287c7bf3e5ce0a783995de8e2f2de96ce00130100002e002b0002030400330024001d002000371eb59ebeb09f0b73f6998a71553beee6b213a02c96df26841bd65fd4913b1703030c1ee36aafb6ea60f308bd2342a6f6e70336f2cd2a2283ca55fd209ae1c17f50c5fc3cfa284c732264008ed100c7dee6ac1258907158c9c4f87386cde5bc519251c2170d7db9884e8257f561b3a141cabc7b7ac7c6776f467912fb6c4ed53d88f622f22b39c25ed7fcee4cbf064bdfbb56f340296936bbd4083f2bd492d6f9b6c66fa5b4b1633f32d1d42abf99936e6f05c1145d44f747c10cb862d997b1fe253582c487f4c580e69e9255eb9c7abcf923f1b6ef7b0f016c14220c4acd74a6219de9b8e2babbfb34e1b3300dd8c4bd7f61ba56f98ca2e824f173cf7b564cd00331002ac4d170a31639496661828830da60458336a2730d4db9640f53308e86d741089b817748c750925fdef846051eca6b6f3df11fa2816c99d17b61ddc8390c2e86c6bea55863a33a7d30e7c55b76194fcef7420482f2ca54c82eb4720949e75427303e5bb5a187d1829e7dd46f5dc176cb003dcf3271230f35006bafee12d903ac41b0578e79dfda39c04034aa3b0729e84b327b19634ded6ab1aec54c867b1dc1e8d278b6ef9f130a70139b6b6bd480094eef3fb0dbecc90489a9d3e248d32a6a8db9e8b9f4e3403accfbf96fbfb22aa7a76f4b91447dd083bee45e10ee82803e00bd88ad7ce79d1e62f34f608341bafd4140958e10c28f219826e257b8a995bab5066c06ddd3352af0f99082bbdff298043bfd56cd24d848772e40d0b38dd1374b2e2b56581880f6ef49a44fad93ee6eb0fa919c47c3bd735d914b5eac51ceff1865f4c16ebbfc92870d5c52364c8a82f6866ae78948b8ac82a9364c7b50734edced9946031f69c6e33058a44eaaa6c6e2313eadcfe4a6006fa88449f7bcc3bd3c157a6175e0bbc9e714cf56b228cd3ffffe3cef8b03886a199d7906b743f2830a3da243854cc8464e157aaa8f91ed05178e59120d9e45819a14f1fcd8ceac8783aa290ebde8dc41f3bb538b012f137584c2254b53c82ede1afc0bac29684832c3f9c5856919fb0387e69e0454125b84f9e6071c3bc176868236547c3d41f1db6f74c07d08ce474c70b75f5c892fc90daa1d92c5e43726c00b21bfa02c5182e2ac200b5acdd9b5cb131af79469a6e53a1e48d3774fc28e220ba4b30f4a078508b24395f8c6c356cb3935baeeaee42f514522ba9dcbd6ce9dfccaea81169fc63112fac3a31929e8c7b93b82faf136fb94d317fdff5bf8d7b7ced2e52c21c1e88fc2dd9fb4227cc56858df4e69982f549f53c446bec67462b6b247e3a68645bec23407e419ad34e3657063e60bfc72514e210c166abd6c1c887d8aeb907769e2fa8e757e365ace175302c1c1504a19f47fd629fd1ff859cd05af5170266568464ed27c01fbde7e0dd6db4ac1b00e7e73d924b5609dbc06777bc0eed2530dc7fe28ba9766b8fc2bdc3317d319ac586c4e6144b037a4e1c76f747453e26119ea10115101bece43cdc641e104b333bb9288ce308d9aafc0a4ea66e9ed710671468dbca949f3eace6fa355ac60f8fe07805a39c01c910c01383d63159b8ab013fc4ff2ff12ea25176cbb56ae61ac3548d09f4dedea74358749855f8181f38933cc8cf3a4386601477d09a742f67a93aec12f6588165c94b96a11d8465c02293ab3a5d64991fd21889036d625894399f7510e5d45e5299549429c5d088f9a615f3a09798b010ce3491c28411ab79d125629c5f64274f443dc6dbf3382ea43dfe4e1400d2efe0156b832cb65ba9d26790d8543e0a10bd7925693e604420a25804fdbb9b50872ad17a2dbf7c61077c2b507e905aadebcd34d71d5fcf2d2a926f188c1c692be4750721d9104e05b88b5abd916e3a5dbe61ccadc7d4ee5310a464c3e070f11dd3e8e78d61f38cbbe48dfd2b2895ad54c5a2448497f548bc95f5022da4aa462d8f7cd1f7fd9190007bb52621b41788e49bff681b26801b8d014621508f90c6cddc35e1241e2557016a132477139e652ff9fed1b163f36bba5cd09911b845aa04ccce92235330fd7e32a71f155f2c1271c20ed42c28b4e6081321842970125776574f3095f8b2693381dc5b61faafd75c866cb16a7a275e83490683578371992e36e5401e6ff0b7f785a2e60fd8aeb9083bd987cba9f165f8ac4a21398751cc502905262d8063ba35d84321d049adb8efb5a29cdeb0fca477ee591a9a5a3b04428dfebf64da756375793b0fd0c0ee653ef546fde58a101acc20d02517b66e3e9151ba414ce10bf16648701b256bf71e8f4768a3f5d084b1fa8f03b017506c99a38fe77d386852542d32d4a6759d25b64ab7be9a9628494468b30fd7f4765e5ae58503552bdc81ed1f3e07152ac5b389a3515d9267d817543e99f92bb12ff2cbcd912093c35e4d1131441298fbc3628fa258cace4169cdf466d9e193779c9ba11db1feab51ac82d57fb1a2550fef737dee932b355d7b7be342a24ae12ff95ba3a59f0ae81017cafc9329503d23e763718cfcd69e146661b66dd65e4b2b86d01ead85bc2fd70bb335ed98f231dc2f058b4e9623f5e9d333f28da47e193e9ceea035daabf3cfbe33f6af9222bfbf3e93d95c07da47062fbe3fc3605017590b48d5219347f22378f7f866515626f3fe351a9e67b59db45e5c94b9e255105afc825563e36df83c98b3243cde8c14bd404cfa819f63bb4d890856451694d9c799b168d112c5616fac68a272b8562772270a71a69406914116af0ac508c37d8f3822471ffc524810ab4e2972f0e89bb24cdd656bcb2785896b436aa24610a6d9bcce6a1247d67c211628102bb9c990db79fed8f4778436dbe4b772899045c9cb4745b69026ec3b2b56b56d9ca381cc79fccd0ddbb35d3731afe85d1c6e46e0c63be1fc9f3f0bca849e9fd2f974a48f1c2fc5171b3d6749f1e84b6d7246905b45710cbdffc9ec9d3860ed1ca05c916f5da419c6dd5890a9986facf801375104d05dbcbb170171ed171090d4d304c3a49379ed8c1ee097e4bc499b7af50e850e127b01a20e932d949339b386ea768a2460e859e08688117dbf2e4b35cb248610861731eb30f5f8e30b2c149138e418c22691613a927080b39a0dedfdda186281c37a38c8c8feb10810a3e2d8f11396773b70fcde7f8a0fecfcc1f428eb92bc5c133dbfd5397a702fc2830317f2fc8ec97dd48b6f2cb1b09ab643cbe0b92a17416cdf8d7b8ad4956abeae4268c82b8c5fe34ffe851713dcb331ed87ac69ea622d59f2af04de002201ce1f40fac51f00789a1a2c14417759d4d63468ef1bff62c394fa05239b168579e405691ce8971edc20e0084a71c9b57d364f059fecf7b540227d1cd0ec717739a02b603b6700a0927caf3345966a027eb9d8b038b82d9ae3a511ad4109ed9fdcbc4d6fe4932d8a2f9193293aee3249fd00fa98203325d57e5de732947332afb8f94751ddcba064ec119f59359522c44b7f48fcee728cd5f17f79df6622f290d310bc8d081183b252c24d4f8c82bcab7da1b5367be2cd875040014006627de367f7d88d24c6652873a5730c47ed77268437561afa7f7d4bc2e9dd5c6d623f0628a53aaad8e495a5b5e0f71d6485f885815885ed9bc721544080f4f5ef1d22cfd96d2e78d4440051d860215d440ea2c07a2fa33bc99e8126ee3c4398b2db396c23537762429434507a7b7f16babc1ae3dbfdc8001c03880e5fda1cad31357e39c23bac727b543d69eeb206b4904ae5e3901ba7ccf4a0b90fe6dbe3d8d81fb085787ed1af4be39edcf68e58c8e0508ea3a53bef9b9d9102ddc950914ca831672b5e8bf6f1209f46508748eb549b3baae752e72f233d7c321004bd412e21afe1e1bfc6f9fdea8b8ebe5bafbbf6d47e16b131472be740431bc112dca272eb4d2b63ce22de1c538affa32952d19f6a2864196777a6fd2565bd08ef0880117477387d91d0163e30fb72c38b545ad83692f4528b9c882e5fe1365c7876a6399adf989bc628e0aea9be63c13d5d3e18b92ce0068c14896bf280832359d8c65bdc68912f09fce076dceffbfdb6c49f94c4a448bae2f5fde343571b5090f0d503376e984907f3c4a3c8f31e493b658b48cd194a4b31fa657bbdc8d1139e0568d00ae3abc420ec43d98b93e8f385abbaac513176f46e4cec74d5219900acd8398b17d0d5a266030359afefc1bca867baa2d37904507a35597728a3cdaa185a125a18f06bfef3de37d1d3f38239e8afca51c5f3d88ed5f92f089baa292f34104c092ed70c4e143cb4876f2d3d3026643df3f9ecced01087e6482a0648bfe7fcfd7731d43b973f9be9297f7e45c601739c492c42487f39ea5edbcd0841742d19c215b1b3fb0aa4ea7227f84314554fb00da26c3e26e9484ea102ea1a4e7f4cbf2bb04c4436eedf468dd88307beeb9a2802c72bd15d02befe6b6247ce22909b00aab170303006c6d81d97eddc3a6e36139dd34c04e3b95c42538d077fc10693382ff375bedd67bc5c26b8251486448a522d404e7b2ca000cc9c2ee20e3d5429070e10bbd90ee26c4f49a318d9d9ab4ee2fd407e895a598e8b38df71ad5b279091010bcbb5ecb488e0b3aa52eceaeab65271f3017030300ac73008905d542fbc5c41bb557387e00681bb318adb5bbba7e0e0aaa45cf7bfde3913981fa444fb1d95645f78b666ce4f6ccca50458658b80afa171aa52bb38bf889b521495ded6195a1122b047c4038819de8d2ff1bdfbfeaf6e21319501967759e15e84030646caf6a1c5229aa2a31dc168befceccd6ee74c45e6b6469751d0edcab0777040e4411a3e3474eacd9920977d4025229606dcdb8b5d68a30ec2b8ebbedc437d158bb4a7d8a789e17030305ed8ecafd7e42d42715b4e9ae3282f3af4d4fd06090d8c93123d690ec16f7b576ee64f44c59d595eebbb58a31ab2694e3b24872913873445b8ab709f655dc33854fa2da7a9287b1993eff7aad87fc40b0fec93c270f09ef31fdb5caeee62fa0204e0ac683e7ac5c16f3a5df370f69e2aaa0cb8a9990239e878f2a9e39e6897fd59d76c75e6f89884a5e2d5139409979259b1c71b06ca32056bc3bc62e9e192052e62b873e84a074179af55859477b8c9b693352c1d8d805731d532968c92b750d0a17e5562ca27d6d0f8a7c61a5551f988565e20c9838c2463113b9c1f3ef4715f03d743ebad1b17d4ecbfe8f6b3fcdbf7da76a615ce2d40c3d7e3d268c0d28759ef8a68b7f1006467f84dc18709ff94ae12f4d47c38f049f1344879f31893419995f6856417ce94a2c2be14ff92d40c434ea928da923440493e92e389f1a06b2f60a275c5cc149f517d73e2b79fb8b6ec2a530aeb915011af81df10ec1262e1d67088030c05ed51c3263dff6c55f88e29474a7e8b6f9b7f2f1e265a0a524eb29f6732467ff24ced2231ceffa279d8102e096fb874a3a1e021f2ad2af3569cf365baeeacdf48720e022b181f4ad06b8e907c60b3c33c2204d0caca8c774f8d531691a9fffc3c43cd4b9405c37c4930d7e1bee0ab4b901a6707a3b02dfcbc309c9bdaa5b44d6e0ecaccfb5efd661bb40a9b925899ef99a44642a7332d396538ddd67a7180ee239dc9ab7ce86540fceb76ec426663bb0eafe11708cbd650b8b7903ffbb02406b41c287ccd5f5c472eebceda3fed8b04b6f04c631c9b569ac27e3fb8e73e601010f84fcf064e1cede22fa32f4598a865fd8e6002546c01773592255bca9dbd4b80ee53260761cda17bee1c00ff8f18a97c42e3116235c42ea84ab7053edf117ad5c9541ea7c41c0fa78820a73210d33a82891c5c639c542057c8a8cbf45b72ce76c98a14b12dfb4fc020995fae8a47738d4aa0918d75478c65ee78940f92135dfdc9d6829e704e62c5dde7f59f14566280273e579e7456bc34ddba9b147683aa1aa884918976e3b386803eefaa12862d9365ae90aac9b4555492c9e35f67ac825bec73ff38ddb1a22477876b61165c2a526af39cbcb0e9e2924e1ceae7d192055573755c0536ad1ab618e4394dd345d4ce84bbf2690e983c8bb726164529fea5dee4464349ffbdc209eabae0ccbeb390b4ca937b9cc9c11fafab75959299fc177d60b66f7b3e60a800787447e2f373bbe4d410411a254c985609b295663c92278dd20cab9e869003fa89af61c80a0b2d581587aa0b44cbce68371ac26b039b082d48f708c7ec7d284ee2dac125da63d326751b6575fd59e3a02bf878c9f83e2809b173dcd70c72c7511e555e704cd1b9b6d9f40438c7f851c06e8089e2133f9a0f2655eccfcf4cedc8cd55242205056d593db6a64a733251b6cb2141b568d3694497711d7138fbb6dd54d2738b9c49fefe68ccbfdbd7c90169cf7374ffcaed1ed8ff9ce2919791d86b3c51f58a8fe27aca0c72c5bccdaae5fc6295aa2045e2af06f8a010ce970311b922c209a0070372b6fc749486641fe145271995c9cc49848589d1c6feaf7bc4b067bfb809b6f75558a287bdcb444c5a8b21ff01ef3dd4b3db84dad3de6e08349eaffed91c4b11daf8c8ed2603228b3cd17f0646c6df9102ba3ca404d096de46a3de7e1b4f228378f79722d0fa196fcba0d1d530c9677cbd27f2e23ee1edf43aadf28c0f47806a10ffc3dca6ac3ef176f25ddb2e6e75719496833f654fc1533bbddf0651428f98e386090eafd2e4c6a281d4cc19ba3f4f300a07d5e5f32755a3b9353c6062fea4d46bd50971090292f9cfd29f3b543a2ce2fc60dbd5bccf41817d2340e17f7f5a8f8bc91b77eff76ff85c6468d86a47ba1863734b9543fe071b467b7a18767401e02e93d1bcd7d61b909e7784b204858018cb1342110860f865a63dc3172f40f12f8d3a972f3db3eeef8fd9ba3cd0a7be1fb5a53ba6c85a309339d74f3350abe58a9cda2ac175200b3f9dd68de7300d07c11ab9eb3a36a33e682807ab033a5cedd0a19908189cb4247868396d16eb593aaa9926ccef99131f10168d754995744008d7e8b7cef01c74528cdf784bc0cba8171f6a4d931d45224decf17030305ed9cacb37af592091d6db1509b407c5a9a65930213dd86740a79a2e6315a64eb26f140b79be6cc149c20964ca3f66c08686700bffb2df60883a49d4495a563bf2a398c7de0d3acdb96ae68e2c502c9578ace438236b673b145a03fc27befdbbe77ac82641c9289ebb8366094f684d8e0d578ab59820dc3526390c0bbfc893752692cd6553156dff0d658b30373a555da35f23e50eac3afa4751b931d6e0df4e35752342d497a2b944a2f167940b72ecec6ae2e29a8efc8986fa96b17ba8c943379461f2ae02b731fdabd4db726a39e62a377d2c3747ea9c97314fea3260c2f7ac0ecb53dc04c99584b2095b82cb2e6c4a93a6688b22be0de703e6931500448c34422bfcb80121bf419626a64557a362d391260d533a88661c910bd4991211d0751aaaf67754b8fd093d4898b1698fa07d96770548c56274081259012bc08237d3bf0af44a1052a5b272b3c8b59bf65de9d213080813182636f604669245b968e81dad665593b28f9212ccaa8b554a714e756441b7359b3a5caadf51fa81de5b4fa4e4e7c43f1a98a38e743d40a406016b52f68e7f62d0861f8d92c73e2dd188f20f5e8dfe2507fd46357dde21978baab582a88bc25e915a36db104d0789654e600a8c464930f5cf0469772ad2d92e8be5069d526f86a430f4d61063b16263accc40e69b72a131b000e2c3097bf75965da585c1b44637b375550c9a702bba294be48fd0998581b3264ab63b0fdfc7ee60b094934ef993803748588214aadee2706677c45ae359a4ede10db2fe4ab07f70ee6c0d0fd077199572d0fb3124cb9c7b6d88c6636ddcd19468f7a25d690b5228589e452b395bc4b6aeb2051b7e34f575f9b879d67aa0a101d86cd7aca739734fc7e07adb14e87f4f4526d20cc7d24b56bbd52b312d426c93b30021616ba9df320a5a9da6ab17815fb358efae8428b71ef1653a3f4bebb07fe61f20cb43e9c3e92c8ed3f3d0b81e9449092f43e7c18199ceeef66788f6f713c1b831b62a9243b832d8b896b4cdbbd20458ec6aa5fc0430d07e3e991b4643257a25a728736cf93f9fbb85b89884f810ee31c1507a585b4f91aa53210229f2931c07e81eba00c9121373fc1e0322050036101b9f3fbdeddf2d8d5f59ad84207fcb136d1150b08560e6e04d921cb33107458619c471044ca52e307048845ffad8360fb73e8c94e62bde099b6ee6b6eaacd81d8a71fa40167b87a2c50e2303c3228492237d33341e5f8fe08668ac5f17e149e27e20b66f78becd29f874dfa0bd6ec4046834d3f023fe5cd97abb30035744150cfde56473c56656bc57b9b3b7f3c13f0d3ec895a6c416a8082f07edc8a71a217d3fb9096d8f6554b7888a854c0eba85b4a58806ff7c76964f8dd74db1c0aad457197756080681f4eff3f6d510b49c65154cf74eb5fd112e6a789086cf955d1115ea285265d127c059d2194b3add2771f2570ef1d658613686d65402a98da13adacf194f210c664cb071043541559f3f1a5a516211e711a98c6a44a35e92f63a0dfde3272ec96abcb58164973a906bc09dc6a38b3ab601be6e7c42e20c1f8ebfa00f40621b4a031f90b668ea0b58d5a6175de436d0256dfad539b46c6ae10c68b53cfbcd9f73098729c85784babc5c69d86502eaa03f9c1d00ba2b243cb7ac3e7b22ec36279cee5e4b78eb84e64f45a433e67e813af9bfa6c1a15a5f5b696c4c828108b6b64e7cdd0d2fe3c5721e79dd6aeef7b43f76622f33a0a0bdbf238b0a861996ad13c4c069cf97265ccf6c4d2af7509017984d1699e6dbb601a21ba657fd3e822dbd499bc1022bc3131350c3ff5683f5441b33bd437c23ca45d4d015ae4d43ab034fa913f9222d593039d3459638b868a0e3ab777b2380c75e6fb5371bdb9bea1c95bde17b65ed39e3b6f7ac75f61fb2b2fed36cb690b171fab70c9f8a5f9f16028a61edbd6cbfa6102c8259a7638dd0b81725a158382bb38534b79ca501a0c887d52ac172268045a5ea37e0992179c327c0b079b088f423b84131ee3997f5e2a593d63826e708d91d0648c72ad30b6f7d8e6bcbe93c1a080fa9a6f6cc7fac04f0c1fcf1594485d627dabfba732e7047157168599e28c6579781cba34f8cfbb4742734c78e1769ccfe5cb2387144140e7a0c17030305ed6debdbdd5087586381168f901f3302b65fc1515f8c3ac7f8b24958a17fd4695f8740574c8d51c0b9f6f2b064c82c24e6973ae42dc9774dace06ffca67218f47f4dd7a33cdb07a50d301246d455899b047d6bd8e9c0e55e735c3a3b2ed1eb73263d06d867c778f74a9cdb104ae4ad568b82e3b46b1eb83d5995d22a338bf9151c439e0dded676aee7165ee06261d224e62987617aaa55db217c8397549cbf46c534d9eff74656e7503a22d4b8e4cd19a3d57f36f8d6cd53f38411c69de10dbae5908f0c2ec7544dc2fb12824ef82e673c6a42a3b7b865a2ee4b78c221663dfc810a2bb103b55068e94a29256b11da65dda0c1161c11796de838f24bcbef9d24d6a772d9ddc93256072ab09b361ef5e76783ebc8017dfb6f8f0a5c14fc24709dc8fff51e3e49e4215b8210dcd4f8cd0b33096d184072bf697d5ac9075fcbab73eee4cef45d7e251af0799ab96a7975cf6ab599276cbadd640ff44bcac93e2ab94395a70c390d9bf10d00f3d7413a0061732ad307c49c219835f2161aaaa80c3c7642c4d0839649ba436b2ff97b239cf8e5abc56731302af128af7e7a9035ca2fc326780b527452bef8fae4cdf2ac14fe39a55d108a562a31ac93a4c8fd0777984a1cd967281d188a57c7abf860db8d647be665842ed226a33f49fd0ead50e1f98b06ea915a2be1a7910fa9ff5e36b371234b62ce5310cd3c463cdb4b3ccc68b432aed94906eddddb5a43673609891d9c4e3d2f2601a2458b497f5840ec44158fc7d3f47d4c204d0df8f20442800dbfdc5dc44f732b95ca07c63fd406f59f4d3cb5a56a0b3dce3ee2ef22dd27d839d250a34290d10fa151ca21809fc7c0104ba1988ffd5c2cccb33c2b6babc36fc3fdb9537e4a61a3c7922aa2b80f630e94dceb87658a11adeccf04045a1a6a360411db369bb1c340d0140be87ff1d9d476b1ecaf44976cbb3e0a8a999e7f96a1eefd4c9c39f8f9eac04a7396bde88384c4c2201ed3ab39558fd5cfc0ddb65c30167466f424010d6324278040c45ffb413d122b6d3cfcc467259c293b81af1f6b49f39dc41e1ae4976641b2cead057c76e241475ea2f772c07d396fa65a5e17300cf9523a95f4ce812d5e20245ab15bc0366e9467b6675073842c7929c9f2f37b7578b314da25c6eb058b34dcb6a17d5e118227a98d61203c1b20d1a0361e549951368b5af3ef0603b4f08e4bebfe05e15e810f6dac82c08861c39c7c8f43d8875a2c07e48b78c4b6644b575a0a92abe696d0cce843ff10c2f14d8355d57e1baf31b9ee6a0857bf55de2cdca7c3b083737caaf9de168cab79167f1d31c44f5befa09e2a2b952bfa7301f7177b1395bd596243c509890f9838b5d1702fb05fd37c63f9cff12c56e00c5dc6913cf3fdff77834b746c1087af3fe891da4fee61abd077d6ea4cae09fd672cb7d95b079890c54d295192d45df6315681ea2eca18a5cb8e455cc81fee1cc9f5a9031e194a626483d2e0d964e20729163c58d9857aeca68df926a6590b479db5157d856c369f4555fe1bcc263445297faf6068416acab9e790790bcc021671c42da0ae97b085f5a0cf41586824bfc7eb4c581e7582559e4bceea93d625af35f95f79ed82fcfeb6109316016acccaf576f983feb4ecff4cb06f288593694a97abd9695ac52054e5093265cc44fbba593ae8c81af9f18dbdb23f02f219f7a7b0abc3d2f39b9d361db98dfc96940a0f809ce41a6948d666f8cf5ec80aab4c9558dff1aef95b3ae45e9d60de8dd16626916941b0be3205a7055a92ee174c1e7e9a023bd6bcf8b99edfbfd331bd8468ff37f57e0f9630d5279d004c23065e8778bce0938f90e2106b42698b6ea8e29b78ab483cbd4f982955e91fcc8e6127ec2b8964989568266db8be688953e1fb8d084ed1a86c4f98dce765d38c3a04f1bd26f8ec767a5e279f9c80c7224ac77cda2e98bed40f2ac084d99b530630654754a4799abac875dc41900a6d6d6983d17a82f8d63b9f4ab0333c7ba83cb3f1db2eb450425e30cf1e9fea6804c06fd3031d9ce59347b48bf1ebe57afb5d2796c3a0570a92bfc00fea602ce865801aa87a29b385f388d154fd9bb56cb913d73c8124e7f4997d93a5f151a54e64dbc0e11a8d5440ae44d002fc9ac3f3f91703030537a7802b09b8979702aef273c860f183231babe71e7a1a0f77fbc52ff92bfeb3c99b4057f924086f89d38fa4ac055cdd02fbed1ca455ebb97804946a79eaaff0757028ba5a6f9d1a806721b70b72ca46bed3d420c33cb98240d3f772c1bca8707077acef9e46c9cac23293b8ccff7c6ca2d70ebedddb212660ad094230fe3deab3313ca1e308a94ce044a7a91acc0a415383c999b175c251368d77f344142de3efe2f1afb3c843b97554d4ff99e9c67699e346c21ff8fa533ce64f1418cad6c60a8467f39756db3f18a673076fe8fe45830fcc42916f1a01ce969f95e9b2a26f6a8d542dd87b34a1f3dc6cdd1a4ca72bfc1653f85e0f312788e55a83a86316f2d71aec1e13005fd7ce0c3e8510afa8c0f86a6affe75995d3a322766d0c38f78d2f55493d4372fc90c4574c3c5374c7590add3959f0d26235afb731fd0ac99389a972b18adafcbd203a6b3380dc3ab00c876bbbd5c0bb122d31c095a68be5c9b9ddf8df2cd46fd2a5888dd90e300dd7cafc809e67c36736acd29efc9701b17baca7acef4fda12158cac69fe7eb0407838b37116f016a577a291cae09d648bfa442765beeb97e0a7862ebfea415086d29c291056f4d7db325ee3c536c8d0a62bd150fafb5f2dae89e1817ffc6b776f9d16d152c369c79bf32789065d9f5fac534d5349a33566c9c2067ba0f6fe1ed447497dc5edb13f47c2aa060e0d0f14e79fc825ac090f4ecb9e5e3d9975149ea8a02c18640db11e75c62fa176ea4b5148d7ff4d79afb1b84208142b9ab91499e8dcf48b8e2b3d4d6bf8ff8dd728234c70cc8f14afd1a64b01bc56117ea124c15fc42905bec9d2d4272b7c7d74f012c93f1e0a43b7455edf041389e10f710215a979a2055f448df77ae128dcb5ffd44d3da6188df8fe4973192dcff516777e23c2d182d29f5b5ac9a1fbacf7aaf1748ccd1cb1c0c7b354c6ae55886036bcc5c846403263ac7b96552a046c428165f40495d9f3c30a8a19085547dbdc51602660be9e326df1db856a8be0c6355ffe26f832fe457872c70adeb58cb2d4dcfbf0db8aac79be8fe9d464f26cb5ac5667e8d51da4502a102c063882ac70fb0605955029902693d3ac848b059ab3f5e2fdfc4b3adce46cd25021637863a3be8b3ced932884045e429cfa5f86a3a0448623ec51b32a4d464c7c0679c8db53c41d52340d003c41927065723f51a247c4af6924e1acbeed1ebf3711d0e827ae9b85b901d5a4fe88dfe5118ec8b565605353b7f04292dd490e23fa791c404471dfbb6780f62512fd6fee3872c6a86706af8000b5e863c7a59924debb02008a677a5937c5e40ce042ede1f08e744f2f70b45444dffd9dc51dbf25a53a52b2a33cb18b7087f48a84fdeb2f7f41776907a202bc8ff39e654ac89cd996d166663199113ca380f8e0698dbd9bbd334bdd4582aa70e2f6ae8e3d609c91c3d9d7e3946e442e2094d961e210b6af17f299bc602ada6f3123135323d04029de3f16b956156b6337a91a658ee19897d3a8fe8fdc4cffdd628e16592e5711f513a36bda97b2d2feb7826cbb4db72edeea292b297ddc7a3106b49b935cd2a11609d3be1cb9baba6aec1e933b8834f6ceec53cb8f6573b86d71c65743309497f2236eef4b8fc2adb0afbe81069c2269549566f64367a801e441454c63b370703c742ec05875deaa24e15f581b9b3f058345f4254d0880c4520fce21436c4562ebc78c7da82ca70277bbd30bf2e8fadeedbb1a3369b3f9888ecb6984ca899e0d4b0609a212bcbe4823d50c9200c9ce23fdbf2edfe39ab2cf8c36c5d8686a3cdc83745713856df13e93823026320ef1d3eb6f00c1deee3327da507a3e000649d3fd35f354d80f70f3034f8e6b2d9dde05b36955cd3ad978").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03923082038E30820276A0030201020210033AF1E6A711A9A0BB2864B11D09FAE5300D06092A864886F70D01010B05003061310B300906035504061302555331153013060355040A130C446967694365727420496E6331193017060355040B13107777772E64696769636572742E636F6D3120301E06035504031317446967694365727420476C6F62616C20526F6F74204732301E170D3133303830313132303030305A170D3338303131353132303030305A3061310B300906035504061302555331153013060355040A130C446967694365727420496E6331193017060355040B13107777772E64696769636572742E636F6D3120301E06035504031317446967694365727420476C6F62616C20526F6F7420473230820122300D06092A864886F70D01010105000382010F003082010A0282010100BB37CD34DC7B6BC9B26890AD4A75FF46BA210A088DF51954C9FB88DBF3AEF23A89913C7AE6AB061A6BCFAC2DE85E092444BA629A7ED6A3A87EE054752005AC50B79C631A6C30DCDA1F19B1D71EDEFDD7E0CB948337AEEC1F434EDD7B2CD2BD2EA52FE4A9B8AD3AD499A4B625E99B6B00609260FF4F214918F76790AB61069C8FF2BAE9B4E992326BB5F357E85D1BCD8C1DAB95049549F3352D96E3496DDD77E3FB494BB4AC5507A98F95B3B423BB4C6D45F0F6A9B29530B4FD4C558C274A57147C829DCD7392D3164A060C8C50D18F1E09BE17A1E621CAFD83E510BC83A50AC46728F67314143D4676C387148921344DAF0F450CA649A1BABB9CC5B1338329850203010001A3423040300F0603551D130101FF040530030101FF300E0603551D0F0101FF040403020186301D0603551D0E041604144E2254201895E6E36EE60FFAFAB912ED06178F39300D06092A864886F70D01010B05000382010100606728946F0E4863EB31DDEA6718D5897D3CC58B4A7FE9BEDB2B17DFB05F73772A3213398167428423F2456735EC88BFF88FB0610C34A4AE204C84C6DBF835E176D9DFA642BBC74408867F3674245ADA6C0D145935BDF249DDB61FC9B30D472A3D992FBB5CBBB5D420E1995F534615DB689BF0F330D53E31E28D849EE38ADADA963E3513A55FF0F970507047411157194EC08FAE06C49513172F1B259F75F2B18E99A16F13B14171FE882AC84F102055D7F31445E5E044F4EA879532930EFE5346FA2C9DFF8B22B94BD90945A4DEA4B89A58DD1B7D529F8E59438881A49E26D56FADDD0DC6377DED03921BE5775F76EE3C8DC45D565BA2D9666EB33537E532B6").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14e4f6715b789895089f5c26d53b01a2991ed2772b").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; // facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068f0ea0e8eac9eeb509907c5c1d44ce6d2c045bc9240d4ea41195a82c160ecc731f345898a65a698ca6267423fd3149583c1cffc99104ca5bad9227182c4e07f918baea634e50087298ce52c5733691f501a700c680667d919de1844333105cc4340623e8b66d6de35f608603747804ec68dae54ce0a6dc1dbbbd733e7b14b45302863e78d02f8467da4769a19a84c46e9518cf6a08e22eb911fa0d6a4620ab2ef4d3ce4038cd30ebee239d090e26a9579712a7fb4eaf121a05f13fe346c660eae496877de27978ebf3478a87759317e3fed591a7520a54aa85089ffb5f6c9ca02e8cd2f585d6fcf62274dea9c1a04b4c61e625b4680943ec878b8ed3e8843093b8c5db1",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_for_not_existing_kid() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14827b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("0003c8", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_for_invalid_root_cert() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![6, 103, 111, 111, 103, 108, 101]; //google
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("0003be", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_too_short_tls_data() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8fa2d869").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000321", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_invalid_provider_name() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
    //"d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    //"7670910579bb17bf986de6e318c6f5a8bf7e148b3fb8e0cbf03479fb9eb8c948";
	"b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("ae99261bdbf0e212fa58865326389e28e96ca44b1079a53731e3e1192c3b4289010316030100a10100009d0303cd553fdd847760b8ba57b8dbecdff4a2055d6e2181f0dec0c243ae16de82db2f0000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00200cdba1f93b5792c2cea4f91374a5797980e803c33ee566aafbac59d7e4eb5f61002d00020101002b0003020304160303005a020000560303cd320295b23dd5cd7af526abfd7e7646c4602297d5c36ae55b6c14a91e73ebc200130100002e00330024001d00208f686534e10f106701122c7037257fae5554b62905774b84d8d030f107ffa27e002b0002030417030310f9c5b689470355d8d3d2889b1281f34b1d2e6de4ca35b380aaf30c30ba573a1b880e868b3b00ab3d947fa3bb3a45e4a7ad562784c883fd5d2477990541f44939b6db749c6a1ec5c5a43be4b52f949af64bf3d2fe49178cbf1390a5a575ea1ee88343ef0ac2a2eb328993f246b53f9f51dbdffdffeeb73c872dd5d5a826bd42d17dcba367662b19c6101adffabfe5a994ce725ea7a0ff72d35c95fcf84de9ffc4d160d7d7b37233068bb5957f2a71b8ec0431243d7fa791b402be416bf30ce02b2fb3d03fff6e5b83ee30c3107dbfcc1524eee24914e5f869049df826f6dac5e1d1a074c7837b0ae06e73a0b99f29a9e18dcaec4ffd4894f7d60896659d45a50eba185ae0f5c7a4ffa23471aaeacd82730460d28cb5b815d3b98067a90106c34a648c3ee9d93383f22b62ad0911b0854818b718fa3f2f15a3a68e6b2cd509013ae0540ae6029ae532a326a757843b15b26deeca466fecf71ea25b0565c1f1315305be272941fb703df3bffedca7c1f6385fb19420ecab7189a383609804f2e9d86b1520ddf5283292ed65cf523e67aceafdbaa0996e491d5a886fe708cafc9a1fe47c87eb5b1fc2be96ea0b440447a27f55b7ff47779358e7c3997e80cf234c4145318ef1a92d7f8db4ab8e34e92d62c765aeefc56794eb92cf3bf2ab3a67839f378dad510229d2f82415d691b9426bda7d887cd1a5428478e43630209fc08b79098e63db471da66ee01e3d04b5eadeadaf2e50c8b261aaa0b18fcd0ccb889970207cd091ea03a0e13469e8db0bf5e6fb1802eeff59cdc4a6c7daafe7ab32a509d7a126b86fa55b749360157a6243176cbe2c3de6222c9991d10a75bb2f2c4c40282aa47216514ad45ac6a4bdc03a339f2a99702754009ea12d4926cb21ea236e2b7aaad16a81d4ef0fd723d6cefbfbc2bb35ba992cac00615478861b4786fd8aea25b3928261a5a97d0aa5b5a1620e7f6e84c070d7252d3c43fc5cb9584ac25c593dc4f36b726d1f61c9524d660f9ea972618ad438fe38e39b1751a3cfaeaa6fa1ac2230a2f5fe6d02208dc6d832ce64ba38d4e6ce0459dd3b95ff42e36e843dfc89a16ae9c28dc5ca6e9c1601f014038a104105a923d3b0d55803d0090b3eded7925c3784d72dff6218ee4bb628bea07700d7fc61ec5aa99b8e4d10599b4c5f52e35aaa3ef442ddb4d931b29a3f4f7ddad4d307974f9900870b54e207d627945c6d053088dd2cc55dfd4be561179590d285ab6409fef29b2738e23dfd16acabb0ca2c5b6e8cdfaf616cf71991fc2cf6da270879748def1d638cf479f853040cba0ebbe51d2259607abb7c7133393224d7036e6150d73c3609c4c0869388033b94e92b7b6859a40597d586d5cfdb9c2507d74ca273d56097f9d333c600aa560c5878febf9e4f97e6b5a3a42552b5a9f0c9e6888c15e54476f2d51c24f26dd732aa43e2e5ecc6aaa6b4c1b01cff3661d8ecea9d3eabb288e64836441cace0e3e3f419105ce00ec4a03e9f06d5227ab8a323f6726a527d95a4f319bf0a7e898f9c58b554010450fff0cdcb418496f97718520db51486acd3b9d0c391b693a330c132c5094587d653a1dbfd3499a26e39ff9d2aff1c57910c417d46a3fe381af140e7ecc9f6ac4e49ae390248b9327ce63f3f7fdd29b89f9faca0dfa29217294935d183f7da77a3f2ef574c18220aa096efcd559688ce1109ba08cfdd03c2191db227569f774dda6b61940b067c9541d8e4d4e7fbfac3838a5e8cb2edc85742b99d616cecf1fe6387aa3723a83698ee089367b530fdd93ac2cf57d28c4722424f03b42056ee4a4c38ac682a70f1ece3f0928b7d08dec89e4631bebe5fa73416cdde6982e621fa47d65e2f5f37bb8c50fd9120a83fe2100aa718ac411802be085a86beb9e2f28a3009a4209f909735516cdab96cd0e8e5a833aff57561b6016b12d081156e0817e88995a093642a3f62df2f955bcc972d1b2b560b1687666467bc364717cfabeafe5276deebff70b66c2bd93987b447c9e0a3c5a66cce167fc04fa946fe75cde757b93ddb61b679ea114d99bbaa4f8da52099bc3e61ccb7b38be78904967c14a551d1584b8e7dd4597040cefbac457bf6c21686875dc55c0891b17c5b7495f23db43efc85514e0722cb54419fe12a9bd4b656e607977f6bf76ca94521968bdd9332c7cffc1fe1eb2880a988c472acfad363fac0845c6f07bcddc1abb230471b20e8299bdfdd46bb3dc6200c3c4f478ce3cce51afe91cb3db0f8fd92c86b81524eacb8dd739d0b961b7910c560971d3f260922144a9c4c9cfc50f6cd9c4f21ede3f9d74d1a8e567c3eac3ffb3896bb649e31c5cbd55f0280d06cbcca9496ebfda6a6067e6d774dd71d88c30f480b192347be6f45de495b6eef038cdca66ecfd3f0b65215db9b6c412e62b0dbf871762879885372f8f70b882babe3e21802072299403bf49cf5f30840322fcd8373302c8adab672b8430fe75548e456f3c7d718772aa998e7c401d225fd92786911299c3211b7e4714a3fd1fb79b79b7ae3f38a7c01469071f39d72619173e4f916ed0e8eaf19c2cbd53a654b7caffb71bc94545161ae9712dc72c90e22e365cb3f856a581c3e3419eb1b04f3dbe580415cbc3ddd60039442b5a81c2391e1419f3899339c3c4e065b3145a782a51e40279cc4cf81dde4bf2ba780ba025bec2be0ccb72ec31e778c71f0514a41d15ae6f7c4ccfc7d4865ca2766b0cd8e8c7ec107023751ab8e33057a72b4b44fcaf8f5eea1cd43b71dac0f5ac24ea87e7311029e2243f293ef539c0c9156dc4a6739b86ba86e5629f867c60f06e66ee55a07eacbbe5da4fb19404f502369c4c8b22afe002301b9ec80f8b0a1a9f53d74bd47f32ff509e8844770c9af0d6b8d394d24ed48e4d1274ec2007e8b47b89c82f082f9485878d22ffbc72d7f1d9332cbe2053163544437478109a1eca1aae4f5bd329ed6e9f9c437f8fa41e0a69356ee771d535d9fe1adc1dcf16ea0d71e5839a83c9e75fdd8551d9a5bba7bac8b3a1bb5c3e9d04ea9ac6e57f02a027b6d690268cc217e51725f959ceb02bdb4aaeb1296fddd36e71ba48ed0faa8210d4f713e0e6fe85b2cde7a702f90ce0824d695dc41e72d6353ec9bc617a0e69ac9f7731909be75979b8e2538210730a041a0840d23196e76a2a4b486c581de7b8850318adb06c146d7bced7e3b817b40bdf90b319fa01f1e4ef955e4af3911508fa3a363c997a91ce680bc5c234c80a844a27a62c04d963c201a13808ea9ea83ca0979b4833ff11e5732fbbebabd2e349d130d99ef2f3bdb9805a7aeda9777a05ec7098c80eea868baf1e6d254f9d2712d87c864a3635d8e4cf0b5398d4e5f6c01f9ac2111ac7d50235183a28bb587e4369da862fd97a210f61cbdf8cf14ec3ddc220694bdc91fc64894abb3bf118ca485ada1746e066213c2b1b262430c9f7caee1641a2747429362f97ca9e531173a897142f237e13c769c381049712abf289b683ebf5e80d52adabd4d30f417dbc042dfeaf802f8deef077b80a9a39fd57564b86bc03301df10a6e13af944464082bfbd4fde0f9519bf9773ebb9efe16ceaca57310bd2110f924533567f09bb937132015989cc265f1fd86fdd6c9df535d9c04042cb18d99b39c0dbfbb4061b0b816297e522ceec15a5eeffbb0e1d03f22768ca1f85c6cc86f89b1c3efa5294b82cc91158fbd2d6ed153cf170299025780f849be6a4889c19c521326f5db2540f3accb160f01737a6a211fd4ff5f488bc03f7a478e5da2d13cbf88915ea1df89ccd7bd388d0528cca39668b663842af60cf46859dabe16c89661feca898d329042e7375bd6e172287bfa655f997964bda83e718028f9b7e2ea341fc1bae1dbb572a16cdc31ba49ef466cdd1bf8c58bdf169f7c1f6dcee165d3c2abbb65119ebcf466e574a52f24d11aab9f88c2c3f9fb62705fc87fd8d5bd69336f7846d95f924af027af80126561113f6a98097e9e71d374410917f31ab2df515c915f067e1bb9aaab2852661cebeefebc369bfae9ecbff26d87e4aa681dce8323ec940cc7a56b146d177ced199d0441d2336b7a0010a58ca4517a44b9067603743d8d07344d08ed251abd1d3f770462b47c21d7c1e3906eeefa2d96a76adcfe46a24ce159577f7b953222526eb1bf20d09d67f74501d1964ad41b91c1752c7f50fd85fd26a5f8fec7a4d368eefccdd0abdb5eef5ce90ec94b84aa96bbba0234c6e2e1f825c8a3de9d2546995438f88b5e9166a36089e1e85b348ddd91f5c78017a9fd5dc7f3487b585115da7d96d59847668f600d7fbb78cd1b5b0b4160e1d5c86680207be4248915dbb36022427762a384d98e5443f26a2c73cb3e293b6604d8ba212f99f5100c45d40c7b4abddd58e477687bd98229165535a79afb32191331a2950aa70966da07d437baa177f50497d0b0522a46129871d2dea935bd3ef8f0a88fb821a8969b68754da7ef6e3d2b001c0b9ff269dff4ff9d3006c5f62ddf276188e1a47635b8df4d65c6ce443449d684feceac01eff66130fd9d4243a66512916736cda979b98fa526bcc3d78a8b40670bd19d9d2a62afbf20bb0596658c2fb17954a06b4dc280c1a3853857746a1980827c56be9c027d5e4585c50102ab0de3a782839a10000fb7ead185050100fcea9e48cbf663fcdd21f7c41fe3a8f5059b9d9ebf664f459a1d9a9808bf572fb7c6682b826eaf4ef50889851883dd488a7382a9919b52a2e98b04e48e3f98c5e5e0c37a107322bc2a23361379108c4302ec49fbad3ff29fd03f932e28c522636f7bc89f0fd3b4bb077f79f346b716ec25a8478666a377ebc93ff0ec61ba8aafe6bebb1f3ae7008af29dc969be8424b9ca4fb2fe606a2ef460e83fef191e68cb3fbb3b65960507af7ded1cac281f49393ba1e32f059440ff8b90a995c2f525b92a608db211f3fd21fa396f2cdb9300fe7c33421a2e1623fe2eed458140445c1e0be75d9dec4d1068ce52b77a97e470d002874cbaf95f70b5b25922ed02b5667a11d73b5f67719fceb8e19d1587bc8fb7eeceda7849a5291934a6625ee99acdd30638c63db1f3ed3489e3812d5cf0a3435841f88f3fdaf33baa8d80592bd8f14e22b028366318d4577264c32b85bd20fa63554486928fccd42648b7c6e9e48a59d4983f634e1f8006ea64bca593bab2a134f0e767f72bad69387210b7564ede20c6a6229d80a6318b46cad354084693ca27c844377f2ac9d2ce5c88f9459e7a0e3df5466accbb10d20b33cd656625c995fdb7257faa25d8ef6433146b493d318c6bf99f8239bb83990f5af3f3cb8b651bfc4651af857589d153753bc8571b9631067b3cddf74be4af42f15ec457a3d21a2de2672b6fa85268fde91d3fbf19fe2001b04b1117c5f13dcb3e6c35bf4d76692b75ffc2b57360fdf3d0da1aafd0412668d7a9ad85f2e84fee5e19e2ae06225dd006e872eeee8540a8e5e3c8deb1fbf3e42a080822412345750394c9abf05204345c626283efa49749ca0681f3abb41610aaea063f96be48100441e9eb9775aa94e5e6c43a666b24091f02fc6a64a31557163ce5a432fd74cf31cd0ce360b7a61226a30adf43c2028a493774590d1b3eb5ce66b54534096c9fe6edd141b2e6edef22e0c94f9471d84b26356a5ac9ff3bd280efc5aac38dc8d2200c1dff8e9949e93d5d181066711d834ad10053e9c834449b92106804905c124a3e1d6b7869c3e548e048c396ca99adae9f7c54048a62cba83b8c2583c560d9dfdf4ef85a5e3a6d4562806bc1b3a73a5062053f77e3098c83b5066a4ee94c7b3015996b73e96f57e8ee6e2ef26534b767d66a219fc239e0848929ef16558657f758fa69d359bec1e1ad6895b97f371ed0c329e872de8171fd9fcd8375002a29d1c2c7ec0f73c9b41285a3797254f9cfa9925a9e0ed63ebf394dae825732524938bfa3d083a1a526ddb0b836636ffdf57e81e2dc317c10373dbd093be0e731657bb62b7568d6a25c73f1c322d66f16d2532f44ce3e6c5db6de971a4c2aa700e55d482da2d0eb7abde23f10d01edcce31ce64eb4d780df2764b8802ae4f3e69f2445de02145e35310817669bf74e6045015c5dc8be23d92e04ddf10c32ffea8ef280639b615bc51d5862be682ca5e94c170303005f1d7f1e12d5ffc0c0a0b4497dda2233fd69ba26fec55cb0f6953a02e4d256e0acd5b97568076f9d5a364fef025362e151e76a65e3f678969e7126c9bf70d2957c47c41c5b48f465dcafda37ecbfabd267398991f629395544f658a7cf6aa1cd1703030217be7c5a78debcb8bdf2461b13d1468e9f17e618c848d9bc70a8d3ad08ffcbc16a7de1d45530dc5e3390ddb02bc5ec88fc4921c4d77c07a353b791fb9a2c4c462257eb65286fe378fb47f4247a84d4e77f7d2ce2a75c888a58363798937f4f7018b919b6a9b1329fd94cf0594a25e66a99e70ac9d03fede46b0b73cd56282bef762cd8d683a0b0dab9dca91c0fbcea5c15d071f9b48e9a400b0d9b534820e0608c21e1e85de4be4c714e6cb5e65ca28763616e8954ba4ff9316ad7aa861490a7a89dc4ddeeb6b0c46117f4b8b4e093b74af76757ef44c6b15d381dc6d4b86ece1fb49e3f955d29395f2da895b695ca4ca24fc796e5868f3531abf8b57c07983f10514656bc44ae490a08bf350c73131597260a6ccf766ea228b2822f6497ef5b6ba0b10deea024f3cc2e19a71aada752611711165f3d511d6849d6ac125b0e0c3f76307f2716ba9ca72aa48b508af2f879ac3f302297d4a0b70b78ef9358e3163b4c2e99a77a45eff534b1c8885a09a5e4df23635afcfc6cba9a30d9dba5988aa56f898df7ed971488dc1beb971cdc63f9de0fdf74a90356a648726b69fea8e2bc81b7a855769a5aca863797b2f8bcfca783828ee2edc906b4cb3d9097374688d84d4e98b785e28ffc614cd2392fbc9a95e1091cc2b1e1922ef03e924256c31d702c48c71dcd8d7ff915f6c2ed6f12b3927ee71e84b11c93f7680de5ca3690a79d81fbc619fd44615b4fa7099faaabc58a5b090ac18109c11703030573ea467182f4e55d194ad3831ad2fa001e663e8faf2d0728bb39eca4ea81ad1f882737eeeae5bce56edb032efdb231b6efe5213cb3eda0effc93ba53d9457398f253a58a8c448dc7e7e646d19591516dcb1325c7051d991d0ee511bdc24ae335b6cd1aa0742de2952de00ef7cb04c838acfae653e48f9064f759054bb70b95f616c73360aaa162995e01b2a6a09835d43f4e7b992f1338441d4f1c23fdba9e6f7cb042753e5af3144c1bb58ed510eea0e0a79bac443d68e62835944f7e10fb15ff77726966a8dd622a4a021ebd49d4a919a62f673645726f49b3d021af4585b326fa3d9bea3fc3f9d44df33e8fb9751907b773044a31a4499c4a94852d0cdde5afc478b10e9d4f6e4c0b3a7bad9336d7b3b1dbacf9b888438eaadab08402c3e36885d9ed2b4070f21c9be5cb0118e240478ea6f3d445381c37f509585d89165406968c71334977b1c096204baef1dd74d8310948a82af4a9fd43d08935bda61a2c549a96578780a1522d39e87a3bfd6d0dcb2f5bfae250ef43a27d2a49bc3b0c5a98a158871ef32d8acfa91575ff4d0f7904d1fc99925224a58010e47ddd1c0a91040ef8b6f330777508cb50d0d54c18917ede01928ed97af926b95e86b7e1c4931e3e173867e705896e47972d7d86de59485fe087be296a6a949730026c067301704aec6123ad3df4e6508a651ffbd499f7d49a82ce29598c1db30e4963e100ca46cbfe847a22f934ebb0406d82c4c5a1ba92e18458fe985cb69f1267de4b6d565a3d4874c5a5abe1f81e256a2d2dffd3a1bae5429d30d5f3de996d752add02e3ad449f4a89fc8c7f48ebb47f64cbc9b2ef0f0af570b5fd056c09d2de9f80ef13d81f871f57b689881f8d202e27cd0c5b69680482842452762ef0ecdced2258c80efcedf5e41b5997df76998d31f15d8cd223255968edbfb75d14d5f432557ae0c4be8c8396cff7042d6a0ad4e383f668977e48a27d04fa479dd39a3f782ca3c10bf075d1de448d8e2f919a74ea6f82b1cba3d9d164daa46867f12f476fbc744f0a5190932dcb67e36a69fb8a152cc4af53ad79e654e8236453abc69b5025bf427b1b2ef2ca6a311127f47aaee7187a73d47bfa1bb52f84c6cfafd5701706ba97a21403dd2ad23801857f8e6e9eaf101655a72462959424a9fb2d3e62233c8352562d44ddd321443792c7140b6271dee30f32df40a9dfd6a1f203de10e79dc885e24595a60ef62819c511474e589d022007791ed0f5e2faba4b43a94ec05230c8014aa2a965f3c2b4f829644d0d3475b3c4215f9ad2d1536f6ac7da992f9f2d2ae9d11d4fc9c553de615f2a76d906bade8ba9e57d5b31e054581e9ab329cffa01dfb9271f028106bc176490fc94e0c3641703be613b04e8fe3a15cf10722d98b5c556e646e95305ea9c65eac538ac913ec2b0237a4c20751dfa8cb5b03886e74c4884af77fad85bb9494c7ceb6442de0061b8d53cb8571b2dc9839e0a4b5c51cfab01c35c6b0be8779167a7ebcfd204abf79eda211473e1c489d912fd6069a4cf4fe46c37078d87fa0138d42b320e6f55fc37558c69340ea0e2d19de0a3fec3257cf75b9b9c7641852391d8d718072e5f615d7f1e87e9d51e132c62bb3bb67bb4d410b660371d6114beae07bf2594c4d207e4f668d11adf5571c0bf6b3dc84a04de62cc8c7319af6caac430309e9dcfdbe6fd2e0225a464c186340724835b5c51c7a07bdf65129e3a57d493d32c39672b25d9a69d3a9d48b4b08e28dbbda4a711191f8c08ba028d27be2f99c3db54458f9b23f4fa25e1d2d048bc0ec4da327a3f18dc061a36ecde9346e5d518a640d344a68a4d1002ec1f08152926ace5064a44b035a4556f5e10eae6b851713edd4989492fb86f57e2521630ff1f5af8750f2fb58c654e82f5aa9b27c6709d6564c5d37a691b8c34036ab6223882735cb78ec93a4dbc515d3fc258d7b835786031424eb8085517030300c458f09ed726047311401c89d52985be1013aed7ad1955d73ebc96fe25c51bbee54d2f6f115754b240b2946a78b7e488f4f8280d74bcaf6451837e43112f84dd14943ea202f0f061c643c67cd6ec63912edc909d8d4f9328fd90717d99f53ecbedb15de33dc0addfff6b94377d0b8eff1139c0ddb033d27ea86e913a9258ce6796be0e69c908c05751acc6ce000599ccafcb0ded086a31c9fc1c8bc5d8e39177dc46602ec05712c5a88a49ba45d1b38e393840abce2f0608a802d753c4d65eee93f6136b4c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; //google but facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000327", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_facebook_invalid_root_cert() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "b8891b913656ae35d9ffff371f0f03e4f1f869d0e17556a8c273750313884b0a";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("05e00a86df6cf47bd879e7392977562336d38d705d98ed02c4ef53b91d919ca60105160301009f0100009b0303241c28f0a081385b47f0b95886434f588a4121cdee92840f32fbcea2c40d43d80000021301010000700000001500130000107777772e66616365626f6f6b2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d0020636d6062393140916553a6d590110de9e085e37ba828d49f84b6db7225faf44a002d00020101002b0003020304160303005a020000560303b5ac49b76cf019ce046443f2d82d638287c7bf3e5ce0a783995de8e2f2de96ce00130100002e002b0002030400330024001d002000371eb59ebeb09f0b73f6998a71553beee6b213a02c96df26841bd65fd4913b1703030c1ee36aafb6ea60f308bd2342a6f6e70336f2cd2a2283ca55fd209ae1c17f50c5fc3cfa284c732264008ed100c7dee6ac1258907158c9c4f87386cde5bc519251c2170d7db9884e8257f561b3a141cabc7b7ac7c6776f467912fb6c4ed53d88f622f22b39c25ed7fcee4cbf064bdfbb56f340296936bbd4083f2bd492d6f9b6c66fa5b4b1633f32d1d42abf99936e6f05c1145d44f747c10cb862d997b1fe253582c487f4c580e69e9255eb9c7abcf923f1b6ef7b0f016c14220c4acd74a6219de9b8e2babbfb34e1b3300dd8c4bd7f61ba56f98ca2e824f173cf7b564cd00331002ac4d170a31639496661828830da60458336a2730d4db9640f53308e86d741089b817748c750925fdef846051eca6b6f3df11fa2816c99d17b61ddc8390c2e86c6bea55863a33a7d30e7c55b76194fcef7420482f2ca54c82eb4720949e75427303e5bb5a187d1829e7dd46f5dc176cb003dcf3271230f35006bafee12d903ac41b0578e79dfda39c04034aa3b0729e84b327b19634ded6ab1aec54c867b1dc1e8d278b6ef9f130a70139b6b6bd480094eef3fb0dbecc90489a9d3e248d32a6a8db9e8b9f4e3403accfbf96fbfb22aa7a76f4b91447dd083bee45e10ee82803e00bd88ad7ce79d1e62f34f608341bafd4140958e10c28f219826e257b8a995bab5066c06ddd3352af0f99082bbdff298043bfd56cd24d848772e40d0b38dd1374b2e2b56581880f6ef49a44fad93ee6eb0fa919c47c3bd735d914b5eac51ceff1865f4c16ebbfc92870d5c52364c8a82f6866ae78948b8ac82a9364c7b50734edced9946031f69c6e33058a44eaaa6c6e2313eadcfe4a6006fa88449f7bcc3bd3c157a6175e0bbc9e714cf56b228cd3ffffe3cef8b03886a199d7906b743f2830a3da243854cc8464e157aaa8f91ed05178e59120d9e45819a14f1fcd8ceac8783aa290ebde8dc41f3bb538b012f137584c2254b53c82ede1afc0bac29684832c3f9c5856919fb0387e69e0454125b84f9e6071c3bc176868236547c3d41f1db6f74c07d08ce474c70b75f5c892fc90daa1d92c5e43726c00b21bfa02c5182e2ac200b5acdd9b5cb131af79469a6e53a1e48d3774fc28e220ba4b30f4a078508b24395f8c6c356cb3935baeeaee42f514522ba9dcbd6ce9dfccaea81169fc63112fac3a31929e8c7b93b82faf136fb94d317fdff5bf8d7b7ced2e52c21c1e88fc2dd9fb4227cc56858df4e69982f549f53c446bec67462b6b247e3a68645bec23407e419ad34e3657063e60bfc72514e210c166abd6c1c887d8aeb907769e2fa8e757e365ace175302c1c1504a19f47fd629fd1ff859cd05af5170266568464ed27c01fbde7e0dd6db4ac1b00e7e73d924b5609dbc06777bc0eed2530dc7fe28ba9766b8fc2bdc3317d319ac586c4e6144b037a4e1c76f747453e26119ea10115101bece43cdc641e104b333bb9288ce308d9aafc0a4ea66e9ed710671468dbca949f3eace6fa355ac60f8fe07805a39c01c910c01383d63159b8ab013fc4ff2ff12ea25176cbb56ae61ac3548d09f4dedea74358749855f8181f38933cc8cf3a4386601477d09a742f67a93aec12f6588165c94b96a11d8465c02293ab3a5d64991fd21889036d625894399f7510e5d45e5299549429c5d088f9a615f3a09798b010ce3491c28411ab79d125629c5f64274f443dc6dbf3382ea43dfe4e1400d2efe0156b832cb65ba9d26790d8543e0a10bd7925693e604420a25804fdbb9b50872ad17a2dbf7c61077c2b507e905aadebcd34d71d5fcf2d2a926f188c1c692be4750721d9104e05b88b5abd916e3a5dbe61ccadc7d4ee5310a464c3e070f11dd3e8e78d61f38cbbe48dfd2b2895ad54c5a2448497f548bc95f5022da4aa462d8f7cd1f7fd9190007bb52621b41788e49bff681b26801b8d014621508f90c6cddc35e1241e2557016a132477139e652ff9fed1b163f36bba5cd09911b845aa04ccce92235330fd7e32a71f155f2c1271c20ed42c28b4e6081321842970125776574f3095f8b2693381dc5b61faafd75c866cb16a7a275e83490683578371992e36e5401e6ff0b7f785a2e60fd8aeb9083bd987cba9f165f8ac4a21398751cc502905262d8063ba35d84321d049adb8efb5a29cdeb0fca477ee591a9a5a3b04428dfebf64da756375793b0fd0c0ee653ef546fde58a101acc20d02517b66e3e9151ba414ce10bf16648701b256bf71e8f4768a3f5d084b1fa8f03b017506c99a38fe77d386852542d32d4a6759d25b64ab7be9a9628494468b30fd7f4765e5ae58503552bdc81ed1f3e07152ac5b389a3515d9267d817543e99f92bb12ff2cbcd912093c35e4d1131441298fbc3628fa258cace4169cdf466d9e193779c9ba11db1feab51ac82d57fb1a2550fef737dee932b355d7b7be342a24ae12ff95ba3a59f0ae81017cafc9329503d23e763718cfcd69e146661b66dd65e4b2b86d01ead85bc2fd70bb335ed98f231dc2f058b4e9623f5e9d333f28da47e193e9ceea035daabf3cfbe33f6af9222bfbf3e93d95c07da47062fbe3fc3605017590b48d5219347f22378f7f866515626f3fe351a9e67b59db45e5c94b9e255105afc825563e36df83c98b3243cde8c14bd404cfa819f63bb4d890856451694d9c799b168d112c5616fac68a272b8562772270a71a69406914116af0ac508c37d8f3822471ffc524810ab4e2972f0e89bb24cdd656bcb2785896b436aa24610a6d9bcce6a1247d67c211628102bb9c990db79fed8f4778436dbe4b772899045c9cb4745b69026ec3b2b56b56d9ca381cc79fccd0ddbb35d3731afe85d1c6e46e0c63be1fc9f3f0bca849e9fd2f974a48f1c2fc5171b3d6749f1e84b6d7246905b45710cbdffc9ec9d3860ed1ca05c916f5da419c6dd5890a9986facf801375104d05dbcbb170171ed171090d4d304c3a49379ed8c1ee097e4bc499b7af50e850e127b01a20e932d949339b386ea768a2460e859e08688117dbf2e4b35cb248610861731eb30f5f8e30b2c149138e418c22691613a927080b39a0dedfdda186281c37a38c8c8feb10810a3e2d8f11396773b70fcde7f8a0fecfcc1f428eb92bc5c133dbfd5397a702fc2830317f2fc8ec97dd48b6f2cb1b09ab643cbe0b92a17416cdf8d7b8ad4956abeae4268c82b8c5fe34ffe851713dcb331ed87ac69ea622d59f2af04de002201ce1f40fac51f00789a1a2c14417759d4d63468ef1bff62c394fa05239b168579e405691ce8971edc20e0084a71c9b57d364f059fecf7b540227d1cd0ec717739a02b603b6700a0927caf3345966a027eb9d8b038b82d9ae3a511ad4109ed9fdcbc4d6fe4932d8a2f9193293aee3249fd00fa98203325d57e5de732947332afb8f94751ddcba064ec119f59359522c44b7f48fcee728cd5f17f79df6622f290d310bc8d081183b252c24d4f8c82bcab7da1b5367be2cd875040014006627de367f7d88d24c6652873a5730c47ed77268437561afa7f7d4bc2e9dd5c6d623f0628a53aaad8e495a5b5e0f71d6485f885815885ed9bc721544080f4f5ef1d22cfd96d2e78d4440051d860215d440ea2c07a2fa33bc99e8126ee3c4398b2db396c23537762429434507a7b7f16babc1ae3dbfdc8001c03880e5fda1cad31357e39c23bac727b543d69eeb206b4904ae5e3901ba7ccf4a0b90fe6dbe3d8d81fb085787ed1af4be39edcf68e58c8e0508ea3a53bef9b9d9102ddc950914ca831672b5e8bf6f1209f46508748eb549b3baae752e72f233d7c321004bd412e21afe1e1bfc6f9fdea8b8ebe5bafbbf6d47e16b131472be740431bc112dca272eb4d2b63ce22de1c538affa32952d19f6a2864196777a6fd2565bd08ef0880117477387d91d0163e30fb72c38b545ad83692f4528b9c882e5fe1365c7876a6399adf989bc628e0aea9be63c13d5d3e18b92ce0068c14896bf280832359d8c65bdc68912f09fce076dceffbfdb6c49f94c4a448bae2f5fde343571b5090f0d503376e984907f3c4a3c8f31e493b658b48cd194a4b31fa657bbdc8d1139e0568d00ae3abc420ec43d98b93e8f385abbaac513176f46e4cec74d5219900acd8398b17d0d5a266030359afefc1bca867baa2d37904507a35597728a3cdaa185a125a18f06bfef3de37d1d3f38239e8afca51c5f3d88ed5f92f089baa292f34104c092ed70c4e143cb4876f2d3d3026643df3f9ecced01087e6482a0648bfe7fcfd7731d43b973f9be9297f7e45c601739c492c42487f39ea5edbcd0841742d19c215b1b3fb0aa4ea7227f84314554fb00da26c3e26e9484ea102ea1a4e7f4cbf2bb04c4436eedf468dd88307beeb9a2802c72bd15d02befe6b6247ce22909b00aab170303006c6d81d97eddc3a6e36139dd34c04e3b95c42538d077fc10693382ff375bedd67bc5c26b8251486448a522d404e7b2ca000cc9c2ee20e3d5429070e10bbd90ee26c4f49a318d9d9ab4ee2fd407e895a598e8b38df71ad5b279091010bcbb5ecb488e0b3aa52eceaeab65271f3017030300ac73008905d542fbc5c41bb557387e00681bb318adb5bbba7e0e0aaa45cf7bfde3913981fa444fb1d95645f78b666ce4f6ccca50458658b80afa171aa52bb38bf889b521495ded6195a1122b047c4038819de8d2ff1bdfbfeaf6e21319501967759e15e84030646caf6a1c5229aa2a31dc168befceccd6ee74c45e6b6469751d0edcab0777040e4411a3e3474eacd9920977d4025229606dcdb8b5d68a30ec2b8ebbedc437d158bb4a7d8a789e17030305ed8ecafd7e42d42715b4e9ae3282f3af4d4fd06090d8c93123d690ec16f7b576ee64f44c59d595eebbb58a31ab2694e3b24872913873445b8ab709f655dc33854fa2da7a9287b1993eff7aad87fc40b0fec93c270f09ef31fdb5caeee62fa0204e0ac683e7ac5c16f3a5df370f69e2aaa0cb8a9990239e878f2a9e39e6897fd59d76c75e6f89884a5e2d5139409979259b1c71b06ca32056bc3bc62e9e192052e62b873e84a074179af55859477b8c9b693352c1d8d805731d532968c92b750d0a17e5562ca27d6d0f8a7c61a5551f988565e20c9838c2463113b9c1f3ef4715f03d743ebad1b17d4ecbfe8f6b3fcdbf7da76a615ce2d40c3d7e3d268c0d28759ef8a68b7f1006467f84dc18709ff94ae12f4d47c38f049f1344879f31893419995f6856417ce94a2c2be14ff92d40c434ea928da923440493e92e389f1a06b2f60a275c5cc149f517d73e2b79fb8b6ec2a530aeb915011af81df10ec1262e1d67088030c05ed51c3263dff6c55f88e29474a7e8b6f9b7f2f1e265a0a524eb29f6732467ff24ced2231ceffa279d8102e096fb874a3a1e021f2ad2af3569cf365baeeacdf48720e022b181f4ad06b8e907c60b3c33c2204d0caca8c774f8d531691a9fffc3c43cd4b9405c37c4930d7e1bee0ab4b901a6707a3b02dfcbc309c9bdaa5b44d6e0ecaccfb5efd661bb40a9b925899ef99a44642a7332d396538ddd67a7180ee239dc9ab7ce86540fceb76ec426663bb0eafe11708cbd650b8b7903ffbb02406b41c287ccd5f5c472eebceda3fed8b04b6f04c631c9b569ac27e3fb8e73e601010f84fcf064e1cede22fa32f4598a865fd8e6002546c01773592255bca9dbd4b80ee53260761cda17bee1c00ff8f18a97c42e3116235c42ea84ab7053edf117ad5c9541ea7c41c0fa78820a73210d33a82891c5c639c542057c8a8cbf45b72ce76c98a14b12dfb4fc020995fae8a47738d4aa0918d75478c65ee78940f92135dfdc9d6829e704e62c5dde7f59f14566280273e579e7456bc34ddba9b147683aa1aa884918976e3b386803eefaa12862d9365ae90aac9b4555492c9e35f67ac825bec73ff38ddb1a22477876b61165c2a526af39cbcb0e9e2924e1ceae7d192055573755c0536ad1ab618e4394dd345d4ce84bbf2690e983c8bb726164529fea5dee4464349ffbdc209eabae0ccbeb390b4ca937b9cc9c11fafab75959299fc177d60b66f7b3e60a800787447e2f373bbe4d410411a254c985609b295663c92278dd20cab9e869003fa89af61c80a0b2d581587aa0b44cbce68371ac26b039b082d48f708c7ec7d284ee2dac125da63d326751b6575fd59e3a02bf878c9f83e2809b173dcd70c72c7511e555e704cd1b9b6d9f40438c7f851c06e8089e2133f9a0f2655eccfcf4cedc8cd55242205056d593db6a64a733251b6cb2141b568d3694497711d7138fbb6dd54d2738b9c49fefe68ccbfdbd7c90169cf7374ffcaed1ed8ff9ce2919791d86b3c51f58a8fe27aca0c72c5bccdaae5fc6295aa2045e2af06f8a010ce970311b922c209a0070372b6fc749486641fe145271995c9cc49848589d1c6feaf7bc4b067bfb809b6f75558a287bdcb444c5a8b21ff01ef3dd4b3db84dad3de6e08349eaffed91c4b11daf8c8ed2603228b3cd17f0646c6df9102ba3ca404d096de46a3de7e1b4f228378f79722d0fa196fcba0d1d530c9677cbd27f2e23ee1edf43aadf28c0f47806a10ffc3dca6ac3ef176f25ddb2e6e75719496833f654fc1533bbddf0651428f98e386090eafd2e4c6a281d4cc19ba3f4f300a07d5e5f32755a3b9353c6062fea4d46bd50971090292f9cfd29f3b543a2ce2fc60dbd5bccf41817d2340e17f7f5a8f8bc91b77eff76ff85c6468d86a47ba1863734b9543fe071b467b7a18767401e02e93d1bcd7d61b909e7784b204858018cb1342110860f865a63dc3172f40f12f8d3a972f3db3eeef8fd9ba3cd0a7be1fb5a53ba6c85a309339d74f3350abe58a9cda2ac175200b3f9dd68de7300d07c11ab9eb3a36a33e682807ab033a5cedd0a19908189cb4247868396d16eb593aaa9926ccef99131f10168d754995744008d7e8b7cef01c74528cdf784bc0cba8171f6a4d931d45224decf17030305ed9cacb37af592091d6db1509b407c5a9a65930213dd86740a79a2e6315a64eb26f140b79be6cc149c20964ca3f66c08686700bffb2df60883a49d4495a563bf2a398c7de0d3acdb96ae68e2c502c9578ace438236b673b145a03fc27befdbbe77ac82641c9289ebb8366094f684d8e0d578ab59820dc3526390c0bbfc893752692cd6553156dff0d658b30373a555da35f23e50eac3afa4751b931d6e0df4e35752342d497a2b944a2f167940b72ecec6ae2e29a8efc8986fa96b17ba8c943379461f2ae02b731fdabd4db726a39e62a377d2c3747ea9c97314fea3260c2f7ac0ecb53dc04c99584b2095b82cb2e6c4a93a6688b22be0de703e6931500448c34422bfcb80121bf419626a64557a362d391260d533a88661c910bd4991211d0751aaaf67754b8fd093d4898b1698fa07d96770548c56274081259012bc08237d3bf0af44a1052a5b272b3c8b59bf65de9d213080813182636f604669245b968e81dad665593b28f9212ccaa8b554a714e756441b7359b3a5caadf51fa81de5b4fa4e4e7c43f1a98a38e743d40a406016b52f68e7f62d0861f8d92c73e2dd188f20f5e8dfe2507fd46357dde21978baab582a88bc25e915a36db104d0789654e600a8c464930f5cf0469772ad2d92e8be5069d526f86a430f4d61063b16263accc40e69b72a131b000e2c3097bf75965da585c1b44637b375550c9a702bba294be48fd0998581b3264ab63b0fdfc7ee60b094934ef993803748588214aadee2706677c45ae359a4ede10db2fe4ab07f70ee6c0d0fd077199572d0fb3124cb9c7b6d88c6636ddcd19468f7a25d690b5228589e452b395bc4b6aeb2051b7e34f575f9b879d67aa0a101d86cd7aca739734fc7e07adb14e87f4f4526d20cc7d24b56bbd52b312d426c93b30021616ba9df320a5a9da6ab17815fb358efae8428b71ef1653a3f4bebb07fe61f20cb43e9c3e92c8ed3f3d0b81e9449092f43e7c18199ceeef66788f6f713c1b831b62a9243b832d8b896b4cdbbd20458ec6aa5fc0430d07e3e991b4643257a25a728736cf93f9fbb85b89884f810ee31c1507a585b4f91aa53210229f2931c07e81eba00c9121373fc1e0322050036101b9f3fbdeddf2d8d5f59ad84207fcb136d1150b08560e6e04d921cb33107458619c471044ca52e307048845ffad8360fb73e8c94e62bde099b6ee6b6eaacd81d8a71fa40167b87a2c50e2303c3228492237d33341e5f8fe08668ac5f17e149e27e20b66f78becd29f874dfa0bd6ec4046834d3f023fe5cd97abb30035744150cfde56473c56656bc57b9b3b7f3c13f0d3ec895a6c416a8082f07edc8a71a217d3fb9096d8f6554b7888a854c0eba85b4a58806ff7c76964f8dd74db1c0aad457197756080681f4eff3f6d510b49c65154cf74eb5fd112e6a789086cf955d1115ea285265d127c059d2194b3add2771f2570ef1d658613686d65402a98da13adacf194f210c664cb071043541559f3f1a5a516211e711a98c6a44a35e92f63a0dfde3272ec96abcb58164973a906bc09dc6a38b3ab601be6e7c42e20c1f8ebfa00f40621b4a031f90b668ea0b58d5a6175de436d0256dfad539b46c6ae10c68b53cfbcd9f73098729c85784babc5c69d86502eaa03f9c1d00ba2b243cb7ac3e7b22ec36279cee5e4b78eb84e64f45a433e67e813af9bfa6c1a15a5f5b696c4c828108b6b64e7cdd0d2fe3c5721e79dd6aeef7b43f76622f33a0a0bdbf238b0a861996ad13c4c069cf97265ccf6c4d2af7509017984d1699e6dbb601a21ba657fd3e822dbd499bc1022bc3131350c3ff5683f5441b33bd437c23ca45d4d015ae4d43ab034fa913f9222d593039d3459638b868a0e3ab777b2380c75e6fb5371bdb9bea1c95bde17b65ed39e3b6f7ac75f61fb2b2fed36cb690b171fab70c9f8a5f9f16028a61edbd6cbfa6102c8259a7638dd0b81725a158382bb38534b79ca501a0c887d52ac172268045a5ea37e0992179c327c0b079b088f423b84131ee3997f5e2a593d63826e708d91d0648c72ad30b6f7d8e6bcbe93c1a080fa9a6f6cc7fac04f0c1fcf1594485d627dabfba732e7047157168599e28c6579781cba34f8cfbb4742734c78e1769ccfe5cb2387144140e7a0c17030305ed6debdbdd5087586381168f901f3302b65fc1515f8c3ac7f8b24958a17fd4695f8740574c8d51c0b9f6f2b064c82c24e6973ae42dc9774dace06ffca67218f47f4dd7a33cdb07a50d301246d455899b047d6bd8e9c0e55e735c3a3b2ed1eb73263d06d867c778f74a9cdb104ae4ad568b82e3b46b1eb83d5995d22a338bf9151c439e0dded676aee7165ee06261d224e62987617aaa55db217c8397549cbf46c534d9eff74656e7503a22d4b8e4cd19a3d57f36f8d6cd53f38411c69de10dbae5908f0c2ec7544dc2fb12824ef82e673c6a42a3b7b865a2ee4b78c221663dfc810a2bb103b55068e94a29256b11da65dda0c1161c11796de838f24bcbef9d24d6a772d9ddc93256072ab09b361ef5e76783ebc8017dfb6f8f0a5c14fc24709dc8fff51e3e49e4215b8210dcd4f8cd0b33096d184072bf697d5ac9075fcbab73eee4cef45d7e251af0799ab96a7975cf6ab599276cbadd640ff44bcac93e2ab94395a70c390d9bf10d00f3d7413a0061732ad307c49c219835f2161aaaa80c3c7642c4d0839649ba436b2ff97b239cf8e5abc56731302af128af7e7a9035ca2fc326780b527452bef8fae4cdf2ac14fe39a55d108a562a31ac93a4c8fd0777984a1cd967281d188a57c7abf860db8d647be665842ed226a33f49fd0ead50e1f98b06ea915a2be1a7910fa9ff5e36b371234b62ce5310cd3c463cdb4b3ccc68b432aed94906eddddb5a43673609891d9c4e3d2f2601a2458b497f5840ec44158fc7d3f47d4c204d0df8f20442800dbfdc5dc44f732b95ca07c63fd406f59f4d3cb5a56a0b3dce3ee2ef22dd27d839d250a34290d10fa151ca21809fc7c0104ba1988ffd5c2cccb33c2b6babc36fc3fdb9537e4a61a3c7922aa2b80f630e94dceb87658a11adeccf04045a1a6a360411db369bb1c340d0140be87ff1d9d476b1ecaf44976cbb3e0a8a999e7f96a1eefd4c9c39f8f9eac04a7396bde88384c4c2201ed3ab39558fd5cfc0ddb65c30167466f424010d6324278040c45ffb413d122b6d3cfcc467259c293b81af1f6b49f39dc41e1ae4976641b2cead057c76e241475ea2f772c07d396fa65a5e17300cf9523a95f4ce812d5e20245ab15bc0366e9467b6675073842c7929c9f2f37b7578b314da25c6eb058b34dcb6a17d5e118227a98d61203c1b20d1a0361e549951368b5af3ef0603b4f08e4bebfe05e15e810f6dac82c08861c39c7c8f43d8875a2c07e48b78c4b6644b575a0a92abe696d0cce843ff10c2f14d8355d57e1baf31b9ee6a0857bf55de2cdca7c3b083737caaf9de168cab79167f1d31c44f5befa09e2a2b952bfa7301f7177b1395bd596243c509890f9838b5d1702fb05fd37c63f9cff12c56e00c5dc6913cf3fdff77834b746c1087af3fe891da4fee61abd077d6ea4cae09fd672cb7d95b079890c54d295192d45df6315681ea2eca18a5cb8e455cc81fee1cc9f5a9031e194a626483d2e0d964e20729163c58d9857aeca68df926a6590b479db5157d856c369f4555fe1bcc263445297faf6068416acab9e790790bcc021671c42da0ae97b085f5a0cf41586824bfc7eb4c581e7582559e4bceea93d625af35f95f79ed82fcfeb6109316016acccaf576f983feb4ecff4cb06f288593694a97abd9695ac52054e5093265cc44fbba593ae8c81af9f18dbdb23f02f219f7a7b0abc3d2f39b9d361db98dfc96940a0f809ce41a6948d666f8cf5ec80aab4c9558dff1aef95b3ae45e9d60de8dd16626916941b0be3205a7055a92ee174c1e7e9a023bd6bcf8b99edfbfd331bd8468ff37f57e0f9630d5279d004c23065e8778bce0938f90e2106b42698b6ea8e29b78ab483cbd4f982955e91fcc8e6127ec2b8964989568266db8be688953e1fb8d084ed1a86c4f98dce765d38c3a04f1bd26f8ec767a5e279f9c80c7224ac77cda2e98bed40f2ac084d99b530630654754a4799abac875dc41900a6d6d6983d17a82f8d63b9f4ab0333c7ba83cb3f1db2eb450425e30cf1e9fea6804c06fd3031d9ce59347b48bf1ebe57afb5d2796c3a0570a92bfc00fea602ce865801aa87a29b385f388d154fd9bb56cb913d73c8124e7f4997d93a5f151a54e64dbc0e11a8d5440ae44d002fc9ac3f3f91703030537a7802b09b8979702aef273c860f183231babe71e7a1a0f77fbc52ff92bfeb3c99b4057f924086f89d38fa4ac055cdd02fbed1ca455ebb97804946a79eaaff0757028ba5a6f9d1a806721b70b72ca46bed3d420c33cb98240d3f772c1bca8707077acef9e46c9cac23293b8ccff7c6ca2d70ebedddb212660ad094230fe3deab3313ca1e308a94ce044a7a91acc0a415383c999b175c251368d77f344142de3efe2f1afb3c843b97554d4ff99e9c67699e346c21ff8fa533ce64f1418cad6c60a8467f39756db3f18a673076fe8fe45830fcc42916f1a01ce969f95e9b2a26f6a8d542dd87b34a1f3dc6cdd1a4ca72bfc1653f85e0f312788e55a83a86316f2d71aec1e13005fd7ce0c3e8510afa8c0f86a6affe75995d3a322766d0c38f78d2f55493d4372fc90c4574c3c5374c7590add3959f0d26235afb731fd0ac99389a972b18adafcbd203a6b3380dc3ab00c876bbbd5c0bb122d31c095a68be5c9b9ddf8df2cd46fd2a5888dd90e300dd7cafc809e67c36736acd29efc9701b17baca7acef4fda12158cac69fe7eb0407838b37116f016a577a291cae09d648bfa442765beeb97e0a7862ebfea415086d29c291056f4d7db325ee3c536c8d0a62bd150fafb5f2dae89e1817ffc6b776f9d16d152c369c79bf32789065d9f5fac534d5349a33566c9c2067ba0f6fe1ed447497dc5edb13f47c2aa060e0d0f14e79fc825ac090f4ecb9e5e3d9975149ea8a02c18640db11e75c62fa176ea4b5148d7ff4d79afb1b84208142b9ab91499e8dcf48b8e2b3d4d6bf8ff8dd728234c70cc8f14afd1a64b01bc56117ea124c15fc42905bec9d2d4272b7c7d74f012c93f1e0a43b7455edf041389e10f710215a979a2055f448df77ae128dcb5ffd44d3da6188df8fe4973192dcff516777e23c2d182d29f5b5ac9a1fbacf7aaf1748ccd1cb1c0c7b354c6ae55886036bcc5c846403263ac7b96552a046c428165f40495d9f3c30a8a19085547dbdc51602660be9e326df1db856a8be0c6355ffe26f832fe457872c70adeb58cb2d4dcfbf0db8aac79be8fe9d464f26cb5ac5667e8d51da4502a102c063882ac70fb0605955029902693d3ac848b059ab3f5e2fdfc4b3adce46cd25021637863a3be8b3ced932884045e429cfa5f86a3a0448623ec51b32a4d464c7c0679c8db53c41d52340d003c41927065723f51a247c4af6924e1acbeed1ebf3711d0e827ae9b85b901d5a4fe88dfe5118ec8b565605353b7f04292dd490e23fa791c404471dfbb6780f62512fd6fee3872c6a86706af8000b5e863c7a59924debb02008a677a5937c5e40ce042ede1f08e744f2f70b45444dffd9dc51dbf25a53a52b2a33cb18b7087f48a84fdeb2f7f41776907a202bc8ff39e654ac89cd996d166663199113ca380f8e0698dbd9bbd334bdd4582aa70e2f6ae8e3d609c91c3d9d7e3946e442e2094d961e210b6af17f299bc602ada6f3123135323d04029de3f16b956156b6337a91a658ee19897d3a8fe8fdc4cffdd628e16592e5711f513a36bda97b2d2feb7826cbb4db72edeea292b297ddc7a3106b49b935cd2a11609d3be1cb9baba6aec1e933b8834f6ceec53cb8f6573b86d71c65743309497f2236eef4b8fc2adb0afbe81069c2269549566f64367a801e441454c63b370703c742ec05875deaa24e15f581b9b3f058345f4254d0880c4520fce21436c4562ebc78c7da82ca70277bbd30bf2e8fadeedbb1a3369b3f9888ecb6984ca899e0d4b0609a212bcbe4823d50c9200c9ce23fdbf2edfe39ab2cf8c36c5d8686a3cdc83745713856df13e93823026320ef1d3eb6f00c1deee3327da507a3e000649d3fd35f354d80f70f3034f8e6b2d9dde05b36955cd3ad978").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let root_cert: Vec<u8> = hex::decode("03c9308203c5308202ada003020102021002ac5c266a0b409b8f0b79f2ae462577300d06092a864886f70d0101050500306c310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d312b30290603550403132244696769436572742048696768204173737572616e636520455620526f6f74204341301e170d3036313131303030303030305a170d3331313131303030303030305a306c310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d312b30290603550403132244696769436572742048696768204173737572616e636520455620526f6f7420434130820122300d06092a864886f70d01010105000382010f003082010a0282010100c6cce573e6fbd4bbe52d2d32a6dfe5813fc9cd2549b6712ac3d5943467a20a1cb05f69a640b1c4b7b28fd098a4a941593ad3dc94d63cdb7438a44acc4d2582f74aa5531238eef3496d71917e63b6aba65fc3a484f84f6251bef8c5ecdb3892e306e508910cc4284155fbcb5a89157e71e835bf4d72093dbe3a38505b77311b8db3c724459aa7ac6d00145a04b7ba13eb510a984141224e656187814150a6795c89de194a57d52ee65d1c532c7e98cd1a0616a46873d03404135ca171d35a7c55db5e64e13787305604e511b4298012f1793988a202117c2766b788b778f2ca0aa838ab0a64c2bf665d9584c1a1251e875d1a500b2012cc41bb6e0b5138b84bcb0203010001a3633061300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414b13ec36903f8bf4701d498261a0802ef63642bc3301f0603551d23041830168014b13ec36903f8bf4701d498261a0802ef63642bc3300d06092a864886f70d010105050003820101001c1a0697dcd79c9f3c886606085721db2147f82a67aabf183276401057c18af37ad911658e35fa9efc45b59ed94c314bb891e8432c8eb378cedbe3537971d6e5219401da55879a2464f68a66ccde9c37cda834b1699b23c89e78222b7043e35547316119ef58c5852f4e30f6a0311623c8e7e2651633cbbf1a1ba03df8ca5e8b318b6008892d0c065c52b7c4f90a98d1155f9f12be7c366338bd44a47fe4262b0ac497690de98ce2c01057b8c876129155f24869d8bc2a025b0f44d42031dbf4ba70265d90609ebc4b17092fb4cb1e4368c90727c1d25cf7ea21b968129c3c9cbf9efc805c9b63cdec47aa252767a037f300827d54d7a9f8e92e13a377e81f4a").unwrap();

    let cell = TokenValue::write_bytes(&root_cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14e4f6715b789895089f5c26d53b01a2991ed2772b").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp_lv_provider: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp_lv_provider, current_timestamp);

    let mut lv_provider: Vec<u8> = vec![8, 102, 97, 99, 101, 98, 111, 111, 107]; // facebook
    timestamp_lv_provider.append(&mut lv_provider);

    let cell = TokenValue::write_bytes(&timestamp_lv_provider, &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000352", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

