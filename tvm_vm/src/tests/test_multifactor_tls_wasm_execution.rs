// Copyright (C) 2019-2021 TON Labs. All Rights Reserved.
//
// Licensed under the SOFTWARE EVALUATION License (the "License"); you may not
// use this file except in compliance with the License.
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific TON DEV software governing permissions and
// limitations under the License.
use chrono::Utc;
use tvm_abi::TokenValue;
use tvm_abi::contract::ABI_VERSION_2_4;
use tvm_types::SliceData;

use crate::executor::engine::Engine;
use crate::executor::token::execute_run_wasm_concat_multiarg;
use crate::stack::Stack;
use crate::stack::StackItem;
use crate::stack::savelist::SaveList;
use crate::utils::pack_data_to_cell;
use crate::utils::unpack_data_from_cell;

static DEFAULT_CAPABILITIES: u64 = 0x572e;

fn read_boc(filename: &str) -> Vec<u8> {
    let mut bytes = Vec::new();
    let mut file = std::fs::File::open(filename).unwrap();
    std::io::Read::read_to_end(&mut file, &mut bytes).unwrap();
    bytes
}

fn load_boc(filename: &str) -> tvm_types::Cell {
    let bytes = read_boc(filename);
    tvm_types::read_single_root_boc(bytes).unwrap()
}

fn append_uint32(b: &mut Vec<u8>, v: u32) {
    b.push((v >> 24) as u8);
    b.push((v >> 16) as u8);
    b.push((v >> 8) as u8);
    b.push(v as u8);
}

#[test]
fn test_tls_wasm_from_hash_for_google() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    //"f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
    "d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8fa2d869e938a71a2cd1d1eed76c82c133408bf07d49f5e6a5768d518c8ae72c010316030100a10100009d03038f73f3532eb8b51bfb5f88dc2cf559eb728751d67e458dc067fc49e2062e52d50000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00204796db556e029e1b98b0e9be06d4c23ddde853c627f1dfc52b9e3103b5f1ca0b002d00020101002b0003020304160303005a020000560303c99f389e5ac8e8f3181e4804b70c89036be8d2cc7668e0c1649c78e66ce17fe800130100002e00330024001d00209cacd9c4e8bca9041188341a5bb347d1cc86012614432bcc192cd129d17d5c20002b000203041703030be7d99a04ada3091a4e87220816628a2f76033a4b3e5bb0d7c6515993d0dc6e49cc68bbe2724d973ab450c7e312cf513f9cd2577682873feef58531782bb90ce37aaeb62c1005568bf5d993c98510ce51099cf76cf73d9e54c33e16e747f97688d83b5b1d7274ae2b3eadff5e5d209f86c0af37b81a1ba00e3451397b8338ddba20ed634503f78ebf2dec7ef350b806d47c7e31c5748f2488322100171ca0313d0bd8c5460e896c664f3e593953e7fa6394430ba064c28d26686444ee4ea1eb67aced42070ba044bc999e9e6b56b9256407297bc79b6043cb92e4cf0bab84ec0755a0c5556d8ad7b622bccd3f3322ee0c16f7e3a7d17b5c82d80241e5045a400eaa4814835867db2858bb988797dac15f633c0aca926e5496b0c4572fb0947a85b7d4928db482a17b79052840cf080b0c25cd219da7301b2c766b88980626997448cf9ff696b90e8262852ded638b96e716b34af40d01785fe34c1de91739ab7cbfe7579fdb67bc7ffff1b187de962da204fcf0a00323ae125662f19f0e427c35383b81826e7a0bc7d89621d589e074ccc0470103d0c271394dda1f72ae52a61997754608a4ac42eeada12237a416968de797095792d7c26f1a0ae89c02ce9f88501d8474a4fb37aece4c696d504a265a3303f1af4e3641234ae8e6fab4a2f466eb43172a3d3a12ca714ebb5624bfe0433ed54b17ee90d8b5b5577e470db6bf1cda0a59f40c7f4872b766b9c8cfd27ee2d6be5d73f17aa92bc586b0da97ef2443d5d63140e45f621d4b88833fa2b9c34398ee2c4510ee3b5fa56008f2e05537486e4f0c6c3fb920b1d0724f92d1210213d5e0cf3fb4b090268243c2386a32d1d0294a52c00ba16db0418f2e4626ffd1f30d90c76aff0b1bd3250ed2fa9a437ce229bc673b506c1a017ec56b0d53e40f94020e44fa6bbd3f5b31e3aa3fbc741da5413a5c055ea2bf8a7f928054fc26a261813b5d2d247851b2a5df4aa3f577a5999342a77e9c35c811914e2a80eabe77018f7218b285b97f204849027bad55eb6d0d0746a3bc7790699dde1ff17e32fb26aa27b7f92022db3b12b65c290060de578a79d7de62fc4b16b43d8a1e1cc8f5290023a9b4021537c5fe488ce9d48aa596957c6588cb31f90653ac75d6b3c0d5beaf01064a9e6631aaa2fe0ccb2fe8296e99a5181af90e893e29ec5aeee44b568d5d78d445dab932843be6b0bae4e87e04fd0a574f7f63a3d7a9b311b99b5c824f20047453060e13d441edee8c12d0644c730e04eaa15fbb349c338861e5b67d8caa2df839a89283fade6b9ad4f3174b301e8e5a7550c720ba561cfaddf864259eac6465b955fe4c83ab9bcedd8509abc2c814be18c1045cb0c9ca08f154eac9baee5418b638ec2162da27515a85feb1c983a0c867650819f423d4fb27fd345d5ec63e463d07b484be14eca45eb9cdad05942d67a44b9e5966749b0a695c3c1cb9750ec3275b3d1193eef1eba4dcf9f2985877ab7c1c68c1a7985ec859f66ab2a7480c9fb24adba48b3b1a1e74b36b405c40cfbe0f3a2d9eb21b9c1074c42c633b90863d10d317db0ae7bee4523d1b7acc6310f1134d24f51cc4f4572bf0eaf097c470456c45c293aa3639e255853c9621d7555a759787b8819dc2e945927af9bdebd8a471116a40decad5ce0a45517954f97edbb760636958ef529f241fab7eda69c904c914090f915fc4fbdd4266a34f60642a01d3537616f7cc0739a1c07dd046048c6f55bf6a5f521cc957aa97bf9483a7512d41872b76b9573610b98b8874f77771c00ebc937d0c587989e7ea5b1c0b727b42100c26c3d808a811c2e57b3123f145eb035ba9a1bff4c555be2762cc1595e5797d081ba5897c260778932ffa694345059c35094f8e4b0235111fb916ee8527f7e38a73af562cb846ac55f1bd6e638021164a91c93acd15b2b90db95802406d8d3d6a7c8b6817dcd84eb4cdabedb162c827dfd86ea9525b4d21b8d350a8900d156fe896d76514cd75cda5080215093795bf8c15629af912aa8987a8fed60eb56ed17b0b2c14288f77db57b6f79dcf888b3407229ef2eacf950e138ac7b0a86f04dd27ed1863cfc4958d95349beb50ab4b1049413127a3071dfef124980cb738ef41435e8fa5c9b7d38cf274f48ace0bc73048e29c7fe1e22ae0b786d066eec46229779ef43fe34f4375edac2c2967ebe941c1f9c54c9456c9d2a134a7da80faf65ca3681045f81e4235cdde3a899b90d2519d49fccbaacd47380fe56ddc277b05293cb63fbe86459d9f0a887cf17e9d7b9c88c0ecb0be853ea9e7e83ebd78e10dd2396c50f76108cb6ef5cb9c6992cd20090c49b7c63ee258aa452b9fd507766c0b9ca0c512761ff2ce1acda26b07aaf35b4c1c4b695326f18205883014a3a456afbe1237b69f6a447e1b471e713da33c6ca333e2c76ba4edc521acd6aa7f9342b8c8da2e4b72c3b89497caf40a5eaf53398aada0630fb715fa328f261c9542d0d2a67f7548ecd76a6c3b46c965ffdfd926129b5a0e64048a3df4bac29440e2cf8c0a0d4dca25ff1df5bc0a683b32ed3e01f12710ad2875d644b47bc51d9de32d9754207aca629ab9bef6086a59d2cf789e04a38a854f586413ed0f2c634a88dab6d6dfd76e7cd02c314a765b727b049f3926cc53e6453c4d4bef9c7fa04f4abedd0b553752713453307a6b094b4249efab7d68590ce3c64ef3d7373c90951d611eed2c68d8734243e0f1464becf04fa6a4cd2a72ffd1a1069ecfeb1837732acd723dc3ee291c380818ff2c4ceb7ab375dd6aa18596f55269889af34d395dbb2bddf4491b5a7c41aefe65b1be73a501d1c03f1711af1c4535df54446d774ca01f213ff01910a05e3542682768f258e1625e0a197f7f509c3cdd61524652759edd5206eb1339c858ab78a34e32dc3cb330cd619ec8478aa8a6e3c46181c6bfd396d63d7505fcaf9189719fbc8715fce2066e644952fcf146ae66fab35445d299e4d44060f4dc5c76993bf9388b22a0d43ae9b723bc265b2d258387928fce27696746ed5f25f65011089be5d8040c0bff0ffaf2e649f22853b38ec6b70c62e4a90e45afa0bc357ae7ad90c0cd0f9a1224a6d05c892a47e860e249e2af53c6b6016a9212ed7d2a897421971fc775e27804d4e4dd5116e180206a1a4e32f7283020baf73441a7a575110202222b2ee5a2011f18571439ffaf334445424f5b4d8487b1faeece0524f6208765fc840d3d11c864f219fc323da4ce07c30dd2800d3da350173b3fe49b2635a687fa09e177004f1b3f1d83d26905d380bfc8b266f87bcdb2adec175a8aa26dd386362992e92678061a312fc5444a2d3c2b73c0c3159280bb59303ed0f8fd91cc3d36f9ad687fc96b1984e9f607446c0ed6d5b5c4d6ac9728041c013ae25dcf77893157fd245ba2aa60823ac3c9e1930bddf05f6d7de37a6fd05529e67bf836e133c98e5cc0ac8c29bf9af8c8a9b4ed82ab4e2be8e02a2a2928def2640ced0d76c7162e5ab17642257435bcb24b27da2d15e39cf5dd78506f66cee3f4ca01581e38d36312ec21d1272d97a40d9041790e0372b6007dd09e7d6aca768e1419b669e17c7ecf0e5e65be20a29cc77481451947d8dfed6559ca75f8e9fad957f53a1956e85f87740ae154aa9ab30cd5b2ae26a9a0d1b2901982403080889e28721cdac49228a306f19bcaefbf493c2e3199e51a409282725ebb2ccfb7e99d9ff92090433b2b7ad1d2f04fd5fcbc8abf4438a73eb4e42e9414b032b234dc4ca70ea74f11545a5ccaa5c6e7fe506f8ece85fa8858573eb31239bca2b795baf7a27f301621d906c5e1dc3b52c2a926eb22cb17d609f328e6042655a86d9194c331195517f72923aebcc3cdf3f174bd0e764e32a9af6b5e4dd518836b458261c7b6161410498bdb43e819b35800444788e67b0c651a63ec4eb0f77c9bf0ef68afc6e62128bceacfba13a47e023c6faaee3c619e471c173a51c2cd4411a9f34e0f4b5fbe84345c60e74f84e5bb75eb04ace1b10405ef5ae608e214a1e39838b9bd4bc76ae5e444f6f7b48c1c54a29bf84d5f911f2ade92193d7dc02fda263f72b2b3b6baa5a4fe5f3b8c2226106673c8e8bc626597e81d56cbb54bf8b3d68342d8ca72b505f3ea6c3e95c0fe66a542daee5e5487a15ac96fb4099cb0d6112c5b897a534019e4c3ae54f82a910f10d757144e6e0242b3f64bc32f3f1fc7d2dc5ac779c60b63b9e7138f0126748da64905c0868c36b5c7bbdad35c078e7b2dabe66dbf2412473d38571a97ff497e715d16c184e0c310a44b2b2584c4becb2b059716170303005f4eafe9ed8c935f7725035adc100422c722633aec99bb085ea3d32b87206b330e3f31f51e7db76dc4e2a0f562c5634cbfa72da16db78606f1fc383531ce789e78c19d50a01db91d2d19e54359e83eb1bf78b445af18e5e68afd985a5c92186917030302172c4cc8ffe4658b5ab9f57383ec481daef6edeb8b2ef176a23e0305d37f1c8af52536b5bbe8e339b079881ffaca7ebd9ef3deb4c2c5b5c9b8847a8d9c2ab436bbcaddae027d0396821bc40314f51b00f904228a338a02607af2bc0eb3ae764fcee80cbe155941c1ad7e0d2b20efcec20b49abb30fd9a20f65a11d6e27729bbdd206ec082f953765a763a31968cb4c34355d071d677a409c31b35c2d101294c33664cd1c39292757e19d05fa6b5fb0c0c2c1e4ccc62c8315e61dd91a9c200c459e37612efe313334bb292a56d0665a2ffcc9fe3ade7943d8e6bede14fd6876327891493eae251ec57be177b893eb2ec8644435a106ba4202318448fc07fe821b622dce71405720e8ec1789f4a9ccf63f399d201831674201513b09ff27c3a2b89d13415f5343ab5c82495d692be6326e08faa4b90bf1bf09e5317ade350b2250b92e3750b87ef140fb3c6dbd72ec72ff91263c0221dda6c8327cccc5b903c554c7e431e87cd01c2c64f9c291b8687102305ff2c2ca1105ab00dc4c54cc035183da20294fc6a8712d0736de196a97bb38acdaf356ae1be2e686aac5eb04594c814f8bb93b83b28e59b8d51ec414d05b572c6c28e0aa6b8a8c0474c928b983f1a3a83e6ad9446f61cc1ced7b54e46d0db2133d6deb01eedfc6aca335d7d64519b601f7784ce9ba8f99387cf65a0f40dac80198795e178e5464a32bcc0c57a9e5a408adfea63680c7b9ccdb1c863d1df16a14f13afb5cafd14617030305536e49d346e03977f3e0053e968ba2d88969e3ad81a462d887e67a2a93dddfe2d7436e22781ceaf7e52c2eaf190c37c25e4bd16ed79a256b057086a49a8507841741f490f372b7fe5b75d97c1190c87da8be4e8785acb1572eba94f97abfc545d8850d709b4cc94b12b36bb9da53706fc1e7b6f3c5a0eb16af2693799659bbda0fd0ee8106d980d016eea154be5ec706749f58bafe3812ab8936b3ca2a35020935ee72f4f93a09b21aec5fb91d3f5b39331d51df4e7aa7b4230ff2de7cd567c53834d2b927ba2d54612422a127ae6ca89c9891968268983ccced3f92018371698d8cd681ce7a00c9c33fc0935aef41b7a57ffb7d89e7a3ebf24d23564a97643fd6d2ce9f5106cafb10edee21772a9456ea8b666f6c8cba750a518cbde33145df9b409cf74054595f47e4fd62521d49fd8b7a48c18693f4560d5997fc442cf1cb70983a4a3f506198da10cca030af9bf5ab3f9d4f0f39dd92cea13bee52d27f19cb03927042607b9be06bf2e53e5c4cc16eee7ed17b7700bcca4972e3f682f24a40cd3b19a514b2fc8d09551a29e6864b8cd852c245f9267422388176e0c4c83fe483d2b2f7398527022076ff9071d3fc206a4b22c0868523afc1390ee0094df37bebb8096baf93d95986b72065bbedbb38f32dcf32a62d2a717c959a59f990fc2de93a70dcc0f7593d52072c2b5f0e49996aae8239217ee732d341fdcd2d810be6ddddd22276c09a46ea1262b33dc342c9762f000eaaa4e8bf545e54bb2b998b5c76f9ac5a81298fc57f9f5e4ee7b925f8b134dfdfa08de3067584af0e86e8b9745955b4e0e209fc453c4a87ae62a482172636ed627982af9d80cf26749c9ec9d920054fb5042a7c0d46a0e6c010de55bdd699e8bfa62a690302ce956b9ad6ff9ff4653918be4eda472d4b61321eaa3ffefb43f0b430c65b8b9156ba2730bffa6899f5f03d3c3e76ced6d1cf7dff663b7555aa5a8fb589d7e61b4c1ee8c84deda3b80410f3045d5cd8c76180bdfcc159647d5594c7d921312568786b34d42896f18116fd86f3aa49c421188a09f77a7ade07ef0ef55cf85a1416f8aed111a179cce8c0068f26e101720793240eb1f4988108fc39b26e8ca5c87430c5e2faf77104fd2233e178359618190a280dda9d3f06e414d9098b97d093b573ae8b34b1fb38018294019415e5ca04a71269d28ccc29bdcbb2a41def67a512773b87f00e30f315897f20332ec9a02081472fb8a7a9dd0f9fbee92e7da301bd39c6ba7405994a551ea054a78fbe8183ba82fd93c300ea88e3c587740238cc7e9b6c03c4e66ce37a4b9fac14c2b49520c4c4ae90a8defce4f5050d5218dab0c7052ec7f191e438b290aa3884e39b9162731064e2129a8a4b92c710f3ada848854debbd30990fb5d10f494138f09ebc2918384348e7fc6eb04dde09fc90a1595199e90ebffaf0de390d8abf93ac0894f8f14a61c3915276df375a73d975937d82c60e719b90c139793bd416237ea5bb023f2917ef4c984fe8f62e5d2c2b2f354c8d12422901ec7727a150687e2fb56f4ccfa9c3d8d5c189c53f0a5a504a2bb54f2cf82980f832dde951025e731b2bda8caac33b773d1bbe77226b6bf643288f303d060834566b1abeff996789d27c8602a388b1564a0deee991e672b36232d08c09fb812604c32be9ea5e618ca3e03c174bbcb75ad210217c3241fa1b73edcc902bbddb9a0b57f64060b0156c4ca3ffd0f6c0a27b220c183cc2e4a6d70ed71930f0c3fe98ab82140df5ff0ac7ef3820edec0f8fde890a15045c1848b80f4bb0ac7e5bd03d8ab03b97c20dd404e485fae2e51827c8105c536948e309f0998dee252dce110c6c3ad93f0afd05467df874b0c7df80e19aaaefe02285a3e0eef41421ad6dd9a2450967f4b11d06df1a9e351490119bc099fff2592d1917030300e47867a00b245092c645c3d564267c357379cfb308045e64a1da1bb749dc0cf016baa8c725b2a87b569aa0c551fb3bb03eaffcece061248749c3be0ec8a01ce0cd7e0b03c97b2f5a836645e924cd91aacd7ae2685e2eaa1cab1bd4822236c9c8c86fa27e38bf73f64e0ba8e27998055aba324630dff541cbffbb71cd2e0b0ea788976535e4c5782e9b50fc61f549b2577ff31bfd7da9201da840a2da5aa93e8eb4191a665eb423f87ecbb3f731b8d43ce84c01ac68b8696babe333dd76fc5fbd9e51fe1c4da9e9d22a1217d6f262ed5767460c6bf6a65bafb7e85fcde2d1d3fd6a10f0cb9c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("010000000068d1dd34959c3cb911566de12044befd39445660adad6fe7d9d2ab142ff079db21306667b11f1c10b45c7972d2dbb2d6f2de8394baa546f5ebda274c8b6cac3b6d9c5875d9f918265db25d1bde74fb9af72f08ea5313d16a94c843e33ec48bad0bba82f67bb02d7ac1e2b58bc0545b8f2b2777f7ba4b33f726a56865e48ff4980957a9515126b7f113241c9d13b78134b428e451252e3ac15776a93ae19339e6329b821032dee28e913c5cba7542ca3c196aa1490baa65fce33719a26e720294a5c0d11499e265ff70db69dce3364178342e65718ad47165756cc7ee4735df823730fdb78d5dc45d98be1015d8a4eebc05b6318779a56429ccd1f3bc024ee4746158e6b5", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_kakao() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("5d0b5a81946454c16da71fcc94c208c7e4e117989e15d8bc1c309cc0c13f00e50103160301009e0100009a030361667ea28c6a2a299513054d972c2e2e557fea51ace237b46cd75680a293120e00000213010100006f00000014001200000f6b617574682e6b616b616f2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d0020c324068e3adc34afdb5bb47142885e644b36a2f249be1dd9dfda069fe3878a6e002d00020101002b0003020304160303005a0200005603030f209ea3e2e918b70d988e400afc01f4e4c7b8928c2eff5b7057600ed4457c1800130100002e002b0002030400330024001d002029761c520bfa089778bc30217475ad5d25c8e07fa8bd2f9e48566a74ca1bb02e1703030fdf0b5cedfd744e12f818ab38cb7a168891064b7653585d50007bedc81d8f5312dd8724382af7a3055c6ab778e035aa2e2b7ef8c82835fda52fed1ab5d2a1ef51e38c52b83ccab769c153c62bb529529fd814d0d636c939d47b5a27139b00927ccc0e91ae423cbde04a5970dd474035947b1db801aed01451cea7a9984b96b730372c33b4540b5c99f24a0433b2176c4d971977d6fd4b5ae3b6337ab70570675ab2ecea576106d79524a59ee8e5ef422cee95314687c08c317c32bca75dc75c85da1b3f9533f2ac441643d81c36520a5aa617d85a49be3d3138d725cb939f0570652dbd591aee2d01b558b26ba970a2952c7fdadb0af5e460735a4c3bbb79d74e219cf6023096c68f8882c2c12712a77b6b99c6ca0eba773c5b8cc688d4f68ca310e5a582382441403a33c1898d0e58e7b706d14370b7e9074c0090569368ce31dad3f85c48a0520eed48ed486b97a6828285016fcdb03052c7d4f68a889815fdcfd243d5b6bd2e342e43a86ca8daf07ecdc9bfeb609379cd5393754b36a924a4bd6f5589d4bdb228e8ae089c1ecfc1dd4fbfa465499135af6b67edc91dd78c8348e5d1781bdf138e0e1e8e03b22f966cbcfada092ab9e049c7db63e8798d4b8c52e59ead08dd9359be4a660ae772cd0926a42443cacfc718bd2f4c78e9302ab8c31fa8cc119082a34964a696dd1936e5a662cdec455ae191e9ccfe2f02b13a01d05a656f63d089f95a4676ef018bd1590a4b13058564e54d8f17f50fa189fac3339f4e6cc22ffa6cb8f1253a7308e6594590863fbbe8a80d458fbb416065da7c7c50fb9ecdda51aaecf0a0e35a2ebed9b8e746ec9afe5846efba2ed1d515f6b3be0b6e346e890bef9f1c24bdd799358f0f03e6dc410fb9124f1b46bf0e936e23bb7b43aba5e60504c63ce29250c705e50e69c389df596dd7750a1ba8dcbf2da0d89791a11cd781896e5b4e9683f10e1df0f240a0952a4b37fa24afcf92f79e561ff49f7c52f6b9e48602f28f589a73483cf896265d609fdde8000159791eea930ac7b56b9eeac205462d830f68dd5a19712eb0cf436f557c781d69ab62f44f1fe029ecae1e0fada12c724abd98b6c1254b4424c6e48db9f0aeb2eb6e7f75171508e0618ea7449bc42c0dfca5ac7d3564f9e8c07a98657051df880bb09f8dfe6e95cf14c186d01cdd21656897459fdf499c8e3d63f8c5466a5663ffba9fd57b8bca78e86605813012775c59c22372d737be5f757af2f818e4cd5d736bc0ff2b416752606fd3eb21c523547536ce43ae7e65f7a40b19b7ca7f99483dbfbe6dfcad846c1f110362b980bab778a99543050c42fde77b47fedc2e31ee73a5b6df129d42aa4d6ac75610226a590e0a59ab53b093073c4ace22d0c57eae1ebd1781114fc3407755c7330f16321e672d8811bf8ef583493e8a3bf823c036ebe4f1450b5f554a78a5259321f739351182fbcd8c57f40e74167b4b5b4b7f1333a12373cbafbbd336098dfd2fc8ecc4b90a2d850c9d2f176e39fe494c570b7f758e8ce91005a5a43fba32635633dfea00e98912084998a23996df3a2c68663e257869fdc1757a7eb34d2cde2751430201f1364c636367604dd80a877133d963841132a6736a2f8f6df49d6e65f7c51ac267bd70030e78c0c7a0af4387bf09e0e8a3f3ebc1d741962988a315af96c6187be162e7bbb04e8d3b75fa055f0ec12c97a8359df0beb7d00e27385700754c226b6200192dca2ff774cb0d696da7adde5f8e94d0a233c62faaa8ce26421b77f07bb73265ea10d84c8695c6d1903d21d92e17c631f2604d13b71eed79a8c9e920eb1bcffff4ee1bd68f240d87c714af75ae0c081c6e35b821e23540d8fd8b5956ae2fd603dec8ee59bfd533d377889fa8d02f54c965565c24943ef13a437416f2875d30db27715c4edae82f803b1d6b83d303d9b5cd062d891d54097c0609aa87975a28bb238e7a30c37a81803b8384bd926395f4641930189631b58468ba34b608a4481af25177836a84b54b2718af841b64248ead2014b7824f804bba8270f4a0cdfd5d9b29fbc20b3fbc17cc6e345d6693db234e0acc0a67c781b96ac219831442c85a505aa84d92d8c0d8368d64c3b92719d89bb3f84ca2a412d578f54b754a2e78bf1b29ac32561d19df446004a648731bc3676a065fbdc486ae558f8eb48ddeafad4afcead034b5b088635dbb4d176a3f6f80c3236b00527ca5153dd47407e75cf5307629a5e8a063ed025838ff231593638b0aa3c6026812ed96259a5b315aa60fc0648ca2125748cc7e3470e343461f69399b44b0bba66e837ccfb8bfa09d3cd9bb5f7f7e4875d64c07eea135c2e6e131fd7d571f1798452a1b92de573310c99308a0738dc81412cb736b22c041216f5ed3dea0aa8be0010e5777df9e0bbcc2905a24ba5fccea8d068ab9c977e8f071d2fe66d5c77172bc15a9e45ec4d2053d2af9c6da2fe825bdeaf0baa50bfcdb4fc8f17547a6ce2a7bfed5a61f8568611c1bbd7cb17cee6fa5fd5e918b997a3508a99f1e0447c130e202af6acce7d9a82b0ed142edd80b1027942b88798da3bbbb93f107ccf9c0235c357cae5db3ccb0e4ca6d0abe8dff77a1cd87425d01826c8a998dd5c87ae26f89376185a0d8d18ee0f3d76f9b039b89bd0a96113e385e4a85bedb958706514b6681a2e5a9cea2429f9481db32285e659bbbfa9e7fced184320bab10282c0b9657057f1556e0600ab5a9a4a67a95722258e31e149f29e31b4340deec2d40b833adc50206032a1a513f50b469af3bc794162d0477ef924ae45823e5f6064469cf3e61f497ec489527738904a969fcd7cccc9a043432537f6dfd91de80116d54801352f21c768b0ee34ccc437e4ac4b48110b26e56c66fdfea977725835e17a7163ffc5dd2e5a5a12413cf03feb2a4d2368d7f216c174cfc4932fd38c07054a29db7057d40fb57212705b523d6b647bcd1a3ed7777f6d8974cbf9abdff251128adc27b30708b798449cb2220d45aa9d29b88e66bdf4380a2d751602a47d0e65025242ba4e35c41318602f0676fc3e67afba8eefe467c9059d1c98a0cc3e495f7c802dfb7da7f1050fec08a5562d87cd6b10c33a760d98f8716b8759e38ada6a2fd3e306c13084d631421f77529e62b87b5b7ded1dd95038ad26f391a07e91f66007149a84c1b2c80ea50a932368aedf1200607c365a2d4e901fa65658bd2bcb1c88472d630a490301948ac53e1c0c7a31743068b7830035a0d681472c1bddb5f3e7bfacb7a93b126ebf6e2160f090b4a16de29a385aaf0a1fc562eba0791be281092b11303927a201618aa2c2830eb25679b98ee16bf852f68667807473c1a94972745ff89ed8850f1477a249e6d9fa3f7fab6a58d78d92abef89ff240e4b1ff732d34a4df95c61ea5797d00812b64468f6464f2fa54487bc1ef06d98e9c4c7df8d8e6a74c1bc5b59986830ebada09ac49d6aca0b3991691f0dd4ff7c4f4c9d785daa3e62d049e1b14f93fcdb73f34cdd3fc038bdbf8e531495488f810373698f5912ce08d82ff9a4ddf55f27715c2ce9a550ae17b023baa4e776ca93ae633179ab69d516b7cf4de2ace966b644f2336cca4e8e6a7989f205ba87b713edea06b40e3cdfed2b5f9264986369df9945f502588eca94cac43cfa50c3630d1365af79302724848493d6eeda9f93a12c36f2769870a9050c6a463ccc6e7543fc112607a5245941eb948843e9a872a75328dc66f5f3c952353e6e1c7cc6afa2b7c8d74fe923b8a93b30365ea1808af199e5fa1b7e7b5d65006822cecb8769731faefc7fed74b60dae74e2173423e7479234d1c17150cf17d75da44aac6aa47b7b7d32c54fe38c7493e66517efae4660a97815d29e82d796795bc74f805b50e5cc57f41c83405baae365b0b1375df5a7a485238c97a619c902e557aa343172bc35ce95515dece2046b90b16bf1a7fe2df8e3a785604a85d26ddf5c2b22ec54c0570771da356dbd11287cec5c913e297463f853386f223249d56143f73eca87c8be6eeedba2da26dcd4b3f984d2d950d8766592c8c5e4797d5c5801ffecf9642016e592e3d645c421e7f6c034ae16d5fa14125f7ef757fca736a56d3d7afda9e2b591e2e6be170d0504f6a976783b336cf4ca0255107c5cefc447f1feeed729a2585257ca0bfba64a6b828febfbf000592935978b670b1d1bd3914c5b5f95b38e646dff3afaebe14903af3335c507aad4fdaccb12c95525d93d9014e4f4068ad864c3ccb88c8187799739750cbdb2d43c0b884a2a6c80ab4f7bd5a3ef784c77090291de122ff42d5ead7b4cf8963b57476d729d1a1ebc3c7cef77a9bfa92198be6abfb6dac6ed8104a7f8460f745c600c89770235cfd7f4c6405c777eb7ff5798a2485e6a6b38b0b3b2a9eb17ded5a412a65bfaddb6dc350c917280fe27f905df52c04d8920571173d7fd73d869025607d45195694c1b3a673011849cdb23637b9972efef2bc38448a1fe4a0a1107cd4ad6ca570e17b1c47382b76f4f5dc0f18ecc01b403d8a76f421c69a15022e44b390341a6f25b3bb48dcb5f594f87a09dde221712bfb4e043a8d069476b48afd60c156b0d6a70eb203b1c45861dc21b1bdcfa03f50cf28f9d148b886c37023db87ca02ce21801f133b35bc48d0d8f64d3c3cc21e364a59ebc5e17b36f1947dd4f0bd407e3e63dd267885c640d01b782fc05cf9d49f6089552168674c1578f039a502b828f3932afea8f8a5460625a0b70a6b1111fa74d569439ce9c5d47ef564470308d681f327f231ba3f0df6c61230f457ae57b4e96be5bd4d1191c20a64372cf0aaee2d92f34add10c9ffeb5e6854c715f9a1665f5c6a54d514f07f34f656d871461cc59c886cd102a23fd4147d912d435ae25695512f0a2a6e2b865de5343a408df483c7d88c68713dc740da7d62607542f3dadaf7cbb40056d262f6ed727f53127575847bca4059b1bad05526d26f8213ff567c5c787f084c5ab51bfe031b336df71b6e6de34a0505134a03822e77c2c680dbce86819d61af3d998ed4e38049ab17b7c4da052962be860f1f5e78e6f6e1f37631cbec5befd25585444a86dca9cc7073f2825e26046bcbb25358dcfdf67ed2bbe3ca1db2c0c83a10fd964904a949c067bf562e1e1a57f7cc8c1c9df594da47773d2916407fcc5e3fae4839a4919e4f0a6906b44c86a976061f634bc786a3a2e34d5b6b8bf2184bada065f3e35b158633063a4d44dd620e96f874f6798a93f681a380d1078546cf999dca3af7572bc8cbb85043c132dc476bd0e7935314790c9a6b4bf95d9451fc6d64ea7ae335ecfe846108f476cd472ed435d86ea1c04f3274bd7d89b2ddf58e50bb00a0aee034c417e4a3fc16466899926a758f9f8e20163617ed5dc5a44e5fdf90eae429478a9b699d6c79e173fb75510bb7ffbfedb910facd16797672c28f7ada1b82dcb1c8320f523e458147b8ca83bc6915c36c7ff4b97b7ec7694bd9e050f7da85f32000b600b6a31a754799e3a63985626e2abe76b30e6e1c3aa85d0784e59d330e2f776da4a80029207b2e75be8b737fa376ab7387e792eb0867fe81d6ba17f37c77a432e75ffb74459b27d44aac36c3e1affb8cb80861c5955ada94abefd1fa32a64cd8900cec81a8f4bc43423731ef1a79288f9c6151da7e3bd538fd7957874fbd87c30eec674f2a3763e683e3b92ecbd1b6c71856a6ae1240a8173ddc1ece79996c11f8183d18263d1663d43d618de56d1703030062585a7517a2af3ef1b129a4fe6c179f1fbcac6a598d512765ecfa2064676808c7a370c836212ffd2dce226ead615da2f5e9ac58593bbea41f5a55b8efcb630ad29556e9f5b3e28cf8aefc9e09f1f0e5e0b30d086d5b1ccaddef7e9ed8ce18539c018a170303010a652223cb90cf8cf24c175fb4ddcb9594735cbe0bbf5f7fdda97d3dc6fc207f5ce2f67e8cb54421ecb460a27827bca1f9fe4a619dc31d9c1c39ecca012c26f20c27c5c08d0171e182f0261b049f047b73798d579d909059b7746bb8423eafa86a9b7109649aa960e1b03f83e184577249bbec2a80d943175724d89193746abd609ffc73d7a565e9c8ad4be9cc5db54549c2818f3041d19e0bc26bab090eaeb91cdbb93910e9af1e1c2c94659f933bb278014d719d2030a4ce268bbadba795afb72f9f8d5babdf8bf713d41ca1b454e569d3890cc30598797dcf6343564e7af93119f64a4468c5c7e5084612df6e1ef8441c4daad7b69146c629323dec3b6b5e9f06ad1642d26a928c65d6170303010a6dafb96474a0739ba983dfa08457fb535dda0496ba9a12bb071aa0434896a694ec622464d7575f89cd9b46a779730d9510efa0e06165699110801324a4267bd181ebd7d38d614fc64be74a371f2e8c496d1a1c3db0df332fd1aad00de3aa886d38862518b3cd62224ef3e528b05311f7f16bf4cb5bd73037040c4eb2863d3f1e0c36fe338f75e585faefa615b38ba6d1f607250d94b949f5057c3016048c2644138c5eba9a02fe298059246e45f0ac9b610b974a73bb894545d16afb977f7c005d7261979c38f14d3979babc7ca71e9aa28b61e1b8d6b5360c87541c8f1d462a9bb42d463d14da20e5382b8b7e2274af557af0e14b86d3347d0c202396ab147c8bcfd59c90569b491fff17030304e8d37aa2ab7e63287f97a6376cc03812e5d6a157ba33b90d79b9451e13b4dc0de602c16e6fe1d19686015e5d150a57db5758d20bd8049b0488e74294b3d5e489aea4694e7efeae276603308b0a177dd28ee0d00db7c5ac9b786076b4544230bfba504e94debb7d125a6f572fe8d990401c9ba58a512617f7607de1f13d7c034c7636e99f854dea09ba93673e0ffe53d67169b88c1830b8089785793fbd3e5460b4bbd0c629a5d71b58b9400869162a1254bfc2c9f2ebacab2c90b8c71914db957408a6def4470b8dd53358a5b995e99e8633864808462f7664ff3c5e759e3ea6d4afa81a5049cd2e3a9ced376c50f97d82a45f7a84a5a89db0b1446f66aff3b6dda175dd3231a6027d864506283ebd597d47b69ca7acb62bb4aea867abee4118be7636d3e7c47ca336789751fed9a4622ff6650179084429445cac0f311dc0e6d527cad7f9c6874674bc926f84d7bcc74f54b59e70ad596e02a304f88442fb719e7a03ce9a512f47f5598b5a2426ab5471351721691a2d4b594d6573d1c1b72e4244e42b77c2cca4e616722a1a8b7420e2bb6339a1c1dd584b5e523b3dc30d6e9874d5a3bd35e48f800e717b28d02753bda1e68e96bbc6bc0b26f680e7616aca935f133d8005c7ec8b20fb434e469385ed0fcc8d5d995bc58a94bd7ab83e99b5475a607f18a884956840ff172b6f34f0c91a857238131b3d13313f2a465428c1a8da21954962bf7b15a8e057cbf4ccee0331a2e0c73932c92404b026351901c012bcd40fe14ec411a46552ba765845268aed7de57494e4bbf7ee9ba1d8440453bde2fa70a258eca91057b2bee4610a801fd76926aa90fd0f1addfa9fb2b6c4c79e35ef71d124ab9b55f99ed0ac2c547acb378b55f29599662fd76f2fe98a0090f0a0cf3274a9f734ad851d77d87939b68d30cc2248374f180bbf35a5dbec8d247f5e611faa72f39b662acf6cd6cd0d7599534aa66c8e76e4b58d27af6ce1543748271780e7fe3caf2459cdec1bd03a3b8cf5ba1fde7fadb5309f0e207d3ba34a5a20c80c8b1a6f530fd977fbd8ebf12bed254c62e15fe617116e6e9c616aa0bfd3b6aa8f22d681740e846dd6d3b685d8fe6bc355294b155568fdf497c94f52d9c2c0ba8fb50a41ba4b47e69857030e779814ea412c002dc876f01e48495017cd2e328928ce63ba7c2197e8965ea9da1afbe673e1514104d9e70c6d53c18ab35424f2d58fffe57315072b93aa2bb508711cb218ac66ac467afb08dec98168091c6432af464602b0e7b7f499af496084162fcb43d4e8f83065182fa3a7eec834704b157f4a837555b0aceaf7782bb8789cadd3a0ae19a6b649ca962ee469b73b7f24c9f3446b1edb8a63491eb3c3d9045aade521ebb9f2f8d450946c7bae7909c6391bb24a1d28f05152bb36bc57365833e03d5af85d5b3fe12c962a82a17644e55a5140b138c029f11ad8e89b01681e330905627758c712c97ed537861dc8d061e50a5c07a60a31d4dee6a12f5018312a783d7728c91e833e5fb44eaf43dd00ccddeb32a3ba19d79b1074d83447134047f6d93ce7c14df6a8a5f64526d209fe66651110ef434608dc9c7a2605aabdb29548e58b1bb6f5251df5e8e24bf4ba60a58a5a56662f0c2baa7644d2eb5b54be813e74def99c64e8ddc744f8dc9cb30dc684f360f163a6b0af01131daa4783dc8c8d426261f15f389ff2034ec34c62e64162169a77e06fe2c67b4c3d0b253be90350e3fa70ee432275365ef2bacf795e8af8d7459f6024976590").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let cert: Vec<u8> = hex::decode("03923082038e30820276a0030201020210033af1e6a711a9a0bb2864b11d09fae5300d06092a864886f70d01010b05003061310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d3120301e06035504031317446967694365727420476c6f62616c20526f6f74204732301e170d3133303830313132303030305a170d3338303131353132303030305a3061310b300906035504061302555331153013060355040a130c446967694365727420496e6331193017060355040b13107777772e64696769636572742e636f6d3120301e06035504031317446967694365727420476c6f62616c20526f6f7420473230820122300d06092a864886f70d01010105000382010f003082010a0282010100bb37cd34dc7b6bc9b26890ad4a75ff46ba210a088df51954c9fb88dbf3aef23a89913c7ae6ab061a6bcfac2de85e092444ba629a7ed6a3a87ee054752005ac50b79c631a6c30dcda1f19b1d71edefdd7e0cb948337aeec1f434edd7b2cd2bd2ea52fe4a9b8ad3ad499a4b625e99b6b00609260ff4f214918f76790ab61069c8ff2bae9b4e992326bb5f357e85d1bcd8c1dab95049549f3352d96e3496ddd77e3fb494bb4ac5507a98f95b3b423bb4c6d45f0f6a9b29530b4fd4c558c274a57147c829dcd7392d3164a060c8c50d18f1e09be17a1e621cafd83e510bc83a50ac46728f67314143d4676c387148921344daf0f450ca649a1babb9cc5b1338329850203010001a3423040300f0603551d130101ff040530030101ff300e0603551d0f0101ff040403020186301d0603551d0e041604144e2254201895e6e36ee60ffafab912ed06178f39300d06092a864886f70d01010b05000382010100606728946f0e4863eb31ddea6718d5897d3cc58b4a7fe9bedb2b17dfb05f73772a3213398167428423f2456735ec88bff88fb0610c34a4ae204c84c6dbf835e176d9dfa642bbc74408867f3674245ada6c0d145935bdf249ddb61fc9b30d472a3d992fbb5cbbb5d420e1995f534615db689bf0f330d53e31e28d849ee38adada963e3513a55ff0f970507047411157194ec08fae06c49513172f1b259f75f2b18e99a16f13b14171fe882ac84f102055d7f31445e5e044f4ea879532930efe5346fa2c9dff8b22b94bd90945a4dea4b89a58dd1b7d529f8e59438881a49e26d56faddd0dc6377ded03921be5775f76ee3c8dc45d565ba2d9666eb33537e532b6").unwrap();

    let cell = TokenValue::write_bytes(&cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("0f3f96980381e451efad0d2ddd30e3d3").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);
    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d1d3e9abccd9d1bfcc35a2dde8dcbcc1de1c8c5a268a52df14865c9a1352735b6dc7fa10749259b790831c1f165b03c60540d4c98f0099f8254bd635a80d3f7f1c6cf9951676de398d26d4c6084a358804c12bad7cce6c44e877b2b9b94e22d6e187cebcacad196d6bf5340474b7bdf28ae4f3eacd4583f26d123748aa2aa5c8b59b540e72f520e3111846f6d921692edb80cd3127a17b2b4a533e8d8b890a3959337c6375d6b523d48ae5451f8b340f55f596267a8cb0cb7934ebaac3e536991e8af96cce60233b7507816652e1484e95ca190652e479ff0a4f0181cf242d618053c4f398eccb7913a8b2a284d1e649e0448b3089936f65d2119b8dd701722f456d27",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_facebook() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("5a3bd4eecb03a905f3c90c2d02e473868d3979009e141c1e434053c6b75ad04b0107160301009f0100009b0303db04674730d5eed082dda523ca3d602356324be33b5cb809ef242bb9fdd41c4d0000021301010000700000001500130000107777772e66616365626f6f6b2e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d002055a9933ec2aef72c7f76be32057416cf4226c5d7a43ce0af93788ad7d65ffd03002d00020101002b0003020304160303005a020000560303a4d4052ed4237d9bbc57ee85025f8a03fa22943cbb7f77652b63919699e7151c00130100002e002b0002030400330024001d0020a7058e91bbac3c178a04bdf0f02fe3ddc294c5cf1a7877e1054d6ed9dc286f051703030c1dfe8b6cdd1f16e7fcfc03f7f7adbed35fde4ba21b2a5434f7949ca4046a9a3894fe474838634bd2cbb063cc4708d8b32914c9bae1cab0274d280d865038e19be98d5485d32ef058ba92d06f5006ff49348e26feb62e0438fa40f0bc9b0736402de84219ddb9c15c72ec5f9404dc9d1940cb944bc1f55e664886b50a7f2bf00531624b49c84d834e43731648ae556eed0f78c4629ac5e58b5ae8fbda4a7ca83922e3cd848e9ed0c4619ca1181b0a7b0b52410a311db1af2c3ef6e167584b3ae0f7bf80ac060eb30a5fe327be614395f2b75f4f7dc4678bfab88fad55bffa9b66e51e2ced43234691d3de15b0ebf3138bf390f000204ef152e3c56ade0433fecbe64d7bdba5199606316799bb5cbb03057f3f5b2159fdb4c54d01f0477392145cd54665e7257af901dd0f3c1558c3e0103b9382cf3331964134e20b2754935d04cb0bde488a7fa914ee54d8ad3f0070896da071489826d39245b1145a3247cf363c71c1550e93bb639fc2b706461f20c1dcb2ba08068de360c8cb36b279a72e0a87c4e5e3b8b99b8d467e38292bc57290303127ea72e3dcadc1093a89ee62d1d1c80491c00c78fc0d605f53440c459ca092c3332d38f0c10e0fd8a7297c1c86f7589e4e64b9abab0ffe1ecbbedd79cc88b8b3fef87eaff8d824a04f73ae9651b2e6e9a4e5abc210926c4a4ab0d3ee7a1369c666a494a4296d63d9ce4e41afba9c9533c7c51f691a41eb9a1ac1f909c069772b35d646546e9db6702314a721d58271256e81b0b1597efb7a1783a5162c9c7ba8def8975b5bb73d47d08af01cdcc4cb6599282f484ea2c60f74afb91554a24c54ebc4d359d30b9ab3143c286bbf63859e1463c4dfbe4614570208f0a1cdf6d63343971de84e77b67138db922d310c5694bd832af6fe1064510381e9b009df8de9436e4bfec787c39cd1bc38e58e3ca6751bdd66bfc226c6e23c3cd24e7243e7eabfe2c2274c4850ad479c43c6b0b8b96d01670139e17c7240dad892bde22b8cdb2c4dd02806c26c0ae553957415c249db2246cb19c8ee02dfd3cf2f5b0db11f89915605da7962c42f8f8ec2d28b2b4c78eb3f023989cd6a22bf1701725c6a7ce40ec80735f2d95176683489702c5148522c50d7ca65006b4ec1eefd5c883b1a06061d97bc3553826796111366c537b2aec7263ae7f6557371b9a691872e197d424bf8ce6d4cf37c92b82343fce9ac7e0d543a316870a463aadf5440a15d1b524cecb3a2b86fcb9ffeedd6b4093369dd4b6e9047d51fd93de2b1d143e6341a8f40e56239a2a75917956479df525dde426f37d485639fe07c216f84ad2b115a90ab248b796f89d329785d422bbf796db415f4d6ffbf4f554748bd748e00e9c3a205b38bca8ed0c4cb2f5239a144c037c7d520739558318df51f4aa0884692a1bb8653850df1052369e5189689a717a366d72098b897d6ac3e2a117e40df8846609c26fc92e4cbed7c98db8547819f6e8786863fa8730a3004ae8d2df06d5eb578d3fd484ec6bf8eb52b68b956a82c23dfa3451e56c57592040a0f20b77ab34b58781b12f3b0a989e2b7463ec490faaab7308b327b940c10b56394b60696b3c921e1f4210bc643fdf237455cb17e8679c8046ec18a30981cf96a6a33c59164fc48b7e7abeb2003a57aedcea115409b82bb0dc54c53df1e1f327a9b7a139873795f6fbf5d295eadb8d1d0bde00e424be795097f0151b204829d70746dcf2be34ab75c7d2c9dd60cc6fa8a16efe81f383fdc8b88bcbe77d0ad384770cc378123a3de907ad6a70519c958d380cd01ef0d009290e9b822d18039d52fd9fe7d8da1b11435dca13f22b0018581ea387241e2904e123bd0a1e6af81f0931b09740e2ee9bc0ec9077b2e6d275deb3b025eb13e95656b90bd0787d0cd0edc51c7e20932963f50dc2118d5157ae8b3d82e192a4371aa7c503537b0d5c3a18aa50dce423cceee1b6f0721bd22683566786a13f29136f3e23806cbcdbc070dbb3fa7b55c537617c83a90271e2c7a8fc8e6c4c8a3f216b14dad0d174f3643cb09532624bcf9ac65effab92ff279cde074e5be017e7067508496a1a4eb1d3bf630b59d6413e132c8694821c4de9f8e15282a0223d6b3ef0b9f057dd0ce59f13a7d7af4126be24a28fce01a2a7281e644f92b69ec0c86f0d5b6343a03a75f3672f2208b99965b57341d30e7cc4fbb659945138853926da1c82b8168b380d854d16f0741db4ffe33f856fc5965db042818e1afd6bec1a296c20de465c70b8129a8235bd0bfd388eb08a607ea61f1387b91ed61f80f2f236e9bd05b6ad7c8e66c625f0078fb3fef6b98b9291494513d2be6c92bca7fec7c850000d65ee58f7cf4b73a8ffb11b3f8e6ed803250ca76149d0ae05df517bf0cb63de85ef50957715adc51bf081d4df322cb502a1e7fbdca156ea26c267e4e0e07014a4e9ea9399dbaf85f4cb27aef025255308be21d1a9fbd2b3904531f838e3fe4c5d85cd236f6dc53742e4fde9dc32b241ebc4391f45e2a705415040fab741582027ff5ae5cb67edf3526e8ce5bdf363d04b15107c30e8258c33c964d41db0423629c36db2463d39b5be707dd677c756d2b41cf8b0bc0a10d4daea165a0fc37f342a93429343730e4fbbfa75863c39077e8b6c66c8bee80a9689ac58ea7ca83f3fd54a4b1fd6bfa2b6a3e3bf8365c7f45f290d95d950cde3f5c9c5261f97a0fb9e5b4a1b1b61bbd66fdb53a812f3e65bdd2fc79d8b1f74ac1a14c0513be33d28828233f723fe1dc83c1de6f751901d8506892f0aff872d2fc3b6e16301a4e317e643f136217e6410059a25c006ec9aedb6f2bd3f22beb3b773f70670eeed2bec70882ad646f689f3be3a5a4c4fe7d69f4ea5f3de49481879f54c7880d7cc271db64ccb528226db7340dd2408e38d151d5caf2de1e5a263d303d37aec021e5bcd7df02b1ebbe20e6dae1c57392690814eaeea322f6a9d918eaece55eaa464832332b2b25f11c1f99e13452876a4025a361074cb6f7bce655d55d8a6d03f2521ab4a0721da39fd065f4ed674e965016aeb2011ed22afcae735a2f418ec8ddc9bad90a1bd0511e3d0139bd0e61dd4c4fdfc2f86325dce6dda279d3e108cdd9304fded7038d91c6166298ea95630d77a5579ab80949305702cb59065f36808263899f2cc3bbf8c831e1a7040864f7ef2bd17faf17e175ee9adaa0f15c4acdf686a4bb1f30dc47b50b8a4746f172c1be94c63e238d4f24d56a065c479539db5a98d7e5c3eee300940779276050a3258d55d1c49cb9e3dfa194e98390d76aa1b18398d3a01f998854fb145dc77d001d7c57872f897e6813f15df7c47f0e2b5e92cfe81c7da5dc1b826868573b47a31a79d8733ec06771129f3d4c3439349b29cb494ebaa55b5e294c6452bed2ee9adc1a11870ac5435d751f99e834f3528a896aba4c06c8fe9513d80a79fd339e0cdbd416c97cc92a57ade198b362d91ba3c46338d97253445f34007233e0d6937df880288f0670658d23f4ffc20e4d58452502ba10b62e7765df6936a144f1dce8c8b132afd42c07aae10ce07c3f53af1f4b8c1a0293fb2c3bb9bf778cf1fd127a1a05a4754744cb7ec166c697db20462163e968d1c09fdb4e9fda5c19cfb87dc3226a41deb11288c835c65a76e17015f90ef96cc32f23a09275e8d26734c7fd80aecbcbd8f9e3cd62938640ab2a1a81ec87f4be2a9dddfd2f3527a14057dbc2734e790565340aaba95c5a7a8b2d13bce830ad1d5e46a1a5769e6f1f12d5613288f6de1658ce62cb14e0b706459fedfacf0dcefd72217c6b90527547fd3f444cf59aa11b8fdc26511af69e1e9e3309cadfad1146323055572b13290b8028632bc7f135b40504bd0a339295cd6b2c733d483a72494fe5abe983e1ea6e7be10598a386b2c16cad812b7b025561349f3c88e6ac73327d906962308bc692bfb995278c085810b3ca06273e9335c1bf3e8ef331f9e0ad3210daca21e89850f61f96275fb866d0df27da4496ab7dc9a6cfd7b332ededd6fb21d4433e2ea4a33ab80effacad91d273e3ca709e5849cfacc01fd7d0dd4da636b39496a09709f824845dbe566a3de4fa4dd0cfeb38887cca23c3710a2ef6ddbc4d5c9122175a85ae46fe4f3060f58f76c9e54621508f245c3785bffc3146132a29552e2cf637d31558208caefecebe0e84e53409a0f7ed9d3f28720a671b69b64f2706631fb8cc1a75a2617aa8a598e26b6931d150e39feedfddd9916f0bb944b83b231fe1a29932426db6fd2a86750e6b9a9a5296f23e8d3ed2ad3a9bf7763cb0140e27b015f30c898d91f201090514d453bc70ec3ba83445759410e89007f3bc1794aeb6a9fc4317ee80ae5437ff44164782289d098cd43b50d4b7ac6e170303006c1fd4fcd78fd5a7e70b2fb469cde4a52a1ce554ab2fb9009870643ea5784c8daf6c243f4acfd24182d0b4188d0abb6f3dbb1a16c89257e6b02c7d7b5ad1b95d4c3e4ba98c0e6ba96d6ed9ad2cb0b0f4af8b22807c997090c64c825937073204e55496dd71d4d1905c6eab482e17030300acde5ff938cef6fe81533f83b75318a2999da5810b835aa033387d2d0ca1cd0967730c6e25b7c049af01e49dd96789c20a47b36a5254cfdf6ce3228faacad99e0bf379d694bca98491bf1695b8f0535d920562e771d036715a15b0d82c8610fc9863581bd65dc5ec51920898240b78ba84e2c7d91ce3800116da84ddc047b518fc4c3d1704a8d8263a8e2943f0fccca21f984d4e697dc48932019fd4c60b925d3864aa3150a1a7941b74c9668817030305ed960654926a133c08e33cf31bfb4bffe34cb6374273fdc5bb38496aa303e917394e6d415c7757b89e5a8d4b71e61eaa7c08e1f6bbb169d4a71327db1f3fa5529ea65501af7c3a82025ad3ddd38878cec45f3bec8bae41fac5e20cb8df56e8135a01bdb096500d26feb4cc20eeb595627b2d36c9e22a3657084310564907d001f61401927c1481ce8d6b8773749810937676c885f02578562c867c4834ef536383677d99b17abdb908681bb907d0d78da61d84d64dccf1bb83266d0aeba609bc9870fe45e80fe9ab2b4907a59c2755f0191b9e3fdffae9fd146b63ea2605bc32ae01839462eb6bcd5358a3b107bbe52c496a8bb9d9d7382b57774658b00e438d76371c66be776aa378682ad890354098a706a9b5abad7aaa08cf1fe962a7683aa594d9f1f13540199ac37bb5fcfd24ddbcec8c9239eff2e99b8cc8ffa94356ba97f3ae9aa02a8b5894eeca632e1a8604ddacbcf1e5ed4b2c5fd83e0bc529cd9752245ce98abbc5a418f541a2edd1e60b400854d12c364891c6d8b62edd31c1c651ed97badd2e9d7ca112f6f1f61ffec7e4c69893b2ff597586321b1c2bca1751706d4e421c5470a8fce840c29ca44b5969b4b0b7cd0f30ee6249f81cb3ffb1725c827d5801c97feed18229e2b24b08019d1c335cb2bd6ab7874ff8165168b0729a80f86d469827e582a58c69254641aab8d1f94f23ed528b83e11ccfa267ca42b4e4a85c3fee201d9c5294cdac91bbd2f310ade63df50214ab833bf1310e8700417566b552e0df8373833e1256bb711ab317e77d744e0ec9e362b1205edd10b0e55547a9fcca0d9dbb9469849b3a892aa96aa5688f145a065302a2f723ecb837c0c07a964e6ef33c2657f5dbc80fd0bb369b810b179c9afdc2ab30e5d14df77faf554e99d4190989ebd6a0eff1bffe7430ea4f664fa78dba0d6678f258f6050290d74b2fa050db8f83261900cbefd00605f77931681b92bff501f7fd7af1a287a0dfe9d342c4b5e0f65859ba60732762089539bfb09613e1f2781e9d3f9dca4bed288d2ff626b7d98eda682be00f0593c52023075b52c5fd40395c80369d6b7129d7f88a5c3c14d6d07836ec18c67b1c193113af6af5eea5d0bf0f88dab572e679ea034c5a24a4719ec49b9d8edaf6516429a200908956afd1e01ea170f29224c575d226c697e453d757e7ac3381c635b4ae8bfde80f03e66b0f08df12f60347eb2a1b4e06ff278d1d70efc57dfb1a0640aef9590dce9b1e8bc823258e498a0e09ab6ab80837e70b6add53ce5151f80cb27df0e573bc0b9ad69b66eaf07012f923af702cb793b1d664de56e7a4a2137d5791f1a05c4800bec8b2a0e05f5a8ce3448a79eee844c5ef7545180f9f8441b2e2bdfafcf85c861ee94e83dc7cfcf6b23c570d77f2bf483c474489f44da6f7d18c82ae24d06c085c9d54046d6f2e541f342f1a8537338b0a44ff2eefa5c1e3d94f02548232f79492a53b6b99b18c30b2ca77bfba749085eb8d0fc27702f387d274cf64b8c0e5f5b2b5811f06d751cf0b8172b4d93d2b88baa180d2126dcbcee1cba9d432f6b9ba353c0b0ac3e7e6702a1e2572c77c6220a9b6a122a6dd5927218b8ef6c4d31f28e3a279c9004fdf0a63431bc58795640fa0b1e905de514aea169f4747da662b1d7fcbefa6bb03dcaa36ee5afec04ea3013d8db5df21abd0701d94d6c6b261d4ebc76b3177e4c5ebc33df3ff6db274ccf70f8ac3551c89db0d5803faccd96761be9ee3a013c0019c467475958cb5083fad737aef54f96f67fd54211e88a747683118ac898a4f1d9c59a05cd6d2cd46853c1fac50e023c0f21967ce71b06e50435909818864d5d265428f1efdc52313d2b8a3fb48b66b8eb9fb91b02750014aafbd505e243220a5becd69e3c0917655019507429ffc913eb1f77a035494449383ca90755edfea2418508a4c5bba4aadf3d0da45a3adde6fede769ac19f9dff304666d5de105ba4771e2ebb215f556fb1857766ecdd3587c59104a2bc872e7309323d6857e13a26d2b74e1256fd68129c4e24c965f0ba224375bedf17d10678bf3d6efba18aa503aeacb95824d07a28f94b85b549b46b024efd4e92958a42667bebb5d946979cde127c6e5d29640ab325711d73290c0f1d92d17030305ed37a7a77ff32949f53a0af5e4373595608c66ef4a6200ad46dfd525dbb867bf4d297a2635e2f93a778dff30e3070335b3e6d029a5b9b2c5c796b7b63dcc420de9ae11268da91afea4a2434d49dc8669eb1f2df7d2fffd17a50dd521008d4bd1c17881d62b141e4a6b5133ccb790bc332cd2095b3abb7cc1c88dd9c1edae771821c46d6eaa5fa6c01e3c0596a374cd4290aea99444c4b7f1092b1ab43ce1dbdc73278575ecf0b1bd9057c2d45bf646928d1ccb7f34d859402bb965cc158323d031b3ac9d290c2bbe248abd34b37e9d76ca9bab5a3aff552d8281e1e5e70f39217af02b60ee5073be5d86954e9cb188616248088119190564db842e1bedb71191a1d3f176527d4f29231f5199a9a2f27624793f43620ee2d524ad9d9462f2f2dd6f25164da89116f08633160d79786eca97695795acfc27710743459ba58854320bfbb4ffb233aaa9dc657ad6eabe18e8682a8f0671f566da961ec166e5f45a638e3ad3a5836efa8184d7128f22af05fa9a0fb7954a86c186d1291c7eb979e079469078d8e62ac5068bab2411f1a7d62dad88c56a3825d9a65a2705c7bf3f98e98ffa4c11955b599336464c9d6804d234694ed29a586e4915aabad7e112804d41b2c7fa70f8b726fed85493617a80083cfee89205658b25c11165f56ede7869e4d768c1ad452e3fbd562d85795a4ea39706d880fd39f64a4733248ccd1f6c8202df97956a8637317a6ed5cb089a9fc2f065ced037a41b652cbb8c1bd57e352059788a287eead565ff95377c4cd6bb889f6351ae06a311c92e36de6808b6322e5b1a93e5551a9265a320234437c5500d9bacdbf88ef46bbdf0a7952773207651f08d494020df930d46f22e2dd52ba28305b2d94701115f8ea57c21550c2c691c4653c5069a6dfafd96b189b0af30b3bd0b5568ba4640e8c5faf115e8cfac89ff35d73ce33753b0f390f0efa42321ba64380481a23ba9a615e0946b3fa1d4c7afcbd25662d70e36a2f5cedb492f31c2b03b7d117eba1f7b03dbc47725c7cba85f4606f57032fd026d308f4d9a21bf982749772d2efff6107f4c284fe6c0ab9844194d43cfca3efb40b0495989d378843021b7d87864cf3408b86be221f3d37a17da7466655bed77f0d429f23f1d2c907a14717783bf6ef853779c634f33dd7f1c0587eac83fb01a1cbd4f10178a673e5ef462215740257f24fc446eba8c65533936d83769076bdc34697e38d25ae352a7c6d8075450dbd5bc14097aad6425ddab07701a03a7ebedc699d9e8e269773aff83fbee78d3fc0aec03cb14f62fb753df78901d12eb3dbdf349462b10bf6ef67367af160d57f0741999d0bcae59da3c7088155960e656a3c3639b7c589296353dfb29c84937afd424c5c9fbdf80bd9706dedd8e230832d814c75684e42aa314a6e028660aeaa7b669e0231241cc5493ea91710bf7ae89d07287514872b6f8fac20b6a2a5c682feda544874cff43355c71a8cd6f36b2299a0da24bf91243342bcb678c69ffb94c32c09a9bc37cd776425755b3fe32b8a73757b5b4727a1bfd4838e1756da56526a47c4e6bb9718f350e81ad762fbcac29ef6725ffe1a6b63ab24490279d93c6a1f4a3d2c184c6751d7d625e57425c2df74b37f3e630cef3689a4d7abdedb9907b5c39d2ad43a70dc6865b817d75a00917d56e36427e1e60388613a7adf2fbd7ea39c04a096ffbfd115dfe4a8b156a65fb1b978c3c0483a631e6d7c409273a0a9ad1eeedeb191f1327a9eea849a02b14871ae9647518d91e1272f87a59527a4cece507dfdad453ed4361705db1c850565514032f876d864721bedaf823e8d003cf59e724fd083079733a5fcfb7c99d415a339dc84ea28f99cd28c34ba244a76f65614930a842e50236dafce45520e60772d5d5090e84721a29b3ea57c670e9e12600c1ce9cda0e65d756f6b5fe4259813f20a77add107c96cfe8f268ce5ef309f46768017d2c02926bf8e4969b2776b20ec0a30042e2cf94bf36e5c682f2e9e98201c311e619443e12ed571ab57e1c2e074ebdfc61983cc2e14af3de68a8f0c3c6fc387af9229c51043baadccdbcf5e6de350c91206bdb5b5ad2f75a9b16348a6038e35451a203f3aeb9012bd99b78dbe5c6807749646486867f17030305ed5c7e35ac9edaa1165b07f75ce6800b3fa24e8829fe30fe0863a347a1ac0f2944378f686cac78a709d406fe4abdb7cea479ee56eeb83ebec107848f52eaeeefb98d26ea7c5b638bcc732867a68a100919d9f2ee0fa4d45d66bb11340f83c25133bcc81c204590bdba073a42eb12a337440d94a8b072e8cdc2c170cc74498d9d54fb6f596dd1579147bc6c471bb6b11f8df280441574d11e3313ffdb3642308d1b2833aa3295b28640b5eedcc4cd632ceebaf1f20945f28a5862bef7edd2ba909318c257437c23375011b3559acb3342dc937bd78aecc3f965ca84e50b241b2f9b8ffa0062067b8ee977c29469d9f9c24ea1d90a1eeeedfe128d4661e53b1fd8a975c796a896d1b62eec8085bb6e0eb2582ef245d231fab7b757b1a27cde1a4a6da8d4efb51a6de12c03599cb2c8938cf4542910fa0dd1f1013d13c16136a3ec7baccd52286ac02eaa5673351e2b30f1afad15436cf55b9841924de9217a75548c3904bd979bcaa9fda42163c43cbc60c334fc471837b1b77faad372c695b02993b697f9a0174fb3c5ddb01ffd91225cf7c0e2cc8239214cca35037f78ecc2861a19bf3d1296c93fb5d436448bc0596e30d018abc1e4e819eaa6bc2e12ecf4337c6ff4797da93890312b157ca0e5de4159cb999f2a1b62347ad6df20dbde222acc17667ec37ab1b198c790c84bfa0aa0ba85dcdb7814c7f9b12f9edadd93f8a3b3a4ce6ae8352712b03a72807e99f2fd9361de3a495598482889cc97e19ec77d8b9060707d727b60c2a7401da38b2eda4c3e0a6646881e712f743fefc6157c691ae613f5ceaa4ef2121d70be1a39d2a630396138fab4bf33ca540fccb6927f46b7c62a22898a53db2ce33b9ac66ae9bbff10738c3136a8b983b37d10a8da5fe15fd0ba08620d5f322108ee20b4e228bcb619f112f1493d612f26362e1a3e0efc903ecd1b8762a38be6dc207d6064028c9aa0b4c0d661470ba38b5e7e71e2da86dbef9a4a69c903c58b1aca1a384dfbb6e46aa2891e574dea1a44a8866e6cdb8f4131bbeb2254d16a050f20cfaf71f83a6ff5e4e98263736dee1c69b8a6483edc121ef6fbee73be7028d62d4696be956161425f9af85f2d1d7bec6ffede6ce601916b720413ebad3230d7fbb9b96649e3ef42cd0edd108a5e83ff87957367dacd49ab1e7d156ddf3b98219a19b2d4572f789f64d7a937265f8b996bc5e9dcc71023d84ea5dc9d7b64f8b5e178404cb437f4c8858740a91e09c1a2d43fb3b020ce2519b60ea7c404a26cebd7524bd5489ced3e7a203133f4827d1b0baba6a5416612fc3f9857da7fe523bf70db94a6521ba82e2490b82b03632d7516d5cb523d0a33fefb1b8313d0c108b180318e469f03e7fd01a20f2a5b11964185b53e8a5d6c7293b7646e2b0145a3ae8df437279da707df870de326e82d8f9cdcad3f6054a3fea30bad77d1fbe22e811aef8746e530d0a625726e7b03ffac9ac50534efb7241c837b1be6b528594ac5e60354ad5927c357311ec06b05d3136c2ba5c86e555428d6aa46be594b02163c1ea3298a7c683aa707bc6b914d521437d2995ed32b7102d2440bd76aa99bd62de09b0b677e05ffcf62677a572a8de4d16d7b606917e8e226d165a87c235810eb44024a243ff7fc087b062cc9e9737bf595731c288a35a91936a12f52ec19344719c1a3aa74cf5a29784e7d794838a05016cdf175a0f7ac4d9d0135998fe9dc40c9a6757efb7d6ce3a62215a7dfbfe84f719f31d4d83e0e2b27664e8594a15b4745e8ddecc03e08512cca5dc1092eb6b8031f9322423f0154194df0bfd7b48965eba4b402176abf31ed317b5d855de28456bc64b99e4ab504f22287ccf7f8471fcdd734811f5a232119902fa13023ee11de0cba65fd2bc0d99fb54cdcaf93caad2b472bbd8d818441550e0b8083873eaafc09e6cb7314e2a93fa098403be2ea8fc35b78e86617c1752b4a90181f71e4376e349b718991a56bbfe2ad138759b03d327dc4b5188ea297d7ddfe3a0b9e99fc39884ede9ca72542afcf9b9578756c4bd8bb806aaccb2159e5fdd97a59cb2e3318a6cdee6c6cf12e401773845983b65ed16f1e13676039f3a29f1c04a5ab25a40da40693525b23f13971448d1e250c11fe0a57e017030305ed1f0fda120cbccf7fb87a987c81dd573408e8bb07602d2cb4d754c3f69f299f6ebd01afe3b3c2e9916c4cfe8316e36810f59fd4c7665513d6d30ca97d69fe4eb0bf496a7170f34ce634f63dc5487ae0bc71b684a1fcfb250305ec6f04a0e4aa11321321fc24fee29b67497f80328f0a5841cac563ca4cc2df21d66b763fbd3c3c5540dd389aadf97c5d8c4b651f25100e6bffc014737dc941947206a1032a3c06600ed2cded147c1fde311c269a805a727e14dcf720d6abeb17ef67e076452f90c00accd0ca51d0f6dde95ac63f3b74fc85a8d35df09eb9964c297a20ef6f56a998ed6c106cb1ce7834db0487a142d7be7769cc425aea655e922eb54be963b67bc8a94eac57c38ea7d3a1d218ab25e2e1e642e332619df608f1a924e19572cd05ed1d3852dca540d9b439b69dc09405c3379e46e57c504a51441d910ea95ee30ea47b1824ca0cce4b4eeb15ed820be868942189969c175466da360fd378fda1455cd1fd110d69bd8c76ed5b0521279fc6da594548024c06b533ac7f316e890703232efb6c5699165336f0ffae687fc05571fbf723d3a7d15139a147708000d7285c6d4e39cf46737e7e16ebc4bfa89c0ef84526fc672542d5f438e3ad18d7da7983425892afee282078d04ec8f5b546699b4a2b5f518f305e9f689466d19df6713fbe65819a3d27e42b029189b80158e803d2f44ce2a80a8b00490e75528a4838d4ca9e38a820022233cd4cd5a738ea3d2ce59a014763346e735a08ebcfee9ce51011205a8841a70ab72e91cdd67d872759b95ffec98272898fd2bc7a8a9852c014d037d1c40f07e09d6a7cca025d249a97350eadce88a0d9dd512d24f690650bc12a704d46c645debe070b81a5b41a555b193a7f0c6d682c36667da726a67ad8cb5e243f8eb963f795ad70c4c72d2010b499271f0c1e8712bdd7c99b09e0f409402c954d09ea998c608cac42f37658277c154d81bc86ff3bf412a84ea9cfd2069c9bb61023069bb516bbec212f8a246ab43548dc95c910b035431e35d1a421e7b3af300d3901ac1caf558b9e7044899a5dd58c54658ea3a3d2599e893c78f54ed6508c78c3af1bb9629f9d62a9b6515ec4550b7c710f8bf1ddc54230c0fd832a1994c058dbc689557202732cfd939bd0d6e22caa70c449066cbba07d4788502130a4b4df8346fbe005c6502dfbb74a5b194bb0a57c5763125a483b0674a471f8a1cd62c2612274d67403fd9497a57a0e10c59d2e21e7857fd5e9f7605021c9f7e15cb06e4eaf447d9722b8c0e092cff62e3113db6e8206480f9182730976084866a9ff54013a96b4e32fa9d84f174a78739649a34820901f8d573cb6aa9d61ccb710e02e7b88c2f20f97f19ea98e3480d4973ef1dc93db3b5dd6f63bdee288abfd518819b5df64bffd47238a921d4060b6da834cd1c7b3aa6eb6a4868444d1a296a6f63694496671cf75293ea262e41dd604b6f8809d03ab9a5b9ce0abec9062bea12d5ef68091823ea2e5fd4590e236959b8206a24bca8c54a9c70e40526020d156b724d21feb855df571410e1297e064829d37d2ba528d9ea11ff25c9348bd74081c78b8149bd5af512224c10a2b37c6ea242dd1eae314c9ef9f476ca4f68d48f159a4ec80b2dd8ecf708c506096a1635d4b4e070577c5f400c14315948af967960ff5aa7c70c8d0f7b5e00f2e070276bd3f49a54bd31d2fc7bcdaf41316bef7ec15022bd758293fe6d5a2fe35e05ac8e5f8968a8b7cf0378b1845bbb6cfbcf076eb582e6e776ef778db37e024e5f16c81dac77fa3a283184783b2ae860208632625977c7bade1118d36c2227e5db43627a08c921c51e75b9894f1becfb9a4cfa1b54e503cdd829d5153f4d2bc1e1a5b612e15a30e5dd17ae944cebb89f4772501cd164389d3fe9c2b062f23833abd9b4782a19d40b0d605f6e832426102d79a2498f4888f66c7fdd835a5aec69bb6a14f5fa5cb5e8f94735c9effb0bf35304f53bee26bea1c859f1b6a471e834f68eb649f2a98e841127bd4fa3732b342dea28f73d16354ab80bb70fed128d4ba7f08648cbdbdd2d1a925566dbe5409c86e44af0319e49b162322af13b8aa42bc20ab4a1529ccadd6372ae9c5a986e835470a7484affd1f2fbda5c510d50617030300747a6062667523a42f07ddb7e3e0f263dd97648bb0f0a40e506b8db417d8e02f0f718031f5de159921e2f993c0cb7bffce74b5e3002409273775511bea0ca4c4e83e957e40be66b1f7c9507d43fbd33ac0dd1ba8b2fa81e55010576f0757b91a1b9efef98173faf6a250c7a95b2a640d53673752d017030300163ad8844ccd1c181798d4e1d37dbcaf65f7c99e8365f9").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let cert: Vec<u8> = hex::decode("03923082038E30820276A0030201020210033AF1E6A711A9A0BB2864B11D09FAE5300D06092A864886F70D01010B05003061310B300906035504061302555331153013060355040A130C446967694365727420496E6331193017060355040B13107777772E64696769636572742E636F6D3120301E06035504031317446967694365727420476C6F62616C20526F6F74204732301E170D3133303830313132303030305A170D3338303131353132303030305A3061310B300906035504061302555331153013060355040A130C446967694365727420496E6331193017060355040B13107777772E64696769636572742E636F6D3120301E06035504031317446967694365727420476C6F62616C20526F6F7420473230820122300D06092A864886F70D01010105000382010F003082010A0282010100BB37CD34DC7B6BC9B26890AD4A75FF46BA210A088DF51954C9FB88DBF3AEF23A89913C7AE6AB061A6BCFAC2DE85E092444BA629A7ED6A3A87EE054752005AC50B79C631A6C30DCDA1F19B1D71EDEFDD7E0CB948337AEEC1F434EDD7B2CD2BD2EA52FE4A9B8AD3AD499A4B625E99B6B00609260FF4F214918F76790AB61069C8FF2BAE9B4E992326BB5F357E85D1BCD8C1DAB95049549F3352D96E3496DDD77E3FB494BB4AC5507A98F95B3B423BB4C6D45F0F6A9B29530B4FD4C558C274A57147C829DCD7392D3164A060C8C50D18F1E09BE17A1E621CAFD83E510BC83A50AC46728F67314143D4676C387148921344DAF0F450CA649A1BABB9CC5B1338329850203010001A3423040300F0603551D130101FF040530030101FF300E0603551D0F0101FF040403020186301D0603551D0E041604144E2254201895E6E36EE60FFAFAB912ED06178F39300D06092A864886F70D01010B05000382010100606728946F0E4863EB31DDEA6718D5897D3CC58B4A7FE9BEDB2B17DFB05F73772A3213398167428423F2456735EC88BFF88FB0610C34A4AE204C84C6DBF835E176D9DFA642BBC74408867F3674245ADA6C0D145935BDF249DDB61FC9B30D472A3D992FBB5CBBB5D420E1995F534615DB689BF0F330D53E31E28D849EE38ADADA963E3513A55FF0F970507047411157194EC08FAE06C49513172F1B259F75F2B18E99A16F13B14171FE882AC84F102055D7F31445E5E044F4EA879532930EFE5346FA2C9DFF8B22B94BD90945A4DEA4B89A58DD1B7D529F8E59438881A49E26D56FADDD0DC6377DED03921BE5775F76EE3C8DC45D565BA2D9666EB33537E532B6").unwrap();

    let cell = TokenValue::write_bytes(&cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14996af12848fc796cb61a6ab287e4b01dbd78a82f").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    println!("Wasm Return Status: {:?}", status);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!(
        "010000000068d1e8a6a8cdd763e2175db4b267e9c6e14a506f7169475fc0af54decde9fb04316826f0e56cc54d19c80a8a1fe24c404420d09ec9288ca46fbfcd9e80dd19f6accdc0b4519b775019e139ba001b1e62cad6ad021605892c49b1e778fca40497621a001de52b8fa1ad5ae4834191da3ef2345bce28fb49d3a3ea4a6ccedbd314facaed71558bf47bd4ea8c792944c3c5daa0add41784423aa660f3acd8a1d4ec0e6535a2714f762f6e0be41c6ef36079f1e307a309adf04ffb761aa8bbc66f5bcacc74c84655f3f3bed93206b70c30bf93069195f1c9d51b2e59f6d226ab9a92f473578221456143e0c45065f50d930a1807ca24702e4b045589c8353f80383f608288c3",
        hex::encode(ress.clone())
    );

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_for_not_existing_kid() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8fa2d869e938a71a2cd1d1eed76c82c133408bf07d49f5e6a5768d518c8ae72c010316030100a10100009d03038f73f3532eb8b51bfb5f88dc2cf559eb728751d67e458dc067fc49e2062e52d50000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00204796db556e029e1b98b0e9be06d4c23ddde853c627f1dfc52b9e3103b5f1ca0b002d00020101002b0003020304160303005a020000560303c99f389e5ac8e8f3181e4804b70c89036be8d2cc7668e0c1649c78e66ce17fe800130100002e00330024001d00209cacd9c4e8bca9041188341a5bb347d1cc86012614432bcc192cd129d17d5c20002b000203041703030be7d99a04ada3091a4e87220816628a2f76033a4b3e5bb0d7c6515993d0dc6e49cc68bbe2724d973ab450c7e312cf513f9cd2577682873feef58531782bb90ce37aaeb62c1005568bf5d993c98510ce51099cf76cf73d9e54c33e16e747f97688d83b5b1d7274ae2b3eadff5e5d209f86c0af37b81a1ba00e3451397b8338ddba20ed634503f78ebf2dec7ef350b806d47c7e31c5748f2488322100171ca0313d0bd8c5460e896c664f3e593953e7fa6394430ba064c28d26686444ee4ea1eb67aced42070ba044bc999e9e6b56b9256407297bc79b6043cb92e4cf0bab84ec0755a0c5556d8ad7b622bccd3f3322ee0c16f7e3a7d17b5c82d80241e5045a400eaa4814835867db2858bb988797dac15f633c0aca926e5496b0c4572fb0947a85b7d4928db482a17b79052840cf080b0c25cd219da7301b2c766b88980626997448cf9ff696b90e8262852ded638b96e716b34af40d01785fe34c1de91739ab7cbfe7579fdb67bc7ffff1b187de962da204fcf0a00323ae125662f19f0e427c35383b81826e7a0bc7d89621d589e074ccc0470103d0c271394dda1f72ae52a61997754608a4ac42eeada12237a416968de797095792d7c26f1a0ae89c02ce9f88501d8474a4fb37aece4c696d504a265a3303f1af4e3641234ae8e6fab4a2f466eb43172a3d3a12ca714ebb5624bfe0433ed54b17ee90d8b5b5577e470db6bf1cda0a59f40c7f4872b766b9c8cfd27ee2d6be5d73f17aa92bc586b0da97ef2443d5d63140e45f621d4b88833fa2b9c34398ee2c4510ee3b5fa56008f2e05537486e4f0c6c3fb920b1d0724f92d1210213d5e0cf3fb4b090268243c2386a32d1d0294a52c00ba16db0418f2e4626ffd1f30d90c76aff0b1bd3250ed2fa9a437ce229bc673b506c1a017ec56b0d53e40f94020e44fa6bbd3f5b31e3aa3fbc741da5413a5c055ea2bf8a7f928054fc26a261813b5d2d247851b2a5df4aa3f577a5999342a77e9c35c811914e2a80eabe77018f7218b285b97f204849027bad55eb6d0d0746a3bc7790699dde1ff17e32fb26aa27b7f92022db3b12b65c290060de578a79d7de62fc4b16b43d8a1e1cc8f5290023a9b4021537c5fe488ce9d48aa596957c6588cb31f90653ac75d6b3c0d5beaf01064a9e6631aaa2fe0ccb2fe8296e99a5181af90e893e29ec5aeee44b568d5d78d445dab932843be6b0bae4e87e04fd0a574f7f63a3d7a9b311b99b5c824f20047453060e13d441edee8c12d0644c730e04eaa15fbb349c338861e5b67d8caa2df839a89283fade6b9ad4f3174b301e8e5a7550c720ba561cfaddf864259eac6465b955fe4c83ab9bcedd8509abc2c814be18c1045cb0c9ca08f154eac9baee5418b638ec2162da27515a85feb1c983a0c867650819f423d4fb27fd345d5ec63e463d07b484be14eca45eb9cdad05942d67a44b9e5966749b0a695c3c1cb9750ec3275b3d1193eef1eba4dcf9f2985877ab7c1c68c1a7985ec859f66ab2a7480c9fb24adba48b3b1a1e74b36b405c40cfbe0f3a2d9eb21b9c1074c42c633b90863d10d317db0ae7bee4523d1b7acc6310f1134d24f51cc4f4572bf0eaf097c470456c45c293aa3639e255853c9621d7555a759787b8819dc2e945927af9bdebd8a471116a40decad5ce0a45517954f97edbb760636958ef529f241fab7eda69c904c914090f915fc4fbdd4266a34f60642a01d3537616f7cc0739a1c07dd046048c6f55bf6a5f521cc957aa97bf9483a7512d41872b76b9573610b98b8874f77771c00ebc937d0c587989e7ea5b1c0b727b42100c26c3d808a811c2e57b3123f145eb035ba9a1bff4c555be2762cc1595e5797d081ba5897c260778932ffa694345059c35094f8e4b0235111fb916ee8527f7e38a73af562cb846ac55f1bd6e638021164a91c93acd15b2b90db95802406d8d3d6a7c8b6817dcd84eb4cdabedb162c827dfd86ea9525b4d21b8d350a8900d156fe896d76514cd75cda5080215093795bf8c15629af912aa8987a8fed60eb56ed17b0b2c14288f77db57b6f79dcf888b3407229ef2eacf950e138ac7b0a86f04dd27ed1863cfc4958d95349beb50ab4b1049413127a3071dfef124980cb738ef41435e8fa5c9b7d38cf274f48ace0bc73048e29c7fe1e22ae0b786d066eec46229779ef43fe34f4375edac2c2967ebe941c1f9c54c9456c9d2a134a7da80faf65ca3681045f81e4235cdde3a899b90d2519d49fccbaacd47380fe56ddc277b05293cb63fbe86459d9f0a887cf17e9d7b9c88c0ecb0be853ea9e7e83ebd78e10dd2396c50f76108cb6ef5cb9c6992cd20090c49b7c63ee258aa452b9fd507766c0b9ca0c512761ff2ce1acda26b07aaf35b4c1c4b695326f18205883014a3a456afbe1237b69f6a447e1b471e713da33c6ca333e2c76ba4edc521acd6aa7f9342b8c8da2e4b72c3b89497caf40a5eaf53398aada0630fb715fa328f261c9542d0d2a67f7548ecd76a6c3b46c965ffdfd926129b5a0e64048a3df4bac29440e2cf8c0a0d4dca25ff1df5bc0a683b32ed3e01f12710ad2875d644b47bc51d9de32d9754207aca629ab9bef6086a59d2cf789e04a38a854f586413ed0f2c634a88dab6d6dfd76e7cd02c314a765b727b049f3926cc53e6453c4d4bef9c7fa04f4abedd0b553752713453307a6b094b4249efab7d68590ce3c64ef3d7373c90951d611eed2c68d8734243e0f1464becf04fa6a4cd2a72ffd1a1069ecfeb1837732acd723dc3ee291c380818ff2c4ceb7ab375dd6aa18596f55269889af34d395dbb2bddf4491b5a7c41aefe65b1be73a501d1c03f1711af1c4535df54446d774ca01f213ff01910a05e3542682768f258e1625e0a197f7f509c3cdd61524652759edd5206eb1339c858ab78a34e32dc3cb330cd619ec8478aa8a6e3c46181c6bfd396d63d7505fcaf9189719fbc8715fce2066e644952fcf146ae66fab35445d299e4d44060f4dc5c76993bf9388b22a0d43ae9b723bc265b2d258387928fce27696746ed5f25f65011089be5d8040c0bff0ffaf2e649f22853b38ec6b70c62e4a90e45afa0bc357ae7ad90c0cd0f9a1224a6d05c892a47e860e249e2af53c6b6016a9212ed7d2a897421971fc775e27804d4e4dd5116e180206a1a4e32f7283020baf73441a7a575110202222b2ee5a2011f18571439ffaf334445424f5b4d8487b1faeece0524f6208765fc840d3d11c864f219fc323da4ce07c30dd2800d3da350173b3fe49b2635a687fa09e177004f1b3f1d83d26905d380bfc8b266f87bcdb2adec175a8aa26dd386362992e92678061a312fc5444a2d3c2b73c0c3159280bb59303ed0f8fd91cc3d36f9ad687fc96b1984e9f607446c0ed6d5b5c4d6ac9728041c013ae25dcf77893157fd245ba2aa60823ac3c9e1930bddf05f6d7de37a6fd05529e67bf836e133c98e5cc0ac8c29bf9af8c8a9b4ed82ab4e2be8e02a2a2928def2640ced0d76c7162e5ab17642257435bcb24b27da2d15e39cf5dd78506f66cee3f4ca01581e38d36312ec21d1272d97a40d9041790e0372b6007dd09e7d6aca768e1419b669e17c7ecf0e5e65be20a29cc77481451947d8dfed6559ca75f8e9fad957f53a1956e85f87740ae154aa9ab30cd5b2ae26a9a0d1b2901982403080889e28721cdac49228a306f19bcaefbf493c2e3199e51a409282725ebb2ccfb7e99d9ff92090433b2b7ad1d2f04fd5fcbc8abf4438a73eb4e42e9414b032b234dc4ca70ea74f11545a5ccaa5c6e7fe506f8ece85fa8858573eb31239bca2b795baf7a27f301621d906c5e1dc3b52c2a926eb22cb17d609f328e6042655a86d9194c331195517f72923aebcc3cdf3f174bd0e764e32a9af6b5e4dd518836b458261c7b6161410498bdb43e819b35800444788e67b0c651a63ec4eb0f77c9bf0ef68afc6e62128bceacfba13a47e023c6faaee3c619e471c173a51c2cd4411a9f34e0f4b5fbe84345c60e74f84e5bb75eb04ace1b10405ef5ae608e214a1e39838b9bd4bc76ae5e444f6f7b48c1c54a29bf84d5f911f2ade92193d7dc02fda263f72b2b3b6baa5a4fe5f3b8c2226106673c8e8bc626597e81d56cbb54bf8b3d68342d8ca72b505f3ea6c3e95c0fe66a542daee5e5487a15ac96fb4099cb0d6112c5b897a534019e4c3ae54f82a910f10d757144e6e0242b3f64bc32f3f1fc7d2dc5ac779c60b63b9e7138f0126748da64905c0868c36b5c7bbdad35c078e7b2dabe66dbf2412473d38571a97ff497e715d16c184e0c310a44b2b2584c4becb2b059716170303005f4eafe9ed8c935f7725035adc100422c722633aec99bb085ea3d32b87206b330e3f31f51e7db76dc4e2a0f562c5634cbfa72da16db78606f1fc383531ce789e78c19d50a01db91d2d19e54359e83eb1bf78b445af18e5e68afd985a5c92186917030302172c4cc8ffe4658b5ab9f57383ec481daef6edeb8b2ef176a23e0305d37f1c8af52536b5bbe8e339b079881ffaca7ebd9ef3deb4c2c5b5c9b8847a8d9c2ab436bbcaddae027d0396821bc40314f51b00f904228a338a02607af2bc0eb3ae764fcee80cbe155941c1ad7e0d2b20efcec20b49abb30fd9a20f65a11d6e27729bbdd206ec082f953765a763a31968cb4c34355d071d677a409c31b35c2d101294c33664cd1c39292757e19d05fa6b5fb0c0c2c1e4ccc62c8315e61dd91a9c200c459e37612efe313334bb292a56d0665a2ffcc9fe3ade7943d8e6bede14fd6876327891493eae251ec57be177b893eb2ec8644435a106ba4202318448fc07fe821b622dce71405720e8ec1789f4a9ccf63f399d201831674201513b09ff27c3a2b89d13415f5343ab5c82495d692be6326e08faa4b90bf1bf09e5317ade350b2250b92e3750b87ef140fb3c6dbd72ec72ff91263c0221dda6c8327cccc5b903c554c7e431e87cd01c2c64f9c291b8687102305ff2c2ca1105ab00dc4c54cc035183da20294fc6a8712d0736de196a97bb38acdaf356ae1be2e686aac5eb04594c814f8bb93b83b28e59b8d51ec414d05b572c6c28e0aa6b8a8c0474c928b983f1a3a83e6ad9446f61cc1ced7b54e46d0db2133d6deb01eedfc6aca335d7d64519b601f7784ce9ba8f99387cf65a0f40dac80198795e178e5464a32bcc0c57a9e5a408adfea63680c7b9ccdb1c863d1df16a14f13afb5cafd14617030305536e49d346e03977f3e0053e968ba2d88969e3ad81a462d887e67a2a93dddfe2d7436e22781ceaf7e52c2eaf190c37c25e4bd16ed79a256b057086a49a8507841741f490f372b7fe5b75d97c1190c87da8be4e8785acb1572eba94f97abfc545d8850d709b4cc94b12b36bb9da53706fc1e7b6f3c5a0eb16af2693799659bbda0fd0ee8106d980d016eea154be5ec706749f58bafe3812ab8936b3ca2a35020935ee72f4f93a09b21aec5fb91d3f5b39331d51df4e7aa7b4230ff2de7cd567c53834d2b927ba2d54612422a127ae6ca89c9891968268983ccced3f92018371698d8cd681ce7a00c9c33fc0935aef41b7a57ffb7d89e7a3ebf24d23564a97643fd6d2ce9f5106cafb10edee21772a9456ea8b666f6c8cba750a518cbde33145df9b409cf74054595f47e4fd62521d49fd8b7a48c18693f4560d5997fc442cf1cb70983a4a3f506198da10cca030af9bf5ab3f9d4f0f39dd92cea13bee52d27f19cb03927042607b9be06bf2e53e5c4cc16eee7ed17b7700bcca4972e3f682f24a40cd3b19a514b2fc8d09551a29e6864b8cd852c245f9267422388176e0c4c83fe483d2b2f7398527022076ff9071d3fc206a4b22c0868523afc1390ee0094df37bebb8096baf93d95986b72065bbedbb38f32dcf32a62d2a717c959a59f990fc2de93a70dcc0f7593d52072c2b5f0e49996aae8239217ee732d341fdcd2d810be6ddddd22276c09a46ea1262b33dc342c9762f000eaaa4e8bf545e54bb2b998b5c76f9ac5a81298fc57f9f5e4ee7b925f8b134dfdfa08de3067584af0e86e8b9745955b4e0e209fc453c4a87ae62a482172636ed627982af9d80cf26749c9ec9d920054fb5042a7c0d46a0e6c010de55bdd699e8bfa62a690302ce956b9ad6ff9ff4653918be4eda472d4b61321eaa3ffefb43f0b430c65b8b9156ba2730bffa6899f5f03d3c3e76ced6d1cf7dff663b7555aa5a8fb589d7e61b4c1ee8c84deda3b80410f3045d5cd8c76180bdfcc159647d5594c7d921312568786b34d42896f18116fd86f3aa49c421188a09f77a7ade07ef0ef55cf85a1416f8aed111a179cce8c0068f26e101720793240eb1f4988108fc39b26e8ca5c87430c5e2faf77104fd2233e178359618190a280dda9d3f06e414d9098b97d093b573ae8b34b1fb38018294019415e5ca04a71269d28ccc29bdcbb2a41def67a512773b87f00e30f315897f20332ec9a02081472fb8a7a9dd0f9fbee92e7da301bd39c6ba7405994a551ea054a78fbe8183ba82fd93c300ea88e3c587740238cc7e9b6c03c4e66ce37a4b9fac14c2b49520c4c4ae90a8defce4f5050d5218dab0c7052ec7f191e438b290aa3884e39b9162731064e2129a8a4b92c710f3ada848854debbd30990fb5d10f494138f09ebc2918384348e7fc6eb04dde09fc90a1595199e90ebffaf0de390d8abf93ac0894f8f14a61c3915276df375a73d975937d82c60e719b90c139793bd416237ea5bb023f2917ef4c984fe8f62e5d2c2b2f354c8d12422901ec7727a150687e2fb56f4ccfa9c3d8d5c189c53f0a5a504a2bb54f2cf82980f832dde951025e731b2bda8caac33b773d1bbe77226b6bf643288f303d060834566b1abeff996789d27c8602a388b1564a0deee991e672b36232d08c09fb812604c32be9ea5e618ca3e03c174bbcb75ad210217c3241fa1b73edcc902bbddb9a0b57f64060b0156c4ca3ffd0f6c0a27b220c183cc2e4a6d70ed71930f0c3fe98ab82140df5ff0ac7ef3820edec0f8fde890a15045c1848b80f4bb0ac7e5bd03d8ab03b97c20dd404e485fae2e51827c8105c536948e309f0998dee252dce110c6c3ad93f0afd05467df874b0c7df80e19aaaefe02285a3e0eef41421ad6dd9a2450967f4b11d06df1a9e351490119bc099fff2592d1917030300e47867a00b245092c645c3d564267c357379cfb308045e64a1da1bb749dc0cf016baa8c725b2a87b569aa0c551fb3bb03eaffcece061248749c3be0ec8a01ce0cd7e0b03c97b2f5a836645e924cd91aacd7ae2685e2eaa1cab1bd4822236c9c8c86fa27e38bf73f64e0ba8e27998055aba324630dff541cbffbb71cd2e0b0ea788976535e4c5782e9b50fc61f549b2577ff31bfd7da9201da840a2da5aa93e8eb4191a665eb423f87ecbb3f731b8d43ce84c01ac68b8696babe333dd76fc5fbd9e51fe1c4da9e9d22a1217d6f262ed5767460c6bf6a65bafb7e85fcde2d1d3fd6a10f0cb9c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14827b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);

    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("00032b", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_for_not_invalid_root_cert() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = "d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8fa2d869e938a71a2cd1d1eed76c82c133408bf07d49f5e6a5768d518c8ae72c010316030100a10100009d03038f73f3532eb8b51bfb5f88dc2cf559eb728751d67e458dc067fc49e2062e52d50000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00204796db556e029e1b98b0e9be06d4c23ddde853c627f1dfc52b9e3103b5f1ca0b002d00020101002b0003020304160303005a020000560303c99f389e5ac8e8f3181e4804b70c89036be8d2cc7668e0c1649c78e66ce17fe800130100002e00330024001d00209cacd9c4e8bca9041188341a5bb347d1cc86012614432bcc192cd129d17d5c20002b000203041703030be7d99a04ada3091a4e87220816628a2f76033a4b3e5bb0d7c6515993d0dc6e49cc68bbe2724d973ab450c7e312cf513f9cd2577682873feef58531782bb90ce37aaeb62c1005568bf5d993c98510ce51099cf76cf73d9e54c33e16e747f97688d83b5b1d7274ae2b3eadff5e5d209f86c0af37b81a1ba00e3451397b8338ddba20ed634503f78ebf2dec7ef350b806d47c7e31c5748f2488322100171ca0313d0bd8c5460e896c664f3e593953e7fa6394430ba064c28d26686444ee4ea1eb67aced42070ba044bc999e9e6b56b9256407297bc79b6043cb92e4cf0bab84ec0755a0c5556d8ad7b622bccd3f3322ee0c16f7e3a7d17b5c82d80241e5045a400eaa4814835867db2858bb988797dac15f633c0aca926e5496b0c4572fb0947a85b7d4928db482a17b79052840cf080b0c25cd219da7301b2c766b88980626997448cf9ff696b90e8262852ded638b96e716b34af40d01785fe34c1de91739ab7cbfe7579fdb67bc7ffff1b187de962da204fcf0a00323ae125662f19f0e427c35383b81826e7a0bc7d89621d589e074ccc0470103d0c271394dda1f72ae52a61997754608a4ac42eeada12237a416968de797095792d7c26f1a0ae89c02ce9f88501d8474a4fb37aece4c696d504a265a3303f1af4e3641234ae8e6fab4a2f466eb43172a3d3a12ca714ebb5624bfe0433ed54b17ee90d8b5b5577e470db6bf1cda0a59f40c7f4872b766b9c8cfd27ee2d6be5d73f17aa92bc586b0da97ef2443d5d63140e45f621d4b88833fa2b9c34398ee2c4510ee3b5fa56008f2e05537486e4f0c6c3fb920b1d0724f92d1210213d5e0cf3fb4b090268243c2386a32d1d0294a52c00ba16db0418f2e4626ffd1f30d90c76aff0b1bd3250ed2fa9a437ce229bc673b506c1a017ec56b0d53e40f94020e44fa6bbd3f5b31e3aa3fbc741da5413a5c055ea2bf8a7f928054fc26a261813b5d2d247851b2a5df4aa3f577a5999342a77e9c35c811914e2a80eabe77018f7218b285b97f204849027bad55eb6d0d0746a3bc7790699dde1ff17e32fb26aa27b7f92022db3b12b65c290060de578a79d7de62fc4b16b43d8a1e1cc8f5290023a9b4021537c5fe488ce9d48aa596957c6588cb31f90653ac75d6b3c0d5beaf01064a9e6631aaa2fe0ccb2fe8296e99a5181af90e893e29ec5aeee44b568d5d78d445dab932843be6b0bae4e87e04fd0a574f7f63a3d7a9b311b99b5c824f20047453060e13d441edee8c12d0644c730e04eaa15fbb349c338861e5b67d8caa2df839a89283fade6b9ad4f3174b301e8e5a7550c720ba561cfaddf864259eac6465b955fe4c83ab9bcedd8509abc2c814be18c1045cb0c9ca08f154eac9baee5418b638ec2162da27515a85feb1c983a0c867650819f423d4fb27fd345d5ec63e463d07b484be14eca45eb9cdad05942d67a44b9e5966749b0a695c3c1cb9750ec3275b3d1193eef1eba4dcf9f2985877ab7c1c68c1a7985ec859f66ab2a7480c9fb24adba48b3b1a1e74b36b405c40cfbe0f3a2d9eb21b9c1074c42c633b90863d10d317db0ae7bee4523d1b7acc6310f1134d24f51cc4f4572bf0eaf097c470456c45c293aa3639e255853c9621d7555a759787b8819dc2e945927af9bdebd8a471116a40decad5ce0a45517954f97edbb760636958ef529f241fab7eda69c904c914090f915fc4fbdd4266a34f60642a01d3537616f7cc0739a1c07dd046048c6f55bf6a5f521cc957aa97bf9483a7512d41872b76b9573610b98b8874f77771c00ebc937d0c587989e7ea5b1c0b727b42100c26c3d808a811c2e57b3123f145eb035ba9a1bff4c555be2762cc1595e5797d081ba5897c260778932ffa694345059c35094f8e4b0235111fb916ee8527f7e38a73af562cb846ac55f1bd6e638021164a91c93acd15b2b90db95802406d8d3d6a7c8b6817dcd84eb4cdabedb162c827dfd86ea9525b4d21b8d350a8900d156fe896d76514cd75cda5080215093795bf8c15629af912aa8987a8fed60eb56ed17b0b2c14288f77db57b6f79dcf888b3407229ef2eacf950e138ac7b0a86f04dd27ed1863cfc4958d95349beb50ab4b1049413127a3071dfef124980cb738ef41435e8fa5c9b7d38cf274f48ace0bc73048e29c7fe1e22ae0b786d066eec46229779ef43fe34f4375edac2c2967ebe941c1f9c54c9456c9d2a134a7da80faf65ca3681045f81e4235cdde3a899b90d2519d49fccbaacd47380fe56ddc277b05293cb63fbe86459d9f0a887cf17e9d7b9c88c0ecb0be853ea9e7e83ebd78e10dd2396c50f76108cb6ef5cb9c6992cd20090c49b7c63ee258aa452b9fd507766c0b9ca0c512761ff2ce1acda26b07aaf35b4c1c4b695326f18205883014a3a456afbe1237b69f6a447e1b471e713da33c6ca333e2c76ba4edc521acd6aa7f9342b8c8da2e4b72c3b89497caf40a5eaf53398aada0630fb715fa328f261c9542d0d2a67f7548ecd76a6c3b46c965ffdfd926129b5a0e64048a3df4bac29440e2cf8c0a0d4dca25ff1df5bc0a683b32ed3e01f12710ad2875d644b47bc51d9de32d9754207aca629ab9bef6086a59d2cf789e04a38a854f586413ed0f2c634a88dab6d6dfd76e7cd02c314a765b727b049f3926cc53e6453c4d4bef9c7fa04f4abedd0b553752713453307a6b094b4249efab7d68590ce3c64ef3d7373c90951d611eed2c68d8734243e0f1464becf04fa6a4cd2a72ffd1a1069ecfeb1837732acd723dc3ee291c380818ff2c4ceb7ab375dd6aa18596f55269889af34d395dbb2bddf4491b5a7c41aefe65b1be73a501d1c03f1711af1c4535df54446d774ca01f213ff01910a05e3542682768f258e1625e0a197f7f509c3cdd61524652759edd5206eb1339c858ab78a34e32dc3cb330cd619ec8478aa8a6e3c46181c6bfd396d63d7505fcaf9189719fbc8715fce2066e644952fcf146ae66fab35445d299e4d44060f4dc5c76993bf9388b22a0d43ae9b723bc265b2d258387928fce27696746ed5f25f65011089be5d8040c0bff0ffaf2e649f22853b38ec6b70c62e4a90e45afa0bc357ae7ad90c0cd0f9a1224a6d05c892a47e860e249e2af53c6b6016a9212ed7d2a897421971fc775e27804d4e4dd5116e180206a1a4e32f7283020baf73441a7a575110202222b2ee5a2011f18571439ffaf334445424f5b4d8487b1faeece0524f6208765fc840d3d11c864f219fc323da4ce07c30dd2800d3da350173b3fe49b2635a687fa09e177004f1b3f1d83d26905d380bfc8b266f87bcdb2adec175a8aa26dd386362992e92678061a312fc5444a2d3c2b73c0c3159280bb59303ed0f8fd91cc3d36f9ad687fc96b1984e9f607446c0ed6d5b5c4d6ac9728041c013ae25dcf77893157fd245ba2aa60823ac3c9e1930bddf05f6d7de37a6fd05529e67bf836e133c98e5cc0ac8c29bf9af8c8a9b4ed82ab4e2be8e02a2a2928def2640ced0d76c7162e5ab17642257435bcb24b27da2d15e39cf5dd78506f66cee3f4ca01581e38d36312ec21d1272d97a40d9041790e0372b6007dd09e7d6aca768e1419b669e17c7ecf0e5e65be20a29cc77481451947d8dfed6559ca75f8e9fad957f53a1956e85f87740ae154aa9ab30cd5b2ae26a9a0d1b2901982403080889e28721cdac49228a306f19bcaefbf493c2e3199e51a409282725ebb2ccfb7e99d9ff92090433b2b7ad1d2f04fd5fcbc8abf4438a73eb4e42e9414b032b234dc4ca70ea74f11545a5ccaa5c6e7fe506f8ece85fa8858573eb31239bca2b795baf7a27f301621d906c5e1dc3b52c2a926eb22cb17d609f328e6042655a86d9194c331195517f72923aebcc3cdf3f174bd0e764e32a9af6b5e4dd518836b458261c7b6161410498bdb43e819b35800444788e67b0c651a63ec4eb0f77c9bf0ef68afc6e62128bceacfba13a47e023c6faaee3c619e471c173a51c2cd4411a9f34e0f4b5fbe84345c60e74f84e5bb75eb04ace1b10405ef5ae608e214a1e39838b9bd4bc76ae5e444f6f7b48c1c54a29bf84d5f911f2ade92193d7dc02fda263f72b2b3b6baa5a4fe5f3b8c2226106673c8e8bc626597e81d56cbb54bf8b3d68342d8ca72b505f3ea6c3e95c0fe66a542daee5e5487a15ac96fb4099cb0d6112c5b897a534019e4c3ae54f82a910f10d757144e6e0242b3f64bc32f3f1fc7d2dc5ac779c60b63b9e7138f0126748da64905c0868c36b5c7bbdad35c078e7b2dabe66dbf2412473d38571a97ff497e715d16c184e0c310a44b2b2584c4becb2b059716170303005f4eafe9ed8c935f7725035adc100422c722633aec99bb085ea3d32b87206b330e3f31f51e7db76dc4e2a0f562c5634cbfa72da16db78606f1fc383531ce789e78c19d50a01db91d2d19e54359e83eb1bf78b445af18e5e68afd985a5c92186917030302172c4cc8ffe4658b5ab9f57383ec481daef6edeb8b2ef176a23e0305d37f1c8af52536b5bbe8e339b079881ffaca7ebd9ef3deb4c2c5b5c9b8847a8d9c2ab436bbcaddae027d0396821bc40314f51b00f904228a338a02607af2bc0eb3ae764fcee80cbe155941c1ad7e0d2b20efcec20b49abb30fd9a20f65a11d6e27729bbdd206ec082f953765a763a31968cb4c34355d071d677a409c31b35c2d101294c33664cd1c39292757e19d05fa6b5fb0c0c2c1e4ccc62c8315e61dd91a9c200c459e37612efe313334bb292a56d0665a2ffcc9fe3ade7943d8e6bede14fd6876327891493eae251ec57be177b893eb2ec8644435a106ba4202318448fc07fe821b622dce71405720e8ec1789f4a9ccf63f399d201831674201513b09ff27c3a2b89d13415f5343ab5c82495d692be6326e08faa4b90bf1bf09e5317ade350b2250b92e3750b87ef140fb3c6dbd72ec72ff91263c0221dda6c8327cccc5b903c554c7e431e87cd01c2c64f9c291b8687102305ff2c2ca1105ab00dc4c54cc035183da20294fc6a8712d0736de196a97bb38acdaf356ae1be2e686aac5eb04594c814f8bb93b83b28e59b8d51ec414d05b572c6c28e0aa6b8a8c0474c928b983f1a3a83e6ad9446f61cc1ced7b54e46d0db2133d6deb01eedfc6aca335d7d64519b601f7784ce9ba8f99387cf65a0f40dac80198795e178e5464a32bcc0c57a9e5a408adfea63680c7b9ccdb1c863d1df16a14f13afb5cafd14617030305536e49d346e03977f3e0053e968ba2d88969e3ad81a462d887e67a2a93dddfe2d7436e22781ceaf7e52c2eaf190c37c25e4bd16ed79a256b057086a49a8507841741f490f372b7fe5b75d97c1190c87da8be4e8785acb1572eba94f97abfc545d8850d709b4cc94b12b36bb9da53706fc1e7b6f3c5a0eb16af2693799659bbda0fd0ee8106d980d016eea154be5ec706749f58bafe3812ab8936b3ca2a35020935ee72f4f93a09b21aec5fb91d3f5b39331d51df4e7aa7b4230ff2de7cd567c53834d2b927ba2d54612422a127ae6ca89c9891968268983ccced3f92018371698d8cd681ce7a00c9c33fc0935aef41b7a57ffb7d89e7a3ebf24d23564a97643fd6d2ce9f5106cafb10edee21772a9456ea8b666f6c8cba750a518cbde33145df9b409cf74054595f47e4fd62521d49fd8b7a48c18693f4560d5997fc442cf1cb70983a4a3f506198da10cca030af9bf5ab3f9d4f0f39dd92cea13bee52d27f19cb03927042607b9be06bf2e53e5c4cc16eee7ed17b7700bcca4972e3f682f24a40cd3b19a514b2fc8d09551a29e6864b8cd852c245f9267422388176e0c4c83fe483d2b2f7398527022076ff9071d3fc206a4b22c0868523afc1390ee0094df37bebb8096baf93d95986b72065bbedbb38f32dcf32a62d2a717c959a59f990fc2de93a70dcc0f7593d52072c2b5f0e49996aae8239217ee732d341fdcd2d810be6ddddd22276c09a46ea1262b33dc342c9762f000eaaa4e8bf545e54bb2b998b5c76f9ac5a81298fc57f9f5e4ee7b925f8b134dfdfa08de3067584af0e86e8b9745955b4e0e209fc453c4a87ae62a482172636ed627982af9d80cf26749c9ec9d920054fb5042a7c0d46a0e6c010de55bdd699e8bfa62a690302ce956b9ad6ff9ff4653918be4eda472d4b61321eaa3ffefb43f0b430c65b8b9156ba2730bffa6899f5f03d3c3e76ced6d1cf7dff663b7555aa5a8fb589d7e61b4c1ee8c84deda3b80410f3045d5cd8c76180bdfcc159647d5594c7d921312568786b34d42896f18116fd86f3aa49c421188a09f77a7ade07ef0ef55cf85a1416f8aed111a179cce8c0068f26e101720793240eb1f4988108fc39b26e8ca5c87430c5e2faf77104fd2233e178359618190a280dda9d3f06e414d9098b97d093b573ae8b34b1fb38018294019415e5ca04a71269d28ccc29bdcbb2a41def67a512773b87f00e30f315897f20332ec9a02081472fb8a7a9dd0f9fbee92e7da301bd39c6ba7405994a551ea054a78fbe8183ba82fd93c300ea88e3c587740238cc7e9b6c03c4e66ce37a4b9fac14c2b49520c4c4ae90a8defce4f5050d5218dab0c7052ec7f191e438b290aa3884e39b9162731064e2129a8a4b92c710f3ada848854debbd30990fb5d10f494138f09ebc2918384348e7fc6eb04dde09fc90a1595199e90ebffaf0de390d8abf93ac0894f8f14a61c3915276df375a73d975937d82c60e719b90c139793bd416237ea5bb023f2917ef4c984fe8f62e5d2c2b2f354c8d12422901ec7727a150687e2fb56f4ccfa9c3d8d5c189c53f0a5a504a2bb54f2cf82980f832dde951025e731b2bda8caac33b773d1bbe77226b6bf643288f303d060834566b1abeff996789d27c8602a388b1564a0deee991e672b36232d08c09fb812604c32be9ea5e618ca3e03c174bbcb75ad210217c3241fa1b73edcc902bbddb9a0b57f64060b0156c4ca3ffd0f6c0a27b220c183cc2e4a6d70ed71930f0c3fe98ab82140df5ff0ac7ef3820edec0f8fde890a15045c1848b80f4bb0ac7e5bd03d8ab03b97c20dd404e485fae2e51827c8105c536948e309f0998dee252dce110c6c3ad93f0afd05467df874b0c7df80e19aaaefe02285a3e0eef41421ad6dd9a2450967f4b11d06df1a9e351490119bc099fff2592d1917030300e47867a00b245092c645c3d564267c357379cfb308045e64a1da1bb749dc0cf016baa8c725b2a87b569aa0c551fb3bb03eaffcece061248749c3be0ec8a01ce0cd7e0b03c97b2f5a836645e924cd91aacd7ae2685e2eaa1cab1bd4822236c9c8c86fa27e38bf73f64e0ba8e27998055aba324630dff541cbffbb71cd2e0b0ea788976535e4c5782e9b50fc61f549b2577ff31bfd7da9201da840a2da5aa93e8eb4191a665eb423f87ecbb3f731b8d43ce84c01ac68b8696babe333dd76fc5fbd9e51fe1c4da9e9d22a1217d6f262ed5767460c6bf6a65bafb7e85fcde2d1d3fd6a10f0cb9c").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let cert: Vec<u8> = hex::decode("055b308205573082033fa003020102020d0203e5936f31b01349886ba217300d06092a864886f70d01010c05003047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205231301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f7420523130820222300d06092a864886f70d01010105000382020f003082020a0282020100b611028b1ee3a1779b3bdcbf943eb795a7403ca1fd82f97d32068271f6f68c7ffbe8dbbc6a2e9797a38c4bf92bf6b1f9ce841db1f9c597deefb9f2a3e9bc12895ea7aa52abf82327cba4b19c63dbd7997ef00a5eeb68a6f4c65a470d4d1033e34eb113a3c8186c4becfc0990df9d6429252307a1b4d23d2e60e0cfd20987bbcd48f04dc2c27a888abbbacf5919d6af8fb007b09e31f182c1c0df2ea66d6c190eb5d87e261a45033db079a49428ad0f7f26e5a808fe96e83c689453ee833a882b159609b2e07a8c2e75d69ceba756648f964f68ae3d97c2848fc0bc40c00b5cbdf687b3356cac18507f84e04ccd92d320e933bc5299af32b529b3252ab448f972e1ca64f7e682108de89dc28a88fa38668afc63f901f978fd7b5c77fa7687faecdfb10e799557b4bd26efd601d1eb160abb8e0bb5c5c58a55abd3acea914b29cc19a432254e2af16544d002ceaace49b4ea9f7c83b0407be743aba76ca38f7d8981fa4ca5ffd58ec3ce4be0b5d8b38e45cf76c0ed402bfd530fb0a7d53b0db18aa203de31adcc77ea6f7b3ed6df912212e6befad832fc1063145172de5dd61693bd296833ef3a66ec078a26df13d757657827de5e491400a2007f9aa821b6a9b195b0a5b90d1611dac76c483c40e07e0d5acd563cd19705b9cb4bed394b9cc43fd255136e24b0d671faf4c1bacced1bf5fe8141d800983d3ac8ae7a98371805950203010001a3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414e4af2b26711a2b4827852f52662ceff08913713e300d06092a864886f70d01010c050003820201009faa4226db0b9bbeff1e96922e3ea2654a6a98ba22cb7dc13ad8820a06c6f6a5dec04e876679a1f9a6589caaf9b5e660e7e0e8b11e4241330b373dce897015cab524a8cf6bb5d2402198cf2234cf3bc52284e0c50e8a7c5d88e43524ce9b3e1a541e6edbb287a7fcf3fa815514620a59a92205313e82d6eedb5734bc3395d3171be827a28b7b4e261a7a5a64b6d1ac37f1fda0f338ec72f011759dcb34528de6766b17c6df86ab278e492b7566811021a6ea3ef4ae25ff7c15dece8c253fca62700af72f096607c83f1cfcf0db4530df6288c1b50f9dc39f4ade595947c5872236e682a7ed0ab9e207a08d7b7a4a3c71d2e203a11f3207dd1be442ce0c00456180b50b20592978bdf955cb63c53c4cf4b6ffdb6a5f316b999e2cc16b50a4d7e61814bd853f67ab469fa0ff42a73a7f5ccb5db0701d2b34f5d476090ceb784c5905f33342c36115101b774dce228cd485f2457db753eaef405a940a5c205f4e405d622276dfffce61bd8c2378d23702e08eded1113789f6bfed490762ae92ec401aaf1409d9d04eb2a2f7beeeeed8ffdc1a2ddeb83671e2fc79b79425d148735ba135e7b3996775c1193a2b474ed3428efd31c81666dad20c3cdbb38ec9a10d800f7b167714bfffdb0994b293bc205815e9db7143f3de10c300dca82a95b6c2d63f906b76db6cfe8cbcf270350cdc991935dcd7c84663d53671ae57fbb7826ddc").unwrap();

    let cell = TokenValue::write_bytes(&cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);

    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000327", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

#[test]
fn test_tls_wasm_from_hash_for_google_too_short_tls_data() {
    let elector_code = load_boc("benches/elector-code.boc");
    let elector_data = load_boc("benches/elector-data.boc");
    let config_data = load_boc("benches/config-data.boc");

    let mut ctrls = SaveList::default();
    ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
    let params = vec![
        StackItem::int(0x76ef1ea),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(1633458077),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::int(0),
        StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
        StackItem::slice(
            SliceData::from_string(
                "9fe0000000000000000000000000000000000000000000000000000000000000001_",
            )
            .unwrap(),
        ),
        StackItem::cell(config_data.reference(0).unwrap()),
        StackItem::None,
        StackItem::int(0),
    ];
    ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();

    let stack = Stack::new();

    let mut engine = Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
        SliceData::load_cell_ref(&elector_code).unwrap(),
        Some(ctrls.clone()),
        Some(stack.clone()),
        None,
        vec![],
    );
    engine.wasm_engine_init_cached().unwrap();

    let hash_str = //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11"; 
    //"25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
    "d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
    let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
    let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
    let hash: Vec<u8> = (0..hash_str.len())
        .step_by(2)
        .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
        .collect::<Vec<u8>>();
    let cell =
        TokenValue::write_bytes(hash.as_slice(), &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let tls_data: Vec<u8> = hex::decode("8fa2d869").unwrap();

    let cell = TokenValue::write_bytes(&tls_data, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let cert: Vec<u8> = hex::decode("020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943").unwrap();

    let cell = TokenValue::write_bytes(&cert, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let lv_kid: Vec<u8> = hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();

    let cell = TokenValue::write_bytes(&lv_kid, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let current_timestamp = Utc::now().timestamp() as u32;
    let mut timestamp: Vec<u8> = Vec::new();
    append_uint32(&mut timestamp, current_timestamp);

    // let timestamp: Vec<u8> = vec![0, 0, 3, 232];
    let cell = TokenValue::write_bytes(&timestamp, &ABI_VERSION_2_4).unwrap().into_cell().unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));

    // Push args, func name, instance name, then wasm.
    let wasm_func = "tlscheck";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
    let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
    engine.cc.stack.push(StackItem::cell(cell.clone()));
    let wasm_dict = Vec::<u8>::new();

    let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
        .unwrap()
        .into_cell()
        .unwrap();

    engine.cc.stack.push(StackItem::cell(cell.clone()));

    let start = std::time::Instant::now();
    let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
    let t = start.elapsed().as_micros();
    println!("Wasm Return Status: {:?}", status);
    println!("Time: {:?}", t);

    let res = engine.cc.stack.get(0).as_cell().unwrap(); //engine.cc.stack.get(0).as_slice().unwrap().clone();
    let slice = SliceData::load_cell(res.clone()).unwrap();
    let ress = unpack_data_from_cell(slice, &mut engine).unwrap();

    assert_eq!("000321", hex::encode(ress.clone()));

    println!("ress: {:?}", hex::encode(ress));
}

// #[test]
// fn test_tls_wasm_from_hash_for_google_spoiled_tls_data() {
// let elector_code = load_boc("benches/elector-code.boc");
// let elector_data = load_boc("benches/elector-data.boc");
// let config_data = load_boc("benches/config-data.boc");
//
// let mut ctrls = SaveList::default();
// ctrls.put(4, &mut StackItem::Cell(elector_data)).unwrap();
// let params = vec![
// StackItem::int(0x76ef1ea),
// StackItem::int(0),
// StackItem::int(0),
// StackItem::int(1633458077),
// StackItem::int(0),
// StackItem::int(0),
// StackItem::int(0),
// StackItem::tuple(vec![StackItem::int(1000000000), StackItem::None]),
// StackItem::slice(
// SliceData::from_string(
// "9fe0000000000000000000000000000000000000000000000000000000000000001_",
// )
// .unwrap(),
// ),
// StackItem::cell(config_data.reference(0).unwrap()),
// StackItem::None,
// StackItem::int(0),
// ];
// ctrls.put(7, &mut StackItem::tuple(vec![StackItem::tuple(params)])).unwrap();
//
// let stack = Stack::new();
//
// let mut engine =
// Engine::with_capabilities(DEFAULT_CAPABILITIES).setup_with_libraries(
// SliceData::load_cell_ref(&elector_code).unwrap(),
// Some(ctrls.clone()),
// Some(stack.clone()),
// None,
// vec![],
// );
// engine.wasm_engine_init_cached().unwrap();
//
// let hash_str =
// //"f45dae3df26f2a45f006bd7e7d32f426e240dfd1391669953688cb40886aff11";
// "25dc3d80d7e4d8f27dfadc9c2faf9cf2d8dea0a9e08a692da2db7e34d74d66e1";
// "f6b0cc30d023d266819b16dafa5a6a6ad25b97246bbbca80abac2df974939b87";
// "d4a067079c3ff4e0b0b6f579ef2d1b9a1d8fc21a0076162503ff46a6e8fca2e5";
// let _ = engine.add_wasm_hash_to_whitelist_by_str(hash_str.to_owned());
// let mut engine = engine.precompile_all_wasm_by_hash().unwrap();
// let hash: Vec<u8> = (0..hash_str.len())
// .step_by(2)
// .map(|i| u8::from_str_radix(&hash_str[i..i + 2], 16).unwrap())
// .collect::<Vec<u8>>();
// let cell =
// TokenValue::write_bytes(hash.as_slice(),
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// let tls_data: Vec<u8> =
// hex::decode("
// 8fa2d869e938a71a2cd1d1eed76c82c133408bf07d49f5e6a5768d518c8ae72c010316030100a10100009d03038f73f3532eb8b51bfb5f88dc2cf559eb728751d67e458dc067fc49e2062e52d50000021301010000720000001700150000127777772e676f6f676c65617069732e636f6d000a00040002001d000d00140012040308040401050308050501080606010201003300260024001d00204796db556e029e1b98b0e9be06d4c23ddde853c627f1dfc52b9e3103b5f1ca0b002d00020101002b0003020304160303005a020000560303c99f389e5ac8e8f3181e4804b70c89036be8d2cc7668e0c1649c78e66ce17fe800130100002e00330024001d00209cacd9c4e8bca9041188341a5bb347d1cc86012614432bcc192cd129d17d5c20002b000203041703030be7d99a04ada3091a4e87220816628a2f76033a4b3e5bb0d7c6515993d0dc6e49cc68bbe2724d973ab450c7e312cf513f9cd2577682873feef58531782bb90ce37aaeb62c1005568bf5d993c98510ce51099cf76cf73d9e54c33e16e747f97688d83b5b1d7274ae2b3eadff5e5d209f86c0af37b81a1ba00e3451397b8338ddba20ed634503f78ebf2dec7ef350b806d47c7e31c5748f2488322100171ca0313d0bd8c5460e896c664f3e593953e7fa6394430ba064c28d26686444ee4ea1eb67aced42070ba044bc999e9e6b56b9256407297bc79b6043cb92e4cf0bab84ec0755a0c5556d8ad7b622bccd3f3322ee0c16f7e3a7d17b5c82d80241e5045a400eaa4814835867db2858bb988797dac15f633c0aca926e5496b0c4572fb0947a85b7d4928db482a17b79052840cf080b0c25cd219da7301b2c766b88980626997448cf9ff696b90e8262852ded638b96e716b34af40d01785fe34c1de91739ab7cbfe7579fdb67bc7ffff1b187de962da204fcf0a00323ae125662f19f0e427c35383b81826e7a0bc7d89621d589e074ccc0470103d0c271394dda1f72ae52a61997754608a4ac42eeada12237a416968de797095792d7c26f1a0ae89c02ce9f88501d8474a4fb37aece4c696d504a265a3303f1af4e3641234ae8e6fab4a2f466eb43172a3d3a12ca714ebb5624bfe0433ed54b17ee90d8b5b5577e470db6bf1cda0a59f40c7f4872b766b9c8cfd27ee2d6be5d73f17aa92bc586b0da97ef2443d5d63140e45f621d4b88833fa2b9c34398ee2c4510ee3b5fa56008f2e05537486e4f0c6c3fb920b1d0724f92d1210213d5e0cf3fb4b090268243c2386a32d1d0294a52c00ba16db0418f2e4626ffd1f30d90c76aff0b1bd3250ed2fa9a437ce229bc673b506c1a017ec56b0d53e40f94020e44fa6bbd3f5b31e3aa3fbc741da5413a5c055ea2bf8a7f928054fc26a261813b5d2d247851b2a5df4aa3f577a5999342a77e9c35c811914e2a80eabe77018f7218b285b97f204849027bad55eb6d0d0746a3bc7790699dde1ff17e32fb26aa27b7f92022db3b12b65c290060de578a79d7de62fc4b16b43d8a1e1cc8f5290023a9b4021537c5fe488ce9d48aa5957c6588cb31f90653ac75d6b3c0d5beaf01064a9e6631aaa2fe0ccb2fe8296e99a5181af90e893e29ec5aeee44b568d5d78d445dab932843be6b0bae4e87e04fd0a574f7f63a3d7a9b311b99b5c824f20047453060e13d441edee8c12d0644c730e04eaa15fbb349c338861e5b67d8caa2df839a89283fade6b9ad4f3174b301e8e5a7550c720ba561cfaddf864259eac6465b955fe4c83ab9bcedd8509abc2c814be18c1045cb0c9ca08f154eac9baee5418b638ec2162da27515a85feb1c983a0c867650819f423d4fb27fd345d5ec63e463d07b484be14eca45eb9cdad05942d67a44b9e5966749b0a695c3c1cb90ec3275b3d1193eef1eba4dcf9f2985877ab7c1c68c1a7985ec859f66ab2a7480c9fb24adba48b3b1a1e74b36b405c40cfbe0f3a2d9eb21b9c1074c42c633b90863d10d317db0ae7bee4523d1b7acc6310f1134d24f51cc4f4572bf0eaf097c470456c45c293aa3639e255853c9621d7555a759787b8819dc2e945927af9bdebd8a471116a40decad5ce0a45517954f97edbb760636958ef529f241fab7eda69c904c914090f915fc4fbdd4266a34f60642a01d3537616f7cc0739a1c07dd046048c6f55bf6a5f521cc957aa97bf9483a7512d41872b76b9573610b98b8874f77771c00ebc937d0c587989e7ea5b1c0b727b42100c26c3d808a811c2e57b3123f145eb035ba9a1bff4c555be2762cc1595e5797d081ba5897c260778932ffa694345059c35094f8e4b0235111fb916ee8527f7e38a73af562cb846ac55f1bd6e638021164a91c93acd15b2b90db95802406d8d3d6a7c8b6817dcd84eb4cdabedb162c827dfd86ea9525b4d21b8d350a8900d156fe896d76514cd75cda5080215093795bf8c15629af912aa8987a8fed60eb56ed17b0b2c14288f77db57b6f79dcf888b3407229ef2eacf950e138ac7b0a86f04dd27ed1863cfc4958d95349beb50ab4b1049413127a3071dfef124980cb738ef41435e8fa5c9b7d38cf274f48ace0bc73048e29c7fe1e22ae0b786d066eec46229779ef43fe34f4375edac2c2967ebe941c1f9c54c9456c9d2a134a7da80faf65ca3681045f81e4235cdde3a899b90d2519d49fccbaacd47380fe56ddc277b05293cb63fbe86459d9f0a887cf17e9d7b9c88c0ecb0be853ea9e7e83ebd78e10dd2396c50f76108cb6ef5cb9c6992cd20090c49b7c63ee258aa452b9fd507766c0b9ca0c512761ff2ce1acda26b07aaf35b4c1c4b695326f18205883014a3a456afbe1237b69f6a447e1b471e713da33c6ca333e2c76ba4edc521acd6aa7f9342b8c8da2e4b72c3b89497caf40a5eaf53398aada0630fb715fa328f261c9542d0d2a67f7548ecd76a6c3b46c965ffdfd926129b5a0e64048a3df4bac29440e2cf8c0a0d4dca25ff1df5bc0a683b32ed3e01f12710ad2875d644b47bc51d9de32d9754207aca629ab9bef6086a59d2cf789e04a38a854f586413ed0f2c634a88dab6d6dfd76e7cd02c314a765b727b049f3926cc53e6453c4d4bef9c7fa04f4abedd0b553752713453307a6b094b4249efab7d68590ce3c64ef3d7373c90951d611eed2c68d8734243e0f1464becf04fa6a4cd2a72ffd1a1069ecfeb1837732acd723dc3ee291c380818ff2c4ceb7ab375dd6aa18596f55269889af34d395dbb2bddf4491b5a7c41aefe65b1be73a501d1c03f1711af1c4535df54446d774ca01f213ff01910a05e3542682768f258e1625e0a197f7f509c3cdd61524652759edd5206eb1339c858ab78a34e32dc3cb330cd619ec8478aa8a6e3c46181c6bfd396d63d7505fcaf9189719fbc8715fce2066e644952fcf146ae66fab35445d299e4d44060f4dc5c76993bf9388b22a0d43ae9b723bc265b2d258387928fce27696746ed5f25f65011089be5d8040c0bff0ffaf2e649f22853b38ec6b70c62e4a90e45afa0bc357ae7ad90c0cd0f9a1224a6d05c892a47e860e249e2af53c6b6016a9212ed7d2a897421971fc775e27804d4e4dd5116e180206a1a4e32f7283020baf73441a7a575110202222b2ee5a2011f18571439ffaf334445424f5b4d8487b1faeece0524f6208765fc840d3d11c864f219fc323da4ce07c30dd2800d3da350173b3fe49b2635a687fa09e177004f1b3f1d83d26905d380bfc8b266f87bcdb2adec175a8aa26dd386362992e92678061a312fc5444a2d3c2b73c0c3159280bb59303ed0f8fd91cc3d36f9ad687fc96b1984e9f607446c0ed6d5b5c4d6ac9728041c013ae25dcf77893157fd245ba2aa60823ac3c9e1930bddf05f6d7de37a6fd05529e67bf836e133c98e5cc0ac8c29bf9af8c8a9b4ed82ab4e2be8e02a2a2928def2640ced0d76c7162e5ab17642257435bcb24b27da2d15e39cf5dd78506f66cee3f4ca01581e38d36312ec21d1272d97a40d9041790e0372b6007dd09e7d6aca768e1419b669e17c7ecf0e5e65be20a29cc77481451947d8dfed6559ca75f8e9fad957f53a1956e85f87740ae154aa9ab30cd5b2ae26a9a0d1b2901982403080889e28721cdac49228a306f19bcaefbf493c2e3199e51a409282725ebb2ccfb7e99d9ff92090433b2b7ad1d2f04fd5fcbc8abf4438a73eb4e42e9414b032b234dc4ca70ea74f11545a5ccaa5c6e7fe506f8ece85fa8858573eb31239bca2b795baf7a27f301621d906c5e1dc3b52c2a926eb22cb17d609f328e6042655a86d9194c331195517f72923aebcc3cdf3f174bd0e764e32a9af6b5e4dd518836b458261c7b6161410498bdb43e819b35800444788e67b0c651a63ec4eb0f77c9bf0ef68afc6e62128bceacfba13a47e023c6faaee3c619e471c173a51c2cd4411a9f34e0f4b5fbe84345c60e74f84e5bb75eb04ace1b10405ef5ae608e214a1e39838b9bd4bc76ae5e444f6f7b48c1c54a29bf84d5f911f2ade92193d7dc02fda263f72b2b3b6baa5a4fe5f3b8c2226106673c8e8bc626597e81d56cbb54bf8b3d68342d8ca72b505f3ea6c3e95c0fe66a542daee5e5487a15ac96fb4099cb0d6112c5b897a534019e4c3ae54f82a910f10d757144e6e0242b3f64bc32f3f1fc7d2dc5ac779c60b63b9e7138f0126748da64905c0868c36b5c7bbdad35c078e7b2dabe66dbf2412473d38571a97ff497e715d16c184e0c310a44b2b2584c4becb2b059716170303005f4eafe9ed8c935f7725035adc100422c722633aec99bb085ea3d32b87206b330e3f31f51e7db76dc4e2a0f562c5634cbfa72da16db78606f1fc383531ce789e78c19d50a01db91d2d19e54359e83eb1bf78b445af18e5e68afd985a5c92186917030302172c4cc8ffe4658b5ab9f57383ec481daef6edeb8b2ef176a23e0305d37f1c8af52536b5bbe8e339b079881ffaca7ebd9ef3deb4c2c5b5c9b8847a8d9c2ab436bbcaddae027d0396821bc40314f51b00f904228a338a02607af2bc0eb3ae764fcee80cbe155941c1ad7e0d2b20efcec20b49abb30fd9a20f65a11d6e27729bbdd206ec082f953765a763a31968cb4c34355d071d677a409c31b35c2d101294c33664cd1c39292757e19d05fa6b5fb0c0c2c1e4ccc62c8315e61dd91a9c200c459e37612efe313334bb292a56d0665a2ffcc9fe3ade7943d8e6bede14fd6876327891493eae251ec57be177b893eb2ec8644435a106ba4202318448fc07fe821b622dce71405720e8ec1789f4a9ccf63f399d201831674201513b09ff27c3a2b89d13415f5343ab5c82495d692be6326e08faa4b90bf1bf09e5317ade350b2250b92e3750b87ef140fb3c6dbd72ec72ff91263c0221dda6c8327cccc5b903c554c7e431e87cd01c2c64f9c291b8687102305ff2c2ca1105ab00dc4c54cc035183da20294fc6a8712d0736de196a97bb38acdaf356ae1be2e686aac5eb04594c814f8bb93b83b28e59b8d51ec414d05b572c6c28e0aa6b8a8c0474c928b983f1a3a83e6ad9446f61cc1ced7b54e46d0db2133d6deb01eedfc6aca335d7d64519b601f7784ce9ba8f99387cf65a0f40dac80198795e178e5464a32bcc0c57a9e5a408adfea63680c7b9ccdb1c863d1df16a14f13afb5cafd14617030305536e49d346e03977f3e0053e968ba2d88969e3ad81a462d887e67a2a93dddfe2d7436e22781ceaf7e52c2eaf190c37c25e4bd16ed79a256b057086a49a8507841741f490f372b7fe5b75d97c1190c87da8be4e8785acb1572eba94f97abfc545d8850d709b4cc94b12b36bb9da53706fc1e7b6f3c5a0eb16af2693799659bbda0fd0ee8106d980d016eea154be5ec706749f58bafe3812ab8936b3ca2a35020935ee72f4f93a09b21aec5fb91d3f5b39331d51df4e7aa7b4230ff2de7cd567c53834d2b927ba2d54612422a127ae6ca89c9891968268983ccced3f92018371698d8cd681ce7a00c9c33fc0935aef41b7a57ffb7d89e7a3ebf24d23564a97643fd6d2ce9f5106cafb10edee21772a9456ea8b666f6c8cba750a518cbde33145df9b409cf74054595f47e4fd62521d49fd8b7a48c18693f4560d5997fc442cf1cb70983a4a3f506198da10cca030af9bf5ab3f9d4f0f39dd92cea13bee52d27f19cb03927042607b9be06bf2e53e5c4cc16eee7ed17b7700bcca4972e3f682f24a40cd3b19a514b2fc8d09551a29e6864b8cd852c245f9267422388176e0c4c83fe483d2b2f7398527022076ff9071d3fc206a4b22c0868523afc1390ee0094df37bebb8096baf93d95986b72065bbedbb38f32dcf32a62d2a717c959a59f990fc2de93a70dcc0f7593d52072c2b5f0e49996aae8239217ee732d341fdcd2d810be6ddddd22276c09a46ea1262b33dc342c9762f000eaaa4e8bf545e54bb2b998b5c76f9ac5a81298fc57f9f5e4ee7b925f8b134dfdfa08de3067584af0e86e8b9745955b4e0e209fc453c4a87ae62a482172636ed627982af9d80cf26749c9ec9d920054fb5042a7c0d46a0e6c010de55bdd699e8bfa62a690302ce956b9ad6ff9ff4653918be4eda472d4b61321eaa3ffefb43f0b430c65b8b9156ba2730bffa6899f5f03d3c3e76ced6d1cf7dff663b7555aa5a8fb589d7e61b4c1ee8c84deda3b80410f3045d5cd8c76180bdfcc159647d5594c7d921312568786b34d42896f18116fd86f3aa49c421188a09f77a7ade07ef0ef55cf85a1416f8aed111a179cce8c0068f26e101720793240eb1f4988108fc39b26e8ca5c87430c5e2faf77104fd2233e178359618190a280dda9d3f06e414d9098b97d093b573ae8b34b1fb38018294019415e5ca04a71269d28ccc29bdcbb2a41def67a512773b87f00e30f315897f20332ec9a02081472fb8a7a9dd0f9fbee92e7da301bd39c6ba7405994a551ea054a78fbe8183ba82fd93c300ea88e3c587740238cc7e9b6c03c4e66ce37a4b9fac14c2b49520c4c4ae90a8defce4f5050d5218dab0c7052ec7f191e438b290aa3884e39b9162731064e2129a8a4b92c710f3ada848854debbd30990fb5d10f494138f09ebc2918384348e7fc6eb04dde09fc90a1595199e90ebffaf0de390d8abf93ac0894f8f14a61c3915276df375a73d975937d82c60e719b90c139793bd416237ea5bb023f2917ef4c984fe8f62e5d2c2b2f354c8d12422901ec7727a150687e2fb56f4ccfa9c3d8d5c189c53f0a5a504a2bb54f2cf82980f832dde951025e731b2bda8caac33b773d1bbe77226b6bf643288f303d060834566b1abeff996789d27c8602a388b1564a0deee991e672b36232d08c09fb812604c32be9ea5e618ca3e03c174bbcb75ad210217c3241fa1b73edcc902bbddb9a0b57f64060b0156c4ca3ffd0f6c0a27b220c183cc2e4a6d70ed71930f0c3fe98ab82140df5ff0ac7ef3820edec0f8fde890a15045c1848b80f4bb0ac7e5bd03d8ab03b97c20dd404e485fae2e51827c8105c536948e309f0998dee252dce110c6c3ad93f0afd05467df874b0c7df80e19aaaefe02285a3e0eef41421ad6dd9a2450967f4b11d06df1a9e351490119bc099fff2592d1917030300e47867a00b245092c645c3d564267c357379cfb308045e64a1da1bb749dc0cf016baa8c725b2a87b569aa0c551fb3bb03eaffcece061248749c3be0ec8a01ce0cd7e0b03c97b2f5a836645e924cd91aacd7ae2685e2eaa1cab1bd4822236c9c8c86fa27e38bf73f64e0ba8e27998055aba324630dff541cbffbb71cd2e0b0ea788976535e4c5782e9b50fc61f549b2577ff31bfd7da9201da840a2da5aa93e8eb4191a665eb423f87ecbb3f731b8d43ce84c01ac68b8696babe333dd76fc5fbd9e51fe1c4da9e9d22a1217d6f262ed5767460c6bf6a65bafb7e85fcde2d1d3fd6a10f0cb9c"
// ).unwrap();
//
// let cell = TokenValue::write_bytes(&tls_data,
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// let cert: Vec<u8> =
// hex::decode("
// 020d308202093082018ea003020102020d0203e5c068ef631a9c72905052300a06082a8648ce3d0403033047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f74205234301e170d3136303632323030303030305a170d3336303632323030303030305a3047310b300906035504061302555331223020060355040a1319476f6f676c65205472757374205365727669636573204c4c43311430120603550403130b47545320526f6f742052343076301006072a8648ce3d020106052b8104002203620004f37473a7688b60ae43b835c581307b4b499dfbc161cee6de46bd6bd5611835ae40dd73f78991305aeb3cee857ca240763ba9c6b847d82ae792916a73e9b172399f299fa298d35f5e5886650fa1846506d1dc8bc9c773c88c6a2fe5c4abd11d8aa3423040300e0603551d0f0101ff040403020186300f0603551d130101ff040530030101ff301d0603551d0e04160414804cd6eb74ff4936a3d5d8fcb53ec56af0941d8c300a06082a8648ce3d0403030369003066023100e840ff83de03f49fae1d7aa72eb9af4ff6831d0e2d85011dd1d96aec0fc2afc75e565e5cd51c5822280bf730b62fb17c023100f0613ca7f4a082e321d5841d73869c2dafca349bf19fb92336e2bc60039d80b39a56c8e1e2bb1479cacd21d494b54943"
// ).unwrap();
//
// let cell = TokenValue::write_bytes(&cert,
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// let lv_kid: Vec<u8> =
// hex::decode("14927b8fb67bbad77445e5fea4c71aa9846d7ddd01").unwrap();
//
// let cell = TokenValue::write_bytes(&lv_kid,
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// let current_timestamp = Utc::now().timestamp() as u32;
// let mut timestamp: Vec<u8> = Vec::new();
// append_uint32(&mut timestamp, current_timestamp);
//
// let timestamp: Vec<u8> = vec![0, 0, 3, 232];
// let cell = TokenValue::write_bytes(&timestamp,
// &ABI_VERSION_2_4).unwrap().into_cell().unwrap(); engine.cc.stack.
// push(StackItem::cell(cell.clone()));
//
// Push args, func name, instance name, then wasm.
// let wasm_func = "tlscheck";
// let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
// engine.cc.stack.push(StackItem::cell(cell.clone()));
// let wasm_func = "docs:tlschecker/tls-check-interface@0.1.0";
// let cell = pack_data_to_cell(&wasm_func.as_bytes(), &mut engine).unwrap();
// engine.cc.stack.push(StackItem::cell(cell.clone()));
// let wasm_dict = Vec::<u8>::new();
//
// let cell = TokenValue::write_bytes(&wasm_dict.as_slice(), &ABI_VERSION_2_4)
// .unwrap()
// .into_cell()
// .unwrap();
//
// engine.cc.stack.push(StackItem::cell(cell.clone()));
//
// let start = std::time::Instant::now();
// let status = execute_run_wasm_concat_multiarg(&mut engine).unwrap();
// let t = start.elapsed().as_micros();
// println!("Wasm Return Status: {:?}", status);
// println!("Time: {:?}", t);
//
// let res = engine.cc.stack.get(0).as_cell().unwrap();
// //engine.cc.stack.get(0).as_slice().unwrap().clone(); let slice =
// SliceData::load_cell(res.clone()).unwrap(); let ress =
// unpack_data_from_cell(slice, &mut engine).unwrap();
//
// assert_eq!("0100000000689fabf7ab8e1f759972f2594613044e4a197c71d4f3f541d7e2afaba98838c6d2e031e330e2fb0805dd8ea233cc05ae3d1d52ea11d0db3ae013e30b1f71808448606f90fb06a56215f57ad962829f36187e345c60153a92f9169f9de61ee7feb5dc6eaadd908e93790c729ab17a3ee9276f51cb0081e5a7d03dd76717ca596bdfc183fe5309d70b1b9cbce2757448b8577d9d1a00c30f56de34e5524255c8a51b0bcfa5d7661dfab69b7ed0e200629687635e769f43a8b2b0251d23da93753dde5b8873898500c85ea72ad05c9b3c1d014106ff21b12495051c87ed593fdc963578a73023b3390e88c39a3941ae443be09fff2a4d1a36c64c2e439ca82bb1dea584f325", hex::encode(ress.clone()));
//
// println!("ress: {:?}", hex::encode(ress));
// }
